function K(e,t,r){function n(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:i,traits:new Set},enumerable:!1}),a._zod.traits.has(e))return;a._zod.traits.add(e),t(a,c);const u=i.prototype,l=Object.keys(u);for(let f=0;f<l.length;f++){const h=l[f];h in a||(a[h]=u[h].bind(a))}}const o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class go extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ig extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Og={};function fn(e){return Og}function Ng(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,o])=>t.indexOf(+n)===-1).map(([n,o])=>o)}function Mu(e,t){return typeof t=="bigint"?t.toString():t}function ka(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Pl(e){return e==null}function Ll(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function mE(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}const s=r>o?r:o,i=Number.parseInt(e.toFixed(s).replace(".","")),a=Number.parseInt(t.toFixed(s).replace(".",""));return i%a/10**s}const wh=Symbol("evaluating");function pe(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==wh)return n===void 0&&(n=wh,n=r()),n},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function Wn(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function wn(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function vh(e){return JSON.stringify(e)}function gE(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Cg="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function ls(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const yE=ka(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function So(e){if(ls(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const r=t.prototype;return!(ls(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function Pg(e){return So(e)?{...e}:Array.isArray(e)?[...e]:e}const wE=new Set(["string","number","symbol"]);function xo(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function vn(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function te(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function vE(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const bE={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function _E(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const s=wn(e._zod.def,{get shape(){const i={};for(const a in t){if(!(a in r.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&(i[a]=r.shape[a])}return Wn(this,"shape",i),i},checks:[]});return vn(e,s)}function EE(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const s=wn(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const a in t){if(!(a in r.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&delete i[a]}return Wn(this,"shape",i),i},checks:[]});return vn(e,s)}function $E(e,t){if(!So(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0){const s=e._zod.def.shape;for(const i in t)if(Object.getOwnPropertyDescriptor(s,i)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const o=wn(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return Wn(this,"shape",s),s}});return vn(e,o)}function SE(e,t){if(!So(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r=wn(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t};return Wn(this,"shape",n),n}});return vn(e,r)}function xE(e,t){const r=wn(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Wn(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return vn(e,r)}function kE(e,t,r){const o=t._zod.def.checks;if(o&&o.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const i=wn(t._zod.def,{get shape(){const a=t._zod.def.shape,c={...a};if(r)for(const u in r){if(!(u in a))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(c[u]=e?new e({type:"optional",innerType:a[u]}):a[u])}else for(const u in a)c[u]=e?new e({type:"optional",innerType:a[u]}):a[u];return Wn(this,"shape",c),c},checks:[]});return vn(t,i)}function RE(e,t,r){const n=wn(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return Wn(this,"shape",s),s}});return vn(t,n)}function co(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function uo(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Ps(e){return typeof e=="string"?e:e?.message}function dn(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const o=Ps(e.inst?._zod.def?.error?.(e))??Ps(t?.error?.(e))??Ps(r.customError?.(e))??Ps(r.localeError?.(e))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function Ul(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function fs(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const Lg=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Mu,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ug=K("$ZodError",Lg),zg=K("$ZodError",Lg,{Parent:Error});function TE(e,t=r=>r.message){const r={},n=[];for(const o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}}function AE(e,t=r=>r.message){const r={_errors:[]},n=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>n({issues:i}));else if(s.code==="invalid_key")n({issues:s.issues});else if(s.code==="invalid_element")n({issues:s.issues});else if(s.path.length===0)r._errors.push(t(s));else{let i=r,a=0;for(;a<s.path.length;){const c=s.path[a];a===s.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(s))):i[c]=i[c]||{_errors:[]},i=i[c],a++}}};return n(e),r}const zl=e=>(t,r,n,o)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new go;if(i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>dn(c,s,fn())));throw Cg(a,o?.callee),a}return i.value},Bl=e=>async(t,r,n,o)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>dn(c,s,fn())));throw Cg(a,o?.callee),a}return i.value},Ra=e=>(t,r,n)=>{const o=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new go;return s.issues.length?{success:!1,error:new(e??Ug)(s.issues.map(i=>dn(i,o,fn())))}:{success:!0,data:s.value}},Bg=Ra(zg),Ta=e=>async(t,r,n)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>dn(i,o,fn())))}:{success:!0,data:s.value}},IE=Ta(zg),OE=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return zl(e)(t,r,o)},NE=e=>(t,r,n)=>zl(e)(t,r,n),CE=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Bl(e)(t,r,o)},PE=e=>async(t,r,n)=>Bl(e)(t,r,n),LE=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Ra(e)(t,r,o)},UE=e=>(t,r,n)=>Ra(e)(t,r,n),zE=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Ta(e)(t,r,o)},BE=e=>async(t,r,n)=>Ta(e)(t,r,n),ME=/^[cC][^\s-]{8,}$/,qE=/^[0-9a-z]+$/,jE=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,DE=/^[0-9a-vA-V]{20}$/,FE=/^[A-Za-z0-9]{27}$/,HE=/^[a-zA-Z0-9_-]{21}$/,VE=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ZE=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,bh=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,KE=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,GE="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function WE(){return new RegExp(GE,"u")}const JE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,YE=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,XE=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,QE=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,e1=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Mg=/^[A-Za-z0-9_-]*$/,t1=/^\+[1-9]\d{6,14}$/,qg="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",r1=new RegExp(`^${qg}$`);function jg(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function n1(e){return new RegExp(`^${jg(e)}$`)}function o1(e){const t=jg({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${qg}T(?:${n})$`)}const s1=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},i1=/^-?\d+$/,Dg=/^-?\d+(?:\.\d+)?$/,a1=/^(?:true|false)$/i,c1=/^null$/i,u1=/^[^A-Z]*$/,l1=/^[^a-z]*$/,$t=K("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Fg={number:"number",bigint:"bigint",object:"date"},Hg=K("$ZodCheckLessThan",(e,t)=>{$t.init(e,t);const r=Fg[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Vg=K("$ZodCheckGreaterThan",(e,t)=>{$t.init(e,t);const r=Fg[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),f1=K("$ZodCheckMultipleOf",(e,t)=>{$t.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):mE(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),d1=K("$ZodCheckNumberFormat",(e,t)=>{$t.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[o,s]=bE[t.format];e._zod.onattach.push(i=>{const a=i._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,r&&(a.pattern=i1)}),e._zod.check=i=>{const a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inclusive:!0,inst:e,continue:!t.abort})}}),h1=K("$ZodCheckMaxLength",(e,t)=>{var r;$t.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!Pl(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const o=n.value;if(o.length<=t.maximum)return;const i=Ul(o);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),p1=K("$ZodCheckMinLength",(e,t)=>{var r;$t.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!Pl(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const o=n.value;if(o.length>=t.minimum)return;const i=Ul(o);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),m1=K("$ZodCheckLengthEquals",(e,t)=>{var r;$t.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!Pl(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=n=>{const o=n.value,s=o.length;if(s===t.length)return;const i=Ul(o),a=s>t.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Aa=K("$ZodCheckStringFormat",(e,t)=>{var r,n;$t.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),g1=K("$ZodCheckRegex",(e,t)=>{Aa.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),y1=K("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=u1),Aa.init(e,t)}),w1=K("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=l1),Aa.init(e,t)}),v1=K("$ZodCheckIncludes",(e,t)=>{$t.init(e,t);const r=xo(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),b1=K("$ZodCheckStartsWith",(e,t)=>{$t.init(e,t);const r=new RegExp(`^${xo(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),_1=K("$ZodCheckEndsWith",(e,t)=>{$t.init(e,t);const r=new RegExp(`.*${xo(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),E1=K("$ZodCheckOverwrite",(e,t)=>{$t.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class $1{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...r,o.join(`
`))}}const S1={major:4,minor:3,patch:6},ke=K("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=S1;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const o of n)for(const s of o._zod.onattach)s(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,a,c)=>{let u=co(i),l;for(const f of a){if(f._zod.def.when){if(!f._zod.def.when(i))continue}else if(u)continue;const h=i.issues.length,p=f._zod.check(i);if(p instanceof Promise&&c?.async===!1)throw new go;if(l||p instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await p,i.issues.length!==h&&(u||(u=co(i,h)))});else{if(i.issues.length===h)continue;u||(u=co(i,h))}}return l?l.then(()=>i):i},s=(i,a,c)=>{if(co(i))return i.aborted=!0,i;const u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new go;return u.then(l=>e._zod.parse(l,c))}return e._zod.parse(u,c)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(l=>s(l,i,a)):s(u,i,a)}const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new go;return c.then(u=>o(u,n,a))}return o(c,n,a)}}pe(e,"~standard",()=>({validate:o=>{try{const s=Bg(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return IE(e,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}))}),Ml=K("$ZodString",(e,t)=>{ke.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??s1(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),Re=K("$ZodStringFormat",(e,t)=>{Aa.init(e,t),Ml.init(e,t)}),x1=K("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=ZE),Re.init(e,t)}),k1=K("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=bh(n))}else t.pattern??(t.pattern=bh());Re.init(e,t)}),R1=K("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=KE),Re.init(e,t)}),T1=K("$ZodURL",(e,t)=>{Re.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),o=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),A1=K("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=WE()),Re.init(e,t)}),I1=K("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=HE),Re.init(e,t)}),O1=K("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ME),Re.init(e,t)}),N1=K("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=qE),Re.init(e,t)}),C1=K("$ZodULID",(e,t)=>{t.pattern??(t.pattern=jE),Re.init(e,t)}),P1=K("$ZodXID",(e,t)=>{t.pattern??(t.pattern=DE),Re.init(e,t)}),L1=K("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=FE),Re.init(e,t)}),U1=K("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=o1(t)),Re.init(e,t)}),z1=K("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=r1),Re.init(e,t)}),B1=K("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=n1(t)),Re.init(e,t)}),M1=K("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=VE),Re.init(e,t)}),q1=K("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=JE),Re.init(e,t),e._zod.bag.format="ipv4"}),j1=K("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=YE),Re.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),D1=K("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=XE),Re.init(e,t)}),F1=K("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=QE),Re.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[o,s]=n;if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Zg(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const H1=K("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=e1),Re.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{Zg(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function V1(e){if(!Mg.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Zg(r)}const Z1=K("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Mg),Re.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{V1(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),K1=K("$ZodE164",(e,t)=>{t.pattern??(t.pattern=t1),Re.init(e,t)});function G1(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const W1=K("$ZodJWT",(e,t)=>{Re.init(e,t),e._zod.check=r=>{G1(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Kg=K("$ZodNumber",(e,t)=>{ke.init(e,t),e._zod.pattern=e._zod.bag.pattern??Dg,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),r}}),J1=K("$ZodNumberFormat",(e,t)=>{d1.init(e,t),Kg.init(e,t)}),Y1=K("$ZodBoolean",(e,t)=>{ke.init(e,t),e._zod.pattern=a1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),r}}),X1=K("$ZodNull",(e,t)=>{ke.init(e,t),e._zod.pattern=c1,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:e}),r}}),Q1=K("$ZodUnknown",(e,t)=>{ke.init(e,t),e._zod.parse=r=>r}),e$=K("$ZodNever",(e,t)=>{ke.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function _h(e,t,r){e.issues.length&&t.issues.push(...uo(r,e.issues)),t.value[r]=e.value}const t$=K("$ZodArray",(e,t)=>{ke.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),r;r.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>_h(u,r,i))):_h(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function Yi(e,t,r,n,o){if(e.issues.length){if(o&&!(r in n))return;t.issues.push(...uo(r,e.issues))}e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function Gg(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=vE(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function Wg(e,t,r,n,o,s){const i=[],a=o.keySet,c=o.catchall._zod,u=c.def.type,l=c.optout==="optional";for(const f in t){if(a.has(f))continue;if(u==="never"){i.push(f);continue}const h=c.run({value:t[f],issues:[]},n);h instanceof Promise?e.push(h.then(p=>Yi(p,r,f,t,l))):Yi(h,r,f,t,l)}return i.length&&r.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:s}),e.length?Promise.all(e).then(()=>r):r}const r$=K("$ZodObject",(e,t)=>{if(ke.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=ka(()=>Gg(t));pe(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const l=a[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(const f of l.values)c[u].add(f)}}return c});const o=ls,s=t.catchall;let i;e._zod.parse=(a,c)=>{i??(i=n.value);const u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const l=[],f=i.shape;for(const h of i.keys){const p=f[h],g=p._zod.optout==="optional",m=p._zod.run({value:u[h],issues:[]},c);m instanceof Promise?l.push(m.then(d=>Yi(d,a,h,u,g))):Yi(m,a,h,u,g)}return s?Wg(l,u,a,c,n.value,e):l.length?Promise.all(l).then(()=>a):a}}),n$=K("$ZodObjectJIT",(e,t)=>{r$.init(e,t);const r=e._zod.parse,n=ka(()=>Gg(t)),o=h=>{const p=new $1(["shape","payload","ctx"]),g=n.value,m=v=>{const E=vh(v);return`shape[${E}]._zod.run({ value: input[${E}], issues: [] }, ctx)`};p.write("const input = payload.value;");const d=Object.create(null);let w=0;for(const v of g.keys)d[v]=`key_${w++}`;p.write("const newResult = {};");for(const v of g.keys){const E=d[v],b=vh(v),$=h[v]?._zod?.optout==="optional";p.write(`const ${E} = ${m(v)};`),$?p.write(`
        if (${E}.issues.length) {
          if (${b} in input) {
            payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${b}, ...iss.path] : [${b}]
            })));
          }
        }
        
        if (${E}.value === undefined) {
          if (${b} in input) {
            newResult[${b}] = undefined;
          }
        } else {
          newResult[${b}] = ${E}.value;
        }
        
      `):p.write(`
        if (${E}.issues.length) {
          payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${b}, ...iss.path] : [${b}]
          })));
        }
        
        if (${E}.value === undefined) {
          if (${b} in input) {
            newResult[${b}] = undefined;
          }
        } else {
          newResult[${b}] = ${E}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const y=p.compile();return(v,E)=>y(h,v,E)};let s;const i=ls,a=!Og.jitless,u=a&&yE.value,l=t.catchall;let f;e._zod.parse=(h,p)=>{f??(f=n.value);const g=h.value;return i(g)?a&&u&&p?.async===!1&&p.jitless!==!0?(s||(s=o(t.shape)),h=s(h,p),l?Wg([],g,h,p,f,e):h):r(h,p):(h.issues.push({expected:"object",code:"invalid_type",input:g,inst:e}),h)}});function Eh(e,t,r,n){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!co(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(s=>s.issues.map(i=>dn(i,n,fn())))}),t)}const Jg=K("$ZodUnion",(e,t)=>{ke.init(e,t),pe(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),pe(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),pe(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),pe(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${o.map(s=>Ll(s.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(o,s)=>{if(r)return n(o,s);let i=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:o.value,issues:[]},s);if(u instanceof Promise)a.push(u),i=!0;else{if(u.issues.length===0)return u;a.push(u)}}return i?Promise.all(a).then(c=>Eh(c,o,e,s)):Eh(a,o,e,s)}}),o$=K("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,Jg.init(e,t);const r=e._zod.parse;pe(e._zod,"propValues",()=>{const o={};for(const s of t.options){const i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(s)}"`);for(const[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(const u of c)o[a].add(u)}}return o});const n=ka(()=>{const o=t.options,s=new Map;for(const i of o){const a=i._zod.propValues?.[t.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(const c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});e._zod.parse=(o,s)=>{const i=o.value;if(!ls(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:e}),o;const a=n.value.get(i?.[t.discriminator]);return a?a._zod.run(o,s):t.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:i,path:[t.discriminator],inst:e}),o)}}),s$=K("$ZodIntersection",(e,t)=>{ke.init(e,t),e._zod.parse=(r,n)=>{const o=r.value,s=t.left._zod.run({value:o,issues:[]},n),i=t.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>$h(r,c,u)):$h(r,s,i)}});function qu(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(So(e)&&So(t)){const r=Object.keys(t),n=Object.keys(e).filter(s=>r.indexOf(s)!==-1),o={...e,...t};for(const s of n){const i=qu(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=t[n],i=qu(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function $h(e,t,r){const n=new Map;let o;for(const a of t.issues)if(a.code==="unrecognized_keys"){o??(o=a);for(const c of a.keys)n.has(c)||n.set(c,{}),n.get(c).l=!0}else e.issues.push(a);for(const a of r.issues)if(a.code==="unrecognized_keys")for(const c of a.keys)n.has(c)||n.set(c,{}),n.get(c).r=!0;else e.issues.push(a);const s=[...n].filter(([,a])=>a.l&&a.r).map(([a])=>a);if(s.length&&o&&e.issues.push({...o,keys:s}),co(e))return e;const i=qu(t.value,r.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const i$=K("$ZodRecord",(e,t)=>{ke.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!So(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),r;const s=[],i=t.keyType._zod.values;if(i){r.value={};const a=new Set;for(const u of i)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){a.add(typeof u=="number"?u.toString():u);const l=t.valueType._zod.run({value:o[u],issues:[]},n);l instanceof Promise?s.push(l.then(f=>{f.issues.length&&r.issues.push(...uo(u,f.issues)),r.value[u]=f.value})):(l.issues.length&&r.issues.push(...uo(u,l.issues)),r.value[u]=l.value)}let c;for(const u in o)a.has(u)||(c=c??[],c.push(u));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:c})}else{r.value={};for(const a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let c=t.keyType._zod.run({value:a,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof a=="string"&&Dg.test(a)&&c.issues.length){const f=t.keyType._zod.run({value:Number(a),issues:[]},n);if(f instanceof Promise)throw new Error("Async schemas not supported in object keys currently");f.issues.length===0&&(c=f)}if(c.issues.length){t.mode==="loose"?r.value[a]=o[a]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(f=>dn(f,n,fn())),input:a,path:[a],inst:e});continue}const l=t.valueType._zod.run({value:o[a],issues:[]},n);l instanceof Promise?s.push(l.then(f=>{f.issues.length&&r.issues.push(...uo(a,f.issues)),r.value[c.value]=f.value})):(l.issues.length&&r.issues.push(...uo(a,l.issues)),r.value[c.value]=l.value)}}return s.length?Promise.all(s).then(()=>r):r}}),a$=K("$ZodEnum",(e,t)=>{ke.init(e,t);const r=Ng(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(o=>wE.has(typeof o)).map(o=>typeof o=="string"?xo(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return n.has(i)||o.issues.push({code:"invalid_value",values:r,input:i,inst:e}),o}}),c$=K("$ZodLiteral",(e,t)=>{if(ke.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?xo(n):n?xo(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,o)=>{const s=n.value;return r.has(s)||n.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),n}}),u$=K("$ZodTransform",(e,t)=>{ke.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ig(e.constructor.name);const o=t.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new go;return r.value=o,r}});function Sh(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Yg=K("$ZodOptional",(e,t)=>{ke.init(e,t),e._zod.optin="optional",e._zod.optout="optional",pe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),pe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Ll(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Sh(s,r.value)):Sh(o,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),l$=K("$ZodExactOptional",(e,t)=>{Yg.init(e,t),pe(e._zod,"values",()=>t.innerType._zod.values),pe(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(r,n)=>t.innerType._zod.run(r,n)}),f$=K("$ZodNullable",(e,t)=>{ke.init(e,t),pe(e._zod,"optin",()=>t.innerType._zod.optin),pe(e._zod,"optout",()=>t.innerType._zod.optout),pe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Ll(r.source)}|null)$`):void 0}),pe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),d$=K("$ZodDefault",(e,t)=>{ke.init(e,t),e._zod.optin="optional",pe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>xh(s,t)):xh(o,t)}});function xh(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const h$=K("$ZodPrefault",(e,t)=>{ke.init(e,t),e._zod.optin="optional",pe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),p$=K("$ZodNonOptional",(e,t)=>{ke.init(e,t),pe(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>kh(s,e)):kh(o,e)}});function kh(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const m$=K("$ZodCatch",(e,t)=>{ke.init(e,t),pe(e._zod,"optin",()=>t.innerType._zod.optin),pe(e._zod,"optout",()=>t.innerType._zod.optout),pe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>dn(i,n,fn()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>dn(s,n,fn()))},input:r.value}),r.issues=[]),r)}}),g$=K("$ZodPipe",(e,t)=>{ke.init(e,t),pe(e._zod,"values",()=>t.in._zod.values),pe(e._zod,"optin",()=>t.in._zod.optin),pe(e._zod,"optout",()=>t.out._zod.optout),pe(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const s=t.out._zod.run(r,n);return s instanceof Promise?s.then(i=>Ls(i,t.in,n)):Ls(s,t.in,n)}const o=t.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Ls(s,t.out,n)):Ls(o,t.out,n)}});function Ls(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const y$=K("$ZodReadonly",(e,t)=>{ke.init(e,t),pe(e._zod,"propValues",()=>t.innerType._zod.propValues),pe(e._zod,"values",()=>t.innerType._zod.values),pe(e._zod,"optin",()=>t.innerType?._zod?.optin),pe(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(Rh):Rh(o)}});function Rh(e){return e.value=Object.freeze(e.value),e}const w$=K("$ZodCustom",(e,t)=>{$t.init(e,t),ke.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,o=t.fn(n);if(o instanceof Promise)return o.then(s=>Th(s,r,n,e));Th(o,r,n,e)}});function Th(e,t,r,n){if(!e){const o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),t.issues.push(fs(o))}}var Ah;class v${constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];return this._map.set(t,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const o={...n,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function b$(){return new v$}(Ah=globalThis).__zod_globalRegistry??(Ah.__zod_globalRegistry=b$());const os=globalThis.__zod_globalRegistry;function _$(e,t){return new e({type:"string",...te(t)})}function E$(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...te(t)})}function Ih(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...te(t)})}function $$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...te(t)})}function S$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...te(t)})}function x$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...te(t)})}function k$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...te(t)})}function R$(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...te(t)})}function T$(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...te(t)})}function A$(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...te(t)})}function I$(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...te(t)})}function O$(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...te(t)})}function N$(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...te(t)})}function C$(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...te(t)})}function P$(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...te(t)})}function L$(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...te(t)})}function U$(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...te(t)})}function z$(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...te(t)})}function B$(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...te(t)})}function M$(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...te(t)})}function q$(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...te(t)})}function j$(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...te(t)})}function D$(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...te(t)})}function F$(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...te(t)})}function H$(e,t){return new e({type:"string",format:"date",check:"string_format",...te(t)})}function V$(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...te(t)})}function Z$(e,t){return new e({type:"string",format:"duration",check:"string_format",...te(t)})}function K$(e,t){return new e({type:"number",checks:[],...te(t)})}function G$(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...te(t)})}function W$(e,t){return new e({type:"boolean",...te(t)})}function J$(e,t){return new e({type:"null",...te(t)})}function Y$(e){return new e({type:"unknown"})}function X$(e,t){return new e({type:"never",...te(t)})}function Oh(e,t){return new Hg({check:"less_than",...te(t),value:e,inclusive:!1})}function xc(e,t){return new Hg({check:"less_than",...te(t),value:e,inclusive:!0})}function Nh(e,t){return new Vg({check:"greater_than",...te(t),value:e,inclusive:!1})}function kc(e,t){return new Vg({check:"greater_than",...te(t),value:e,inclusive:!0})}function Ch(e,t){return new f1({check:"multiple_of",...te(t),value:e})}function Xg(e,t){return new h1({check:"max_length",...te(t),maximum:e})}function Xi(e,t){return new p1({check:"min_length",...te(t),minimum:e})}function Qg(e,t){return new m1({check:"length_equals",...te(t),length:e})}function Q$(e,t){return new g1({check:"string_format",format:"regex",...te(t),pattern:e})}function e2(e){return new y1({check:"string_format",format:"lowercase",...te(e)})}function t2(e){return new w1({check:"string_format",format:"uppercase",...te(e)})}function r2(e,t){return new v1({check:"string_format",format:"includes",...te(t),includes:e})}function n2(e,t){return new b1({check:"string_format",format:"starts_with",...te(t),prefix:e})}function o2(e,t){return new _1({check:"string_format",format:"ends_with",...te(t),suffix:e})}function zo(e){return new E1({check:"overwrite",tx:e})}function s2(e){return zo(t=>t.normalize(e))}function i2(){return zo(e=>e.trim())}function a2(){return zo(e=>e.toLowerCase())}function c2(){return zo(e=>e.toUpperCase())}function u2(){return zo(e=>gE(e))}function l2(e,t,r){return new e({type:"array",element:t,...te(r)})}function f2(e,t,r){const n=te(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function d2(e,t,r){return new e({type:"custom",check:"custom",fn:t,...te(r)})}function h2(e){const t=p2(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(fs(n,r.value,t._zod.def));else{const o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),r.issues.push(fs(o))}},e(r.value,r)));return t}function p2(e,t){const r=new $t({check:"custom",...te(t)});return r._zod.check=e,r}function e0(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??os,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function qe(e,t,r={path:[],schemaPath:[]}){var n;const o=e._zod.def,s=t.seen.get(e);if(s)return s.count++,r.schemaPath.includes(e)&&(s.cycle=r.path),s.schema;const i={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,i);const a=e._zod.toJSONSchema?.();if(a)i.schema=a;else{const l={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,i.schema,l);else{const h=i.schema,p=t.processors[o.type];if(!p)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);p(e,t,h,l)}const f=e._zod.parent;f&&(i.ref||(i.ref=f),qe(f,t,l),t.seen.get(f).isParent=!0)}const c=t.metadataRegistry.get(e);return c&&Object.assign(i.schema,c),t.io==="input"&&dt(e)&&(delete i.schema.examples,delete i.schema.default),t.io==="input"&&i.schema._prefault&&((n=i.schema).default??(n.default=i.schema._prefault)),delete i.schema._prefault,t.seen.get(e).schema}function t0(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=new Map;for(const i of e.seen.entries()){const a=e.metadataRegistry.get(i[0])?.id;if(a){const c=n.get(a);if(c&&c!==i[0])throw new Error(`Duplicate schema id "${a}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(a,i[0])}}const o=i=>{const a=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const f=e.external.registry.get(i[0])?.id,h=e.external.uri??(g=>g);if(f)return{ref:h(f)};const p=i[1].defId??i[1].schema.id??`schema${e.counter++}`;return i[1].defId=p,{defId:p,ref:`${h("__shared")}#/${a}/${p}`}}if(i[1]===r)return{ref:"#"};const u=`#/${a}/`,l=i[1].schema.id??`__schema${e.counter++}`;return{defId:l,ref:u+l}},s=i=>{if(i[1].schema.$ref)return;const a=i[1],{ref:c,defId:u}=o(i);a.def={...a.schema},u&&(a.defId=u);const l=a.schema;for(const f in l)delete l[f];l.$ref=c};if(e.cycles==="throw")for(const i of e.seen.entries()){const a=i[1];if(a.cycle)throw new Error(`Cycle detected: #/${a.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const i of e.seen.entries()){const a=i[1];if(t===i[0]){s(i);continue}if(e.external){const u=e.external.registry.get(i[0])?.id;if(t!==i[0]&&u){s(i);continue}}if(e.metadataRegistry.get(i[0])?.id){s(i);continue}if(a.cycle){s(i);continue}if(a.count>1&&e.reused==="ref"){s(i);continue}}}function r0(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=i=>{const a=e.seen.get(i);if(a.ref===null)return;const c=a.def??a.schema,u={...c},l=a.ref;if(a.ref=null,l){n(l);const h=e.seen.get(l),p=h.schema;if(p.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(p)):Object.assign(c,p),Object.assign(c,u),i._zod.parent===l)for(const m in c)m==="$ref"||m==="allOf"||m in u||delete c[m];if(p.$ref&&h.def)for(const m in c)m==="$ref"||m==="allOf"||m in h.def&&JSON.stringify(c[m])===JSON.stringify(h.def[m])&&delete c[m]}const f=i._zod.parent;if(f&&f!==l){n(f);const h=e.seen.get(f);if(h?.schema.$ref&&(c.$ref=h.schema.$ref,h.def))for(const p in c)p==="$ref"||p==="allOf"||p in h.def&&JSON.stringify(c[p])===JSON.stringify(h.def[p])&&delete c[p]}e.override({zodSchema:i,jsonSchema:c,path:a.path??[]})};for(const i of[...e.seen.entries()].reverse())n(i[0]);const o={};if(e.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const i=e.external.registry.get(t)?.id;if(!i)throw new Error("Schema is missing an `id` property");o.$id=e.external.uri(i)}Object.assign(o,r.def??r.schema);const s=e.external?.defs??{};for(const i of e.seen.entries()){const a=i[1];a.def&&a.defId&&(s[a.defId]=a.def)}e.external||Object.keys(s).length>0&&(e.target==="draft-2020-12"?o.$defs=s:o.definitions=s);try{const i=JSON.parse(JSON.stringify(o));return Object.defineProperty(i,"~standard",{value:{...t["~standard"],jsonSchema:{input:Qi(t,"input",e.processors),output:Qi(t,"output",e.processors)}},enumerable:!1,writable:!1}),i}catch{throw new Error("Error converting schema to JSON.")}}function dt(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return dt(n.element,r);if(n.type==="set")return dt(n.valueType,r);if(n.type==="lazy")return dt(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return dt(n.innerType,r);if(n.type==="intersection")return dt(n.left,r)||dt(n.right,r);if(n.type==="record"||n.type==="map")return dt(n.keyType,r)||dt(n.valueType,r);if(n.type==="pipe")return dt(n.in,r)||dt(n.out,r);if(n.type==="object"){for(const o in n.shape)if(dt(n.shape[o],r))return!0;return!1}if(n.type==="union"){for(const o of n.options)if(dt(o,r))return!0;return!1}if(n.type==="tuple"){for(const o of n.items)if(dt(o,r))return!0;return!!(n.rest&&dt(n.rest,r))}return!1}const m2=(e,t={})=>r=>{const n=e0({...r,processors:t});return qe(e,n),t0(n,e),r0(n,e)},Qi=(e,t,r={})=>n=>{const{libraryOptions:o,target:s}=n??{},i=e0({...o??{},target:s,io:t,processors:r});return qe(e,i),t0(i,e),r0(i,e)},g2={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},y2=(e,t,r,n)=>{const o=r;o.type="string";const{minimum:s,maximum:i,format:a,patterns:c,contentEncoding:u}=e._zod.bag;if(typeof s=="number"&&(o.minLength=s),typeof i=="number"&&(o.maxLength=i),a&&(o.format=g2[a]??a,o.format===""&&delete o.format,a==="time"&&delete o.format),u&&(o.contentEncoding=u),c&&c.size>0){const l=[...c];l.length===1?o.pattern=l[0].source:l.length>1&&(o.allOf=[...l.map(f=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:f.source}))])}},w2=(e,t,r,n)=>{const o=r,{minimum:s,maximum:i,format:a,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=e._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(o.minimum=l,o.exclusiveMinimum=!0):o.exclusiveMinimum=l),typeof s=="number"&&(o.minimum=s,typeof l=="number"&&t.target!=="draft-04"&&(l>=s?delete o.minimum:delete o.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(o.maximum=u,o.exclusiveMaximum=!0):o.exclusiveMaximum=u),typeof i=="number"&&(o.maximum=i,typeof u=="number"&&t.target!=="draft-04"&&(u<=i?delete o.maximum:delete o.exclusiveMaximum)),typeof c=="number"&&(o.multipleOf=c)},v2=(e,t,r,n)=>{r.type="boolean"},b2=(e,t,r,n)=>{t.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},_2=(e,t,r,n)=>{r.not={}},E2=(e,t,r,n)=>{},$2=(e,t,r,n)=>{const o=e._zod.def,s=Ng(o.entries);s.every(i=>typeof i=="number")&&(r.type="number"),s.every(i=>typeof i=="string")&&(r.type="string"),r.enum=s},S2=(e,t,r,n)=>{const o=e._zod.def,s=[];for(const i of o.values)if(i===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof i=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");s.push(Number(i))}else s.push(i);if(s.length!==0)if(s.length===1){const i=s[0];r.type=i===null?"null":typeof i,t.target==="draft-04"||t.target==="openapi-3.0"?r.enum=[i]:r.const=i}else s.every(i=>typeof i=="number")&&(r.type="number"),s.every(i=>typeof i=="string")&&(r.type="string"),s.every(i=>typeof i=="boolean")&&(r.type="boolean"),s.every(i=>i===null)&&(r.type="null"),r.enum=s},x2=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},k2=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},R2=(e,t,r,n)=>{const o=r,s=e._zod.def,{minimum:i,maximum:a}=e._zod.bag;typeof i=="number"&&(o.minItems=i),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=qe(s.element,t,{...n,path:[...n.path,"items"]})},T2=(e,t,r,n)=>{const o=r,s=e._zod.def;o.type="object",o.properties={};const i=s.shape;for(const u in i)o.properties[u]=qe(i[u],t,{...n,path:[...n.path,"properties",u]});const a=new Set(Object.keys(i)),c=new Set([...a].filter(u=>{const l=s.shape[u]._zod;return t.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(o.required=Array.from(c)),s.catchall?._zod.def.type==="never"?o.additionalProperties=!1:s.catchall?s.catchall&&(o.additionalProperties=qe(s.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):t.io==="output"&&(o.additionalProperties=!1)},A2=(e,t,r,n)=>{const o=e._zod.def,s=o.inclusive===!1,i=o.options.map((a,c)=>qe(a,t,{...n,path:[...n.path,s?"oneOf":"anyOf",c]}));s?r.oneOf=i:r.anyOf=i},I2=(e,t,r,n)=>{const o=e._zod.def,s=qe(o.left,t,{...n,path:[...n.path,"allOf",0]}),i=qe(o.right,t,{...n,path:[...n.path,"allOf",1]}),a=u=>"allOf"in u&&Object.keys(u).length===1,c=[...a(s)?s.allOf:[s],...a(i)?i.allOf:[i]];r.allOf=c},O2=(e,t,r,n)=>{const o=r,s=e._zod.def;o.type="object";const i=s.keyType,c=i._zod.bag?.patterns;if(s.mode==="loose"&&c&&c.size>0){const l=qe(s.valueType,t,{...n,path:[...n.path,"patternProperties","*"]});o.patternProperties={};for(const f of c)o.patternProperties[f.source]=l}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(o.propertyNames=qe(s.keyType,t,{...n,path:[...n.path,"propertyNames"]})),o.additionalProperties=qe(s.valueType,t,{...n,path:[...n.path,"additionalProperties"]});const u=i._zod.values;if(u){const l=[...u].filter(f=>typeof f=="string"||typeof f=="number");l.length>0&&(o.required=l)}},N2=(e,t,r,n)=>{const o=e._zod.def,s=qe(o.innerType,t,n),i=t.seen.get(e);t.target==="openapi-3.0"?(i.ref=o.innerType,r.nullable=!0):r.anyOf=[s,{type:"null"}]},C2=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType},P2=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType,r.default=JSON.parse(JSON.stringify(o.defaultValue))},L2=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType,t.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},U2=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType;let i;try{i=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=i},z2=(e,t,r,n)=>{const o=e._zod.def,s=t.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;qe(s,t,n);const i=t.seen.get(e);i.ref=s},B2=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType,r.readOnly=!0},n0=(e,t,r,n)=>{const o=e._zod.def;qe(o.innerType,t,n);const s=t.seen.get(e);s.ref=o.innerType};function Ia(e){return!!e._zod}function rn(e,t){return Ia(e)?Bg(e,t):e.safeParse(t)}function o0(e){if(!e)return;let t;if(Ia(e)?t=e._zod?.def?.shape:t=e.shape,!!t){if(typeof t=="function")try{return t()}catch{return}return t}}function M2(e){if(Ia(e)){const s=e._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}const r=e._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}const n=e.value;if(n!==void 0)return n}const q2=K("ZodISODateTime",(e,t)=>{U1.init(e,t),Ne.init(e,t)});function s0(e){return F$(q2,e)}const j2=K("ZodISODate",(e,t)=>{z1.init(e,t),Ne.init(e,t)});function D2(e){return H$(j2,e)}const F2=K("ZodISOTime",(e,t)=>{B1.init(e,t),Ne.init(e,t)});function H2(e){return V$(F2,e)}const V2=K("ZodISODuration",(e,t)=>{M1.init(e,t),Ne.init(e,t)});function Z2(e){return Z$(V2,e)}const K2=(e,t)=>{Ug.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>AE(e,r)},flatten:{value:r=>TE(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,Mu,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,Mu,2)}},isEmpty:{get(){return e.issues.length===0}}})},Mt=K("ZodError",K2,{Parent:Error}),G2=zl(Mt),W2=Bl(Mt),J2=Ra(Mt),Y2=Ta(Mt),X2=OE(Mt),Q2=NE(Mt),eS=CE(Mt),tS=PE(Mt),rS=LE(Mt),nS=UE(Mt),oS=zE(Mt),sS=BE(Mt),Te=K("ZodType",(e,t)=>(ke.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:Qi(e,"input"),output:Qi(e,"output")}}),e.toJSONSchema=m2(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(wn(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),e.with=e.check,e.clone=(r,n)=>vn(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>G2(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>J2(e,r,n),e.parseAsync=async(r,n)=>W2(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>Y2(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>X2(e,r,n),e.decode=(r,n)=>Q2(e,r,n),e.encodeAsync=async(r,n)=>eS(e,r,n),e.decodeAsync=async(r,n)=>tS(e,r,n),e.safeEncode=(r,n)=>rS(e,r,n),e.safeDecode=(r,n)=>nS(e,r,n),e.safeEncodeAsync=async(r,n)=>oS(e,r,n),e.safeDecodeAsync=async(r,n)=>sS(e,r,n),e.refine=(r,n)=>e.check(JS(r,n)),e.superRefine=r=>e.check(YS(r)),e.overwrite=r=>e.check(zo(r)),e.optional=()=>Pe(e),e.exactOptional=()=>zS(e),e.nullable=()=>Uh(e),e.nullish=()=>Pe(Uh(e)),e.nonoptional=r=>FS(e,r),e.array=()=>ce(e),e.or=r=>be([e,r]),e.and=r=>ql(e,r),e.transform=r=>Du(e,d0(r)),e.default=r=>qS(e,r),e.prefault=r=>DS(e,r),e.catch=r=>VS(e,r),e.pipe=r=>Du(e,r),e.readonly=()=>GS(e),e.describe=r=>{const n=e.clone();return os.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return os.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return os.get(e);const n=e.clone();return os.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=r=>r(e),e)),i0=K("_ZodString",(e,t)=>{Ml.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>y2(e,n,o);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Q$(...n)),e.includes=(...n)=>e.check(r2(...n)),e.startsWith=(...n)=>e.check(n2(...n)),e.endsWith=(...n)=>e.check(o2(...n)),e.min=(...n)=>e.check(Xi(...n)),e.max=(...n)=>e.check(Xg(...n)),e.length=(...n)=>e.check(Qg(...n)),e.nonempty=(...n)=>e.check(Xi(1,...n)),e.lowercase=n=>e.check(e2(n)),e.uppercase=n=>e.check(t2(n)),e.trim=()=>e.check(i2()),e.normalize=(...n)=>e.check(s2(...n)),e.toLowerCase=()=>e.check(a2()),e.toUpperCase=()=>e.check(c2()),e.slugify=()=>e.check(u2())}),iS=K("ZodString",(e,t)=>{Ml.init(e,t),i0.init(e,t),e.email=r=>e.check(E$(aS,r)),e.url=r=>e.check(R$(cS,r)),e.jwt=r=>e.check(D$($S,r)),e.emoji=r=>e.check(T$(uS,r)),e.guid=r=>e.check(Ih(Ph,r)),e.uuid=r=>e.check($$(Us,r)),e.uuidv4=r=>e.check(S$(Us,r)),e.uuidv6=r=>e.check(x$(Us,r)),e.uuidv7=r=>e.check(k$(Us,r)),e.nanoid=r=>e.check(A$(lS,r)),e.guid=r=>e.check(Ih(Ph,r)),e.cuid=r=>e.check(I$(fS,r)),e.cuid2=r=>e.check(O$(dS,r)),e.ulid=r=>e.check(N$(hS,r)),e.base64=r=>e.check(M$(bS,r)),e.base64url=r=>e.check(q$(_S,r)),e.xid=r=>e.check(C$(pS,r)),e.ksuid=r=>e.check(P$(mS,r)),e.ipv4=r=>e.check(L$(gS,r)),e.ipv6=r=>e.check(U$(yS,r)),e.cidrv4=r=>e.check(z$(wS,r)),e.cidrv6=r=>e.check(B$(vS,r)),e.e164=r=>e.check(j$(ES,r)),e.datetime=r=>e.check(s0(r)),e.date=r=>e.check(D2(r)),e.time=r=>e.check(H2(r)),e.duration=r=>e.check(Z2(r))});function V(e){return _$(iS,e)}const Ne=K("ZodStringFormat",(e,t)=>{Re.init(e,t),i0.init(e,t)}),aS=K("ZodEmail",(e,t)=>{R1.init(e,t),Ne.init(e,t)}),Ph=K("ZodGUID",(e,t)=>{x1.init(e,t),Ne.init(e,t)}),Us=K("ZodUUID",(e,t)=>{k1.init(e,t),Ne.init(e,t)}),cS=K("ZodURL",(e,t)=>{T1.init(e,t),Ne.init(e,t)}),uS=K("ZodEmoji",(e,t)=>{A1.init(e,t),Ne.init(e,t)}),lS=K("ZodNanoID",(e,t)=>{I1.init(e,t),Ne.init(e,t)}),fS=K("ZodCUID",(e,t)=>{O1.init(e,t),Ne.init(e,t)}),dS=K("ZodCUID2",(e,t)=>{N1.init(e,t),Ne.init(e,t)}),hS=K("ZodULID",(e,t)=>{C1.init(e,t),Ne.init(e,t)}),pS=K("ZodXID",(e,t)=>{P1.init(e,t),Ne.init(e,t)}),mS=K("ZodKSUID",(e,t)=>{L1.init(e,t),Ne.init(e,t)}),gS=K("ZodIPv4",(e,t)=>{q1.init(e,t),Ne.init(e,t)}),yS=K("ZodIPv6",(e,t)=>{j1.init(e,t),Ne.init(e,t)}),wS=K("ZodCIDRv4",(e,t)=>{D1.init(e,t),Ne.init(e,t)}),vS=K("ZodCIDRv6",(e,t)=>{F1.init(e,t),Ne.init(e,t)}),bS=K("ZodBase64",(e,t)=>{H1.init(e,t),Ne.init(e,t)}),_S=K("ZodBase64URL",(e,t)=>{Z1.init(e,t),Ne.init(e,t)}),ES=K("ZodE164",(e,t)=>{K1.init(e,t),Ne.init(e,t)}),$S=K("ZodJWT",(e,t)=>{W1.init(e,t),Ne.init(e,t)}),a0=K("ZodNumber",(e,t)=>{Kg.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>w2(e,n,o),e.gt=(n,o)=>e.check(Nh(n,o)),e.gte=(n,o)=>e.check(kc(n,o)),e.min=(n,o)=>e.check(kc(n,o)),e.lt=(n,o)=>e.check(Oh(n,o)),e.lte=(n,o)=>e.check(xc(n,o)),e.max=(n,o)=>e.check(xc(n,o)),e.int=n=>e.check(Lh(n)),e.safe=n=>e.check(Lh(n)),e.positive=n=>e.check(Nh(0,n)),e.nonnegative=n=>e.check(kc(0,n)),e.negative=n=>e.check(Oh(0,n)),e.nonpositive=n=>e.check(xc(0,n)),e.multipleOf=(n,o)=>e.check(Ch(n,o)),e.step=(n,o)=>e.check(Ch(n,o)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function ge(e){return K$(a0,e)}const SS=K("ZodNumberFormat",(e,t)=>{J1.init(e,t),a0.init(e,t)});function Lh(e){return G$(SS,e)}const xS=K("ZodBoolean",(e,t)=>{Y1.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>v2(e,r,n)});function Xe(e){return W$(xS,e)}const kS=K("ZodNull",(e,t)=>{X1.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>b2(e,r,n)});function c0(e){return J$(kS,e)}const RS=K("ZodUnknown",(e,t)=>{Q1.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>E2()});function Ae(){return Y$(RS)}const TS=K("ZodNever",(e,t)=>{e$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>_2(e,r,n)});function AS(e){return X$(TS,e)}const IS=K("ZodArray",(e,t)=>{t$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>R2(e,r,n,o),e.element=t.element,e.min=(r,n)=>e.check(Xi(r,n)),e.nonempty=r=>e.check(Xi(1,r)),e.max=(r,n)=>e.check(Xg(r,n)),e.length=(r,n)=>e.check(Qg(r,n)),e.unwrap=()=>e.element});function ce(e,t){return l2(IS,e,t)}const u0=K("ZodObject",(e,t)=>{n$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>T2(e,r,n,o),pe(e,"shape",()=>t.shape),e.keyof=()=>Rt(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ae()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ae()}),e.strict=()=>e.clone({...e._zod.def,catchall:AS()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>$E(e,r),e.safeExtend=r=>SE(e,r),e.merge=r=>xE(e,r),e.pick=r=>_E(e,r),e.omit=r=>EE(e,r),e.partial=(...r)=>kE(h0,e,r[0]),e.required=(...r)=>RE(p0,e,r[0])});function ee(e,t){const r={type:"object",shape:e??{},...te(t)};return new u0(r)}function wt(e,t){return new u0({type:"object",shape:e,catchall:Ae(),...te(t)})}const l0=K("ZodUnion",(e,t)=>{Jg.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>A2(e,r,n,o),e.options=t.options});function be(e,t){return new l0({type:"union",options:e,...te(t)})}const OS=K("ZodDiscriminatedUnion",(e,t)=>{l0.init(e,t),o$.init(e,t)});function f0(e,t,r){return new OS({type:"union",options:t,discriminator:e,...te(r)})}const NS=K("ZodIntersection",(e,t)=>{s$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>I2(e,r,n,o)});function ql(e,t){return new NS({type:"intersection",left:e,right:t})}const CS=K("ZodRecord",(e,t)=>{i$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>O2(e,r,n,o),e.keyType=t.keyType,e.valueType=t.valueType});function Ie(e,t,r){return new CS({type:"record",keyType:e,valueType:t,...te(r)})}const ju=K("ZodEnum",(e,t)=>{a$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>$2(e,n,o),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,o)=>{const s={};for(const i of n)if(r.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new ju({...t,checks:[],...te(o),entries:s})},e.exclude=(n,o)=>{const s={...t.entries};for(const i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new ju({...t,checks:[],...te(o),entries:s})}});function Rt(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new ju({type:"enum",entries:r,...te(t)})}const PS=K("ZodLiteral",(e,t)=>{c$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>S2(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function re(e,t){return new PS({type:"literal",values:Array.isArray(e)?e:[e],...te(t)})}const LS=K("ZodTransform",(e,t)=>{u$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>k2(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ig(e.constructor.name);r.addIssue=s=>{if(typeof s=="string")r.issues.push(fs(s,r.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(fs(i))}};const o=t.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function d0(e){return new LS({type:"transform",transform:e})}const h0=K("ZodOptional",(e,t)=>{Yg.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>n0(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function Pe(e){return new h0({type:"optional",innerType:e})}const US=K("ZodExactOptional",(e,t)=>{l$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>n0(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function zS(e){return new US({type:"optional",innerType:e})}const BS=K("ZodNullable",(e,t)=>{f$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>N2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function Uh(e){return new BS({type:"nullable",innerType:e})}const MS=K("ZodDefault",(e,t)=>{d$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>P2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function qS(e,t){return new MS({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Pg(t)}})}const jS=K("ZodPrefault",(e,t)=>{h$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>L2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function DS(e,t){return new jS({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Pg(t)}})}const p0=K("ZodNonOptional",(e,t)=>{p$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>C2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function FS(e,t){return new p0({type:"nonoptional",innerType:e,...te(t)})}const HS=K("ZodCatch",(e,t)=>{m$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>U2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function VS(e,t){return new HS({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const ZS=K("ZodPipe",(e,t)=>{g$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>z2(e,r,n,o),e.in=t.in,e.out=t.out});function Du(e,t){return new ZS({type:"pipe",in:e,out:t})}const KS=K("ZodReadonly",(e,t)=>{y$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>B2(e,r,n,o),e.unwrap=()=>e._zod.def.innerType});function GS(e){return new KS({type:"readonly",innerType:e})}const m0=K("ZodCustom",(e,t)=>{w$.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(r,n,o)=>x2(e,r)});function WS(e,t){return f2(m0,e??(()=>!0),t)}function JS(e,t={}){return d2(m0,e,t)}function YS(e){return h2(e)}function g0(e,t){return Du(d0(e),t)}const jl="2025-11-25",XS=[jl,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Nn="io.modelcontextprotocol/related-task",Oa="2.0",Qe=WS(e=>e!==null&&(typeof e=="object"||typeof e=="function")),y0=be([V(),ge().int()]),w0=V();wt({ttl:be([ge(),c0()]).optional(),pollInterval:ge().optional()});const QS=ee({ttl:ge().optional()}),ex=ee({taskId:V()}),Dl=wt({progressToken:y0.optional(),[Nn]:ex.optional()}),Tt=ee({_meta:Dl.optional()}),Es=Tt.extend({task:QS.optional()}),tx=e=>Es.safeParse(e).success,et=ee({method:V(),params:Tt.loose().optional()}),qt=ee({_meta:Dl.optional()}),At=ee({method:V(),params:qt.loose().optional()}),tt=wt({_meta:Dl.optional()}),Na=be([V(),ge().int()]),v0=ee({jsonrpc:re(Oa),id:Na,...et.shape}).strict(),Cn=e=>v0.safeParse(e).success,b0=ee({jsonrpc:re(Oa),...At.shape}).strict(),Fu=e=>b0.safeParse(e).success,Fl=ee({jsonrpc:re(Oa),id:Na,result:tt}).strict(),zs=e=>Fl.safeParse(e).success;var se;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError",e[e.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(se||(se={}));const Hl=ee({jsonrpc:re(Oa),id:Na.optional(),error:ee({code:ge().int(),message:V(),data:Ae().optional()})}).strict(),rx=e=>Hl.safeParse(e).success,nx=be([v0,b0,Fl,Hl]);be([Fl,Hl]);const lo=tt.strict(),ox=qt.extend({requestId:Na.optional(),reason:V().optional()}),Vl=At.extend({method:re("notifications/cancelled"),params:ox}),sx=ee({src:V(),mimeType:V().optional(),sizes:ce(V()).optional(),theme:Rt(["light","dark"]).optional()}),$s=ee({icons:ce(sx).optional()}),ko=ee({name:V(),title:V().optional()}),_0=ko.extend({...ko.shape,...$s.shape,version:V(),websiteUrl:V().optional(),description:V().optional()}),ix=ql(ee({applyDefaults:Xe().optional()}),Ie(V(),Ae())),ax=g0(e=>e&&typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0?{form:{}}:e,ql(ee({form:ix.optional(),url:Qe.optional()}),Ie(V(),Ae()).optional())),cx=wt({list:Qe.optional(),cancel:Qe.optional(),requests:wt({sampling:wt({createMessage:Qe.optional()}).optional(),elicitation:wt({create:Qe.optional()}).optional()}).optional()}),ux=wt({list:Qe.optional(),cancel:Qe.optional(),requests:wt({tools:wt({call:Qe.optional()}).optional()}).optional()}),lx=ee({experimental:Ie(V(),Qe).optional(),sampling:ee({context:Qe.optional(),tools:Qe.optional()}).optional(),elicitation:ax.optional(),roots:ee({listChanged:Xe().optional()}).optional(),tasks:cx.optional()}),fx=Tt.extend({protocolVersion:V(),capabilities:lx,clientInfo:_0}),dx=et.extend({method:re("initialize"),params:fx}),hx=ee({experimental:Ie(V(),Qe).optional(),logging:Qe.optional(),completions:Qe.optional(),prompts:ee({listChanged:Xe().optional()}).optional(),resources:ee({subscribe:Xe().optional(),listChanged:Xe().optional()}).optional(),tools:ee({listChanged:Xe().optional()}).optional(),tasks:ux.optional()}),Zl=tt.extend({protocolVersion:V(),capabilities:hx,serverInfo:_0,instructions:V().optional()}),px=At.extend({method:re("notifications/initialized"),params:qt.optional()}),Kl=et.extend({method:re("ping"),params:Tt.optional()}),mx=ee({progress:ge(),total:Pe(ge()),message:Pe(V())}),gx=ee({...qt.shape,...mx.shape,progressToken:y0}),Gl=At.extend({method:re("notifications/progress"),params:gx}),yx=Tt.extend({cursor:w0.optional()}),Ss=et.extend({params:yx.optional()}),xs=tt.extend({nextCursor:w0.optional()}),wx=Rt(["working","input_required","completed","failed","cancelled"]),ks=ee({taskId:V(),status:wx,ttl:be([ge(),c0()]),createdAt:V(),lastUpdatedAt:V(),pollInterval:Pe(ge()),statusMessage:Pe(V())}),ds=tt.extend({task:ks}),vx=qt.merge(ks),ea=At.extend({method:re("notifications/tasks/status"),params:vx}),Wl=et.extend({method:re("tasks/get"),params:Tt.extend({taskId:V()})}),Jl=tt.merge(ks),Yl=et.extend({method:re("tasks/result"),params:Tt.extend({taskId:V()})});tt.loose();const Xl=Ss.extend({method:re("tasks/list")}),Ql=xs.extend({tasks:ce(ks)}),ef=et.extend({method:re("tasks/cancel"),params:Tt.extend({taskId:V()})}),bx=tt.merge(ks),E0=ee({uri:V(),mimeType:Pe(V()),_meta:Ie(V(),Ae()).optional()}),$0=E0.extend({text:V()}),tf=V().refine(e=>{try{return atob(e),!0}catch{return!1}},{message:"Invalid Base64 string"}),S0=E0.extend({blob:tf}),Rs=Rt(["user","assistant"]),Bo=ee({audience:ce(Rs).optional(),priority:ge().min(0).max(1).optional(),lastModified:s0({offset:!0}).optional()}),x0=ee({...ko.shape,...$s.shape,uri:V(),description:Pe(V()),mimeType:Pe(V()),annotations:Bo.optional(),_meta:Pe(wt({}))}),_x=ee({...ko.shape,...$s.shape,uriTemplate:V(),description:Pe(V()),mimeType:Pe(V()),annotations:Bo.optional(),_meta:Pe(wt({}))}),Ex=Ss.extend({method:re("resources/list")}),k0=xs.extend({resources:ce(x0)}),$x=Ss.extend({method:re("resources/templates/list")}),R0=xs.extend({resourceTemplates:ce(_x)}),rf=Tt.extend({uri:V()}),Sx=rf,xx=et.extend({method:re("resources/read"),params:Sx}),T0=tt.extend({contents:ce(be([$0,S0]))}),A0=At.extend({method:re("notifications/resources/list_changed"),params:qt.optional()}),kx=rf,Rx=et.extend({method:re("resources/subscribe"),params:kx}),Tx=rf,Ax=et.extend({method:re("resources/unsubscribe"),params:Tx}),Ix=qt.extend({uri:V()}),Ox=At.extend({method:re("notifications/resources/updated"),params:Ix}),Nx=ee({name:V(),description:Pe(V()),required:Pe(Xe())}),Cx=ee({...ko.shape,...$s.shape,description:Pe(V()),arguments:Pe(ce(Nx)),_meta:Pe(wt({}))}),Px=Ss.extend({method:re("prompts/list")}),I0=xs.extend({prompts:ce(Cx)}),Lx=Tt.extend({name:V(),arguments:Ie(V(),V()).optional()}),Ux=et.extend({method:re("prompts/get"),params:Lx}),nf=ee({type:re("text"),text:V(),annotations:Bo.optional(),_meta:Ie(V(),Ae()).optional()}),of=ee({type:re("image"),data:tf,mimeType:V(),annotations:Bo.optional(),_meta:Ie(V(),Ae()).optional()}),sf=ee({type:re("audio"),data:tf,mimeType:V(),annotations:Bo.optional(),_meta:Ie(V(),Ae()).optional()}),zx=ee({type:re("tool_use"),name:V(),id:V(),input:Ie(V(),Ae()),_meta:Ie(V(),Ae()).optional()}),Bx=ee({type:re("resource"),resource:be([$0,S0]),annotations:Bo.optional(),_meta:Ie(V(),Ae()).optional()}),Mx=x0.extend({type:re("resource_link")}),af=be([nf,of,sf,Mx,Bx]),qx=ee({role:Rs,content:af}),O0=tt.extend({description:V().optional(),messages:ce(qx)}),N0=At.extend({method:re("notifications/prompts/list_changed"),params:qt.optional()}),jx=ee({title:V().optional(),readOnlyHint:Xe().optional(),destructiveHint:Xe().optional(),idempotentHint:Xe().optional(),openWorldHint:Xe().optional()}),Dx=ee({taskSupport:Rt(["required","optional","forbidden"]).optional()}),C0=ee({...ko.shape,...$s.shape,description:V().optional(),inputSchema:ee({type:re("object"),properties:Ie(V(),Qe).optional(),required:ce(V()).optional()}).catchall(Ae()),outputSchema:ee({type:re("object"),properties:Ie(V(),Qe).optional(),required:ce(V()).optional()}).catchall(Ae()).optional(),annotations:jx.optional(),execution:Dx.optional(),_meta:Ie(V(),Ae()).optional()}),Fx=Ss.extend({method:re("tools/list")}),P0=xs.extend({tools:ce(C0)}),Ca=tt.extend({content:ce(af).default([]),structuredContent:Ie(V(),Ae()).optional(),isError:Xe().optional()});Ca.or(tt.extend({toolResult:Ae()}));const Hx=Es.extend({name:V(),arguments:Ie(V(),Ae()).optional()}),Vx=et.extend({method:re("tools/call"),params:Hx}),L0=At.extend({method:re("notifications/tools/list_changed"),params:qt.optional()}),Zx=ee({autoRefresh:Xe().default(!0),debounceMs:ge().int().nonnegative().default(300)}),U0=Rt(["debug","info","notice","warning","error","critical","alert","emergency"]),Kx=Tt.extend({level:U0}),Gx=et.extend({method:re("logging/setLevel"),params:Kx}),Wx=qt.extend({level:U0,logger:V().optional(),data:Ae()}),Jx=At.extend({method:re("notifications/message"),params:Wx}),Yx=ee({name:V().optional()}),Xx=ee({hints:ce(Yx).optional(),costPriority:ge().min(0).max(1).optional(),speedPriority:ge().min(0).max(1).optional(),intelligencePriority:ge().min(0).max(1).optional()}),Qx=ee({mode:Rt(["auto","required","none"]).optional()}),ek=ee({type:re("tool_result"),toolUseId:V().describe("The unique identifier for the corresponding tool call."),content:ce(af).default([]),structuredContent:ee({}).loose().optional(),isError:Xe().optional(),_meta:Ie(V(),Ae()).optional()}),tk=f0("type",[nf,of,sf]),ta=f0("type",[nf,of,sf,zx,ek]),rk=ee({role:Rs,content:be([ta,ce(ta)]),_meta:Ie(V(),Ae()).optional()}),nk=Es.extend({messages:ce(rk),modelPreferences:Xx.optional(),systemPrompt:V().optional(),includeContext:Rt(["none","thisServer","allServers"]).optional(),temperature:ge().optional(),maxTokens:ge().int(),stopSequences:ce(V()).optional(),metadata:Qe.optional(),tools:ce(C0).optional(),toolChoice:Qx.optional()}),z0=et.extend({method:re("sampling/createMessage"),params:nk}),B0=tt.extend({model:V(),stopReason:Pe(Rt(["endTurn","stopSequence","maxTokens"]).or(V())),role:Rs,content:tk}),M0=tt.extend({model:V(),stopReason:Pe(Rt(["endTurn","stopSequence","maxTokens","toolUse"]).or(V())),role:Rs,content:be([ta,ce(ta)])}),ok=ee({type:re("boolean"),title:V().optional(),description:V().optional(),default:Xe().optional()}),sk=ee({type:re("string"),title:V().optional(),description:V().optional(),minLength:ge().optional(),maxLength:ge().optional(),format:Rt(["email","uri","date","date-time"]).optional(),default:V().optional()}),ik=ee({type:Rt(["number","integer"]),title:V().optional(),description:V().optional(),minimum:ge().optional(),maximum:ge().optional(),default:ge().optional()}),ak=ee({type:re("string"),title:V().optional(),description:V().optional(),enum:ce(V()),default:V().optional()}),ck=ee({type:re("string"),title:V().optional(),description:V().optional(),oneOf:ce(ee({const:V(),title:V()})),default:V().optional()}),uk=ee({type:re("string"),title:V().optional(),description:V().optional(),enum:ce(V()),enumNames:ce(V()).optional(),default:V().optional()}),lk=be([ak,ck]),fk=ee({type:re("array"),title:V().optional(),description:V().optional(),minItems:ge().optional(),maxItems:ge().optional(),items:ee({type:re("string"),enum:ce(V())}),default:ce(V()).optional()}),dk=ee({type:re("array"),title:V().optional(),description:V().optional(),minItems:ge().optional(),maxItems:ge().optional(),items:ee({anyOf:ce(ee({const:V(),title:V()}))}),default:ce(V()).optional()}),hk=be([fk,dk]),pk=be([uk,lk,hk]),mk=be([pk,ok,sk,ik]),gk=Es.extend({mode:re("form").optional(),message:V(),requestedSchema:ee({type:re("object"),properties:Ie(V(),mk),required:ce(V()).optional()})}),yk=Es.extend({mode:re("url"),message:V(),elicitationId:V(),url:V().url()}),wk=be([gk,yk]),q0=et.extend({method:re("elicitation/create"),params:wk}),vk=qt.extend({elicitationId:V()}),bk=At.extend({method:re("notifications/elicitation/complete"),params:vk}),j0=tt.extend({action:Rt(["accept","decline","cancel"]),content:g0(e=>e===null?void 0:e,Ie(V(),be([V(),ge(),Xe(),ce(V())])).optional())}),_k=ee({type:re("ref/resource"),uri:V()}),Ek=ee({type:re("ref/prompt"),name:V()}),$k=Tt.extend({ref:be([Ek,_k]),argument:ee({name:V(),value:V()}),context:ee({arguments:Ie(V(),V()).optional()}).optional()}),Sk=et.extend({method:re("completion/complete"),params:$k}),D0=tt.extend({completion:wt({values:ce(V()).max(100),total:Pe(ge().int()),hasMore:Pe(Xe())})}),xk=ee({uri:V().startsWith("file://"),name:V().optional(),_meta:Ie(V(),Ae()).optional()}),kk=et.extend({method:re("roots/list"),params:Tt.optional()}),Rk=tt.extend({roots:ce(xk)}),Tk=At.extend({method:re("notifications/roots/list_changed"),params:qt.optional()});be([Kl,dx,Sk,Gx,Ux,Px,Ex,$x,xx,Rx,Ax,Vx,Fx,Wl,Yl,Xl,ef]);be([Vl,Gl,px,Tk,ea]);be([lo,B0,M0,j0,Rk,Jl,Ql,ds]);be([Kl,z0,q0,kk,Wl,Yl,Xl,ef]);be([Vl,Gl,Jx,Ox,A0,L0,N0,ea,bk]);be([lo,Zl,D0,O0,I0,k0,R0,T0,Ca,P0,Jl,Ql,ds]);class ne extends Error{constructor(t,r,n){super(`MCP error ${t}: ${r}`),this.code=t,this.data=n,this.name="McpError"}static fromError(t,r,n){if(t===se.UrlElicitationRequired&&n){const o=n;if(o.elicitations)return new Ak(o.elicitations,r)}return new ne(t,r,n)}}class Ak extends ne{constructor(t,r=`URL elicitation${t.length>1?"s":""} required`){super(se.UrlElicitationRequired,r,{elicitations:t})}get elicitations(){return this.data?.elicitations??[]}}function Sn(e){return e==="completed"||e==="failed"||e==="cancelled"}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function zh(e){const r=o0(e)?.method;if(!r)throw new Error("Schema is missing a method literal");const n=M2(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function Bh(e,t){const r=rn(e,t);if(!r.success)throw r.error;return r.data}const Ik=6e4;class Ok{constructor(t){this._options=t,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Vl,r=>{this._oncancel(r)}),this.setNotificationHandler(Gl,r=>{this._onprogress(r)}),this.setRequestHandler(Kl,r=>({})),this._taskStore=t?.taskStore,this._taskMessageQueue=t?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Wl,async(r,n)=>{const o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new ne(se.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(Yl,async(r,n)=>{const o=async()=>{const s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){const c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{const f=c,h=new ne(f.error.code,f.error.message,f.error.data);l(h)}else{const f=a.type==="response"?"Response":"Error";this._onerror(new Error(`${f} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}const i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new ne(se.InvalidParams,`Task not found: ${s}`);if(!Sn(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(Sn(i.status)){const a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[Nn]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(Xl,async(r,n)=>{try{const{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new ne(se.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(ef,async(r,n)=>{try{const o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new ne(se.InvalidParams,`Task not found: ${r.params.taskId}`);if(Sn(o.status))throw new ne(se.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);const s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new ne(se.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof ne?o:new ne(se.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(t){if(!t.params.requestId)return;this._requestHandlerAbortControllers.get(t.params.requestId)?.abort(t.params.reason)}_setupTimeout(t,r,n,o,s=!1){this._timeoutInfo.set(t,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(t){const r=this._timeoutInfo.get(t);if(!r)return!1;const n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(t),ne.fromError(se.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(t){const r=this._timeoutInfo.get(t);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(t))}async connect(t){this._transport=t;const r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};const n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};const o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),zs(s)||rx(s)?this._onresponse(s):Cn(s)?this._onrequest(s,i):Fu(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();const r=ne.fromError(se.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(const n of t.values())n(r)}_onerror(t){this.onerror?.(t)}_onnotification(t){const r=this._notificationHandlers.get(t.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(t)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(t,r){const n=this._requestHandlers.get(t.method)??this.fallbackRequestHandler,o=this._transport,s=t.params?._meta?.[Nn]?.taskId;if(n===void 0){const l={jsonrpc:"2.0",id:t.id,error:{code:se.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(f=>this._onerror(new Error(`Failed to enqueue error response: ${f}`))):o?.send(l).catch(f=>this._onerror(new Error(`Failed to send an error response: ${f}`)));return}const i=new AbortController;this._requestHandlerAbortControllers.set(t.id,i);const a=tx(t.params)?t.params.task:void 0,c=this._taskStore?this.requestTaskStore(t,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:t.params?._meta,sendNotification:async l=>{const f={relatedRequestId:t.id};s&&(f.relatedTask={taskId:s}),await this.notification(l,f)},sendRequest:async(l,f,h)=>{const p={...h,relatedRequestId:t.id};s&&!p.relatedTask&&(p.relatedTask={taskId:s});const g=p.relatedTask?.taskId??s;return g&&c&&await c.updateTaskStatus(g,"input_required"),await this.request(l,f,p)},authInfo:r?.authInfo,requestId:t.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(t.method)}).then(()=>n(t,u)).then(async l=>{if(i.signal.aborted)return;const f={result:l,jsonrpc:"2.0",id:t.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:f,timestamp:Date.now()},o?.sessionId):await o?.send(f)},async l=>{if(i.signal.aborted)return;const f={jsonrpc:"2.0",id:t.id,error:{code:Number.isSafeInteger(l.code)?l.code:se.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:f,timestamp:Date.now()},o?.sessionId):await o?.send(f)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(t.id)})}_onprogress(t){const{progressToken:r,...n}=t.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(t)}`));return}const i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(t){const r=Number(t.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),zs(t))n(t);else{const i=new ne(t.error.code,t.error.message,t.error.data);n(i)}return}const o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(t)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(zs(t)&&t.result&&typeof t.result=="object"){const i=t.result;if(i.task&&typeof i.task=="object"){const a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),zs(t))o(t);else{const i=ne.fromError(t.error.code,t.error.message,t.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(t,r,n){const{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(t,r,n)}}catch(i){yield{type:"error",error:i instanceof ne?i:new ne(se.InternalError,String(i))}}return}let s;try{const i=await this.request(t,ds,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new ne(se.InternalError,"Task creation did not return a task");for(;;){const a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},Sn(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new ne(se.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new ne(se.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}const c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof ne?i:new ne(se.InternalError,String(i))}}}request(t,r,n){const{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{const f=y=>{l(y)};if(!this._transport){f(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(t.method),a&&this.assertTaskCapability(t.method)}catch(y){f(y);return}n?.signal?.throwIfAborted();const h=this._requestMessageId++,p={...t,jsonrpc:"2.0",id:h};n?.onprogress&&(this._progressHandlers.set(h,n.onprogress),p.params={...t.params,_meta:{...t.params?._meta||{},progressToken:h}}),a&&(p.params={...p.params,task:a}),c&&(p.params={...p.params,_meta:{...p.params?._meta||{},[Nn]:c}});const g=y=>{this._responseHandlers.delete(h),this._progressHandlers.delete(h),this._cleanupTimeout(h),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:h,reason:String(y)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(E=>this._onerror(new Error(`Failed to send cancellation: ${E}`)));const v=y instanceof ne?y:new ne(se.RequestTimeout,String(y));l(v)};this._responseHandlers.set(h,y=>{if(!n?.signal?.aborted){if(y instanceof Error)return l(y);try{const v=rn(r,y.result);v.success?u(v.data):l(v.error)}catch(v){l(v)}}}),n?.signal?.addEventListener("abort",()=>{g(n?.signal?.reason)});const m=n?.timeout??Ik,d=()=>g(ne.fromError(se.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(h,m,n?.maxTotalTimeout,d,n?.resetTimeoutOnProgress??!1);const w=c?.taskId;if(w){const y=v=>{const E=this._responseHandlers.get(h);E?E(v):this._onerror(new Error(`Response handler missing for side-channeled request ${h}`))};this._requestResolvers.set(h,y),this._enqueueTaskMessage(w,{type:"request",message:p,timestamp:Date.now()}).catch(v=>{this._cleanupTimeout(h),l(v)})}else this._transport.send(p,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(y=>{this._cleanupTimeout(h),l(y)})})}async getTask(t,r){return this.request({method:"tasks/get",params:t},Jl,r)}async getTaskResult(t,r,n){return this.request({method:"tasks/result",params:t},r,n)}async listTasks(t,r){return this.request({method:"tasks/list",params:t},Ql,r)}async cancelTask(t,r){return this.request({method:"tasks/cancel",params:t},bx,r)}async notification(t,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(t.method);const n=r?.relatedTask?.taskId;if(n){const a={...t,jsonrpc:"2.0",params:{...t.params,_meta:{...t.params?._meta||{},[Nn]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(t.method)&&!t.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(t.method))return;this._pendingDebouncedNotifications.add(t.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(t.method),!this._transport)return;let a={...t,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Nn]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...t,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[Nn]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(t,r){const n=zh(t);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{const i=Bh(t,o);return Promise.resolve(r(i,s))})}removeRequestHandler(t){this._requestHandlers.delete(t)}assertCanSetRequestHandler(t){if(this._requestHandlers.has(t))throw new Error(`A request handler for ${t} already exists, which would be overridden`)}setNotificationHandler(t,r){const n=zh(t);this._notificationHandlers.set(n,o=>{const s=Bh(t,o);return Promise.resolve(r(s))})}removeNotificationHandler(t){this._notificationHandlers.delete(t)}_cleanupTaskProgressHandler(t){const r=this._taskProgressTokens.get(t);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(t))}async _enqueueTaskMessage(t,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");const o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(t,r,n,o)}async _clearTaskQueue(t,r){if(this._taskMessageQueue){const n=await this._taskMessageQueue.dequeueAll(t,r);for(const o of n)if(o.type==="request"&&Cn(o.message)){const s=o.message.id,i=this._requestResolvers.get(s);i?(i(new ne(se.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${t} cleanup`))}}}async _waitForTaskUpdate(t,r){let n=this._options?.defaultTaskPollInterval??1e3;try{const o=await this._taskStore?.getTask(t);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new ne(se.InvalidRequest,"Request cancelled"));return}const i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new ne(se.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(t,r){const n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!t)throw new Error("No request provided");return await n.createTask(o,t.id,{method:t.method,params:t.params},r)},getTask:async o=>{const s=await n.getTask(o,r);if(!s)throw new ne(se.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);const a=await n.getTask(o,r);if(a){const c=ea.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Sn(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{const a=await n.getTask(o,r);if(!a)throw new ne(se.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Sn(a.status))throw new ne(se.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);const c=await n.getTask(o,r);if(c){const u=ea.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Sn(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}}function Mh(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function Nk(e,t){const r={...e};for(const n in t){const o=n,s=t[o];if(s===void 0)continue;const i=r[o];Mh(i)&&Mh(s)?r[o]={...i,...s}:r[o]=s}return r}function Pa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bs={exports:{}},Rc={},pr={},xn={},Tc={},Ac={},Ic={},qh;function ra(){return qh||(qh=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(y){if(super(),!e.IDENTIFIER.test(y))throw new Error("CodeGen: name must be a valid identifier");this.str=y}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(y){super(),this._items=typeof y=="string"?[y]:y}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const y=this._items[0];return y===""||y==='""'}get str(){var y;return(y=this._str)!==null&&y!==void 0?y:this._str=this._items.reduce((v,E)=>`${v}${E}`,"")}get names(){var y;return(y=this._names)!==null&&y!==void 0?y:this._names=this._items.reduce((v,E)=>(E instanceof r&&(v[E.str]=(v[E.str]||0)+1),v),{})}}e._Code=n,e.nil=new n("");function o(w,...y){const v=[w[0]];let E=0;for(;E<y.length;)a(v,y[E]),v.push(w[++E]);return new n(v)}e._=o;const s=new n("+");function i(w,...y){const v=[p(w[0])];let E=0;for(;E<y.length;)v.push(s),a(v,y[E]),v.push(s,p(w[++E]));return c(v),new n(v)}e.str=i;function a(w,y){y instanceof n?w.push(...y._items):y instanceof r?w.push(y):w.push(f(y))}e.addCodeArg=a;function c(w){let y=1;for(;y<w.length-1;){if(w[y]===s){const v=u(w[y-1],w[y+1]);if(v!==void 0){w.splice(y-1,3,v);continue}w[y++]="+"}y++}}function u(w,y){if(y==='""')return w;if(w==='""')return y;if(typeof w=="string")return y instanceof r||w[w.length-1]!=='"'?void 0:typeof y!="string"?`${w.slice(0,-1)}${y}"`:y[0]==='"'?w.slice(0,-1)+y.slice(1):void 0;if(typeof y=="string"&&y[0]==='"'&&!(w instanceof r))return`"${w}${y.slice(1)}`}function l(w,y){return y.emptyStr()?w:w.emptyStr()?y:i`${w}${y}`}e.strConcat=l;function f(w){return typeof w=="number"||typeof w=="boolean"||w===null?w:p(Array.isArray(w)?w.join(","):w)}function h(w){return new n(p(w))}e.stringify=h;function p(w){return JSON.stringify(w).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=p;function g(w){return typeof w=="string"&&e.IDENTIFIER.test(w)?new n(`.${w}`):o`[${w}]`}e.getProperty=g;function m(w){if(typeof w=="string"&&e.IDENTIFIER.test(w))return new n(`${w}`);throw new Error(`CodeGen: invalid export name: ${w}, use explicit $id name mapping`)}e.getEsmExportName=m;function d(w){return new n(w.toString())}e.regexpCode=d})(Ic)),Ic}var Oc={},jh;function Dh(){return jh||(jh=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=ra();class r extends Error{constructor(u){super(`CodeGen: "code" for ${u} not defined`),this.value=u.value}}var n;(function(c){c[c.Started=0]="Started",c[c.Completed=1]="Completed"})(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class o{constructor({prefixes:u,parent:l}={}){this._names={},this._prefixes=u,this._parent=l}toName(u){return u instanceof t.Name?u:this.name(u)}name(u){return new t.Name(this._newName(u))}_newName(u){const l=this._names[u]||this._nameGroup(u);return`${u}${l.index++}`}_nameGroup(u){var l,f;if(!((f=(l=this._parent)===null||l===void 0?void 0:l._prefixes)===null||f===void 0)&&f.has(u)||this._prefixes&&!this._prefixes.has(u))throw new Error(`CodeGen: prefix "${u}" is not allowed in this scope`);return this._names[u]={prefix:u,index:0}}}e.Scope=o;class s extends t.Name{constructor(u,l){super(l),this.prefix=u}setValue(u,{property:l,itemIndex:f}){this.value=u,this.scopePath=(0,t._)`.${new t.Name(l)}[${f}]`}}e.ValueScopeName=s;const i=(0,t._)`\n`;class a extends o{constructor(u){super(u),this._values={},this._scope=u.scope,this.opts={...u,_n:u.lines?i:t.nil}}get(){return this._scope}name(u){return new s(u,this._newName(u))}value(u,l){var f;if(l.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const h=this.toName(u),{prefix:p}=h,g=(f=l.key)!==null&&f!==void 0?f:l.ref;let m=this._values[p];if(m){const y=m.get(g);if(y)return y}else m=this._values[p]=new Map;m.set(g,h);const d=this._scope[p]||(this._scope[p]=[]),w=d.length;return d[w]=l.ref,h.setValue(l,{property:p,itemIndex:w}),h}getValue(u,l){const f=this._values[u];if(f)return f.get(l)}scopeRefs(u,l=this._values){return this._reduceValues(l,f=>{if(f.scopePath===void 0)throw new Error(`CodeGen: name "${f}" has no value`);return(0,t._)`${u}${f.scopePath}`})}scopeCode(u=this._values,l,f){return this._reduceValues(u,h=>{if(h.value===void 0)throw new Error(`CodeGen: name "${h}" has no value`);return h.value.code},l,f)}_reduceValues(u,l,f={},h){let p=t.nil;for(const g in u){const m=u[g];if(!m)continue;const d=f[g]=f[g]||new Map;m.forEach(w=>{if(d.has(w))return;d.set(w,n.Started);let y=l(w);if(y){const v=this.opts.es5?e.varKinds.var:e.varKinds.const;p=(0,t._)`${p}${v} ${w} = ${y};${this.opts._n}`}else if(y=h?.(w))p=(0,t._)`${p}${y}${this.opts._n}`;else throw new r(w);d.set(w,n.Completed)})}return p}}e.ValueScope=a})(Oc)),Oc}var Fh;function ae(){return Fh||(Fh=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=ra(),r=Dh();var n=ra();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var o=Dh();Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return o.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return o.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return o.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return o.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class s{optimizeNodes(){return this}optimizeNames(x,R){return this}}class i extends s{constructor(x,R,H){super(),this.varKind=x,this.name=R,this.rhs=H}render({es5:x,_n:R}){const H=x?r.varKinds.var:this.varKind,G=this.rhs===void 0?"":` = ${this.rhs}`;return`${H} ${this.name}${G};`+R}optimizeNames(x,R){if(x[this.name.str])return this.rhs&&(this.rhs=z(this.rhs,x,R)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class a extends s{constructor(x,R,H){super(),this.lhs=x,this.rhs=R,this.sideEffects=H}render({_n:x}){return`${this.lhs} = ${this.rhs};`+x}optimizeNames(x,R){if(!(this.lhs instanceof t.Name&&!x[this.lhs.str]&&!this.sideEffects))return this.rhs=z(this.rhs,x,R),this}get names(){const x=this.lhs instanceof t.Name?{}:{...this.lhs.names};return U(x,this.rhs)}}class c extends a{constructor(x,R,H,G){super(x,H,G),this.op=R}render({_n:x}){return`${this.lhs} ${this.op}= ${this.rhs};`+x}}class u extends s{constructor(x){super(),this.label=x,this.names={}}render({_n:x}){return`${this.label}:`+x}}class l extends s{constructor(x){super(),this.label=x,this.names={}}render({_n:x}){return`break${this.label?` ${this.label}`:""};`+x}}class f extends s{constructor(x){super(),this.error=x}render({_n:x}){return`throw ${this.error};`+x}get names(){return this.error.names}}class h extends s{constructor(x){super(),this.code=x}render({_n:x}){return`${this.code};`+x}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(x,R){return this.code=z(this.code,x,R),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class p extends s{constructor(x=[]){super(),this.nodes=x}render(x){return this.nodes.reduce((R,H)=>R+H.render(x),"")}optimizeNodes(){const{nodes:x}=this;let R=x.length;for(;R--;){const H=x[R].optimizeNodes();Array.isArray(H)?x.splice(R,1,...H):H?x[R]=H:x.splice(R,1)}return x.length>0?this:void 0}optimizeNames(x,R){const{nodes:H}=this;let G=H.length;for(;G--;){const J=H[G];J.optimizeNames(x,R)||(k(x,J.names),H.splice(G,1))}return H.length>0?this:void 0}get names(){return this.nodes.reduce((x,R)=>D(x,R.names),{})}}class g extends p{render(x){return"{"+x._n+super.render(x)+"}"+x._n}}class m extends p{}class d extends g{}d.kind="else";class w extends g{constructor(x,R){super(R),this.condition=x}render(x){let R=`if(${this.condition})`+super.render(x);return this.else&&(R+="else "+this.else.render(x)),R}optimizeNodes(){super.optimizeNodes();const x=this.condition;if(x===!0)return this.nodes;let R=this.else;if(R){const H=R.optimizeNodes();R=this.else=Array.isArray(H)?new d(H):H}if(R)return x===!1?R instanceof w?R:R.nodes:this.nodes.length?this:new w(S(x),R instanceof w?[R]:R.nodes);if(!(x===!1||!this.nodes.length))return this}optimizeNames(x,R){var H;if(this.else=(H=this.else)===null||H===void 0?void 0:H.optimizeNames(x,R),!!(super.optimizeNames(x,R)||this.else))return this.condition=z(this.condition,x,R),this}get names(){const x=super.names;return U(x,this.condition),this.else&&D(x,this.else.names),x}}w.kind="if";class y extends g{}y.kind="for";class v extends y{constructor(x){super(),this.iteration=x}render(x){return`for(${this.iteration})`+super.render(x)}optimizeNames(x,R){if(super.optimizeNames(x,R))return this.iteration=z(this.iteration,x,R),this}get names(){return D(super.names,this.iteration.names)}}class E extends y{constructor(x,R,H,G){super(),this.varKind=x,this.name=R,this.from=H,this.to=G}render(x){const R=x.es5?r.varKinds.var:this.varKind,{name:H,from:G,to:J}=this;return`for(${R} ${H}=${G}; ${H}<${J}; ${H}++)`+super.render(x)}get names(){const x=U(super.names,this.from);return U(x,this.to)}}class b extends y{constructor(x,R,H,G){super(),this.loop=x,this.varKind=R,this.name=H,this.iterable=G}render(x){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(x)}optimizeNames(x,R){if(super.optimizeNames(x,R))return this.iterable=z(this.iterable,x,R),this}get names(){return D(super.names,this.iterable.names)}}class _ extends g{constructor(x,R,H){super(),this.name=x,this.args=R,this.async=H}render(x){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(x)}}_.kind="func";class $ extends p{render(x){return"return "+super.render(x)}}$.kind="return";class A extends g{render(x){let R="try"+super.render(x);return this.catch&&(R+=this.catch.render(x)),this.finally&&(R+=this.finally.render(x)),R}optimizeNodes(){var x,R;return super.optimizeNodes(),(x=this.catch)===null||x===void 0||x.optimizeNodes(),(R=this.finally)===null||R===void 0||R.optimizeNodes(),this}optimizeNames(x,R){var H,G;return super.optimizeNames(x,R),(H=this.catch)===null||H===void 0||H.optimizeNames(x,R),(G=this.finally)===null||G===void 0||G.optimizeNames(x,R),this}get names(){const x=super.names;return this.catch&&D(x,this.catch.names),this.finally&&D(x,this.finally.names),x}}class q extends g{constructor(x){super(),this.error=x}render(x){return`catch(${this.error})`+super.render(x)}}q.kind="catch";class F extends g{render(x){return"finally"+super.render(x)}}F.kind="finally";class L{constructor(x,R={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...R,_n:R.lines?`
`:""},this._extScope=x,this._scope=new r.Scope({parent:x}),this._nodes=[new m]}toString(){return this._root.render(this.opts)}name(x){return this._scope.name(x)}scopeName(x){return this._extScope.name(x)}scopeValue(x,R){const H=this._extScope.value(x,R);return(this._values[H.prefix]||(this._values[H.prefix]=new Set)).add(H),H}getScopeValue(x,R){return this._extScope.getValue(x,R)}scopeRefs(x){return this._extScope.scopeRefs(x,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(x,R,H,G){const J=this._scope.toName(R);return H!==void 0&&G&&(this._constants[J.str]=H),this._leafNode(new i(x,J,H)),J}const(x,R,H){return this._def(r.varKinds.const,x,R,H)}let(x,R,H){return this._def(r.varKinds.let,x,R,H)}var(x,R,H){return this._def(r.varKinds.var,x,R,H)}assign(x,R,H){return this._leafNode(new a(x,R,H))}add(x,R){return this._leafNode(new c(x,e.operators.ADD,R))}code(x){return typeof x=="function"?x():x!==t.nil&&this._leafNode(new h(x)),this}object(...x){const R=["{"];for(const[H,G]of x)R.length>1&&R.push(","),R.push(H),(H!==G||this.opts.es5)&&(R.push(":"),(0,t.addCodeArg)(R,G));return R.push("}"),new t._Code(R)}if(x,R,H){if(this._blockNode(new w(x)),R&&H)this.code(R).else().code(H).endIf();else if(R)this.code(R).endIf();else if(H)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(x){return this._elseNode(new w(x))}else(){return this._elseNode(new d)}endIf(){return this._endBlockNode(w,d)}_for(x,R){return this._blockNode(x),R&&this.code(R).endFor(),this}for(x,R){return this._for(new v(x),R)}forRange(x,R,H,G,J=this.opts.es5?r.varKinds.var:r.varKinds.let){const Y=this._scope.toName(x);return this._for(new E(J,Y,R,H),()=>G(Y))}forOf(x,R,H,G=r.varKinds.const){const J=this._scope.toName(x);if(this.opts.es5){const Y=R instanceof t.Name?R:this.var("_arr",R);return this.forRange("_i",0,(0,t._)`${Y}.length`,X=>{this.var(J,(0,t._)`${Y}[${X}]`),H(J)})}return this._for(new b("of",G,J,R),()=>H(J))}forIn(x,R,H,G=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(x,(0,t._)`Object.keys(${R})`,H);const J=this._scope.toName(x);return this._for(new b("in",G,J,R),()=>H(J))}endFor(){return this._endBlockNode(y)}label(x){return this._leafNode(new u(x))}break(x){return this._leafNode(new l(x))}return(x){const R=new $;if(this._blockNode(R),this.code(x),R.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode($)}try(x,R,H){if(!R&&!H)throw new Error('CodeGen: "try" without "catch" and "finally"');const G=new A;if(this._blockNode(G),this.code(x),R){const J=this.name("e");this._currNode=G.catch=new q(J),R(J)}return H&&(this._currNode=G.finally=new F,this.code(H)),this._endBlockNode(q,F)}throw(x){return this._leafNode(new f(x))}block(x,R){return this._blockStarts.push(this._nodes.length),x&&this.code(x).endBlock(R),this}endBlock(x){const R=this._blockStarts.pop();if(R===void 0)throw new Error("CodeGen: not in self-balancing block");const H=this._nodes.length-R;if(H<0||x!==void 0&&H!==x)throw new Error(`CodeGen: wrong number of nodes: ${H} vs ${x} expected`);return this._nodes.length=R,this}func(x,R=t.nil,H,G){return this._blockNode(new _(x,R,H)),G&&this.code(G).endFunc(),this}endFunc(){return this._endBlockNode(_)}optimize(x=1){for(;x-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(x){return this._currNode.nodes.push(x),this}_blockNode(x){this._currNode.nodes.push(x),this._nodes.push(x)}_endBlockNode(x,R){const H=this._currNode;if(H instanceof x||R&&H instanceof R)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${R?`${x.kind}/${R.kind}`:x.kind}"`)}_elseNode(x){const R=this._currNode;if(!(R instanceof w))throw new Error('CodeGen: "else" without "if"');return this._currNode=R.else=x,this}get _root(){return this._nodes[0]}get _currNode(){const x=this._nodes;return x[x.length-1]}set _currNode(x){const R=this._nodes;R[R.length-1]=x}}e.CodeGen=L;function D(C,x){for(const R in x)C[R]=(C[R]||0)+(x[R]||0);return C}function U(C,x){return x instanceof t._CodeOrName?D(C,x.names):C}function z(C,x,R){if(C instanceof t.Name)return H(C);if(!G(C))return C;return new t._Code(C._items.reduce((J,Y)=>(Y instanceof t.Name&&(Y=H(Y)),Y instanceof t._Code?J.push(...Y._items):J.push(Y),J),[]));function H(J){const Y=R[J.str];return Y===void 0||x[J.str]!==1?J:(delete x[J.str],Y)}function G(J){return J instanceof t._Code&&J._items.some(Y=>Y instanceof t.Name&&x[Y.str]===1&&R[Y.str]!==void 0)}}function k(C,x){for(const R in x)C[R]=(C[R]||0)-(x[R]||0)}function S(C){return typeof C=="boolean"||typeof C=="number"||C===null?!C:(0,t._)`!${N(C)}`}e.not=S;const O=T(e.operators.AND);function P(...C){return C.reduce(O)}e.and=P;const B=T(e.operators.OR);function I(...C){return C.reduce(B)}e.or=I;function T(C){return(x,R)=>x===t.nil?R:R===t.nil?x:(0,t._)`${N(x)} ${C} ${N(R)}`}function N(C){return C instanceof t.Name?C:(0,t._)`(${C})`}})(Ac)),Ac}var ie={},Hh;function de(){if(Hh)return ie;Hh=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.checkStrictMode=ie.getErrorPath=ie.Type=ie.useFunc=ie.setEvaluated=ie.evaluatedPropsToName=ie.mergeEvaluated=ie.eachItem=ie.unescapeJsonPointer=ie.escapeJsonPointer=ie.escapeFragment=ie.unescapeFragment=ie.schemaRefOrVal=ie.schemaHasRulesButRef=ie.schemaHasRules=ie.checkUnknownRules=ie.alwaysValidSchema=ie.toHash=void 0;const e=ae(),t=ra();function r(b){const _={};for(const $ of b)_[$]=!0;return _}ie.toHash=r;function n(b,_){return typeof _=="boolean"?_:Object.keys(_).length===0?!0:(o(b,_),!s(_,b.self.RULES.all))}ie.alwaysValidSchema=n;function o(b,_=b.schema){const{opts:$,self:A}=b;if(!$.strictSchema||typeof _=="boolean")return;const q=A.RULES.keywords;for(const F in _)q[F]||E(b,`unknown keyword: "${F}"`)}ie.checkUnknownRules=o;function s(b,_){if(typeof b=="boolean")return!b;for(const $ in b)if(_[$])return!0;return!1}ie.schemaHasRules=s;function i(b,_){if(typeof b=="boolean")return!b;for(const $ in b)if($!=="$ref"&&_.all[$])return!0;return!1}ie.schemaHasRulesButRef=i;function a({topSchemaRef:b,schemaPath:_},$,A,q){if(!q){if(typeof $=="number"||typeof $=="boolean")return $;if(typeof $=="string")return(0,e._)`${$}`}return(0,e._)`${b}${_}${(0,e.getProperty)(A)}`}ie.schemaRefOrVal=a;function c(b){return f(decodeURIComponent(b))}ie.unescapeFragment=c;function u(b){return encodeURIComponent(l(b))}ie.escapeFragment=u;function l(b){return typeof b=="number"?`${b}`:b.replace(/~/g,"~0").replace(/\//g,"~1")}ie.escapeJsonPointer=l;function f(b){return b.replace(/~1/g,"/").replace(/~0/g,"~")}ie.unescapeJsonPointer=f;function h(b,_){if(Array.isArray(b))for(const $ of b)_($);else _(b)}ie.eachItem=h;function p({mergeNames:b,mergeToName:_,mergeValues:$,resultToName:A}){return(q,F,L,D)=>{const U=L===void 0?F:L instanceof e.Name?(F instanceof e.Name?b(q,F,L):_(q,F,L),L):F instanceof e.Name?(_(q,L,F),F):$(F,L);return D===e.Name&&!(U instanceof e.Name)?A(q,U):U}}ie.mergeEvaluated={props:p({mergeNames:(b,_,$)=>b.if((0,e._)`${$} !== true && ${_} !== undefined`,()=>{b.if((0,e._)`${_} === true`,()=>b.assign($,!0),()=>b.assign($,(0,e._)`${$} || {}`).code((0,e._)`Object.assign(${$}, ${_})`))}),mergeToName:(b,_,$)=>b.if((0,e._)`${$} !== true`,()=>{_===!0?b.assign($,!0):(b.assign($,(0,e._)`${$} || {}`),m(b,$,_))}),mergeValues:(b,_)=>b===!0?!0:{...b,..._},resultToName:g}),items:p({mergeNames:(b,_,$)=>b.if((0,e._)`${$} !== true && ${_} !== undefined`,()=>b.assign($,(0,e._)`${_} === true ? true : ${$} > ${_} ? ${$} : ${_}`)),mergeToName:(b,_,$)=>b.if((0,e._)`${$} !== true`,()=>b.assign($,_===!0?!0:(0,e._)`${$} > ${_} ? ${$} : ${_}`)),mergeValues:(b,_)=>b===!0?!0:Math.max(b,_),resultToName:(b,_)=>b.var("items",_)})};function g(b,_){if(_===!0)return b.var("props",!0);const $=b.var("props",(0,e._)`{}`);return _!==void 0&&m(b,$,_),$}ie.evaluatedPropsToName=g;function m(b,_,$){Object.keys($).forEach(A=>b.assign((0,e._)`${_}${(0,e.getProperty)(A)}`,!0))}ie.setEvaluated=m;const d={};function w(b,_){return b.scopeValue("func",{ref:_,code:d[_.code]||(d[_.code]=new t._Code(_.code))})}ie.useFunc=w;var y;(function(b){b[b.Num=0]="Num",b[b.Str=1]="Str"})(y||(ie.Type=y={}));function v(b,_,$){if(b instanceof e.Name){const A=_===y.Num;return $?A?(0,e._)`"[" + ${b} + "]"`:(0,e._)`"['" + ${b} + "']"`:A?(0,e._)`"/" + ${b}`:(0,e._)`"/" + ${b}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return $?(0,e.getProperty)(b).toString():"/"+l(b)}ie.getErrorPath=v;function E(b,_,$=b.opts.strictSchema){if($){if(_=`strict mode: ${_}`,$===!0)throw new Error(_);b.self.logger.warn(_)}}return ie.checkStrictMode=E,ie}var Ms={},Vh;function bn(){if(Vh)return Ms;Vh=1,Object.defineProperty(Ms,"__esModule",{value:!0});const e=ae(),t={data:new e.Name("data"),valCxt:new e.Name("valCxt"),instancePath:new e.Name("instancePath"),parentData:new e.Name("parentData"),parentDataProperty:new e.Name("parentDataProperty"),rootData:new e.Name("rootData"),dynamicAnchors:new e.Name("dynamicAnchors"),vErrors:new e.Name("vErrors"),errors:new e.Name("errors"),this:new e.Name("this"),self:new e.Name("self"),scope:new e.Name("scope"),json:new e.Name("json"),jsonPos:new e.Name("jsonPos"),jsonLen:new e.Name("jsonLen"),jsonPart:new e.Name("jsonPart")};return Ms.default=t,Ms}var Zh;function La(){return Zh||(Zh=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=ae(),r=de(),n=bn();e.keywordError={message:({keyword:d})=>(0,t.str)`must pass "${d}" keyword validation`},e.keyword$DataError={message:({keyword:d,schemaType:w})=>w?(0,t.str)`"${d}" keyword must be ${w} ($data)`:(0,t.str)`"${d}" keyword is invalid ($data)`};function o(d,w=e.keywordError,y,v){const{it:E}=d,{gen:b,compositeRule:_,allErrors:$}=E,A=f(d,w,y);v??(_||$)?c(b,A):u(E,(0,t._)`[${A}]`)}e.reportError=o;function s(d,w=e.keywordError,y){const{it:v}=d,{gen:E,compositeRule:b,allErrors:_}=v,$=f(d,w,y);c(E,$),b||_||u(v,n.default.vErrors)}e.reportExtraError=s;function i(d,w){d.assign(n.default.errors,w),d.if((0,t._)`${n.default.vErrors} !== null`,()=>d.if(w,()=>d.assign((0,t._)`${n.default.vErrors}.length`,w),()=>d.assign(n.default.vErrors,null)))}e.resetErrorsCount=i;function a({gen:d,keyword:w,schemaValue:y,data:v,errsCount:E,it:b}){if(E===void 0)throw new Error("ajv implementation error");const _=d.name("err");d.forRange("i",E,n.default.errors,$=>{d.const(_,(0,t._)`${n.default.vErrors}[${$}]`),d.if((0,t._)`${_}.instancePath === undefined`,()=>d.assign((0,t._)`${_}.instancePath`,(0,t.strConcat)(n.default.instancePath,b.errorPath))),d.assign((0,t._)`${_}.schemaPath`,(0,t.str)`${b.errSchemaPath}/${w}`),b.opts.verbose&&(d.assign((0,t._)`${_}.schema`,y),d.assign((0,t._)`${_}.data`,v))})}e.extendErrors=a;function c(d,w){const y=d.const("err",w);d.if((0,t._)`${n.default.vErrors} === null`,()=>d.assign(n.default.vErrors,(0,t._)`[${y}]`),(0,t._)`${n.default.vErrors}.push(${y})`),d.code((0,t._)`${n.default.errors}++`)}function u(d,w){const{gen:y,validateName:v,schemaEnv:E}=d;E.$async?y.throw((0,t._)`new ${d.ValidationError}(${w})`):(y.assign((0,t._)`${v}.errors`,w),y.return(!1))}const l={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function f(d,w,y){const{createErrors:v}=d.it;return v===!1?(0,t._)`{}`:h(d,w,y)}function h(d,w,y={}){const{gen:v,it:E}=d,b=[p(E,y),g(d,y)];return m(d,w,b),v.object(...b)}function p({errorPath:d},{instancePath:w}){const y=w?(0,t.str)`${d}${(0,r.getErrorPath)(w,r.Type.Str)}`:d;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,y)]}function g({keyword:d,it:{errSchemaPath:w}},{schemaPath:y,parentSchema:v}){let E=v?w:(0,t.str)`${w}/${d}`;return y&&(E=(0,t.str)`${E}${(0,r.getErrorPath)(y,r.Type.Str)}`),[l.schemaPath,E]}function m(d,{params:w,message:y},v){const{keyword:E,data:b,schemaValue:_,it:$}=d,{opts:A,propertyName:q,topSchemaRef:F,schemaPath:L}=$;v.push([l.keyword,E],[l.params,typeof w=="function"?w(d):w||(0,t._)`{}`]),A.messages&&v.push([l.message,typeof y=="function"?y(d):y]),A.verbose&&v.push([l.schema,_],[l.parentSchema,(0,t._)`${F}${L}`],[n.default.data,b]),q&&v.push([l.propertyName,q])}})(Tc)),Tc}var Kh;function Ck(){if(Kh)return xn;Kh=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.boolOrEmptySchema=xn.topBoolOrEmptySchema=void 0;const e=La(),t=ae(),r=bn(),n={message:"boolean schema is false"};function o(a){const{gen:c,schema:u,validateName:l}=a;u===!1?i(a,!1):typeof u=="object"&&u.$async===!0?c.return(r.default.data):(c.assign((0,t._)`${l}.errors`,null),c.return(!0))}xn.topBoolOrEmptySchema=o;function s(a,c){const{gen:u,schema:l}=a;l===!1?(u.var(c,!1),i(a)):u.var(c,!0)}xn.boolOrEmptySchema=s;function i(a,c){const{gen:u,data:l}=a,f={gen:u,keyword:"false schema",data:l,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:a};(0,e.reportError)(f,n,void 0,c)}return xn}var Ge={},kn={},Gh;function F0(){if(Gh)return kn;Gh=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.getRules=kn.isJSONType=void 0;const e=["string","number","integer","boolean","null","object","array"],t=new Set(e);function r(o){return typeof o=="string"&&t.has(o)}kn.isJSONType=r;function n(){const o={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...o,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},o.number,o.string,o.array,o.object],post:{rules:[]},all:{},keywords:{}}}return kn.getRules=n,kn}var mr={},Wh;function H0(){if(Wh)return mr;Wh=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.shouldUseRule=mr.shouldUseGroup=mr.schemaHasRulesForType=void 0;function e({schema:n,self:o},s){const i=o.RULES.types[s];return i&&i!==!0&&t(n,i)}mr.schemaHasRulesForType=e;function t(n,o){return o.rules.some(s=>r(n,s))}mr.shouldUseGroup=t;function r(n,o){var s;return n[o.keyword]!==void 0||((s=o.definition.implements)===null||s===void 0?void 0:s.some(i=>n[i]!==void 0))}return mr.shouldUseRule=r,mr}var Jh;function na(){if(Jh)return Ge;Jh=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.reportTypeError=Ge.checkDataTypes=Ge.checkDataType=Ge.coerceAndCheckDataType=Ge.getJSONTypes=Ge.getSchemaTypes=Ge.DataType=void 0;const e=F0(),t=H0(),r=La(),n=ae(),o=de();var s;(function(y){y[y.Correct=0]="Correct",y[y.Wrong=1]="Wrong"})(s||(Ge.DataType=s={}));function i(y){const v=a(y.type);if(v.includes("null")){if(y.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!v.length&&y.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');y.nullable===!0&&v.push("null")}return v}Ge.getSchemaTypes=i;function a(y){const v=Array.isArray(y)?y:y?[y]:[];if(v.every(e.isJSONType))return v;throw new Error("type must be JSONType or JSONType[]: "+v.join(","))}Ge.getJSONTypes=a;function c(y,v){const{gen:E,data:b,opts:_}=y,$=l(v,_.coerceTypes),A=v.length>0&&!($.length===0&&v.length===1&&(0,t.schemaHasRulesForType)(y,v[0]));if(A){const q=g(v,b,_.strictNumbers,s.Wrong);E.if(q,()=>{$.length?f(y,v,$):d(y)})}return A}Ge.coerceAndCheckDataType=c;const u=new Set(["string","number","integer","boolean","null"]);function l(y,v){return v?y.filter(E=>u.has(E)||v==="array"&&E==="array"):[]}function f(y,v,E){const{gen:b,data:_,opts:$}=y,A=b.let("dataType",(0,n._)`typeof ${_}`),q=b.let("coerced",(0,n._)`undefined`);$.coerceTypes==="array"&&b.if((0,n._)`${A} == 'object' && Array.isArray(${_}) && ${_}.length == 1`,()=>b.assign(_,(0,n._)`${_}[0]`).assign(A,(0,n._)`typeof ${_}`).if(g(v,_,$.strictNumbers),()=>b.assign(q,_))),b.if((0,n._)`${q} !== undefined`);for(const L of E)(u.has(L)||L==="array"&&$.coerceTypes==="array")&&F(L);b.else(),d(y),b.endIf(),b.if((0,n._)`${q} !== undefined`,()=>{b.assign(_,q),h(y,q)});function F(L){switch(L){case"string":b.elseIf((0,n._)`${A} == "number" || ${A} == "boolean"`).assign(q,(0,n._)`"" + ${_}`).elseIf((0,n._)`${_} === null`).assign(q,(0,n._)`""`);return;case"number":b.elseIf((0,n._)`${A} == "boolean" || ${_} === null
              || (${A} == "string" && ${_} && ${_} == +${_})`).assign(q,(0,n._)`+${_}`);return;case"integer":b.elseIf((0,n._)`${A} === "boolean" || ${_} === null
              || (${A} === "string" && ${_} && ${_} == +${_} && !(${_} % 1))`).assign(q,(0,n._)`+${_}`);return;case"boolean":b.elseIf((0,n._)`${_} === "false" || ${_} === 0 || ${_} === null`).assign(q,!1).elseIf((0,n._)`${_} === "true" || ${_} === 1`).assign(q,!0);return;case"null":b.elseIf((0,n._)`${_} === "" || ${_} === 0 || ${_} === false`),b.assign(q,null);return;case"array":b.elseIf((0,n._)`${A} === "string" || ${A} === "number"
              || ${A} === "boolean" || ${_} === null`).assign(q,(0,n._)`[${_}]`)}}}function h({gen:y,parentData:v,parentDataProperty:E},b){y.if((0,n._)`${v} !== undefined`,()=>y.assign((0,n._)`${v}[${E}]`,b))}function p(y,v,E,b=s.Correct){const _=b===s.Correct?n.operators.EQ:n.operators.NEQ;let $;switch(y){case"null":return(0,n._)`${v} ${_} null`;case"array":$=(0,n._)`Array.isArray(${v})`;break;case"object":$=(0,n._)`${v} && typeof ${v} == "object" && !Array.isArray(${v})`;break;case"integer":$=A((0,n._)`!(${v} % 1) && !isNaN(${v})`);break;case"number":$=A();break;default:return(0,n._)`typeof ${v} ${_} ${y}`}return b===s.Correct?$:(0,n.not)($);function A(q=n.nil){return(0,n.and)((0,n._)`typeof ${v} == "number"`,q,E?(0,n._)`isFinite(${v})`:n.nil)}}Ge.checkDataType=p;function g(y,v,E,b){if(y.length===1)return p(y[0],v,E,b);let _;const $=(0,o.toHash)(y);if($.array&&$.object){const A=(0,n._)`typeof ${v} != "object"`;_=$.null?A:(0,n._)`!${v} || ${A}`,delete $.null,delete $.array,delete $.object}else _=n.nil;$.number&&delete $.integer;for(const A in $)_=(0,n.and)(_,p(A,v,E,b));return _}Ge.checkDataTypes=g;const m={message:({schema:y})=>`must be ${y}`,params:({schema:y,schemaValue:v})=>typeof y=="string"?(0,n._)`{type: ${y}}`:(0,n._)`{type: ${v}}`};function d(y){const v=w(y);(0,r.reportError)(v,m)}Ge.reportTypeError=d;function w(y){const{gen:v,data:E,schema:b}=y,_=(0,o.schemaRefOrVal)(y,b,"type");return{gen:v,keyword:"type",data:E,schema:b.type,schemaCode:_,schemaValue:_,parentSchema:b,params:{},it:y}}return Ge}var Ko={},Yh;function Pk(){if(Yh)return Ko;Yh=1,Object.defineProperty(Ko,"__esModule",{value:!0}),Ko.assignDefaults=void 0;const e=ae(),t=de();function r(o,s){const{properties:i,items:a}=o.schema;if(s==="object"&&i)for(const c in i)n(o,c,i[c].default);else s==="array"&&Array.isArray(a)&&a.forEach((c,u)=>n(o,u,c.default))}Ko.assignDefaults=r;function n(o,s,i){const{gen:a,compositeRule:c,data:u,opts:l}=o;if(i===void 0)return;const f=(0,e._)`${u}${(0,e.getProperty)(s)}`;if(c){(0,t.checkStrictMode)(o,`default is ignored for: ${f}`);return}let h=(0,e._)`${f} === undefined`;l.useDefaults==="empty"&&(h=(0,e._)`${h} || ${f} === null || ${f} === ""`),a.if(h,(0,e._)`${f} = ${(0,e.stringify)(i)}`)}return Ko}var jt={},me={},Xh;function Gt(){if(Xh)return me;Xh=1,Object.defineProperty(me,"__esModule",{value:!0}),me.validateUnion=me.validateArray=me.usePattern=me.callValidateCode=me.schemaProperties=me.allSchemaProperties=me.noPropertyInData=me.propertyInData=me.isOwnProperty=me.hasPropFunc=me.reportMissingProp=me.checkMissingProp=me.checkReportMissingProp=void 0;const e=ae(),t=de(),r=bn(),n=de();function o(y,v){const{gen:E,data:b,it:_}=y;E.if(l(E,b,v,_.opts.ownProperties),()=>{y.setParams({missingProperty:(0,e._)`${v}`},!0),y.error()})}me.checkReportMissingProp=o;function s({gen:y,data:v,it:{opts:E}},b,_){return(0,e.or)(...b.map($=>(0,e.and)(l(y,v,$,E.ownProperties),(0,e._)`${_} = ${$}`)))}me.checkMissingProp=s;function i(y,v){y.setParams({missingProperty:v},!0),y.error()}me.reportMissingProp=i;function a(y){return y.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,e._)`Object.prototype.hasOwnProperty`})}me.hasPropFunc=a;function c(y,v,E){return(0,e._)`${a(y)}.call(${v}, ${E})`}me.isOwnProperty=c;function u(y,v,E,b){const _=(0,e._)`${v}${(0,e.getProperty)(E)} !== undefined`;return b?(0,e._)`${_} && ${c(y,v,E)}`:_}me.propertyInData=u;function l(y,v,E,b){const _=(0,e._)`${v}${(0,e.getProperty)(E)} === undefined`;return b?(0,e.or)(_,(0,e.not)(c(y,v,E))):_}me.noPropertyInData=l;function f(y){return y?Object.keys(y).filter(v=>v!=="__proto__"):[]}me.allSchemaProperties=f;function h(y,v){return f(v).filter(E=>!(0,t.alwaysValidSchema)(y,v[E]))}me.schemaProperties=h;function p({schemaCode:y,data:v,it:{gen:E,topSchemaRef:b,schemaPath:_,errorPath:$},it:A},q,F,L){const D=L?(0,e._)`${y}, ${v}, ${b}${_}`:v,U=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,$)],[r.default.parentData,A.parentData],[r.default.parentDataProperty,A.parentDataProperty],[r.default.rootData,r.default.rootData]];A.opts.dynamicRef&&U.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const z=(0,e._)`${D}, ${E.object(...U)}`;return F!==e.nil?(0,e._)`${q}.call(${F}, ${z})`:(0,e._)`${q}(${z})`}me.callValidateCode=p;const g=(0,e._)`new RegExp`;function m({gen:y,it:{opts:v}},E){const b=v.unicodeRegExp?"u":"",{regExp:_}=v.code,$=_(E,b);return y.scopeValue("pattern",{key:$.toString(),ref:$,code:(0,e._)`${_.code==="new RegExp"?g:(0,n.useFunc)(y,_)}(${E}, ${b})`})}me.usePattern=m;function d(y){const{gen:v,data:E,keyword:b,it:_}=y,$=v.name("valid");if(_.allErrors){const q=v.let("valid",!0);return A(()=>v.assign(q,!1)),q}return v.var($,!0),A(()=>v.break()),$;function A(q){const F=v.const("len",(0,e._)`${E}.length`);v.forRange("i",0,F,L=>{y.subschema({keyword:b,dataProp:L,dataPropType:t.Type.Num},$),v.if((0,e.not)($),q)})}}me.validateArray=d;function w(y){const{gen:v,schema:E,keyword:b,it:_}=y;if(!Array.isArray(E))throw new Error("ajv implementation error");if(E.some(F=>(0,t.alwaysValidSchema)(_,F))&&!_.opts.unevaluated)return;const A=v.let("valid",!1),q=v.name("_valid");v.block(()=>E.forEach((F,L)=>{const D=y.subschema({keyword:b,schemaProp:L,compositeRule:!0},q);v.assign(A,(0,e._)`${A} || ${q}`),y.mergeValidEvaluated(D,q)||v.if((0,e.not)(A))})),y.result(A,()=>y.reset(),()=>y.error(!0))}return me.validateUnion=w,me}var Qh;function Lk(){if(Qh)return jt;Qh=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.validateKeywordUsage=jt.validSchemaType=jt.funcKeywordCode=jt.macroKeywordCode=void 0;const e=ae(),t=bn(),r=Gt(),n=La();function o(h,p){const{gen:g,keyword:m,schema:d,parentSchema:w,it:y}=h,v=p.macro.call(y.self,d,w,y),E=u(g,m,v);y.opts.validateSchema!==!1&&y.self.validateSchema(v,!0);const b=g.name("valid");h.subschema({schema:v,schemaPath:e.nil,errSchemaPath:`${y.errSchemaPath}/${m}`,topSchemaRef:E,compositeRule:!0},b),h.pass(b,()=>h.error(!0))}jt.macroKeywordCode=o;function s(h,p){var g;const{gen:m,keyword:d,schema:w,parentSchema:y,$data:v,it:E}=h;c(E,p);const b=!v&&p.compile?p.compile.call(E.self,w,y,E):p.validate,_=u(m,d,b),$=m.let("valid");h.block$data($,A),h.ok((g=p.valid)!==null&&g!==void 0?g:$);function A(){if(p.errors===!1)L(),p.modifying&&i(h),D(()=>h.error());else{const U=p.async?q():F();p.modifying&&i(h),D(()=>a(h,U))}}function q(){const U=m.let("ruleErrs",null);return m.try(()=>L((0,e._)`await `),z=>m.assign($,!1).if((0,e._)`${z} instanceof ${E.ValidationError}`,()=>m.assign(U,(0,e._)`${z}.errors`),()=>m.throw(z))),U}function F(){const U=(0,e._)`${_}.errors`;return m.assign(U,null),L(e.nil),U}function L(U=p.async?(0,e._)`await `:e.nil){const z=E.opts.passContext?t.default.this:t.default.self,k=!("compile"in p&&!v||p.schema===!1);m.assign($,(0,e._)`${U}${(0,r.callValidateCode)(h,_,z,k)}`,p.modifying)}function D(U){var z;m.if((0,e.not)((z=p.valid)!==null&&z!==void 0?z:$),U)}}jt.funcKeywordCode=s;function i(h){const{gen:p,data:g,it:m}=h;p.if(m.parentData,()=>p.assign(g,(0,e._)`${m.parentData}[${m.parentDataProperty}]`))}function a(h,p){const{gen:g}=h;g.if((0,e._)`Array.isArray(${p})`,()=>{g.assign(t.default.vErrors,(0,e._)`${t.default.vErrors} === null ? ${p} : ${t.default.vErrors}.concat(${p})`).assign(t.default.errors,(0,e._)`${t.default.vErrors}.length`),(0,n.extendErrors)(h)},()=>h.error())}function c({schemaEnv:h},p){if(p.async&&!h.$async)throw new Error("async keyword in sync schema")}function u(h,p,g){if(g===void 0)throw new Error(`keyword "${p}" failed to compile`);return h.scopeValue("keyword",typeof g=="function"?{ref:g}:{ref:g,code:(0,e.stringify)(g)})}function l(h,p,g=!1){return!p.length||p.some(m=>m==="array"?Array.isArray(h):m==="object"?h&&typeof h=="object"&&!Array.isArray(h):typeof h==m||g&&typeof h>"u")}jt.validSchemaType=l;function f({schema:h,opts:p,self:g,errSchemaPath:m},d,w){if(Array.isArray(d.keyword)?!d.keyword.includes(w):d.keyword!==w)throw new Error("ajv implementation error");const y=d.dependencies;if(y?.some(v=>!Object.prototype.hasOwnProperty.call(h,v)))throw new Error(`parent schema must have dependencies of ${w}: ${y.join(",")}`);if(d.validateSchema&&!d.validateSchema(h[w])){const E=`keyword "${w}" value is invalid at path "${m}": `+g.errorsText(d.validateSchema.errors);if(p.validateSchema==="log")g.logger.error(E);else throw new Error(E)}}return jt.validateKeywordUsage=f,jt}var gr={},ep;function Uk(){if(ep)return gr;ep=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.extendSubschemaMode=gr.extendSubschemaData=gr.getSubschema=void 0;const e=ae(),t=de();function r(s,{keyword:i,schemaProp:a,schema:c,schemaPath:u,errSchemaPath:l,topSchemaRef:f}){if(i!==void 0&&c!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(i!==void 0){const h=s.schema[i];return a===void 0?{schema:h,schemaPath:(0,e._)`${s.schemaPath}${(0,e.getProperty)(i)}`,errSchemaPath:`${s.errSchemaPath}/${i}`}:{schema:h[a],schemaPath:(0,e._)`${s.schemaPath}${(0,e.getProperty)(i)}${(0,e.getProperty)(a)}`,errSchemaPath:`${s.errSchemaPath}/${i}/${(0,t.escapeFragment)(a)}`}}if(c!==void 0){if(u===void 0||l===void 0||f===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:c,schemaPath:u,topSchemaRef:f,errSchemaPath:l}}throw new Error('either "keyword" or "schema" must be passed')}gr.getSubschema=r;function n(s,i,{dataProp:a,dataPropType:c,data:u,dataTypes:l,propertyName:f}){if(u!==void 0&&a!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:h}=i;if(a!==void 0){const{errorPath:g,dataPathArr:m,opts:d}=i,w=h.let("data",(0,e._)`${i.data}${(0,e.getProperty)(a)}`,!0);p(w),s.errorPath=(0,e.str)`${g}${(0,t.getErrorPath)(a,c,d.jsPropertySyntax)}`,s.parentDataProperty=(0,e._)`${a}`,s.dataPathArr=[...m,s.parentDataProperty]}if(u!==void 0){const g=u instanceof e.Name?u:h.let("data",u,!0);p(g),f!==void 0&&(s.propertyName=f)}l&&(s.dataTypes=l);function p(g){s.data=g,s.dataLevel=i.dataLevel+1,s.dataTypes=[],i.definedProperties=new Set,s.parentData=i.data,s.dataNames=[...i.dataNames,g]}}gr.extendSubschemaData=n;function o(s,{jtdDiscriminator:i,jtdMetadata:a,compositeRule:c,createErrors:u,allErrors:l}){c!==void 0&&(s.compositeRule=c),u!==void 0&&(s.createErrors=u),l!==void 0&&(s.allErrors=l),s.jtdDiscriminator=i,s.jtdMetadata=a}return gr.extendSubschemaMode=o,gr}var ft={},Nc,tp;function cf(){return tp||(tp=1,Nc=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(s=Object.keys(t),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!e(t[i],r[i]))return!1}return!0}return t!==t&&r!==r}),Nc}var Cc={exports:{}},rp;function zk(){if(rp)return Cc.exports;rp=1;var e=Cc.exports=function(n,o,s){typeof o=="function"&&(s=o,o={}),s=o.cb||s;var i=typeof s=="function"?s:s.pre||function(){},a=s.post||function(){};t(o,i,a,n,"",n)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function t(n,o,s,i,a,c,u,l,f,h){if(i&&typeof i=="object"&&!Array.isArray(i)){o(i,a,c,u,l,f,h);for(var p in i){var g=i[p];if(Array.isArray(g)){if(p in e.arrayKeywords)for(var m=0;m<g.length;m++)t(n,o,s,g[m],a+"/"+p+"/"+m,c,a,p,i,m)}else if(p in e.propsKeywords){if(g&&typeof g=="object")for(var d in g)t(n,o,s,g[d],a+"/"+p+"/"+r(d),c,a,p,i,d)}else(p in e.keywords||n.allKeys&&!(p in e.skipKeywords))&&t(n,o,s,g,a+"/"+p,c,a,p,i)}s(i,a,c,u,l,f,h)}}function r(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}return Cc.exports}var np;function Ua(){if(np)return ft;np=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.getSchemaRefs=ft.resolveUrl=ft.normalizeId=ft._getFullPath=ft.getFullPath=ft.inlineRef=void 0;const e=de(),t=cf(),r=zk(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function o(m,d=!0){return typeof m=="boolean"?!0:d===!0?!i(m):d?a(m)<=d:!1}ft.inlineRef=o;const s=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function i(m){for(const d in m){if(s.has(d))return!0;const w=m[d];if(Array.isArray(w)&&w.some(i)||typeof w=="object"&&i(w))return!0}return!1}function a(m){let d=0;for(const w in m){if(w==="$ref")return 1/0;if(d++,!n.has(w)&&(typeof m[w]=="object"&&(0,e.eachItem)(m[w],y=>d+=a(y)),d===1/0))return 1/0}return d}function c(m,d="",w){w!==!1&&(d=f(d));const y=m.parse(d);return u(m,y)}ft.getFullPath=c;function u(m,d){return m.serialize(d).split("#")[0]+"#"}ft._getFullPath=u;const l=/#\/?$/;function f(m){return m?m.replace(l,""):""}ft.normalizeId=f;function h(m,d,w){return w=f(w),m.resolve(d,w)}ft.resolveUrl=h;const p=/^[a-z_][-a-z0-9._]*$/i;function g(m,d){if(typeof m=="boolean")return{};const{schemaId:w,uriResolver:y}=this.opts,v=f(m[w]||d),E={"":v},b=c(y,v,!1),_={},$=new Set;return r(m,{allKeys:!0},(F,L,D,U)=>{if(U===void 0)return;const z=b+L;let k=E[U];typeof F[w]=="string"&&(k=S.call(this,F[w])),O.call(this,F.$anchor),O.call(this,F.$dynamicAnchor),E[L]=k;function S(P){const B=this.opts.uriResolver.resolve;if(P=f(k?B(k,P):P),$.has(P))throw q(P);$.add(P);let I=this.refs[P];return typeof I=="string"&&(I=this.refs[I]),typeof I=="object"?A(F,I.schema,P):P!==f(z)&&(P[0]==="#"?(A(F,_[P],P),_[P]=F):this.refs[P]=z),P}function O(P){if(typeof P=="string"){if(!p.test(P))throw new Error(`invalid anchor "${P}"`);S.call(this,`#${P}`)}}}),_;function A(F,L,D){if(L!==void 0&&!t(F,L))throw q(D)}function q(F){return new Error(`reference "${F}" resolves to more than one schema`)}}return ft.getSchemaRefs=g,ft}var op;function za(){if(op)return pr;op=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.getData=pr.KeywordCxt=pr.validateFunctionCode=void 0;const e=Ck(),t=na(),r=H0(),n=na(),o=Pk(),s=Lk(),i=Uk(),a=ae(),c=bn(),u=Ua(),l=de(),f=La();function h(M){if(b(M)&&($(M),E(M))){d(M);return}p(M,()=>(0,e.topBoolOrEmptySchema)(M))}pr.validateFunctionCode=h;function p({gen:M,validateName:j,schema:Z,schemaEnv:W,opts:Q},oe){Q.code.es5?M.func(j,(0,a._)`${c.default.data}, ${c.default.valCxt}`,W.$async,()=>{M.code((0,a._)`"use strict"; ${y(Z,Q)}`),m(M,Q),M.code(oe)}):M.func(j,(0,a._)`${c.default.data}, ${g(Q)}`,W.$async,()=>M.code(y(Z,Q)).code(oe))}function g(M){return(0,a._)`{${c.default.instancePath}="", ${c.default.parentData}, ${c.default.parentDataProperty}, ${c.default.rootData}=${c.default.data}${M.dynamicRef?(0,a._)`, ${c.default.dynamicAnchors}={}`:a.nil}}={}`}function m(M,j){M.if(c.default.valCxt,()=>{M.var(c.default.instancePath,(0,a._)`${c.default.valCxt}.${c.default.instancePath}`),M.var(c.default.parentData,(0,a._)`${c.default.valCxt}.${c.default.parentData}`),M.var(c.default.parentDataProperty,(0,a._)`${c.default.valCxt}.${c.default.parentDataProperty}`),M.var(c.default.rootData,(0,a._)`${c.default.valCxt}.${c.default.rootData}`),j.dynamicRef&&M.var(c.default.dynamicAnchors,(0,a._)`${c.default.valCxt}.${c.default.dynamicAnchors}`)},()=>{M.var(c.default.instancePath,(0,a._)`""`),M.var(c.default.parentData,(0,a._)`undefined`),M.var(c.default.parentDataProperty,(0,a._)`undefined`),M.var(c.default.rootData,c.default.data),j.dynamicRef&&M.var(c.default.dynamicAnchors,(0,a._)`{}`)})}function d(M){const{schema:j,opts:Z,gen:W}=M;p(M,()=>{Z.$comment&&j.$comment&&U(M),F(M),W.let(c.default.vErrors,null),W.let(c.default.errors,0),Z.unevaluated&&w(M),A(M),z(M)})}function w(M){const{gen:j,validateName:Z}=M;M.evaluated=j.const("evaluated",(0,a._)`${Z}.evaluated`),j.if((0,a._)`${M.evaluated}.dynamicProps`,()=>j.assign((0,a._)`${M.evaluated}.props`,(0,a._)`undefined`)),j.if((0,a._)`${M.evaluated}.dynamicItems`,()=>j.assign((0,a._)`${M.evaluated}.items`,(0,a._)`undefined`))}function y(M,j){const Z=typeof M=="object"&&M[j.schemaId];return Z&&(j.code.source||j.code.process)?(0,a._)`/*# sourceURL=${Z} */`:a.nil}function v(M,j){if(b(M)&&($(M),E(M))){_(M,j);return}(0,e.boolOrEmptySchema)(M,j)}function E({schema:M,self:j}){if(typeof M=="boolean")return!M;for(const Z in M)if(j.RULES.all[Z])return!0;return!1}function b(M){return typeof M.schema!="boolean"}function _(M,j){const{schema:Z,gen:W,opts:Q}=M;Q.$comment&&Z.$comment&&U(M),L(M),D(M);const oe=W.const("_errs",c.default.errors);A(M,oe),W.var(j,(0,a._)`${oe} === ${c.default.errors}`)}function $(M){(0,l.checkUnknownRules)(M),q(M)}function A(M,j){if(M.opts.jtd)return S(M,[],!1,j);const Z=(0,t.getSchemaTypes)(M.schema),W=(0,t.coerceAndCheckDataType)(M,Z);S(M,Z,!W,j)}function q(M){const{schema:j,errSchemaPath:Z,opts:W,self:Q}=M;j.$ref&&W.ignoreKeywordsWithRef&&(0,l.schemaHasRulesButRef)(j,Q.RULES)&&Q.logger.warn(`$ref: keywords ignored in schema at path "${Z}"`)}function F(M){const{schema:j,opts:Z}=M;j.default!==void 0&&Z.useDefaults&&Z.strictSchema&&(0,l.checkStrictMode)(M,"default is ignored in the schema root")}function L(M){const j=M.schema[M.opts.schemaId];j&&(M.baseId=(0,u.resolveUrl)(M.opts.uriResolver,M.baseId,j))}function D(M){if(M.schema.$async&&!M.schemaEnv.$async)throw new Error("async schema in sync schema")}function U({gen:M,schemaEnv:j,schema:Z,errSchemaPath:W,opts:Q}){const oe=Z.$comment;if(Q.$comment===!0)M.code((0,a._)`${c.default.self}.logger.log(${oe})`);else if(typeof Q.$comment=="function"){const ze=(0,a.str)`${W}/$comment`,Ze=M.scopeValue("root",{ref:j.root});M.code((0,a._)`${c.default.self}.opts.$comment(${oe}, ${ze}, ${Ze}.schema)`)}}function z(M){const{gen:j,schemaEnv:Z,validateName:W,ValidationError:Q,opts:oe}=M;Z.$async?j.if((0,a._)`${c.default.errors} === 0`,()=>j.return(c.default.data),()=>j.throw((0,a._)`new ${Q}(${c.default.vErrors})`)):(j.assign((0,a._)`${W}.errors`,c.default.vErrors),oe.unevaluated&&k(M),j.return((0,a._)`${c.default.errors} === 0`))}function k({gen:M,evaluated:j,props:Z,items:W}){Z instanceof a.Name&&M.assign((0,a._)`${j}.props`,Z),W instanceof a.Name&&M.assign((0,a._)`${j}.items`,W)}function S(M,j,Z,W){const{gen:Q,schema:oe,data:ze,allErrors:Ze,opts:je,self:gt}=M,{RULES:Ke}=gt;if(oe.$ref&&(je.ignoreKeywordsWithRef||!(0,l.schemaHasRulesButRef)(oe,Ke))){Q.block(()=>G(M,"$ref",Ke.all.$ref.definition));return}je.jtd||P(M,j),Q.block(()=>{for(const It of Ke.rules)Xn(It);Xn(Ke.post)});function Xn(It){(0,r.shouldUseGroup)(oe,It)&&(It.type?(Q.if((0,n.checkDataType)(It.type,ze,je.strictNumbers)),O(M,It),j.length===1&&j[0]===It.type&&Z&&(Q.else(),(0,n.reportTypeError)(M)),Q.endIf()):O(M,It),Ze||Q.if((0,a._)`${c.default.errors} === ${W||0}`))}}function O(M,j){const{gen:Z,schema:W,opts:{useDefaults:Q}}=M;Q&&(0,o.assignDefaults)(M,j.type),Z.block(()=>{for(const oe of j.rules)(0,r.shouldUseRule)(W,oe)&&G(M,oe.keyword,oe.definition,j.type)})}function P(M,j){M.schemaEnv.meta||!M.opts.strictTypes||(B(M,j),M.opts.allowUnionTypes||I(M,j),T(M,M.dataTypes))}function B(M,j){if(j.length){if(!M.dataTypes.length){M.dataTypes=j;return}j.forEach(Z=>{C(M.dataTypes,Z)||R(M,`type "${Z}" not allowed by context "${M.dataTypes.join(",")}"`)}),x(M,j)}}function I(M,j){j.length>1&&!(j.length===2&&j.includes("null"))&&R(M,"use allowUnionTypes to allow union type keyword")}function T(M,j){const Z=M.self.RULES.all;for(const W in Z){const Q=Z[W];if(typeof Q=="object"&&(0,r.shouldUseRule)(M.schema,Q)){const{type:oe}=Q.definition;oe.length&&!oe.some(ze=>N(j,ze))&&R(M,`missing type "${oe.join(",")}" for keyword "${W}"`)}}}function N(M,j){return M.includes(j)||j==="number"&&M.includes("integer")}function C(M,j){return M.includes(j)||j==="integer"&&M.includes("number")}function x(M,j){const Z=[];for(const W of M.dataTypes)C(j,W)?Z.push(W):j.includes("integer")&&W==="number"&&Z.push("integer");M.dataTypes=Z}function R(M,j){const Z=M.schemaEnv.baseId+M.errSchemaPath;j+=` at "${Z}" (strictTypes)`,(0,l.checkStrictMode)(M,j,M.opts.strictTypes)}class H{constructor(j,Z,W){if((0,s.validateKeywordUsage)(j,Z,W),this.gen=j.gen,this.allErrors=j.allErrors,this.keyword=W,this.data=j.data,this.schema=j.schema[W],this.$data=Z.$data&&j.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,l.schemaRefOrVal)(j,this.schema,W,this.$data),this.schemaType=Z.schemaType,this.parentSchema=j.schema,this.params={},this.it=j,this.def=Z,this.$data)this.schemaCode=j.gen.const("vSchema",X(this.$data,j));else if(this.schemaCode=this.schemaValue,!(0,s.validSchemaType)(this.schema,Z.schemaType,Z.allowUndefined))throw new Error(`${W} value must be ${JSON.stringify(Z.schemaType)}`);("code"in Z?Z.trackErrors:Z.errors!==!1)&&(this.errsCount=j.gen.const("_errs",c.default.errors))}result(j,Z,W){this.failResult((0,a.not)(j),Z,W)}failResult(j,Z,W){this.gen.if(j),W?W():this.error(),Z?(this.gen.else(),Z(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(j,Z){this.failResult((0,a.not)(j),void 0,Z)}fail(j){if(j===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(j),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(j){if(!this.$data)return this.fail(j);const{schemaCode:Z}=this;this.fail((0,a._)`${Z} !== undefined && (${(0,a.or)(this.invalid$data(),j)})`)}error(j,Z,W){if(Z){this.setParams(Z),this._error(j,W),this.setParams({});return}this._error(j,W)}_error(j,Z){(j?f.reportExtraError:f.reportError)(this,this.def.error,Z)}$dataError(){(0,f.reportError)(this,this.def.$dataError||f.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,f.resetErrorsCount)(this.gen,this.errsCount)}ok(j){this.allErrors||this.gen.if(j)}setParams(j,Z){Z?Object.assign(this.params,j):this.params=j}block$data(j,Z,W=a.nil){this.gen.block(()=>{this.check$data(j,W),Z()})}check$data(j=a.nil,Z=a.nil){if(!this.$data)return;const{gen:W,schemaCode:Q,schemaType:oe,def:ze}=this;W.if((0,a.or)((0,a._)`${Q} === undefined`,Z)),j!==a.nil&&W.assign(j,!0),(oe.length||ze.validateSchema)&&(W.elseIf(this.invalid$data()),this.$dataError(),j!==a.nil&&W.assign(j,!1)),W.else()}invalid$data(){const{gen:j,schemaCode:Z,schemaType:W,def:Q,it:oe}=this;return(0,a.or)(ze(),Ze());function ze(){if(W.length){if(!(Z instanceof a.Name))throw new Error("ajv implementation error");const je=Array.isArray(W)?W:[W];return(0,a._)`${(0,n.checkDataTypes)(je,Z,oe.opts.strictNumbers,n.DataType.Wrong)}`}return a.nil}function Ze(){if(Q.validateSchema){const je=j.scopeValue("validate$data",{ref:Q.validateSchema});return(0,a._)`!${je}(${Z})`}return a.nil}}subschema(j,Z){const W=(0,i.getSubschema)(this.it,j);(0,i.extendSubschemaData)(W,this.it,j),(0,i.extendSubschemaMode)(W,j);const Q={...this.it,...W,items:void 0,props:void 0};return v(Q,Z),Q}mergeEvaluated(j,Z){const{it:W,gen:Q}=this;W.opts.unevaluated&&(W.props!==!0&&j.props!==void 0&&(W.props=l.mergeEvaluated.props(Q,j.props,W.props,Z)),W.items!==!0&&j.items!==void 0&&(W.items=l.mergeEvaluated.items(Q,j.items,W.items,Z)))}mergeValidEvaluated(j,Z){const{it:W,gen:Q}=this;if(W.opts.unevaluated&&(W.props!==!0||W.items!==!0))return Q.if(Z,()=>this.mergeEvaluated(j,a.Name)),!0}}pr.KeywordCxt=H;function G(M,j,Z,W){const Q=new H(M,Z,j);"code"in Z?Z.code(Q,W):Q.$data&&Z.validate?(0,s.funcKeywordCode)(Q,Z):"macro"in Z?(0,s.macroKeywordCode)(Q,Z):(Z.compile||Z.validate)&&(0,s.funcKeywordCode)(Q,Z)}const J=/^\/(?:[^~]|~0|~1)*$/,Y=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function X(M,{dataLevel:j,dataNames:Z,dataPathArr:W}){let Q,oe;if(M==="")return c.default.rootData;if(M[0]==="/"){if(!J.test(M))throw new Error(`Invalid JSON-pointer: ${M}`);Q=M,oe=c.default.rootData}else{const gt=Y.exec(M);if(!gt)throw new Error(`Invalid JSON-pointer: ${M}`);const Ke=+gt[1];if(Q=gt[2],Q==="#"){if(Ke>=j)throw new Error(je("property/index",Ke));return W[j-Ke]}if(Ke>j)throw new Error(je("data",Ke));if(oe=Z[j-Ke],!Q)return oe}let ze=oe;const Ze=Q.split("/");for(const gt of Ze)gt&&(oe=(0,a._)`${oe}${(0,a.getProperty)((0,l.unescapeJsonPointer)(gt))}`,ze=(0,a._)`${ze} && ${oe}`);return ze;function je(gt,Ke){return`Cannot access ${gt} ${Ke} levels up, current level is ${j}`}}return pr.getData=X,pr}var qs={},sp;function uf(){if(sp)return qs;sp=1,Object.defineProperty(qs,"__esModule",{value:!0});class e extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}return qs.default=e,qs}var js={},ip;function Ba(){if(ip)return js;ip=1,Object.defineProperty(js,"__esModule",{value:!0});const e=Ua();class t extends Error{constructor(n,o,s,i){super(i||`can't resolve reference ${s} from id ${o}`),this.missingRef=(0,e.resolveUrl)(n,o,s),this.missingSchema=(0,e.normalizeId)((0,e.getFullPath)(n,this.missingRef))}}return js.default=t,js}var St={},ap;function lf(){if(ap)return St;ap=1,Object.defineProperty(St,"__esModule",{value:!0}),St.resolveSchema=St.getCompilingSchema=St.resolveRef=St.compileSchema=St.SchemaEnv=void 0;const e=ae(),t=uf(),r=bn(),n=Ua(),o=de(),s=za();class i{constructor(w){var y;this.refs={},this.dynamicAnchors={};let v;typeof w.schema=="object"&&(v=w.schema),this.schema=w.schema,this.schemaId=w.schemaId,this.root=w.root||this,this.baseId=(y=w.baseId)!==null&&y!==void 0?y:(0,n.normalizeId)(v?.[w.schemaId||"$id"]),this.schemaPath=w.schemaPath,this.localRefs=w.localRefs,this.meta=w.meta,this.$async=v?.$async,this.refs={}}}St.SchemaEnv=i;function a(d){const w=l.call(this,d);if(w)return w;const y=(0,n.getFullPath)(this.opts.uriResolver,d.root.baseId),{es5:v,lines:E}=this.opts.code,{ownProperties:b}=this.opts,_=new e.CodeGen(this.scope,{es5:v,lines:E,ownProperties:b});let $;d.$async&&($=_.scopeValue("Error",{ref:t.default,code:(0,e._)`require("ajv/dist/runtime/validation_error").default`}));const A=_.scopeName("validate");d.validateName=A;const q={gen:_,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[e.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:_.scopeValue("schema",this.opts.code.source===!0?{ref:d.schema,code:(0,e.stringify)(d.schema)}:{ref:d.schema}),validateName:A,ValidationError:$,schema:d.schema,schemaEnv:d,rootId:y,baseId:d.baseId||y,schemaPath:e.nil,errSchemaPath:d.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,e._)`""`,opts:this.opts,self:this};let F;try{this._compilations.add(d),(0,s.validateFunctionCode)(q),_.optimize(this.opts.code.optimize);const L=_.toString();F=`${_.scopeRefs(r.default.scope)}return ${L}`,this.opts.code.process&&(F=this.opts.code.process(F,d));const U=new Function(`${r.default.self}`,`${r.default.scope}`,F)(this,this.scope.get());if(this.scope.value(A,{ref:U}),U.errors=null,U.schema=d.schema,U.schemaEnv=d,d.$async&&(U.$async=!0),this.opts.code.source===!0&&(U.source={validateName:A,validateCode:L,scopeValues:_._values}),this.opts.unevaluated){const{props:z,items:k}=q;U.evaluated={props:z instanceof e.Name?void 0:z,items:k instanceof e.Name?void 0:k,dynamicProps:z instanceof e.Name,dynamicItems:k instanceof e.Name},U.source&&(U.source.evaluated=(0,e.stringify)(U.evaluated))}return d.validate=U,d}catch(L){throw delete d.validate,delete d.validateName,F&&this.logger.error("Error compiling schema, function code:",F),L}finally{this._compilations.delete(d)}}St.compileSchema=a;function c(d,w,y){var v;y=(0,n.resolveUrl)(this.opts.uriResolver,w,y);const E=d.refs[y];if(E)return E;let b=h.call(this,d,y);if(b===void 0){const _=(v=d.localRefs)===null||v===void 0?void 0:v[y],{schemaId:$}=this.opts;_&&(b=new i({schema:_,schemaId:$,root:d,baseId:w}))}if(b!==void 0)return d.refs[y]=u.call(this,b)}St.resolveRef=c;function u(d){return(0,n.inlineRef)(d.schema,this.opts.inlineRefs)?d.schema:d.validate?d:a.call(this,d)}function l(d){for(const w of this._compilations)if(f(w,d))return w}St.getCompilingSchema=l;function f(d,w){return d.schema===w.schema&&d.root===w.root&&d.baseId===w.baseId}function h(d,w){let y;for(;typeof(y=this.refs[w])=="string";)w=y;return y||this.schemas[w]||p.call(this,d,w)}function p(d,w){const y=this.opts.uriResolver.parse(w),v=(0,n._getFullPath)(this.opts.uriResolver,y);let E=(0,n.getFullPath)(this.opts.uriResolver,d.baseId,void 0);if(Object.keys(d.schema).length>0&&v===E)return m.call(this,y,d);const b=(0,n.normalizeId)(v),_=this.refs[b]||this.schemas[b];if(typeof _=="string"){const $=p.call(this,d,_);return typeof $?.schema!="object"?void 0:m.call(this,y,$)}if(typeof _?.schema=="object"){if(_.validate||a.call(this,_),b===(0,n.normalizeId)(w)){const{schema:$}=_,{schemaId:A}=this.opts,q=$[A];return q&&(E=(0,n.resolveUrl)(this.opts.uriResolver,E,q)),new i({schema:$,schemaId:A,root:d,baseId:E})}return m.call(this,y,_)}}St.resolveSchema=p;const g=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function m(d,{baseId:w,schema:y,root:v}){var E;if(((E=d.fragment)===null||E===void 0?void 0:E[0])!=="/")return;for(const $ of d.fragment.slice(1).split("/")){if(typeof y=="boolean")return;const A=y[(0,o.unescapeFragment)($)];if(A===void 0)return;y=A;const q=typeof y=="object"&&y[this.opts.schemaId];!g.has($)&&q&&(w=(0,n.resolveUrl)(this.opts.uriResolver,w,q))}let b;if(typeof y!="boolean"&&y.$ref&&!(0,o.schemaHasRulesButRef)(y,this.RULES)){const $=(0,n.resolveUrl)(this.opts.uriResolver,w,y.$ref);b=p.call(this,v,$)}const{schemaId:_}=this.opts;if(b=b||new i({schema:y,schemaId:_,root:v,baseId:w}),b.schema!==b.root.schema)return b}return St}const Bk="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Mk="Meta-schema for $data reference (JSON AnySchema extension proposal)",qk="object",jk=["$data"],Dk={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},Fk=!1,Hk={$id:Bk,description:Mk,type:qk,required:jk,properties:Dk,additionalProperties:Fk};var Ds={},Go={exports:{}},Pc,cp;function V0(){if(cp)return Pc;cp=1;const e=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),t=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function r(h){let p="",g=0,m=0;for(m=0;m<h.length;m++)if(g=h[m].charCodeAt(0),g!==48){if(!(g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102))return"";p+=h[m];break}for(m+=1;m<h.length;m++){if(g=h[m].charCodeAt(0),!(g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102))return"";p+=h[m]}return p}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function o(h){return h.length=0,!0}function s(h,p,g){if(h.length){const m=r(h);if(m!=="")p.push(m);else return g.error=!0,!1;h.length=0}return!0}function i(h){let p=0;const g={error:!1,address:"",zone:""},m=[],d=[];let w=!1,y=!1,v=s;for(let E=0;E<h.length;E++){const b=h[E];if(!(b==="["||b==="]"))if(b===":"){if(w===!0&&(y=!0),!v(d,m,g))break;if(++p>7){g.error=!0;break}E>0&&h[E-1]===":"&&(w=!0),m.push(":");continue}else if(b==="%"){if(!v(d,m,g))break;v=o}else{d.push(b);continue}}return d.length&&(v===o?g.zone=d.join(""):y?m.push(d.join("")):m.push(r(d))),g.address=m.join(""),g}function a(h){if(c(h,":")<2)return{host:h,isIPV6:!1};const p=i(h);if(p.error)return{host:h,isIPV6:!1};{let g=p.address,m=p.address;return p.zone&&(g+="%"+p.zone,m+="%25"+p.zone),{host:g,isIPV6:!0,escapedHost:m}}}function c(h,p){let g=0;for(let m=0;m<h.length;m++)h[m]===p&&g++;return g}function u(h){let p=h;const g=[];let m=-1,d=0;for(;d=p.length;){if(d===1){if(p===".")break;if(p==="/"){g.push("/");break}else{g.push(p);break}}else if(d===2){if(p[0]==="."){if(p[1]===".")break;if(p[1]==="/"){p=p.slice(2);continue}}else if(p[0]==="/"&&(p[1]==="."||p[1]==="/")){g.push("/");break}}else if(d===3&&p==="/.."){g.length!==0&&g.pop(),g.push("/");break}if(p[0]==="."){if(p[1]==="."){if(p[2]==="/"){p=p.slice(3);continue}}else if(p[1]==="/"){p=p.slice(2);continue}}else if(p[0]==="/"&&p[1]==="."){if(p[2]==="/"){p=p.slice(2);continue}else if(p[2]==="."&&p[3]==="/"){p=p.slice(3),g.length!==0&&g.pop();continue}}if((m=p.indexOf("/",1))===-1){g.push(p);break}else g.push(p.slice(0,m)),p=p.slice(m)}return g.join("")}function l(h,p){const g=p!==!0?escape:unescape;return h.scheme!==void 0&&(h.scheme=g(h.scheme)),h.userinfo!==void 0&&(h.userinfo=g(h.userinfo)),h.host!==void 0&&(h.host=g(h.host)),h.path!==void 0&&(h.path=g(h.path)),h.query!==void 0&&(h.query=g(h.query)),h.fragment!==void 0&&(h.fragment=g(h.fragment)),h}function f(h){const p=[];if(h.userinfo!==void 0&&(p.push(h.userinfo),p.push("@")),h.host!==void 0){let g=unescape(h.host);if(!t(g)){const m=a(g);m.isIPV6===!0?g=`[${m.escapedHost}]`:g=h.host}p.push(g)}return(typeof h.port=="number"||typeof h.port=="string")&&(p.push(":"),p.push(String(h.port))),p.length?p.join(""):void 0}return Pc={nonSimpleDomain:n,recomposeAuthority:f,normalizeComponentEncoding:l,removeDotSegments:u,isIPv4:t,isUUID:e,normalizeIPv6:a,stringArrayToHexStripped:r},Pc}var Lc,up;function Vk(){if(up)return Lc;up=1;const{isUUID:e}=V0(),t=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,r=["http","https","ws","wss","urn","urn:uuid"];function n(b){return r.indexOf(b)!==-1}function o(b){return b.secure===!0?!0:b.secure===!1?!1:b.scheme?b.scheme.length===3&&(b.scheme[0]==="w"||b.scheme[0]==="W")&&(b.scheme[1]==="s"||b.scheme[1]==="S")&&(b.scheme[2]==="s"||b.scheme[2]==="S"):!1}function s(b){return b.host||(b.error=b.error||"HTTP URIs must have a host."),b}function i(b){const _=String(b.scheme).toLowerCase()==="https";return(b.port===(_?443:80)||b.port==="")&&(b.port=void 0),b.path||(b.path="/"),b}function a(b){return b.secure=o(b),b.resourceName=(b.path||"/")+(b.query?"?"+b.query:""),b.path=void 0,b.query=void 0,b}function c(b){if((b.port===(o(b)?443:80)||b.port==="")&&(b.port=void 0),typeof b.secure=="boolean"&&(b.scheme=b.secure?"wss":"ws",b.secure=void 0),b.resourceName){const[_,$]=b.resourceName.split("?");b.path=_&&_!=="/"?_:void 0,b.query=$,b.resourceName=void 0}return b.fragment=void 0,b}function u(b,_){if(!b.path)return b.error="URN can not be parsed",b;const $=b.path.match(t);if($){const A=_.scheme||b.scheme||"urn";b.nid=$[1].toLowerCase(),b.nss=$[2];const q=`${A}:${_.nid||b.nid}`,F=E(q);b.path=void 0,F&&(b=F.parse(b,_))}else b.error=b.error||"URN can not be parsed.";return b}function l(b,_){if(b.nid===void 0)throw new Error("URN without nid cannot be serialized");const $=_.scheme||b.scheme||"urn",A=b.nid.toLowerCase(),q=`${$}:${_.nid||A}`,F=E(q);F&&(b=F.serialize(b,_));const L=b,D=b.nss;return L.path=`${A||_.nid}:${D}`,_.skipEscape=!0,L}function f(b,_){const $=b;return $.uuid=$.nss,$.nss=void 0,!_.tolerant&&(!$.uuid||!e($.uuid))&&($.error=$.error||"UUID is not valid."),$}function h(b){const _=b;return _.nss=(b.uuid||"").toLowerCase(),_}const p={scheme:"http",domainHost:!0,parse:s,serialize:i},g={scheme:"https",domainHost:p.domainHost,parse:s,serialize:i},m={scheme:"ws",domainHost:!0,parse:a,serialize:c},d={scheme:"wss",domainHost:m.domainHost,parse:m.parse,serialize:m.serialize},v={http:p,https:g,ws:m,wss:d,urn:{scheme:"urn",parse:u,serialize:l,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:f,serialize:h,skipNormalize:!0}};Object.setPrototypeOf(v,null);function E(b){return b&&(v[b]||v[b.toLowerCase()])||void 0}return Lc={wsIsSecure:o,SCHEMES:v,isValidSchemeName:n,getSchemeHandler:E},Lc}var lp;function Zk(){if(lp)return Go.exports;lp=1;const{normalizeIPv6:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n,isIPv4:o,nonSimpleDomain:s}=V0(),{SCHEMES:i,getSchemeHandler:a}=Vk();function c(d,w){return typeof d=="string"?d=h(g(d,w),w):typeof d=="object"&&(d=g(h(d,w),w)),d}function u(d,w,y){const v=y?Object.assign({scheme:"null"},y):{scheme:"null"},E=l(g(d,v),g(w,v),v,!0);return v.skipEscape=!0,h(E,v)}function l(d,w,y,v){const E={};return v||(d=g(h(d,y),y),w=g(h(w,y),y)),y=y||{},!y.tolerant&&w.scheme?(E.scheme=w.scheme,E.userinfo=w.userinfo,E.host=w.host,E.port=w.port,E.path=t(w.path||""),E.query=w.query):(w.userinfo!==void 0||w.host!==void 0||w.port!==void 0?(E.userinfo=w.userinfo,E.host=w.host,E.port=w.port,E.path=t(w.path||""),E.query=w.query):(w.path?(w.path[0]==="/"?E.path=t(w.path):((d.userinfo!==void 0||d.host!==void 0||d.port!==void 0)&&!d.path?E.path="/"+w.path:d.path?E.path=d.path.slice(0,d.path.lastIndexOf("/")+1)+w.path:E.path=w.path,E.path=t(E.path)),E.query=w.query):(E.path=d.path,w.query!==void 0?E.query=w.query:E.query=d.query),E.userinfo=d.userinfo,E.host=d.host,E.port=d.port),E.scheme=d.scheme),E.fragment=w.fragment,E}function f(d,w,y){return typeof d=="string"?(d=unescape(d),d=h(n(g(d,y),!0),{...y,skipEscape:!0})):typeof d=="object"&&(d=h(n(d,!0),{...y,skipEscape:!0})),typeof w=="string"?(w=unescape(w),w=h(n(g(w,y),!0),{...y,skipEscape:!0})):typeof w=="object"&&(w=h(n(w,!0),{...y,skipEscape:!0})),d.toLowerCase()===w.toLowerCase()}function h(d,w){const y={host:d.host,scheme:d.scheme,userinfo:d.userinfo,port:d.port,path:d.path,query:d.query,nid:d.nid,nss:d.nss,uuid:d.uuid,fragment:d.fragment,reference:d.reference,resourceName:d.resourceName,secure:d.secure,error:""},v=Object.assign({},w),E=[],b=a(v.scheme||y.scheme);b&&b.serialize&&b.serialize(y,v),y.path!==void 0&&(v.skipEscape?y.path=unescape(y.path):(y.path=escape(y.path),y.scheme!==void 0&&(y.path=y.path.split("%3A").join(":")))),v.reference!=="suffix"&&y.scheme&&E.push(y.scheme,":");const _=r(y);if(_!==void 0&&(v.reference!=="suffix"&&E.push("//"),E.push(_),y.path&&y.path[0]!=="/"&&E.push("/")),y.path!==void 0){let $=y.path;!v.absolutePath&&(!b||!b.absolutePath)&&($=t($)),_===void 0&&$[0]==="/"&&$[1]==="/"&&($="/%2F"+$.slice(2)),E.push($)}return y.query!==void 0&&E.push("?",y.query),y.fragment!==void 0&&E.push("#",y.fragment),E.join("")}const p=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function g(d,w){const y=Object.assign({},w),v={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let E=!1;y.reference==="suffix"&&(y.scheme?d=y.scheme+":"+d:d="//"+d);const b=d.match(p);if(b){if(v.scheme=b[1],v.userinfo=b[3],v.host=b[4],v.port=parseInt(b[5],10),v.path=b[6]||"",v.query=b[7],v.fragment=b[8],isNaN(v.port)&&(v.port=b[5]),v.host)if(o(v.host)===!1){const A=e(v.host);v.host=A.host.toLowerCase(),E=A.isIPV6}else E=!0;v.scheme===void 0&&v.userinfo===void 0&&v.host===void 0&&v.port===void 0&&v.query===void 0&&!v.path?v.reference="same-document":v.scheme===void 0?v.reference="relative":v.fragment===void 0?v.reference="absolute":v.reference="uri",y.reference&&y.reference!=="suffix"&&y.reference!==v.reference&&(v.error=v.error||"URI is not a "+y.reference+" reference.");const _=a(y.scheme||v.scheme);if(!y.unicodeSupport&&(!_||!_.unicodeSupport)&&v.host&&(y.domainHost||_&&_.domainHost)&&E===!1&&s(v.host))try{v.host=URL.domainToASCII(v.host.toLowerCase())}catch($){v.error=v.error||"Host's domain name can not be converted to ASCII: "+$}(!_||_&&!_.skipNormalize)&&(d.indexOf("%")!==-1&&(v.scheme!==void 0&&(v.scheme=unescape(v.scheme)),v.host!==void 0&&(v.host=unescape(v.host))),v.path&&(v.path=escape(unescape(v.path))),v.fragment&&(v.fragment=encodeURI(decodeURIComponent(v.fragment)))),_&&_.parse&&_.parse(v,y)}else v.error=v.error||"URI can not be parsed.";return v}const m={SCHEMES:i,normalize:c,resolve:u,resolveComponent:l,equal:f,serialize:h,parse:g};return Go.exports=m,Go.exports.default=m,Go.exports.fastUri=m,Go.exports}var fp;function Kk(){if(fp)return Ds;fp=1,Object.defineProperty(Ds,"__esModule",{value:!0});const e=Zk();return e.code='require("ajv/dist/runtime/uri").default',Ds.default=e,Ds}var dp;function Gk(){return dp||(dp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=za();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=ae();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=uf(),o=Ba(),s=F0(),i=lf(),a=ae(),c=Ua(),u=na(),l=de(),f=Hk,h=Kk(),p=(I,T)=>new RegExp(I,T);p.code="new RegExp";const g=["removeAdditional","useDefaults","coerceTypes"],m=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),d={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},w={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},y=200;function v(I){var T,N,C,x,R,H,G,J,Y,X,M,j,Z,W,Q,oe,ze,Ze,je,gt,Ke,Xn,It,Ec,$c;const Zo=I.strict,Sc=(T=I.code)===null||T===void 0?void 0:T.optimize,gh=Sc===!0||Sc===void 0?1:Sc||0,yh=(C=(N=I.code)===null||N===void 0?void 0:N.regExp)!==null&&C!==void 0?C:p,pE=(x=I.uriResolver)!==null&&x!==void 0?x:h.default;return{strictSchema:(H=(R=I.strictSchema)!==null&&R!==void 0?R:Zo)!==null&&H!==void 0?H:!0,strictNumbers:(J=(G=I.strictNumbers)!==null&&G!==void 0?G:Zo)!==null&&J!==void 0?J:!0,strictTypes:(X=(Y=I.strictTypes)!==null&&Y!==void 0?Y:Zo)!==null&&X!==void 0?X:"log",strictTuples:(j=(M=I.strictTuples)!==null&&M!==void 0?M:Zo)!==null&&j!==void 0?j:"log",strictRequired:(W=(Z=I.strictRequired)!==null&&Z!==void 0?Z:Zo)!==null&&W!==void 0?W:!1,code:I.code?{...I.code,optimize:gh,regExp:yh}:{optimize:gh,regExp:yh},loopRequired:(Q=I.loopRequired)!==null&&Q!==void 0?Q:y,loopEnum:(oe=I.loopEnum)!==null&&oe!==void 0?oe:y,meta:(ze=I.meta)!==null&&ze!==void 0?ze:!0,messages:(Ze=I.messages)!==null&&Ze!==void 0?Ze:!0,inlineRefs:(je=I.inlineRefs)!==null&&je!==void 0?je:!0,schemaId:(gt=I.schemaId)!==null&&gt!==void 0?gt:"$id",addUsedSchema:(Ke=I.addUsedSchema)!==null&&Ke!==void 0?Ke:!0,validateSchema:(Xn=I.validateSchema)!==null&&Xn!==void 0?Xn:!0,validateFormats:(It=I.validateFormats)!==null&&It!==void 0?It:!0,unicodeRegExp:(Ec=I.unicodeRegExp)!==null&&Ec!==void 0?Ec:!0,int32range:($c=I.int32range)!==null&&$c!==void 0?$c:!0,uriResolver:pE}}class E{constructor(T={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,T=this.opts={...T,...v(T)};const{es5:N,lines:C}=this.opts.code;this.scope=new a.ValueScope({scope:{},prefixes:m,es5:N,lines:C}),this.logger=D(T.logger);const x=T.validateFormats;T.validateFormats=!1,this.RULES=(0,s.getRules)(),b.call(this,d,T,"NOT SUPPORTED"),b.call(this,w,T,"DEPRECATED","warn"),this._metaOpts=F.call(this),T.formats&&A.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),T.keywords&&q.call(this,T.keywords),typeof T.meta=="object"&&this.addMetaSchema(T.meta),$.call(this),T.validateFormats=x}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:T,meta:N,schemaId:C}=this.opts;let x=f;C==="id"&&(x={...f},x.id=x.$id,delete x.$id),N&&T&&this.addMetaSchema(x,x[C],!1)}defaultMeta(){const{meta:T,schemaId:N}=this.opts;return this.opts.defaultMeta=typeof T=="object"?T[N]||T:void 0}validate(T,N){let C;if(typeof T=="string"){if(C=this.getSchema(T),!C)throw new Error(`no schema with key or ref "${T}"`)}else C=this.compile(T);const x=C(N);return"$async"in C||(this.errors=C.errors),x}compile(T,N){const C=this._addSchema(T,N);return C.validate||this._compileSchemaEnv(C)}compileAsync(T,N){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:C}=this.opts;return x.call(this,T,N);async function x(X,M){await R.call(this,X.$schema);const j=this._addSchema(X,M);return j.validate||H.call(this,j)}async function R(X){X&&!this.getSchema(X)&&await x.call(this,{$ref:X},!0)}async function H(X){try{return this._compileSchemaEnv(X)}catch(M){if(!(M instanceof o.default))throw M;return G.call(this,M),await J.call(this,M.missingSchema),H.call(this,X)}}function G({missingSchema:X,missingRef:M}){if(this.refs[X])throw new Error(`AnySchema ${X} is loaded but ${M} cannot be resolved`)}async function J(X){const M=await Y.call(this,X);this.refs[X]||await R.call(this,M.$schema),this.refs[X]||this.addSchema(M,X,N)}async function Y(X){const M=this._loading[X];if(M)return M;try{return await(this._loading[X]=C(X))}finally{delete this._loading[X]}}}addSchema(T,N,C,x=this.opts.validateSchema){if(Array.isArray(T)){for(const H of T)this.addSchema(H,void 0,C,x);return this}let R;if(typeof T=="object"){const{schemaId:H}=this.opts;if(R=T[H],R!==void 0&&typeof R!="string")throw new Error(`schema ${H} must be string`)}return N=(0,c.normalizeId)(N||R),this._checkUnique(N),this.schemas[N]=this._addSchema(T,C,N,x,!0),this}addMetaSchema(T,N,C=this.opts.validateSchema){return this.addSchema(T,N,!0,C),this}validateSchema(T,N){if(typeof T=="boolean")return!0;let C;if(C=T.$schema,C!==void 0&&typeof C!="string")throw new Error("$schema must be a string");if(C=C||this.opts.defaultMeta||this.defaultMeta(),!C)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const x=this.validate(C,T);if(!x&&N){const R="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(R);else throw new Error(R)}return x}getSchema(T){let N;for(;typeof(N=_.call(this,T))=="string";)T=N;if(N===void 0){const{schemaId:C}=this.opts,x=new i.SchemaEnv({schema:{},schemaId:C});if(N=i.resolveSchema.call(this,x,T),!N)return;this.refs[T]=N}return N.validate||this._compileSchemaEnv(N)}removeSchema(T){if(T instanceof RegExp)return this._removeAllSchemas(this.schemas,T),this._removeAllSchemas(this.refs,T),this;switch(typeof T){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const N=_.call(this,T);return typeof N=="object"&&this._cache.delete(N.schema),delete this.schemas[T],delete this.refs[T],this}case"object":{const N=T;this._cache.delete(N);let C=T[this.opts.schemaId];return C&&(C=(0,c.normalizeId)(C),delete this.schemas[C],delete this.refs[C]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(T){for(const N of T)this.addKeyword(N);return this}addKeyword(T,N){let C;if(typeof T=="string")C=T,typeof N=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),N.keyword=C);else if(typeof T=="object"&&N===void 0){if(N=T,C=N.keyword,Array.isArray(C)&&!C.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(z.call(this,C,N),!N)return(0,l.eachItem)(C,R=>k.call(this,R)),this;O.call(this,N);const x={...N,type:(0,u.getJSONTypes)(N.type),schemaType:(0,u.getJSONTypes)(N.schemaType)};return(0,l.eachItem)(C,x.type.length===0?R=>k.call(this,R,x):R=>x.type.forEach(H=>k.call(this,R,x,H))),this}getKeyword(T){const N=this.RULES.all[T];return typeof N=="object"?N.definition:!!N}removeKeyword(T){const{RULES:N}=this;delete N.keywords[T],delete N.all[T];for(const C of N.rules){const x=C.rules.findIndex(R=>R.keyword===T);x>=0&&C.rules.splice(x,1)}return this}addFormat(T,N){return typeof N=="string"&&(N=new RegExp(N)),this.formats[T]=N,this}errorsText(T=this.errors,{separator:N=", ",dataVar:C="data"}={}){return!T||T.length===0?"No errors":T.map(x=>`${C}${x.instancePath} ${x.message}`).reduce((x,R)=>x+N+R)}$dataMetaSchema(T,N){const C=this.RULES.all;T=JSON.parse(JSON.stringify(T));for(const x of N){const R=x.split("/").slice(1);let H=T;for(const G of R)H=H[G];for(const G in C){const J=C[G];if(typeof J!="object")continue;const{$data:Y}=J.definition,X=H[G];Y&&X&&(H[G]=B(X))}}return T}_removeAllSchemas(T,N){for(const C in T){const x=T[C];(!N||N.test(C))&&(typeof x=="string"?delete T[C]:x&&!x.meta&&(this._cache.delete(x.schema),delete T[C]))}}_addSchema(T,N,C,x=this.opts.validateSchema,R=this.opts.addUsedSchema){let H;const{schemaId:G}=this.opts;if(typeof T=="object")H=T[G];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof T!="boolean")throw new Error("schema must be object or boolean")}let J=this._cache.get(T);if(J!==void 0)return J;C=(0,c.normalizeId)(H||C);const Y=c.getSchemaRefs.call(this,T,C);return J=new i.SchemaEnv({schema:T,schemaId:G,meta:N,baseId:C,localRefs:Y}),this._cache.set(J.schema,J),R&&!C.startsWith("#")&&(C&&this._checkUnique(C),this.refs[C]=J),x&&this.validateSchema(T,!0),J}_checkUnique(T){if(this.schemas[T]||this.refs[T])throw new Error(`schema with key or id "${T}" already exists`)}_compileSchemaEnv(T){if(T.meta?this._compileMetaSchema(T):i.compileSchema.call(this,T),!T.validate)throw new Error("ajv implementation error");return T.validate}_compileMetaSchema(T){const N=this.opts;this.opts=this._metaOpts;try{i.compileSchema.call(this,T)}finally{this.opts=N}}}E.ValidationError=n.default,E.MissingRefError=o.default,e.default=E;function b(I,T,N,C="error"){for(const x in I){const R=x;R in T&&this.logger[C](`${N}: option ${x}. ${I[R]}`)}}function _(I){return I=(0,c.normalizeId)(I),this.schemas[I]||this.refs[I]}function $(){const I=this.opts.schemas;if(I)if(Array.isArray(I))this.addSchema(I);else for(const T in I)this.addSchema(I[T],T)}function A(){for(const I in this.opts.formats){const T=this.opts.formats[I];T&&this.addFormat(I,T)}}function q(I){if(Array.isArray(I)){this.addVocabulary(I);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const T in I){const N=I[T];N.keyword||(N.keyword=T),this.addKeyword(N)}}function F(){const I={...this.opts};for(const T of g)delete I[T];return I}const L={log(){},warn(){},error(){}};function D(I){if(I===!1)return L;if(I===void 0)return console;if(I.log&&I.warn&&I.error)return I;throw new Error("logger must implement log, warn and error methods")}const U=/^[a-z_$][a-z0-9_$:-]*$/i;function z(I,T){const{RULES:N}=this;if((0,l.eachItem)(I,C=>{if(N.keywords[C])throw new Error(`Keyword ${C} is already defined`);if(!U.test(C))throw new Error(`Keyword ${C} has invalid name`)}),!!T&&T.$data&&!("code"in T||"validate"in T))throw new Error('$data keyword must have "code" or "validate" function')}function k(I,T,N){var C;const x=T?.post;if(N&&x)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:R}=this;let H=x?R.post:R.rules.find(({type:J})=>J===N);if(H||(H={type:N,rules:[]},R.rules.push(H)),R.keywords[I]=!0,!T)return;const G={keyword:I,definition:{...T,type:(0,u.getJSONTypes)(T.type),schemaType:(0,u.getJSONTypes)(T.schemaType)}};T.before?S.call(this,H,G,T.before):H.rules.push(G),R.all[I]=G,(C=T.implements)===null||C===void 0||C.forEach(J=>this.addKeyword(J))}function S(I,T,N){const C=I.rules.findIndex(x=>x.keyword===N);C>=0?I.rules.splice(C,0,T):(I.rules.push(T),this.logger.warn(`rule ${N} is not defined`))}function O(I){let{metaSchema:T}=I;T!==void 0&&(I.$data&&this.opts.$data&&(T=B(T)),I.validateSchema=this.compile(T,!0))}const P={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function B(I){return{anyOf:[I,P]}}})(Rc)),Rc}var Fs={},Hs={},Vs={},hp;function Wk(){if(hp)return Vs;hp=1,Object.defineProperty(Vs,"__esModule",{value:!0});const e={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return Vs.default=e,Vs}var Vr={},pp;function Jk(){if(pp)return Vr;pp=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.callRef=Vr.getValidate=void 0;const e=Ba(),t=Gt(),r=ae(),n=bn(),o=lf(),s=de(),i={keyword:"$ref",schemaType:"string",code(u){const{gen:l,schema:f,it:h}=u,{baseId:p,schemaEnv:g,validateName:m,opts:d,self:w}=h,{root:y}=g;if((f==="#"||f==="#/")&&p===y.baseId)return E();const v=o.resolveRef.call(w,y,p,f);if(v===void 0)throw new e.default(h.opts.uriResolver,p,f);if(v instanceof o.SchemaEnv)return b(v);return _(v);function E(){if(g===y)return c(u,m,g,g.$async);const $=l.scopeValue("root",{ref:y});return c(u,(0,r._)`${$}.validate`,y,y.$async)}function b($){const A=a(u,$);c(u,A,$,$.$async)}function _($){const A=l.scopeValue("schema",d.code.source===!0?{ref:$,code:(0,r.stringify)($)}:{ref:$}),q=l.name("valid"),F=u.subschema({schema:$,dataTypes:[],schemaPath:r.nil,topSchemaRef:A,errSchemaPath:f},q);u.mergeEvaluated(F),u.ok(q)}}};function a(u,l){const{gen:f}=u;return l.validate?f.scopeValue("validate",{ref:l.validate}):(0,r._)`${f.scopeValue("wrapper",{ref:l})}.validate`}Vr.getValidate=a;function c(u,l,f,h){const{gen:p,it:g}=u,{allErrors:m,schemaEnv:d,opts:w}=g,y=w.passContext?n.default.this:r.nil;h?v():E();function v(){if(!d.$async)throw new Error("async schema referenced by sync schema");const $=p.let("valid");p.try(()=>{p.code((0,r._)`await ${(0,t.callValidateCode)(u,l,y)}`),_(l),m||p.assign($,!0)},A=>{p.if((0,r._)`!(${A} instanceof ${g.ValidationError})`,()=>p.throw(A)),b(A),m||p.assign($,!1)}),u.ok($)}function E(){u.result((0,t.callValidateCode)(u,l,y),()=>_(l),()=>b(l))}function b($){const A=(0,r._)`${$}.errors`;p.assign(n.default.vErrors,(0,r._)`${n.default.vErrors} === null ? ${A} : ${n.default.vErrors}.concat(${A})`),p.assign(n.default.errors,(0,r._)`${n.default.vErrors}.length`)}function _($){var A;if(!g.opts.unevaluated)return;const q=(A=f?.validate)===null||A===void 0?void 0:A.evaluated;if(g.props!==!0)if(q&&!q.dynamicProps)q.props!==void 0&&(g.props=s.mergeEvaluated.props(p,q.props,g.props));else{const F=p.var("props",(0,r._)`${$}.evaluated.props`);g.props=s.mergeEvaluated.props(p,F,g.props,r.Name)}if(g.items!==!0)if(q&&!q.dynamicItems)q.items!==void 0&&(g.items=s.mergeEvaluated.items(p,q.items,g.items));else{const F=p.var("items",(0,r._)`${$}.evaluated.items`);g.items=s.mergeEvaluated.items(p,F,g.items,r.Name)}}}return Vr.callRef=c,Vr.default=i,Vr}var mp;function Yk(){if(mp)return Hs;mp=1,Object.defineProperty(Hs,"__esModule",{value:!0});const e=Wk(),t=Jk(),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",e.default,t.default];return Hs.default=r,Hs}var Zs={},Ks={},gp;function Xk(){if(gp)return Ks;gp=1,Object.defineProperty(Ks,"__esModule",{value:!0});const e=ae(),t=e.operators,r={maximum:{okStr:"<=",ok:t.LTE,fail:t.GT},minimum:{okStr:">=",ok:t.GTE,fail:t.LT},exclusiveMaximum:{okStr:"<",ok:t.LT,fail:t.GTE},exclusiveMinimum:{okStr:">",ok:t.GT,fail:t.LTE}},n={message:({keyword:s,schemaCode:i})=>(0,e.str)`must be ${r[s].okStr} ${i}`,params:({keyword:s,schemaCode:i})=>(0,e._)`{comparison: ${r[s].okStr}, limit: ${i}}`},o={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:n,code(s){const{keyword:i,data:a,schemaCode:c}=s;s.fail$data((0,e._)`${a} ${r[i].fail} ${c} || isNaN(${a})`)}};return Ks.default=o,Ks}var Gs={},yp;function Qk(){if(yp)return Gs;yp=1,Object.defineProperty(Gs,"__esModule",{value:!0});const e=ae(),r={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must be multiple of ${n}`,params:({schemaCode:n})=>(0,e._)`{multipleOf: ${n}}`},code(n){const{gen:o,data:s,schemaCode:i,it:a}=n,c=a.opts.multipleOfPrecision,u=o.let("res"),l=c?(0,e._)`Math.abs(Math.round(${u}) - ${u}) > 1e-${c}`:(0,e._)`${u} !== parseInt(${u})`;n.fail$data((0,e._)`(${i} === 0 || (${u} = ${s}/${i}, ${l}))`)}};return Gs.default=r,Gs}var Ws={},Js={},wp;function eR(){if(wp)return Js;wp=1,Object.defineProperty(Js,"__esModule",{value:!0});function e(t){const r=t.length;let n=0,o=0,s;for(;o<r;)n++,s=t.charCodeAt(o++),s>=55296&&s<=56319&&o<r&&(s=t.charCodeAt(o),(s&64512)===56320&&o++);return n}return Js.default=e,e.code='require("ajv/dist/runtime/ucs2length").default',Js}var vp;function tR(){if(vp)return Ws;vp=1,Object.defineProperty(Ws,"__esModule",{value:!0});const e=ae(),t=de(),r=eR(),o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:s,schemaCode:i}){const a=s==="maxLength"?"more":"fewer";return(0,e.str)`must NOT have ${a} than ${i} characters`},params:({schemaCode:s})=>(0,e._)`{limit: ${s}}`},code(s){const{keyword:i,data:a,schemaCode:c,it:u}=s,l=i==="maxLength"?e.operators.GT:e.operators.LT,f=u.opts.unicode===!1?(0,e._)`${a}.length`:(0,e._)`${(0,t.useFunc)(s.gen,r.default)}(${a})`;s.fail$data((0,e._)`${f} ${l} ${c}`)}};return Ws.default=o,Ws}var Ys={},bp;function rR(){if(bp)return Ys;bp=1,Object.defineProperty(Ys,"__esModule",{value:!0});const e=Gt(),t=ae(),n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:o})=>(0,t.str)`must match pattern "${o}"`,params:({schemaCode:o})=>(0,t._)`{pattern: ${o}}`},code(o){const{data:s,$data:i,schema:a,schemaCode:c,it:u}=o,l=u.opts.unicodeRegExp?"u":"",f=i?(0,t._)`(new RegExp(${c}, ${l}))`:(0,e.usePattern)(o,a);o.fail$data((0,t._)`!${f}.test(${s})`)}};return Ys.default=n,Ys}var Xs={},_p;function nR(){if(_p)return Xs;_p=1,Object.defineProperty(Xs,"__esModule",{value:!0});const e=ae(),r={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:o}){const s=n==="maxProperties"?"more":"fewer";return(0,e.str)`must NOT have ${s} than ${o} properties`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:o,data:s,schemaCode:i}=n,a=o==="maxProperties"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`Object.keys(${s}).length ${a} ${i}`)}};return Xs.default=r,Xs}var Qs={},Ep;function oR(){if(Ep)return Qs;Ep=1,Object.defineProperty(Qs,"__esModule",{value:!0});const e=Gt(),t=ae(),r=de(),o={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:s}})=>(0,t.str)`must have required property '${s}'`,params:({params:{missingProperty:s}})=>(0,t._)`{missingProperty: ${s}}`},code(s){const{gen:i,schema:a,schemaCode:c,data:u,$data:l,it:f}=s,{opts:h}=f;if(!l&&a.length===0)return;const p=a.length>=h.loopRequired;if(f.allErrors?g():m(),h.strictRequired){const y=s.parentSchema.properties,{definedProperties:v}=s.it;for(const E of a)if(y?.[E]===void 0&&!v.has(E)){const b=f.schemaEnv.baseId+f.errSchemaPath,_=`required property "${E}" is not defined at "${b}" (strictRequired)`;(0,r.checkStrictMode)(f,_,f.opts.strictRequired)}}function g(){if(p||l)s.block$data(t.nil,d);else for(const y of a)(0,e.checkReportMissingProp)(s,y)}function m(){const y=i.let("missing");if(p||l){const v=i.let("valid",!0);s.block$data(v,()=>w(y,v)),s.ok(v)}else i.if((0,e.checkMissingProp)(s,a,y)),(0,e.reportMissingProp)(s,y),i.else()}function d(){i.forOf("prop",c,y=>{s.setParams({missingProperty:y}),i.if((0,e.noPropertyInData)(i,u,y,h.ownProperties),()=>s.error())})}function w(y,v){s.setParams({missingProperty:y}),i.forOf(y,c,()=>{i.assign(v,(0,e.propertyInData)(i,u,y,h.ownProperties)),i.if((0,t.not)(v),()=>{s.error(),i.break()})},t.nil)}}};return Qs.default=o,Qs}var ei={},$p;function sR(){if($p)return ei;$p=1,Object.defineProperty(ei,"__esModule",{value:!0});const e=ae(),r={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:o}){const s=n==="maxItems"?"more":"fewer";return(0,e.str)`must NOT have ${s} than ${o} items`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:o,data:s,schemaCode:i}=n,a=o==="maxItems"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`${s}.length ${a} ${i}`)}};return ei.default=r,ei}var ti={},ri={},Sp;function ff(){if(Sp)return ri;Sp=1,Object.defineProperty(ri,"__esModule",{value:!0});const e=cf();return e.code='require("ajv/dist/runtime/equal").default',ri.default=e,ri}var xp;function iR(){if(xp)return ti;xp=1,Object.defineProperty(ti,"__esModule",{value:!0});const e=na(),t=ae(),r=de(),n=ff(),s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i,j:a}})=>(0,t.str)`must NOT have duplicate items (items ## ${a} and ${i} are identical)`,params:({params:{i,j:a}})=>(0,t._)`{i: ${i}, j: ${a}}`},code(i){const{gen:a,data:c,$data:u,schema:l,parentSchema:f,schemaCode:h,it:p}=i;if(!u&&!l)return;const g=a.let("valid"),m=f.items?(0,e.getSchemaTypes)(f.items):[];i.block$data(g,d,(0,t._)`${h} === false`),i.ok(g);function d(){const E=a.let("i",(0,t._)`${c}.length`),b=a.let("j");i.setParams({i:E,j:b}),a.assign(g,!0),a.if((0,t._)`${E} > 1`,()=>(w()?y:v)(E,b))}function w(){return m.length>0&&!m.some(E=>E==="object"||E==="array")}function y(E,b){const _=a.name("item"),$=(0,e.checkDataTypes)(m,_,p.opts.strictNumbers,e.DataType.Wrong),A=a.const("indices",(0,t._)`{}`);a.for((0,t._)`;${E}--;`,()=>{a.let(_,(0,t._)`${c}[${E}]`),a.if($,(0,t._)`continue`),m.length>1&&a.if((0,t._)`typeof ${_} == "string"`,(0,t._)`${_} += "_"`),a.if((0,t._)`typeof ${A}[${_}] == "number"`,()=>{a.assign(b,(0,t._)`${A}[${_}]`),i.error(),a.assign(g,!1).break()}).code((0,t._)`${A}[${_}] = ${E}`)})}function v(E,b){const _=(0,r.useFunc)(a,n.default),$=a.name("outer");a.label($).for((0,t._)`;${E}--;`,()=>a.for((0,t._)`${b} = ${E}; ${b}--;`,()=>a.if((0,t._)`${_}(${c}[${E}], ${c}[${b}])`,()=>{i.error(),a.assign(g,!1).break($)})))}}};return ti.default=s,ti}var ni={},kp;function aR(){if(kp)return ni;kp=1,Object.defineProperty(ni,"__esModule",{value:!0});const e=ae(),t=de(),r=ff(),o={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:s})=>(0,e._)`{allowedValue: ${s}}`},code(s){const{gen:i,data:a,$data:c,schemaCode:u,schema:l}=s;c||l&&typeof l=="object"?s.fail$data((0,e._)`!${(0,t.useFunc)(i,r.default)}(${a}, ${u})`):s.fail((0,e._)`${l} !== ${a}`)}};return ni.default=o,ni}var oi={},Rp;function cR(){if(Rp)return oi;Rp=1,Object.defineProperty(oi,"__esModule",{value:!0});const e=ae(),t=de(),r=ff(),o={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:s})=>(0,e._)`{allowedValues: ${s}}`},code(s){const{gen:i,data:a,$data:c,schema:u,schemaCode:l,it:f}=s;if(!c&&u.length===0)throw new Error("enum must have non-empty array");const h=u.length>=f.opts.loopEnum;let p;const g=()=>p??(p=(0,t.useFunc)(i,r.default));let m;if(h||c)m=i.let("valid"),s.block$data(m,d);else{if(!Array.isArray(u))throw new Error("ajv implementation error");const y=i.const("vSchema",l);m=(0,e.or)(...u.map((v,E)=>w(y,E)))}s.pass(m);function d(){i.assign(m,!1),i.forOf("v",l,y=>i.if((0,e._)`${g()}(${a}, ${y})`,()=>i.assign(m,!0).break()))}function w(y,v){const E=u[v];return typeof E=="object"&&E!==null?(0,e._)`${g()}(${a}, ${y}[${v}])`:(0,e._)`${a} === ${E}`}}};return oi.default=o,oi}var Tp;function uR(){if(Tp)return Zs;Tp=1,Object.defineProperty(Zs,"__esModule",{value:!0});const e=Xk(),t=Qk(),r=tR(),n=rR(),o=nR(),s=oR(),i=sR(),a=iR(),c=aR(),u=cR(),l=[e.default,t.default,r.default,n.default,o.default,s.default,i.default,a.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},c.default,u.default];return Zs.default=l,Zs}var si={},Qn={},Ap;function Z0(){if(Ap)return Qn;Ap=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.validateAdditionalItems=void 0;const e=ae(),t=de(),n={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:s}})=>(0,e.str)`must NOT have more than ${s} items`,params:({params:{len:s}})=>(0,e._)`{limit: ${s}}`},code(s){const{parentSchema:i,it:a}=s,{items:c}=i;if(!Array.isArray(c)){(0,t.checkStrictMode)(a,'"additionalItems" is ignored when "items" is not an array of schemas');return}o(s,c)}};function o(s,i){const{gen:a,schema:c,data:u,keyword:l,it:f}=s;f.items=!0;const h=a.const("len",(0,e._)`${u}.length`);if(c===!1)s.setParams({len:i.length}),s.pass((0,e._)`${h} <= ${i.length}`);else if(typeof c=="object"&&!(0,t.alwaysValidSchema)(f,c)){const g=a.var("valid",(0,e._)`${h} <= ${i.length}`);a.if((0,e.not)(g),()=>p(g)),s.ok(g)}function p(g){a.forRange("i",i.length,h,m=>{s.subschema({keyword:l,dataProp:m,dataPropType:t.Type.Num},g),f.allErrors||a.if((0,e.not)(g),()=>a.break())})}}return Qn.validateAdditionalItems=o,Qn.default=n,Qn}var ii={},eo={},Ip;function K0(){if(Ip)return eo;Ip=1,Object.defineProperty(eo,"__esModule",{value:!0}),eo.validateTuple=void 0;const e=ae(),t=de(),r=Gt(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(s){const{schema:i,it:a}=s;if(Array.isArray(i))return o(s,"additionalItems",i);a.items=!0,!(0,t.alwaysValidSchema)(a,i)&&s.ok((0,r.validateArray)(s))}};function o(s,i,a=s.schema){const{gen:c,parentSchema:u,data:l,keyword:f,it:h}=s;m(u),h.opts.unevaluated&&a.length&&h.items!==!0&&(h.items=t.mergeEvaluated.items(c,a.length,h.items));const p=c.name("valid"),g=c.const("len",(0,e._)`${l}.length`);a.forEach((d,w)=>{(0,t.alwaysValidSchema)(h,d)||(c.if((0,e._)`${g} > ${w}`,()=>s.subschema({keyword:f,schemaProp:w,dataProp:w},p)),s.ok(p))});function m(d){const{opts:w,errSchemaPath:y}=h,v=a.length,E=v===d.minItems&&(v===d.maxItems||d[i]===!1);if(w.strictTuples&&!E){const b=`"${f}" is ${v}-tuple, but minItems or maxItems/${i} are not specified or different at path "${y}"`;(0,t.checkStrictMode)(h,b,w.strictTuples)}}}return eo.validateTuple=o,eo.default=n,eo}var Op;function lR(){if(Op)return ii;Op=1,Object.defineProperty(ii,"__esModule",{value:!0});const e=K0(),t={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,e.validateTuple)(r,"items")};return ii.default=t,ii}var ai={},Np;function fR(){if(Np)return ai;Np=1,Object.defineProperty(ai,"__esModule",{value:!0});const e=ae(),t=de(),r=Gt(),n=Z0(),s={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:i}})=>(0,e.str)`must NOT have more than ${i} items`,params:({params:{len:i}})=>(0,e._)`{limit: ${i}}`},code(i){const{schema:a,parentSchema:c,it:u}=i,{prefixItems:l}=c;u.items=!0,!(0,t.alwaysValidSchema)(u,a)&&(l?(0,n.validateAdditionalItems)(i,l):i.ok((0,r.validateArray)(i)))}};return ai.default=s,ai}var ci={},Cp;function dR(){if(Cp)return ci;Cp=1,Object.defineProperty(ci,"__esModule",{value:!0});const e=ae(),t=de(),n={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:o,max:s}})=>s===void 0?(0,e.str)`must contain at least ${o} valid item(s)`:(0,e.str)`must contain at least ${o} and no more than ${s} valid item(s)`,params:({params:{min:o,max:s}})=>s===void 0?(0,e._)`{minContains: ${o}}`:(0,e._)`{minContains: ${o}, maxContains: ${s}}`},code(o){const{gen:s,schema:i,parentSchema:a,data:c,it:u}=o;let l,f;const{minContains:h,maxContains:p}=a;u.opts.next?(l=h===void 0?1:h,f=p):l=1;const g=s.const("len",(0,e._)`${c}.length`);if(o.setParams({min:l,max:f}),f===void 0&&l===0){(0,t.checkStrictMode)(u,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(f!==void 0&&l>f){(0,t.checkStrictMode)(u,'"minContains" > "maxContains" is always invalid'),o.fail();return}if((0,t.alwaysValidSchema)(u,i)){let v=(0,e._)`${g} >= ${l}`;f!==void 0&&(v=(0,e._)`${v} && ${g} <= ${f}`),o.pass(v);return}u.items=!0;const m=s.name("valid");f===void 0&&l===1?w(m,()=>s.if(m,()=>s.break())):l===0?(s.let(m,!0),f!==void 0&&s.if((0,e._)`${c}.length > 0`,d)):(s.let(m,!1),d()),o.result(m,()=>o.reset());function d(){const v=s.name("_valid"),E=s.let("count",0);w(v,()=>s.if(v,()=>y(E)))}function w(v,E){s.forRange("i",0,g,b=>{o.subschema({keyword:"contains",dataProp:b,dataPropType:t.Type.Num,compositeRule:!0},v),E()})}function y(v){s.code((0,e._)`${v}++`),f===void 0?s.if((0,e._)`${v} >= ${l}`,()=>s.assign(m,!0).break()):(s.if((0,e._)`${v} > ${f}`,()=>s.assign(m,!1).break()),l===1?s.assign(m,!0):s.if((0,e._)`${v} >= ${l}`,()=>s.assign(m,!0)))}}};return ci.default=n,ci}var Uc={},Pp;function hR(){return Pp||(Pp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=ae(),r=de(),n=Gt();e.error={message:({params:{property:c,depsCount:u,deps:l}})=>{const f=u===1?"property":"properties";return(0,t.str)`must have ${f} ${l} when property ${c} is present`},params:({params:{property:c,depsCount:u,deps:l,missingProperty:f}})=>(0,t._)`{property: ${c},
    missingProperty: ${f},
    depsCount: ${u},
    deps: ${l}}`};const o={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(c){const[u,l]=s(c);i(c,u),a(c,l)}};function s({schema:c}){const u={},l={};for(const f in c){if(f==="__proto__")continue;const h=Array.isArray(c[f])?u:l;h[f]=c[f]}return[u,l]}function i(c,u=c.schema){const{gen:l,data:f,it:h}=c;if(Object.keys(u).length===0)return;const p=l.let("missing");for(const g in u){const m=u[g];if(m.length===0)continue;const d=(0,n.propertyInData)(l,f,g,h.opts.ownProperties);c.setParams({property:g,depsCount:m.length,deps:m.join(", ")}),h.allErrors?l.if(d,()=>{for(const w of m)(0,n.checkReportMissingProp)(c,w)}):(l.if((0,t._)`${d} && (${(0,n.checkMissingProp)(c,m,p)})`),(0,n.reportMissingProp)(c,p),l.else())}}e.validatePropertyDeps=i;function a(c,u=c.schema){const{gen:l,data:f,keyword:h,it:p}=c,g=l.name("valid");for(const m in u)(0,r.alwaysValidSchema)(p,u[m])||(l.if((0,n.propertyInData)(l,f,m,p.opts.ownProperties),()=>{const d=c.subschema({keyword:h,schemaProp:m},g);c.mergeValidEvaluated(d,g)},()=>l.var(g,!0)),c.ok(g))}e.validateSchemaDeps=a,e.default=o})(Uc)),Uc}var ui={},Lp;function pR(){if(Lp)return ui;Lp=1,Object.defineProperty(ui,"__esModule",{value:!0});const e=ae(),t=de(),n={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:o})=>(0,e._)`{propertyName: ${o.propertyName}}`},code(o){const{gen:s,schema:i,data:a,it:c}=o;if((0,t.alwaysValidSchema)(c,i))return;const u=s.name("valid");s.forIn("key",a,l=>{o.setParams({propertyName:l}),o.subschema({keyword:"propertyNames",data:l,dataTypes:["string"],propertyName:l,compositeRule:!0},u),s.if((0,e.not)(u),()=>{o.error(!0),c.allErrors||s.break()})}),o.ok(u)}};return ui.default=n,ui}var li={},Up;function G0(){if(Up)return li;Up=1,Object.defineProperty(li,"__esModule",{value:!0});const e=Gt(),t=ae(),r=bn(),n=de(),s={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:i})=>(0,t._)`{additionalProperty: ${i.additionalProperty}}`},code(i){const{gen:a,schema:c,parentSchema:u,data:l,errsCount:f,it:h}=i;if(!f)throw new Error("ajv implementation error");const{allErrors:p,opts:g}=h;if(h.props=!0,g.removeAdditional!=="all"&&(0,n.alwaysValidSchema)(h,c))return;const m=(0,e.allSchemaProperties)(u.properties),d=(0,e.allSchemaProperties)(u.patternProperties);w(),i.ok((0,t._)`${f} === ${r.default.errors}`);function w(){a.forIn("key",l,_=>{!m.length&&!d.length?E(_):a.if(y(_),()=>E(_))})}function y(_){let $;if(m.length>8){const A=(0,n.schemaRefOrVal)(h,u.properties,"properties");$=(0,e.isOwnProperty)(a,A,_)}else m.length?$=(0,t.or)(...m.map(A=>(0,t._)`${_} === ${A}`)):$=t.nil;return d.length&&($=(0,t.or)($,...d.map(A=>(0,t._)`${(0,e.usePattern)(i,A)}.test(${_})`))),(0,t.not)($)}function v(_){a.code((0,t._)`delete ${l}[${_}]`)}function E(_){if(g.removeAdditional==="all"||g.removeAdditional&&c===!1){v(_);return}if(c===!1){i.setParams({additionalProperty:_}),i.error(),p||a.break();return}if(typeof c=="object"&&!(0,n.alwaysValidSchema)(h,c)){const $=a.name("valid");g.removeAdditional==="failing"?(b(_,$,!1),a.if((0,t.not)($),()=>{i.reset(),v(_)})):(b(_,$),p||a.if((0,t.not)($),()=>a.break()))}}function b(_,$,A){const q={keyword:"additionalProperties",dataProp:_,dataPropType:n.Type.Str};A===!1&&Object.assign(q,{compositeRule:!0,createErrors:!1,allErrors:!1}),i.subschema(q,$)}}};return li.default=s,li}var fi={},zp;function mR(){if(zp)return fi;zp=1,Object.defineProperty(fi,"__esModule",{value:!0});const e=za(),t=Gt(),r=de(),n=G0(),o={keyword:"properties",type:"object",schemaType:"object",code(s){const{gen:i,schema:a,parentSchema:c,data:u,it:l}=s;l.opts.removeAdditional==="all"&&c.additionalProperties===void 0&&n.default.code(new e.KeywordCxt(l,n.default,"additionalProperties"));const f=(0,t.allSchemaProperties)(a);for(const d of f)l.definedProperties.add(d);l.opts.unevaluated&&f.length&&l.props!==!0&&(l.props=r.mergeEvaluated.props(i,(0,r.toHash)(f),l.props));const h=f.filter(d=>!(0,r.alwaysValidSchema)(l,a[d]));if(h.length===0)return;const p=i.name("valid");for(const d of h)g(d)?m(d):(i.if((0,t.propertyInData)(i,u,d,l.opts.ownProperties)),m(d),l.allErrors||i.else().var(p,!0),i.endIf()),s.it.definedProperties.add(d),s.ok(p);function g(d){return l.opts.useDefaults&&!l.compositeRule&&a[d].default!==void 0}function m(d){s.subschema({keyword:"properties",schemaProp:d,dataProp:d},p)}}};return fi.default=o,fi}var di={},Bp;function gR(){if(Bp)return di;Bp=1,Object.defineProperty(di,"__esModule",{value:!0});const e=Gt(),t=ae(),r=de(),n=de(),o={keyword:"patternProperties",type:"object",schemaType:"object",code(s){const{gen:i,schema:a,data:c,parentSchema:u,it:l}=s,{opts:f}=l,h=(0,e.allSchemaProperties)(a),p=h.filter(E=>(0,r.alwaysValidSchema)(l,a[E]));if(h.length===0||p.length===h.length&&(!l.opts.unevaluated||l.props===!0))return;const g=f.strictSchema&&!f.allowMatchingProperties&&u.properties,m=i.name("valid");l.props!==!0&&!(l.props instanceof t.Name)&&(l.props=(0,n.evaluatedPropsToName)(i,l.props));const{props:d}=l;w();function w(){for(const E of h)g&&y(E),l.allErrors?v(E):(i.var(m,!0),v(E),i.if(m))}function y(E){for(const b in g)new RegExp(E).test(b)&&(0,r.checkStrictMode)(l,`property ${b} matches pattern ${E} (use allowMatchingProperties)`)}function v(E){i.forIn("key",c,b=>{i.if((0,t._)`${(0,e.usePattern)(s,E)}.test(${b})`,()=>{const _=p.includes(E);_||s.subschema({keyword:"patternProperties",schemaProp:E,dataProp:b,dataPropType:n.Type.Str},m),l.opts.unevaluated&&d!==!0?i.assign((0,t._)`${d}[${b}]`,!0):!_&&!l.allErrors&&i.if((0,t.not)(m),()=>i.break())})})}}};return di.default=o,di}var hi={},Mp;function yR(){if(Mp)return hi;Mp=1,Object.defineProperty(hi,"__esModule",{value:!0});const e=de(),t={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:n,schema:o,it:s}=r;if((0,e.alwaysValidSchema)(s,o)){r.fail();return}const i=n.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},i),r.failResult(i,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};return hi.default=t,hi}var pi={},qp;function wR(){if(qp)return pi;qp=1,Object.defineProperty(pi,"__esModule",{value:!0});const t={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Gt().validateUnion,error:{message:"must match a schema in anyOf"}};return pi.default=t,pi}var mi={},jp;function vR(){if(jp)return mi;jp=1,Object.defineProperty(mi,"__esModule",{value:!0});const e=ae(),t=de(),n={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:o})=>(0,e._)`{passingSchemas: ${o.passing}}`},code(o){const{gen:s,schema:i,parentSchema:a,it:c}=o;if(!Array.isArray(i))throw new Error("ajv implementation error");if(c.opts.discriminator&&a.discriminator)return;const u=i,l=s.let("valid",!1),f=s.let("passing",null),h=s.name("_valid");o.setParams({passing:f}),s.block(p),o.result(l,()=>o.reset(),()=>o.error(!0));function p(){u.forEach((g,m)=>{let d;(0,t.alwaysValidSchema)(c,g)?s.var(h,!0):d=o.subschema({keyword:"oneOf",schemaProp:m,compositeRule:!0},h),m>0&&s.if((0,e._)`${h} && ${l}`).assign(l,!1).assign(f,(0,e._)`[${f}, ${m}]`).else(),s.if(h,()=>{s.assign(l,!0),s.assign(f,m),d&&o.mergeEvaluated(d,e.Name)})})}}};return mi.default=n,mi}var gi={},Dp;function bR(){if(Dp)return gi;Dp=1,Object.defineProperty(gi,"__esModule",{value:!0});const e=de(),t={keyword:"allOf",schemaType:"array",code(r){const{gen:n,schema:o,it:s}=r;if(!Array.isArray(o))throw new Error("ajv implementation error");const i=n.name("valid");o.forEach((a,c)=>{if((0,e.alwaysValidSchema)(s,a))return;const u=r.subschema({keyword:"allOf",schemaProp:c},i);r.ok(i),r.mergeEvaluated(u)})}};return gi.default=t,gi}var yi={},Fp;function _R(){if(Fp)return yi;Fp=1,Object.defineProperty(yi,"__esModule",{value:!0});const e=ae(),t=de(),n={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:s})=>(0,e.str)`must match "${s.ifClause}" schema`,params:({params:s})=>(0,e._)`{failingKeyword: ${s.ifClause}}`},code(s){const{gen:i,parentSchema:a,it:c}=s;a.then===void 0&&a.else===void 0&&(0,t.checkStrictMode)(c,'"if" without "then" and "else" is ignored');const u=o(c,"then"),l=o(c,"else");if(!u&&!l)return;const f=i.let("valid",!0),h=i.name("_valid");if(p(),s.reset(),u&&l){const m=i.let("ifClause");s.setParams({ifClause:m}),i.if(h,g("then",m),g("else",m))}else u?i.if(h,g("then")):i.if((0,e.not)(h),g("else"));s.pass(f,()=>s.error(!0));function p(){const m=s.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},h);s.mergeEvaluated(m)}function g(m,d){return()=>{const w=s.subschema({keyword:m},h);i.assign(f,h),s.mergeValidEvaluated(w,f),d?i.assign(d,(0,e._)`${m}`):s.setParams({ifClause:m})}}}};function o(s,i){const a=s.schema[i];return a!==void 0&&!(0,t.alwaysValidSchema)(s,a)}return yi.default=n,yi}var wi={},Hp;function ER(){if(Hp)return wi;Hp=1,Object.defineProperty(wi,"__esModule",{value:!0});const e=de(),t={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:n,it:o}){n.if===void 0&&(0,e.checkStrictMode)(o,`"${r}" without "if" is ignored`)}};return wi.default=t,wi}var Vp;function $R(){if(Vp)return si;Vp=1,Object.defineProperty(si,"__esModule",{value:!0});const e=Z0(),t=lR(),r=K0(),n=fR(),o=dR(),s=hR(),i=pR(),a=G0(),c=mR(),u=gR(),l=yR(),f=wR(),h=vR(),p=bR(),g=_R(),m=ER();function d(w=!1){const y=[l.default,f.default,h.default,p.default,g.default,m.default,i.default,a.default,s.default,c.default,u.default];return w?y.push(t.default,n.default):y.push(e.default,r.default),y.push(o.default),y}return si.default=d,si}var vi={},bi={},Zp;function SR(){if(Zp)return bi;Zp=1,Object.defineProperty(bi,"__esModule",{value:!0});const e=ae(),r={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must match format "${n}"`,params:({schemaCode:n})=>(0,e._)`{format: ${n}}`},code(n,o){const{gen:s,data:i,$data:a,schema:c,schemaCode:u,it:l}=n,{opts:f,errSchemaPath:h,schemaEnv:p,self:g}=l;if(!f.validateFormats)return;a?m():d();function m(){const w=s.scopeValue("formats",{ref:g.formats,code:f.code.formats}),y=s.const("fDef",(0,e._)`${w}[${u}]`),v=s.let("fType"),E=s.let("format");s.if((0,e._)`typeof ${y} == "object" && !(${y} instanceof RegExp)`,()=>s.assign(v,(0,e._)`${y}.type || "string"`).assign(E,(0,e._)`${y}.validate`),()=>s.assign(v,(0,e._)`"string"`).assign(E,y)),n.fail$data((0,e.or)(b(),_()));function b(){return f.strictSchema===!1?e.nil:(0,e._)`${u} && !${E}`}function _(){const $=p.$async?(0,e._)`(${y}.async ? await ${E}(${i}) : ${E}(${i}))`:(0,e._)`${E}(${i})`,A=(0,e._)`(typeof ${E} == "function" ? ${$} : ${E}.test(${i}))`;return(0,e._)`${E} && ${E} !== true && ${v} === ${o} && !${A}`}}function d(){const w=g.formats[c];if(!w){b();return}if(w===!0)return;const[y,v,E]=_(w);y===o&&n.pass($());function b(){if(f.strictSchema===!1){g.logger.warn(A());return}throw new Error(A());function A(){return`unknown format "${c}" ignored in schema at path "${h}"`}}function _(A){const q=A instanceof RegExp?(0,e.regexpCode)(A):f.code.formats?(0,e._)`${f.code.formats}${(0,e.getProperty)(c)}`:void 0,F=s.scopeValue("formats",{key:c,ref:A,code:q});return typeof A=="object"&&!(A instanceof RegExp)?[A.type||"string",A.validate,(0,e._)`${F}.validate`]:["string",A,F]}function $(){if(typeof w=="object"&&!(w instanceof RegExp)&&w.async){if(!p.$async)throw new Error("async format in sync schema");return(0,e._)`await ${E}(${i})`}return typeof v=="function"?(0,e._)`${E}(${i})`:(0,e._)`${E}.test(${i})`}}}};return bi.default=r,bi}var Kp;function xR(){if(Kp)return vi;Kp=1,Object.defineProperty(vi,"__esModule",{value:!0});const t=[SR().default];return vi.default=t,vi}var Rn={},Gp;function kR(){return Gp||(Gp=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.contentVocabulary=Rn.metadataVocabulary=void 0,Rn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],Rn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),Rn}var Wp;function RR(){if(Wp)return Fs;Wp=1,Object.defineProperty(Fs,"__esModule",{value:!0});const e=Yk(),t=uR(),r=$R(),n=xR(),o=kR(),s=[e.default,t.default,(0,r.default)(),n.default,o.metadataVocabulary,o.contentVocabulary];return Fs.default=s,Fs}var _i={},Wo={},Jp;function TR(){if(Jp)return Wo;Jp=1,Object.defineProperty(Wo,"__esModule",{value:!0}),Wo.DiscrError=void 0;var e;return(function(t){t.Tag="tag",t.Mapping="mapping"})(e||(Wo.DiscrError=e={})),Wo}var Yp;function AR(){if(Yp)return _i;Yp=1,Object.defineProperty(_i,"__esModule",{value:!0});const e=ae(),t=TR(),r=lf(),n=Ba(),o=de(),i={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:a,tagName:c}})=>a===t.DiscrError.Tag?`tag "${c}" must be string`:`value of tag "${c}" must be in oneOf`,params:({params:{discrError:a,tag:c,tagName:u}})=>(0,e._)`{error: ${a}, tag: ${u}, tagValue: ${c}}`},code(a){const{gen:c,data:u,schema:l,parentSchema:f,it:h}=a,{oneOf:p}=f;if(!h.opts.discriminator)throw new Error("discriminator: requires discriminator option");const g=l.propertyName;if(typeof g!="string")throw new Error("discriminator: requires propertyName");if(l.mapping)throw new Error("discriminator: mapping is not supported");if(!p)throw new Error("discriminator: requires oneOf keyword");const m=c.let("valid",!1),d=c.const("tag",(0,e._)`${u}${(0,e.getProperty)(g)}`);c.if((0,e._)`typeof ${d} == "string"`,()=>w(),()=>a.error(!1,{discrError:t.DiscrError.Tag,tag:d,tagName:g})),a.ok(m);function w(){const E=v();c.if(!1);for(const b in E)c.elseIf((0,e._)`${d} === ${b}`),c.assign(m,y(E[b]));c.else(),a.error(!1,{discrError:t.DiscrError.Mapping,tag:d,tagName:g}),c.endIf()}function y(E){const b=c.name("valid"),_=a.subschema({keyword:"oneOf",schemaProp:E},b);return a.mergeEvaluated(_,e.Name),b}function v(){var E;const b={},_=A(f);let $=!0;for(let L=0;L<p.length;L++){let D=p[L];if(D?.$ref&&!(0,o.schemaHasRulesButRef)(D,h.self.RULES)){const z=D.$ref;if(D=r.resolveRef.call(h.self,h.schemaEnv.root,h.baseId,z),D instanceof r.SchemaEnv&&(D=D.schema),D===void 0)throw new n.default(h.opts.uriResolver,h.baseId,z)}const U=(E=D?.properties)===null||E===void 0?void 0:E[g];if(typeof U!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${g}"`);$=$&&(_||A(D)),q(U,L)}if(!$)throw new Error(`discriminator: "${g}" must be required`);return b;function A({required:L}){return Array.isArray(L)&&L.includes(g)}function q(L,D){if(L.const)F(L.const,D);else if(L.enum)for(const U of L.enum)F(U,D);else throw new Error(`discriminator: "properties/${g}" must have "const" or "enum"`)}function F(L,D){if(typeof L!="string"||L in b)throw new Error(`discriminator: "${g}" values must be unique strings`);b[L]=D}}}};return _i.default=i,_i}const IR="http://json-schema.org/draft-07/schema#",OR="http://json-schema.org/draft-07/schema#",NR="Core schema meta-schema",CR={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},PR=["object","boolean"],LR={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},UR={$schema:IR,$id:OR,title:NR,definitions:CR,type:PR,properties:LR,default:!0};var Xp;function W0(){return Xp||(Xp=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=Gk(),n=RR(),o=AR(),s=UR,i=["/properties"],a="http://json-schema.org/draft-07/schema";class c extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(g=>this.addVocabulary(g)),this.opts.discriminator&&this.addKeyword(o.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const g=this.opts.$data?this.$dataMetaSchema(s,i):s;this.addMetaSchema(g,a,!1),this.refs["http://json-schema.org/schema"]=a}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(a)?a:void 0)}}t.Ajv=c,e.exports=t=c,e.exports.Ajv=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var u=za();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return u.KeywordCxt}});var l=ae();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return l._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return l.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return l.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return l.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return l.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return l.CodeGen}});var f=uf();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return f.default}});var h=Ba();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return h.default}})})(Bs,Bs.exports)),Bs.exports}var zR=W0();const BR=Pa(zR);var Ei={exports:{}},zc={},Qp;function MR(){return Qp||(Qp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatNames=e.fastFormats=e.fullFormats=void 0;function t(L,D){return{validate:L,compare:D}}e.fullFormats={date:t(s,i),time:t(c(!0),u),"date-time":t(h(!0),p),"iso-time":t(c(),l),"iso-date-time":t(h(),g),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:w,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:F,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:v,int32:{type:"number",validate:_},int64:{type:"number",validate:$},float:{type:"number",validate:A},double:{type:"number",validate:A},password:!0,binary:!0},e.fastFormats={...e.fullFormats,date:t(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,i),time:t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,u),"date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,p),"iso-time":t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,l),"iso-date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,g),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},e.formatNames=Object.keys(e.fullFormats);function r(L){return L%4===0&&(L%100!==0||L%400===0)}const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,o=[0,31,28,31,30,31,30,31,31,30,31,30,31];function s(L){const D=n.exec(L);if(!D)return!1;const U=+D[1],z=+D[2],k=+D[3];return z>=1&&z<=12&&k>=1&&k<=(z===2&&r(U)?29:o[z])}function i(L,D){if(L&&D)return L>D?1:L<D?-1:0}const a=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function c(L){return function(U){const z=a.exec(U);if(!z)return!1;const k=+z[1],S=+z[2],O=+z[3],P=z[4],B=z[5]==="-"?-1:1,I=+(z[6]||0),T=+(z[7]||0);if(I>23||T>59||L&&!P)return!1;if(k<=23&&S<=59&&O<60)return!0;const N=S-T*B,C=k-I*B-(N<0?1:0);return(C===23||C===-1)&&(N===59||N===-1)&&O<61}}function u(L,D){if(!(L&&D))return;const U=new Date("2020-01-01T"+L).valueOf(),z=new Date("2020-01-01T"+D).valueOf();if(U&&z)return U-z}function l(L,D){if(!(L&&D))return;const U=a.exec(L),z=a.exec(D);if(U&&z)return L=U[1]+U[2]+U[3],D=z[1]+z[2]+z[3],L>D?1:L<D?-1:0}const f=/t|\s/i;function h(L){const D=c(L);return function(z){const k=z.split(f);return k.length===2&&s(k[0])&&D(k[1])}}function p(L,D){if(!(L&&D))return;const U=new Date(L).valueOf(),z=new Date(D).valueOf();if(U&&z)return U-z}function g(L,D){if(!(L&&D))return;const[U,z]=L.split(f),[k,S]=D.split(f),O=i(U,k);if(O!==void 0)return O||u(z,S)}const m=/\/|:/,d=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function w(L){return m.test(L)&&d.test(L)}const y=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function v(L){return y.lastIndex=0,y.test(L)}const E=-2147483648,b=2**31-1;function _(L){return Number.isInteger(L)&&L<=b&&L>=E}function $(L){return Number.isInteger(L)}function A(){return!0}const q=/[^\\]\\Z/;function F(L){if(q.test(L))return!1;try{return new RegExp(L),!0}catch{return!1}}})(zc)),zc}var Bc={},em;function qR(){return em||(em=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLimitDefinition=void 0;const t=W0(),r=ae(),n=r.operators,o={formatMaximum:{okStr:"<=",ok:n.LTE,fail:n.GT},formatMinimum:{okStr:">=",ok:n.GTE,fail:n.LT},formatExclusiveMaximum:{okStr:"<",ok:n.LT,fail:n.GTE},formatExclusiveMinimum:{okStr:">",ok:n.GT,fail:n.LTE}},s={message:({keyword:a,schemaCode:c})=>(0,r.str)`should be ${o[a].okStr} ${c}`,params:({keyword:a,schemaCode:c})=>(0,r._)`{comparison: ${o[a].okStr}, limit: ${c}}`};e.formatLimitDefinition={keyword:Object.keys(o),type:"string",schemaType:"string",$data:!0,error:s,code(a){const{gen:c,data:u,schemaCode:l,keyword:f,it:h}=a,{opts:p,self:g}=h;if(!p.validateFormats)return;const m=new t.KeywordCxt(h,g.RULES.all.format.definition,"format");m.$data?d():w();function d(){const v=c.scopeValue("formats",{ref:g.formats,code:p.code.formats}),E=c.const("fmt",(0,r._)`${v}[${m.schemaCode}]`);a.fail$data((0,r.or)((0,r._)`typeof ${E} != "object"`,(0,r._)`${E} instanceof RegExp`,(0,r._)`typeof ${E}.compare != "function"`,y(E)))}function w(){const v=m.schema,E=g.formats[v];if(!E||E===!0)return;if(typeof E!="object"||E instanceof RegExp||typeof E.compare!="function")throw new Error(`"${f}": format "${v}" does not define "compare" function`);const b=c.scopeValue("formats",{key:v,ref:E,code:p.code.formats?(0,r._)`${p.code.formats}${(0,r.getProperty)(v)}`:void 0});a.fail$data(y(b))}function y(v){return(0,r._)`${v}.compare(${u}, ${l}) ${o[f].fail} 0`}},dependencies:["format"]};const i=a=>(a.addKeyword(e.formatLimitDefinition),a);e.default=i})(Bc)),Bc}var tm;function jR(){return tm||(tm=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=MR(),n=qR(),o=ae(),s=new o.Name("fullFormats"),i=new o.Name("fastFormats"),a=(u,l={keywords:!0})=>{if(Array.isArray(l))return c(u,l,r.fullFormats,s),u;const[f,h]=l.mode==="fast"?[r.fastFormats,i]:[r.fullFormats,s],p=l.formats||r.formatNames;return c(u,p,f,h),l.keywords&&(0,n.default)(u),u};a.get=(u,l="full")=>{const h=(l==="fast"?r.fastFormats:r.fullFormats)[u];if(!h)throw new Error(`Unknown format "${u}"`);return h};function c(u,l,f,h){var p,g;(p=(g=u.opts.code).formats)!==null&&p!==void 0||(g.formats=(0,o._)`require("ajv-formats/dist/formats").${h}`);for(const m of l)u.addFormat(m,f[m])}e.exports=t=a,Object.defineProperty(t,"__esModule",{value:!0}),t.default=a})(Ei,Ei.exports)),Ei.exports}var DR=jR();const FR=Pa(DR);function HR(){const e=new BR({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return FR(e),e}class VR{constructor(t){this._ajv=t??HR()}getValidator(t){const r="$id"in t&&typeof t.$id=="string"?this._ajv.getSchema(t.$id)??this._ajv.compile(t):this._ajv.compile(t);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}}class ZR{constructor(t){this._client=t}async*callToolStream(t,r=Ca,n){const o=this._client,s={...n,task:n?.task??(o.isToolTask(t.name)?{}:void 0)},i=o.requestStream({method:"tools/call",params:t},r,s),a=o.getToolOutputValidator(t.name);for await(const c of i){if(c.type==="result"&&a){const u=c.result;if(!u.structuredContent&&!u.isError){yield{type:"error",error:new ne(se.InvalidRequest,`Tool ${t.name} has an output schema but did not return structured content`)};return}if(u.structuredContent)try{const l=a(u.structuredContent);if(!l.valid){yield{type:"error",error:new ne(se.InvalidParams,`Structured content does not match the tool's output schema: ${l.errorMessage}`)};return}}catch(l){if(l instanceof ne){yield{type:"error",error:l};return}yield{type:"error",error:new ne(se.InvalidParams,`Failed to validate structured content: ${l instanceof Error?l.message:String(l)}`)};return}}yield c}}async getTask(t,r){return this._client.getTask({taskId:t},r)}async getTaskResult(t,r,n){return this._client.getTaskResult({taskId:t},r,n)}async listTasks(t,r){return this._client.listTasks(t?{cursor:t}:void 0,r)}async cancelTask(t,r){return this._client.cancelTask({taskId:t},r)}requestStream(t,r,n){return this._client.requestStream(t,r,n)}}function KR(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"tools/call":if(!e.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${t})`);break}}function GR(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"sampling/createMessage":if(!e.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${t})`);break;case"elicitation/create":if(!e.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${t})`);break}}function Pi(e,t){if(!(!e||t===null||typeof t!="object")){if(e.type==="object"&&e.properties&&typeof e.properties=="object"){const r=t,n=e.properties;for(const o of Object.keys(n)){const s=n[o];r[o]===void 0&&Object.prototype.hasOwnProperty.call(s,"default")&&(r[o]=s.default),r[o]!==void 0&&Pi(s,r[o])}}if(Array.isArray(e.anyOf))for(const r of e.anyOf)typeof r!="boolean"&&Pi(r,t);if(Array.isArray(e.oneOf))for(const r of e.oneOf)typeof r!="boolean"&&Pi(r,t)}}function WR(e){if(!e)return{supportsFormMode:!1,supportsUrlMode:!1};const t=e.form!==void 0,r=e.url!==void 0;return{supportsFormMode:t||!t&&!r,supportsUrlMode:r}}class JR extends Ok{constructor(t,r){super(r),this._clientInfo=t,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new VR,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(t){t.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",L0,t.tools,async()=>(await this.listTools()).tools),t.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",N0,t.prompts,async()=>(await this.listPrompts()).prompts),t.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",A0,t.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new ZR(this)}),this._experimental}registerCapabilities(t){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Nk(this._capabilities,t)}setRequestHandler(t,r){const o=o0(t)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(Ia(o)){const a=o;s=a._zod?.def?.value??a.value}else{const a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");const i=s;if(i==="elicitation/create"){const a=async(c,u)=>{const l=rn(q0,c);if(!l.success){const y=l.error instanceof Error?l.error.message:String(l.error);throw new ne(se.InvalidParams,`Invalid elicitation request: ${y}`)}const{params:f}=l.data;f.mode=f.mode??"form";const{supportsFormMode:h,supportsUrlMode:p}=WR(this._capabilities.elicitation);if(f.mode==="form"&&!h)throw new ne(se.InvalidParams,"Client does not support form-mode elicitation requests");if(f.mode==="url"&&!p)throw new ne(se.InvalidParams,"Client does not support URL-mode elicitation requests");const g=await Promise.resolve(r(c,u));if(f.task){const y=rn(ds,g);if(!y.success){const v=y.error instanceof Error?y.error.message:String(y.error);throw new ne(se.InvalidParams,`Invalid task creation result: ${v}`)}return y.data}const m=rn(j0,g);if(!m.success){const y=m.error instanceof Error?m.error.message:String(m.error);throw new ne(se.InvalidParams,`Invalid elicitation result: ${y}`)}const d=m.data,w=f.mode==="form"?f.requestedSchema:void 0;if(f.mode==="form"&&d.action==="accept"&&d.content&&w&&this._capabilities.elicitation?.form?.applyDefaults)try{Pi(w,d.content)}catch{}return d};return super.setRequestHandler(t,a)}if(i==="sampling/createMessage"){const a=async(c,u)=>{const l=rn(z0,c);if(!l.success){const d=l.error instanceof Error?l.error.message:String(l.error);throw new ne(se.InvalidParams,`Invalid sampling request: ${d}`)}const{params:f}=l.data,h=await Promise.resolve(r(c,u));if(f.task){const d=rn(ds,h);if(!d.success){const w=d.error instanceof Error?d.error.message:String(d.error);throw new ne(se.InvalidParams,`Invalid task creation result: ${w}`)}return d.data}const g=f.tools||f.toolChoice?M0:B0,m=rn(g,h);if(!m.success){const d=m.error instanceof Error?m.error.message:String(m.error);throw new ne(se.InvalidParams,`Invalid sampling result: ${d}`)}return m.data};return super.setRequestHandler(t,a)}return super.setRequestHandler(t,r)}assertCapability(t,r){if(!this._serverCapabilities?.[t])throw new Error(`Server does not support ${t} (required for ${r})`)}async connect(t,r){if(await super.connect(t),t.sessionId===void 0)try{const n=await this.request({method:"initialize",params:{protocolVersion:jl,capabilities:this._capabilities,clientInfo:this._clientInfo}},Zl,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!XS.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,t.setProtocolVersion&&t.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(t){switch(t){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${t})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${t})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${t})`);if(t==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${t})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${t})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${t})`);break}}assertNotificationCapability(t){switch(t){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${t})`);break}}assertRequestHandlerCapability(t){if(this._capabilities)switch(t){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${t})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${t})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${t})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${t})`);break}}assertTaskCapability(t){KR(this._serverCapabilities?.tasks?.requests,t,"Server")}assertTaskHandlerCapability(t){this._capabilities&&GR(this._capabilities.tasks?.requests,t,"Client")}async ping(t){return this.request({method:"ping"},lo,t)}async complete(t,r){return this.request({method:"completion/complete",params:t},D0,r)}async setLoggingLevel(t,r){return this.request({method:"logging/setLevel",params:{level:t}},lo,r)}async getPrompt(t,r){return this.request({method:"prompts/get",params:t},O0,r)}async listPrompts(t,r){return this.request({method:"prompts/list",params:t},I0,r)}async listResources(t,r){return this.request({method:"resources/list",params:t},k0,r)}async listResourceTemplates(t,r){return this.request({method:"resources/templates/list",params:t},R0,r)}async readResource(t,r){return this.request({method:"resources/read",params:t},T0,r)}async subscribeResource(t,r){return this.request({method:"resources/subscribe",params:t},lo,r)}async unsubscribeResource(t,r){return this.request({method:"resources/unsubscribe",params:t},lo,r)}async callTool(t,r=Ca,n){if(this.isToolTaskRequired(t.name))throw new ne(se.InvalidRequest,`Tool "${t.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);const o=await this.request({method:"tools/call",params:t},r,n),s=this.getToolOutputValidator(t.name);if(s){if(!o.structuredContent&&!o.isError)throw new ne(se.InvalidRequest,`Tool ${t.name} has an output schema but did not return structured content`);if(o.structuredContent)try{const i=s(o.structuredContent);if(!i.valid)throw new ne(se.InvalidParams,`Structured content does not match the tool's output schema: ${i.errorMessage}`)}catch(i){throw i instanceof ne?i:new ne(se.InvalidParams,`Failed to validate structured content: ${i instanceof Error?i.message:String(i)}`)}}return o}isToolTask(t){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(t):!1}isToolTaskRequired(t){return this._cachedRequiredTaskTools.has(t)}cacheToolMetadata(t){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(const r of t){if(r.outputSchema){const o=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,o)}const n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(t){return this._cachedToolOutputValidators.get(t)}async listTools(t,r){const n=await this.request({method:"tools/list",params:t},P0,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(t,r,n,o){const s=Zx.safeParse(n);if(!s.success)throw new Error(`Invalid ${t} listChanged options: ${s.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${t} listChanged options: onChanged must be a function`);const{autoRefresh:i,debounceMs:a}=s.data,{onChanged:c}=n,u=async()=>{if(!i){c(null,null);return}try{const f=await o();c(null,f)}catch(f){const h=f instanceof Error?f:new Error(String(f));c(h,null)}},l=()=>{if(a){const f=this._listChangedDebounceTimers.get(t);f&&clearTimeout(f);const h=setTimeout(u,a);this._listChangedDebounceTimers.set(t,h)}else u()};this.setNotificationHandler(r,l)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}const J0=25910,Ma=1059,YR=11316,XR=11317,QR=11318,eT=11319,tT=11320,Li={PUBKEY:"p",EVENT_ID:"e"},rT=5e3,Hu="initialize",nT="notifications/initialized";var fo;(function(e){e.OPTIONAL="optional",e.REQUIRED="required",e.DISABLED="disabled"})(fo||(fo={}));var Jo={exports:{}},Mc,rm;function oT(){if(rm)return Mc;rm=1;function e(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Mc=t;function t(r,n,o){var s=o&&o.stringify||e,i=1;if(typeof r=="object"&&r!==null){var a=n.length+i;if(a===1)return r;var c=new Array(a);c[0]=s(r);for(var u=1;u<a;u++)c[u]=s(n[u]);return c.join(" ")}if(typeof r!="string")return r;var l=n.length;if(l===0)return r;for(var f="",h=1-i,p=-1,g=r&&r.length||0,m=0;m<g;){if(r.charCodeAt(m)===37&&m+1<g){switch(p=p>-1?p:0,r.charCodeAt(m+1)){case 100:case 102:if(h>=l||n[h]==null)break;p<m&&(f+=r.slice(p,m)),f+=Number(n[h]),p=m+2,m++;break;case 105:if(h>=l||n[h]==null)break;p<m&&(f+=r.slice(p,m)),f+=Math.floor(Number(n[h])),p=m+2,m++;break;case 79:case 111:case 106:if(h>=l||n[h]===void 0)break;p<m&&(f+=r.slice(p,m));var d=typeof n[h];if(d==="string"){f+="'"+n[h]+"'",p=m+2,m++;break}if(d==="function"){f+=n[h].name||"<anonymous>",p=m+2,m++;break}f+=s(n[h]),p=m+2,m++;break;case 115:if(h>=l)break;p<m&&(f+=r.slice(p,m)),f+=String(n[h]),p=m+2,m++;break;case 37:p<m&&(f+=r.slice(p,m)),f+="%",p=m+2,m++,h--;break}++h}++m}return p===-1?r:(p<g&&(f+=r.slice(p)),f)}return Mc}var nm;function sT(){if(nm)return Jo.exports;nm=1;const e=oT();Jo.exports=l;const t=z().console||{},r={mapHttpRequest:$,mapHttpResponse:$,wrapRequestSerializer:A,wrapResponseSerializer:A,wrapErrorSerializer:A,req:$,res:$,err:b,errWithCause:b};function n(S,O){return S==="silent"?1/0:O.levels.values[S]}const o=Symbol("pino.logFuncs"),s=Symbol("pino.hierarchy"),i={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(S,O){const P={logger:O,parent:S[s]};O[s]=P}function c(S,O,P){const B={};O.forEach(I=>{B[I]=P[I]?P[I]:t[I]||t[i[I]||"log"]||q}),S[o]=B}function u(S,O){return Array.isArray(S)?S.filter(function(B){return B!=="!stdSerializers.err"}):S===!0?Object.keys(O):!1}function l(S){S=S||{},S.browser=S.browser||{};const O=S.browser.transmit;if(O&&typeof O.send!="function")throw Error("pino: transmit option must have a send function");const P=S.browser.write||t;S.browser.write&&(S.browser.asObject=!0);const B=S.serializers||{},I=u(S.browser.serialize,B);let T=S.browser.serialize;Array.isArray(S.browser.serialize)&&S.browser.serialize.indexOf("!stdSerializers.err")>-1&&(T=!1);const N=Object.keys(S.customLevels||{}),C=["error","fatal","warn","info","debug","trace"].concat(N);typeof P=="function"&&C.forEach(function(M){P[M]=P}),(S.enabled===!1||S.browser.disabled)&&(S.level="silent");const x=S.level||"info",R=Object.create(P);R.log||(R.log=q),c(R,C,P),a({},R),Object.defineProperty(R,"levelVal",{get:G}),Object.defineProperty(R,"level",{get:J,set:Y});const H={transmit:O,serialize:I,asObject:S.browser.asObject,asObjectBindingsOnly:S.browser.asObjectBindingsOnly,formatters:S.browser.formatters,reportCaller:S.browser.reportCaller,levels:C,timestamp:_(S),messageKey:S.messageKey||"msg",onChild:S.onChild||q};R.levels=f(S),R.level=x,R.isLevelEnabled=function(M){return this.levels.values[M]?this.levels.values[M]>=this.levels.values[this.level]:!1},R.setMaxListeners=R.getMaxListeners=R.emit=R.addListener=R.on=R.prependListener=R.once=R.prependOnceListener=R.removeListener=R.removeAllListeners=R.listeners=R.listenerCount=R.eventNames=R.write=R.flush=q,R.serializers=B,R._serialize=I,R._stdErrSerialize=T,R.child=function(...M){return X.call(this,H,...M)},O&&(R._logEvent=E());function G(){return n(this.level,this)}function J(){return this._level}function Y(M){if(M!=="silent"&&!this.levels.values[M])throw Error("unknown level "+M);this._level=M,g(this,H,R,"error"),g(this,H,R,"fatal"),g(this,H,R,"warn"),g(this,H,R,"info"),g(this,H,R,"debug"),g(this,H,R,"trace"),N.forEach(j=>{g(this,H,R,j)})}function X(M,j,Z){if(!j)throw new Error("missing bindings for child Pino");Z=Z||{},I&&j.serializers&&(Z.serializers=j.serializers);const W=Z.serializers;if(I&&W){var Q=Object.assign({},B,W),oe=S.browser.serialize===!0?Object.keys(Q):I;delete j.serializers,y([j],oe,Q,this._stdErrSerialize)}function ze(je){this._childLevel=(je._childLevel|0)+1,this.bindings=j,Q&&(this.serializers=Q,this._serialize=oe),O&&(this._logEvent=E([].concat(je._logEvent.bindings,j)))}ze.prototype=this;const Ze=new ze(this);return a(this,Ze),Ze.child=function(...je){return X.call(this,M,...je)},Ze.level=Z.level||this.level,M.onChild(Ze),Ze}return R}function f(S){const O=S.customLevels||{},P=Object.assign({},l.levels.values,O),B=Object.assign({},l.levels.labels,h(O));return{values:P,labels:B}}function h(S){const O={};return Object.keys(S).forEach(function(P){O[S[P]]=P}),O}l.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},l.stdSerializers=r,l.stdTimeFunctions=Object.assign({},{nullTime:F,epochTime:L,unixTime:D,isoTime:U});function p(S){const O=[];S.bindings&&O.push(S.bindings);let P=S[s];for(;P.parent;)P=P.parent,P.logger.bindings&&O.push(P.logger.bindings);return O.reverse()}function g(S,O,P,B){if(Object.defineProperty(S,B,{value:n(S.level,P)>n(B,P)?q:P[o][B],writable:!0,enumerable:!0,configurable:!0}),S[B]===q){if(!O.transmit)return;const T=O.transmit.level||S.level,N=n(T,P);if(n(B,P)<N)return}S[B]=d(S,O,P,B);const I=p(S);I.length!==0&&(S[B]=m(I,S[B]))}function m(S,O){return function(){return O.apply(this,[...S,...arguments])}}function d(S,O,P,B){return(function(I){return function(){const N=O.timestamp(),C=new Array(arguments.length),x=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var R=0;R<C.length;R++)C[R]=arguments[R];var H=!1;if(O.serialize&&(y(C,this._serialize,this.serializers,this._stdErrSerialize),H=!0),O.asObject||O.formatters){const G=w(this,B,C,N,O);if(O.reportCaller&&G&&G.length>0&&G[0]&&typeof G[0]=="object")try{const J=k();J&&(G[0].caller=J)}catch{}I.call(x,...G)}else{if(O.reportCaller)try{const G=k();G&&C.push(G)}catch{}I.apply(x,C)}if(O.transmit){const G=O.transmit.level||S._level,J=n(G,P),Y=n(B,P);if(Y<J)return;v(this,{ts:N,methodLevel:B,methodValue:Y,transmitValue:P.levels.values[O.transmit.level||S._level],send:O.transmit.send,val:n(S._level,P)},C,H)}}})(S[o][B])}function w(S,O,P,B,I){const{level:T,log:N=G=>G}=I.formatters||{},C=P.slice();let x=C[0];const R={};let H=(S._childLevel|0)+1;if(H<1&&(H=1),B&&(R.time=B),T){const G=T(O,S.levels.values[O]);Object.assign(R,G)}else R.level=S.levels.values[O];if(I.asObjectBindingsOnly){if(x!==null&&typeof x=="object")for(;H--&&typeof C[0]=="object";)Object.assign(R,C.shift());return[N(R),...C]}else{if(x!==null&&typeof x=="object"){for(;H--&&typeof C[0]=="object";)Object.assign(R,C.shift());x=C.length?e(C.shift(),C):void 0}else typeof x=="string"&&(x=e(C.shift(),C));return x!==void 0&&(R[I.messageKey]=x),[N(R)]}}function y(S,O,P,B){for(const I in S)if(B&&S[I]instanceof Error)S[I]=l.stdSerializers.err(S[I]);else if(typeof S[I]=="object"&&!Array.isArray(S[I])&&O)for(const T in S[I])O.indexOf(T)>-1&&T in P&&(S[I][T]=P[T](S[I][T]))}function v(S,O,P,B=!1){const I=O.send,T=O.ts,N=O.methodLevel,C=O.methodValue,x=O.val,R=S._logEvent.bindings;B||y(P,S._serialize||Object.keys(S.serializers),S.serializers,S._stdErrSerialize===void 0?!0:S._stdErrSerialize),S._logEvent.ts=T,S._logEvent.messages=P.filter(function(H){return R.indexOf(H)===-1}),S._logEvent.level.label=N,S._logEvent.level.value=C,I(N,S._logEvent,x),S._logEvent=E(R)}function E(S){return{ts:0,messages:[],bindings:S||[],level:{label:"",value:0}}}function b(S){const O={type:S.constructor.name,msg:S.message,stack:S.stack};for(const P in S)O[P]===void 0&&(O[P]=S[P]);return O}function _(S){return typeof S.timestamp=="function"?S.timestamp:S.timestamp===!1?F:L}function $(){return{}}function A(S){return S}function q(){}function F(){return!1}function L(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function U(){return new Date(Date.now()).toISOString()}function z(){function S(O){return typeof O<"u"&&O}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return S(self)||S(window)||S(this)||{}}}Jo.exports.default=l,Jo.exports.pino=l;function k(){const S=new Error().stack;if(!S)return null;const O=S.split(`
`);for(let P=1;P<O.length;P++){const B=O[P].trim();if(/(^at\s+)?(createWrap|LOG|set\s*\(|asObject|Object\.apply|Function\.apply)/.test(B)||B.indexOf("browser.js")!==-1||B.indexOf("node:internal")!==-1||B.indexOf("node_modules")!==-1)continue;let I=B.match(/\((.*?):(\d+):(\d+)\)/);if(I||(I=B.match(/at\s+(.*?):(\d+):(\d+)/)),I){const T=I[1],N=I[2],C=I[3];return T+":"+N+":"+C}}return null}return Jo.exports}var iT=sT();const Tn=Pa(iT);var zt={};function aT(){if(typeof process<"u"&&zt&&zt.LOG_LEVEL)return zt.LOG_LEVEL;if(typeof globalThis<"u"&&"window"in globalThis){const e=globalThis.window;if(e.LOG_LEVEL)return e.LOG_LEVEL}}const qc=(()=>{const e=aT()||"info",t=(typeof process<"u"&&zt?zt.LOG_DESTINATION:void 0)||"stderr",r=typeof process<"u"&&zt?zt.LOG_FILE:void 0;return{level:(typeof process<"u"&&zt?zt.LOG_ENABLED!=="false":!0)?e:"silent",destination:t,filePath:r}})();function cT(e={}){var t;const r=e.level||qc.level,n=e.file?"file":qc.destination,o=e.file||qc.filePath,s={level:r,base:{env:typeof process<"u"&&zt?"production":"unknown",version:typeof process<"u"&&zt&&zt.npm_package_version||"0.0.0"},timestamp:Tn.stdTimeFunctions.isoTime};if(!(typeof process<"u"&&((t=process.versions)===null||t===void 0?void 0:t.node)))return Tn({...s,browser:{asObject:!1}});let a;if(n==="file"&&o)try{const{existsSync:c,mkdirSync:u}=require("fs"),{dirname:l}=require("path"),f=l(o);c(f)||u(f,{recursive:!0}),a=Tn.destination({dest:o,minLength:1})}catch(c){console.warn("File logging failed, falling back to stderr:",c),a=Tn.destination({dest:2})}else n==="stdout"?a=Tn.destination({dest:1}):a=Tn.destination({dest:2});return Tn(s,a)}function Ts(e,t={}){const n=cT(t).child({module:e});return{debug:(o,s)=>{s?n.debug(s,o):n.debug(o)},info:(o,s)=>{s?n.info(s,o):n.info(o)},warn:(o,s)=>{s?n.warn(s,o):n.warn(o)},error:(o,s)=>{s?n.error(s,o):n.error(o)},withModule:o=>Ts(o,t)}}Ts("ctxvm");const uT=Ts("serializers");function lT(e,t,r,n=[]){return{pubkey:t,kind:r,tags:n,content:JSON.stringify(e),created_at:Math.floor(Date.now()/1e3)}}function fT(e){try{return JSON.parse(e.content)}catch(t){return uT.error(`Invalid JSON in Nostr event content: ${t instanceof Error?t.message:"Unknown error"}`),null}}function dT(e,t){const r=e.find(n=>n[0]===t);return r?r[1]:void 0}function om(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Y0(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function hT(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");om(e.outputLen),om(e.blockLen)}function oa(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function pT(e,t){Y0(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const jc=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const X0=e=>e instanceof Uint8Array,Dc=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Yt=(e,t)=>e<<32-t|e>>>t,mT=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mT)throw new Error("Non little-endian hardware is not supported");function gT(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function df(e){if(typeof e=="string"&&(e=gT(e)),!X0(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function yT(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!X0(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}let Q0=class{clone(){return this._cloneInto()}};function wT(e){const t=n=>e().update(df(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ey(e=32){if(jc&&typeof jc.getRandomValues=="function")return jc.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function vT(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}let bT=class extends Q0{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Dc(this.buffer)}update(t){oa(this);const{view:r,buffer:n,blockLen:o}=this;t=df(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Dc(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){oa(this),pT(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:s}=this;let{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;vT(n,o-8,BigInt(this.length*8),s),this.process(n,0);const a=Dc(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%r&&t.buffer.set(n),t}};const _T=(e,t,r)=>e&t^~e&r,ET=(e,t,r)=>e&t^e&r^t&r,$T=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Zr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Kr=new Uint32Array(64);let ST=class extends bT{constructor(){super(64,32,8,!1),this.A=Zr[0]|0,this.B=Zr[1]|0,this.C=Zr[2]|0,this.D=Zr[3]|0,this.E=Zr[4]|0,this.F=Zr[5]|0,this.G=Zr[6]|0,this.H=Zr[7]|0}get(){const{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)Kr[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){const h=Kr[f-15],p=Kr[f-2],g=Yt(h,7)^Yt(h,18)^h>>>3,m=Yt(p,17)^Yt(p,19)^p>>>10;Kr[f]=m+Kr[f-7]+g+Kr[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=Yt(a,6)^Yt(a,11)^Yt(a,25),p=l+h+_T(a,c,u)+$T[f]+Kr[f]|0,m=(Yt(n,2)^Yt(n,13)^Yt(n,22))+ET(n,o,s)|0;l=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){Kr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Vu=wT(()=>new ST);BigInt(0);const xT=BigInt(1),kT=BigInt(2),qa=e=>e instanceof Uint8Array,RT=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ro(e){if(!qa(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=RT[e[r]];return t}function hf(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function hs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const o=n*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function _t(e){return hf(Ro(e))}function pf(e){if(!qa(e))throw new Error("Uint8Array expected");return hf(Ro(Uint8Array.from(e).reverse()))}function hn(e,t){return hs(e.toString(16).padStart(t*2,"0"))}function mf(e,t){return hn(e,t).reverse()}function ot(e,t,r){let n;if(typeof t=="string")try{n=hs(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(qa(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return n}function Vn(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!qa(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}const gf=e=>(kT<<BigInt(e-1))-xT,Fc=e=>new Uint8Array(e),sm=e=>Uint8Array.from(e);function ty(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Fc(e),o=Fc(e),s=0;const i=()=>{n.fill(1),o.fill(0),s=0},a=(...f)=>r(o,n,...f),c=(f=Fc())=>{o=a(sm([0]),f),n=a(),f.length!==0&&(o=a(sm([1]),f),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<t;){n=a();const p=n.slice();h.push(p),f+=n.length}return Vn(...h)};return(f,h)=>{i(),c(f);let p;for(;!(p=h(u()));)c();return i(),p}}const TT={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function As(e,t,r={}){const n=(o,s,i)=>{const a=TT[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(i&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(t))n(o,s,!1);for(const[o,s]of Object.entries(r))n(o,s,!0);return e}const AT=Object.freeze(Object.defineProperty({__proto__:null,bitMask:gf,bytesToHex:Ro,bytesToNumberBE:_t,bytesToNumberLE:pf,concatBytes:Vn,createHmacDrbg:ty,ensureBytes:ot,hexToBytes:hs,hexToNumber:hf,numberToBytesBE:hn,numberToBytesLE:mf,validateObject:As},Symbol.toStringTag,{value:"Module"}));const He=BigInt(0),Le=BigInt(1),Pn=BigInt(2),IT=BigInt(3),Zu=BigInt(4),im=BigInt(5),am=BigInt(8);BigInt(9);BigInt(16);function Je(e,t){const r=e%t;return r>=He?r:t+r}function OT(e,t,r){if(r<=He||t<He)throw new Error("Expected power/modulo > 0");if(r===Le)return He;let n=Le;for(;t>He;)t&Le&&(n=n*e%r),e=e*e%r,t>>=Le;return n}function Ot(e,t,r){let n=e;for(;t-- >He;)n*=n,n%=r;return n}function Ku(e,t){if(e===He||t<=He)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=Je(e,t),n=t,o=He,s=Le;for(;r!==He;){const a=n/r,c=n%r,u=o-s*a;n=r,r=c,o=s,s=u}if(n!==Le)throw new Error("invert: does not exist");return Je(o,t)}function NT(e){const t=(e-Le)/Pn;let r,n,o;for(r=e-Le,n=0;r%Pn===He;r/=Pn,n++);for(o=Pn;o<e&&OT(o,t,e)!==e-Le;o++);if(n===1){const i=(e+Le)/Zu;return function(c,u){const l=c.pow(u,i);if(!c.eql(c.sqr(l),u))throw new Error("Cannot find square root");return l}}const s=(r+Le)/Pn;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(c,s),h=a.pow(c,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let m=a.sqr(h);p<u&&!a.eql(m,a.ONE);p++)m=a.sqr(m);const g=a.pow(l,Le<<BigInt(u-p-1));l=a.sqr(g),f=a.mul(f,g),h=a.mul(h,l),u=p}return f}}function CT(e){if(e%Zu===IT){const t=(e+Le)/Zu;return function(n,o){const s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%am===im){const t=(e-im)/am;return function(n,o){const s=n.mul(o,Pn),i=n.pow(s,t),a=n.mul(o,i),c=n.mul(n.mul(a,Pn),i),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return NT(e)}const PT=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function LT(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=PT.reduce((n,o)=>(n[o]="function",n),t);return As(e,r)}function UT(e,t,r){if(r<He)throw new Error("Expected power > 0");if(r===He)return e.ONE;if(r===Le)return t;let n=e.ONE,o=t;for(;r>He;)r&Le&&(n=e.mul(n,o)),o=e.sqr(o),r>>=Le;return n}function zT(e,t){const r=new Array(t.length),n=t.reduce((s,i,a)=>e.is0(i)?s:(r[a]=s,e.mul(s,i)),e.ONE),o=e.inv(n);return t.reduceRight((s,i,a)=>e.is0(i)?s:(r[a]=e.mul(s,r[a]),e.mul(s,i)),o),r}function ry(e,t){const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function BT(e,t,r=!1,n={}){if(e<=He)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=ry(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=CT(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:gf(o),ZERO:He,ONE:Le,create:c=>Je(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return He<=c&&c<e},is0:c=>c===He,isOdd:c=>(c&Le)===Le,neg:c=>Je(-c,e),eql:(c,u)=>c===u,sqr:c=>Je(c*c,e),add:(c,u)=>Je(c+u,e),sub:(c,u)=>Je(c-u,e),mul:(c,u)=>Je(c*u,e),pow:(c,u)=>UT(a,c,u),div:(c,u)=>Je(c*Ku(u,e),e),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ku(c,e),sqrt:n.sqrt||(c=>i(a,c)),invertBatch:c=>zT(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?mf(c,s):hn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?pf(c):_t(c)}});return Object.freeze(a)}function ny(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function oy(e){const t=ny(e);return t+Math.ceil(t/2)}function MT(e,t,r=!1){const n=e.length,o=ny(t),s=oy(t);if(n<16||n<s||n>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${n}`);const i=r?_t(e):pf(e),a=Je(i,t-Le)+Le;return r?mf(a,o):hn(a,o)}const qT=BigInt(0),Hc=BigInt(1);function jT(e,t){const r=(o,s)=>{const i=s.negate();return o?i:s},n=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:r,unsafeLadder(o,s){let i=e.ZERO,a=o;for(;s>qT;)s&Hc&&(i=i.add(a)),a=a.double(),s>>=Hc;return i},precomputeWindow(o,s){const{windows:i,windowSize:a}=n(s),c=[];let u=o,l=u;for(let f=0;f<i;f++){l=u,c.push(l);for(let h=1;h<a;h++)l=l.add(u),c.push(l);u=l.double()}return c},wNAF(o,s,i){const{windows:a,windowSize:c}=n(o);let u=e.ZERO,l=e.BASE;const f=BigInt(2**o-1),h=2**o,p=BigInt(o);for(let g=0;g<a;g++){const m=g*c;let d=Number(i&f);i>>=p,d>c&&(d-=h,i+=Hc);const w=m,y=m+Math.abs(d)-1,v=g%2!==0,E=d<0;d===0?l=l.add(r(v,s[w])):u=u.add(r(E,s[y]))}return{p:u,f:l}},wNAFCached(o,s,i,a){const c=o._WINDOW_SIZE||1;let u=s.get(o);return u||(u=this.precomputeWindow(o,c),c!==1&&s.set(o,a(u))),this.wNAF(c,u,i)}}}function sy(e){return LT(e.Fp),As(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ry(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function DT(e){const t=sy(e);As(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:o}=t;if(r){if(!n.eql(o,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:FT,hexToBytes:HT}=AT,zn={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=zn;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:FT(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=zn,r=typeof e=="string"?HT(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=zn._parseInt(r.subarray(2)),{d:i,l:a}=zn._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,r=u=>{const l=u.toString(16);return l.length&1?`0${l}`:l},n=t(r(e.s)),o=t(r(e.r)),s=n.length/2,i=o.length/2,a=r(s),c=r(i);return`30${r(i+s+4)}02${c}${o}02${a}${n}`}},Sr=BigInt(0),Lt=BigInt(1);BigInt(2);const cm=BigInt(3);BigInt(4);function VT(e){const t=DT(e),{Fp:r}=t,n=t.toBytes||((g,m,d)=>{const w=m.toAffine();return Vn(Uint8Array.from([4]),r.toBytes(w.x),r.toBytes(w.y))}),o=t.fromBytes||(g=>{const m=g.subarray(1),d=r.fromBytes(m.subarray(0,r.BYTES)),w=r.fromBytes(m.subarray(r.BYTES,2*r.BYTES));return{x:d,y:w}});function s(g){const{a:m,b:d}=t,w=r.sqr(g),y=r.mul(w,g);return r.add(r.add(y,r.mul(g,m)),d)}if(!r.eql(r.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(g){return typeof g=="bigint"&&Sr<g&&g<t.n}function a(g){if(!i(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(g){const{allowedPrivateKeyLengths:m,nByteLength:d,wrapPrivateKey:w,n:y}=t;if(m&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Ro(g)),typeof g!="string"||!m.includes(g.length))throw new Error("Invalid key");g=g.padStart(d*2,"0")}let v;try{v=typeof g=="bigint"?g:_t(ot("private key",g,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof g}`)}return w&&(v=Je(v,y)),a(v),v}const u=new Map;function l(g){if(!(g instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(m,d,w){if(this.px=m,this.py=d,this.pz=w,m==null||!r.isValid(m))throw new Error("x required");if(d==null||!r.isValid(d))throw new Error("y required");if(w==null||!r.isValid(w))throw new Error("z required")}static fromAffine(m){const{x:d,y:w}=m||{};if(!m||!r.isValid(d)||!r.isValid(w))throw new Error("invalid affine point");if(m instanceof f)throw new Error("projective point not allowed");const y=v=>r.eql(v,r.ZERO);return y(d)&&y(w)?f.ZERO:new f(d,w,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const d=r.invertBatch(m.map(w=>w.pz));return m.map((w,y)=>w.toAffine(d[y])).map(f.fromAffine)}static fromHex(m){const d=f.fromAffine(o(ot("pointHex",m)));return d.assertValidity(),d}static fromPrivateKey(m){return f.BASE.multiply(c(m))}_setWindowSize(m){this._WINDOW_SIZE=m,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:d}=this.toAffine();if(!r.isValid(m)||!r.isValid(d))throw new Error("bad point: x or y not FE");const w=r.sqr(d),y=s(m);if(!r.eql(w,y))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(r.isOdd)return!r.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){l(m);const{px:d,py:w,pz:y}=this,{px:v,py:E,pz:b}=m,_=r.eql(r.mul(d,b),r.mul(v,y)),$=r.eql(r.mul(w,b),r.mul(E,y));return _&&$}negate(){return new f(this.px,r.neg(this.py),this.pz)}double(){const{a:m,b:d}=t,w=r.mul(d,cm),{px:y,py:v,pz:E}=this;let b=r.ZERO,_=r.ZERO,$=r.ZERO,A=r.mul(y,y),q=r.mul(v,v),F=r.mul(E,E),L=r.mul(y,v);return L=r.add(L,L),$=r.mul(y,E),$=r.add($,$),b=r.mul(m,$),_=r.mul(w,F),_=r.add(b,_),b=r.sub(q,_),_=r.add(q,_),_=r.mul(b,_),b=r.mul(L,b),$=r.mul(w,$),F=r.mul(m,F),L=r.sub(A,F),L=r.mul(m,L),L=r.add(L,$),$=r.add(A,A),A=r.add($,A),A=r.add(A,F),A=r.mul(A,L),_=r.add(_,A),F=r.mul(v,E),F=r.add(F,F),A=r.mul(F,L),b=r.sub(b,A),$=r.mul(F,q),$=r.add($,$),$=r.add($,$),new f(b,_,$)}add(m){l(m);const{px:d,py:w,pz:y}=this,{px:v,py:E,pz:b}=m;let _=r.ZERO,$=r.ZERO,A=r.ZERO;const q=t.a,F=r.mul(t.b,cm);let L=r.mul(d,v),D=r.mul(w,E),U=r.mul(y,b),z=r.add(d,w),k=r.add(v,E);z=r.mul(z,k),k=r.add(L,D),z=r.sub(z,k),k=r.add(d,y);let S=r.add(v,b);return k=r.mul(k,S),S=r.add(L,U),k=r.sub(k,S),S=r.add(w,y),_=r.add(E,b),S=r.mul(S,_),_=r.add(D,U),S=r.sub(S,_),A=r.mul(q,k),_=r.mul(F,U),A=r.add(_,A),_=r.sub(D,A),A=r.add(D,A),$=r.mul(_,A),D=r.add(L,L),D=r.add(D,L),U=r.mul(q,U),k=r.mul(F,k),D=r.add(D,U),U=r.sub(L,U),U=r.mul(q,U),k=r.add(k,U),L=r.mul(D,k),$=r.add($,L),L=r.mul(S,k),_=r.mul(z,_),_=r.sub(_,L),L=r.mul(z,D),A=r.mul(S,A),A=r.add(A,L),new f(_,$,A)}subtract(m){return this.add(m.negate())}is0(){return this.equals(f.ZERO)}wNAF(m){return p.wNAFCached(this,u,m,d=>{const w=r.invertBatch(d.map(y=>y.pz));return d.map((y,v)=>y.toAffine(w[v])).map(f.fromAffine)})}multiplyUnsafe(m){const d=f.ZERO;if(m===Sr)return d;if(a(m),m===Lt)return this;const{endo:w}=t;if(!w)return p.unsafeLadder(this,m);let{k1neg:y,k1:v,k2neg:E,k2:b}=w.splitScalar(m),_=d,$=d,A=this;for(;v>Sr||b>Sr;)v&Lt&&(_=_.add(A)),b&Lt&&($=$.add(A)),A=A.double(),v>>=Lt,b>>=Lt;return y&&(_=_.negate()),E&&($=$.negate()),$=new f(r.mul($.px,w.beta),$.py,$.pz),_.add($)}multiply(m){a(m);let d=m,w,y;const{endo:v}=t;if(v){const{k1neg:E,k1:b,k2neg:_,k2:$}=v.splitScalar(d);let{p:A,f:q}=this.wNAF(b),{p:F,f:L}=this.wNAF($);A=p.constTimeNegate(E,A),F=p.constTimeNegate(_,F),F=new f(r.mul(F.px,v.beta),F.py,F.pz),w=A.add(F),y=q.add(L)}else{const{p:E,f:b}=this.wNAF(d);w=E,y=b}return f.normalizeZ([w,y])[0]}multiplyAndAddUnsafe(m,d,w){const y=f.BASE,v=(b,_)=>_===Sr||_===Lt||!b.equals(y)?b.multiplyUnsafe(_):b.multiply(_),E=v(this,d).add(v(m,w));return E.is0()?void 0:E}toAffine(m){const{px:d,py:w,pz:y}=this,v=this.is0();m==null&&(m=v?r.ONE:r.inv(y));const E=r.mul(d,m),b=r.mul(w,m),_=r.mul(y,m);if(v)return{x:r.ZERO,y:r.ZERO};if(!r.eql(_,r.ONE))throw new Error("invZ was invalid");return{x:E,y:b}}isTorsionFree(){const{h:m,isTorsionFree:d}=t;if(m===Lt)return!0;if(d)return d(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:d}=t;return m===Lt?this:d?d(f,this):this.multiplyUnsafe(t.h)}toRawBytes(m=!0){return this.assertValidity(),n(f,this,m)}toHex(m=!0){return Ro(this.toRawBytes(m))}}f.BASE=new f(t.Gx,t.Gy,r.ONE),f.ZERO=new f(r.ZERO,r.ONE,r.ZERO);const h=t.nBitLength,p=jT(f,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}function ZT(e){const t=sy(e);return As(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function KT(e){const t=ZT(e),{Fp:r,n}=t,o=r.BYTES+1,s=2*r.BYTES+1;function i(k){return Sr<k&&k<r.ORDER}function a(k){return Je(k,n)}function c(k){return Ku(k,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:h}=VT({...t,toBytes(k,S,O){const P=S.toAffine(),B=r.toBytes(P.x),I=Vn;return O?I(Uint8Array.from([S.hasEvenY()?2:3]),B):I(Uint8Array.from([4]),B,r.toBytes(P.y))},fromBytes(k){const S=k.length,O=k[0],P=k.subarray(1);if(S===o&&(O===2||O===3)){const B=_t(P);if(!i(B))throw new Error("Point is not on curve");const I=f(B);let T=r.sqrt(I);const N=(T&Lt)===Lt;return(O&1)===1!==N&&(T=r.neg(T)),{x:B,y:T}}else if(S===s&&O===4){const B=r.fromBytes(P.subarray(0,r.BYTES)),I=r.fromBytes(P.subarray(r.BYTES,2*r.BYTES));return{x:B,y:I}}else throw new Error(`Point of length ${S} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),p=k=>Ro(hn(k,t.nByteLength));function g(k){const S=n>>Lt;return k>S}function m(k){return g(k)?a(-k):k}const d=(k,S,O)=>_t(k.slice(S,O));class w{constructor(S,O,P){this.r=S,this.s=O,this.recovery=P,this.assertValidity()}static fromCompact(S){const O=t.nByteLength;return S=ot("compactSignature",S,O*2),new w(d(S,0,O),d(S,O,2*O))}static fromDER(S){const{r:O,s:P}=zn.toSig(ot("DER",S));return new w(O,P)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(S){return new w(this.r,this.s,S)}recoverPublicKey(S){const{r:O,s:P,recovery:B}=this,I=$(ot("msgHash",S));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const T=B===2||B===3?O+t.n:O;if(T>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const N=(B&1)===0?"02":"03",C=u.fromHex(N+p(T)),x=c(T),R=a(-I*x),H=a(P*x),G=u.BASE.multiplyAndAddUnsafe(C,R,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return hs(this.toDERHex())}toDERHex(){return zn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hs(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(k){try{return l(k),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const k=oy(t.n);return MT(t.randomBytes(k),t.n)},precompute(k=8,S=u.BASE){return S._setWindowSize(k),S.multiply(BigInt(3)),S}};function v(k,S=!0){return u.fromPrivateKey(k).toRawBytes(S)}function E(k){const S=k instanceof Uint8Array,O=typeof k=="string",P=(S||O)&&k.length;return S?P===o||P===s:O?P===2*o||P===2*s:k instanceof u}function b(k,S,O=!0){if(E(k))throw new Error("first arg must be private key");if(!E(S))throw new Error("second arg must be public key");return u.fromHex(S).multiply(l(k)).toRawBytes(O)}const _=t.bits2int||function(k){const S=_t(k),O=k.length*8-t.nBitLength;return O>0?S>>BigInt(O):S},$=t.bits2int_modN||function(k){return a(_(k))},A=gf(t.nBitLength);function q(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(Sr<=k&&k<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return hn(k,t.nByteLength)}function F(k,S,O=L){if(["recovered","canonical"].some(Y=>Y in O))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:B}=t;let{lowS:I,prehash:T,extraEntropy:N}=O;I==null&&(I=!0),k=ot("msgHash",k),T&&(k=ot("prehashed msgHash",P(k)));const C=$(k),x=l(S),R=[q(x),q(C)];if(N!=null){const Y=N===!0?B(r.BYTES):N;R.push(ot("extraEntropy",Y))}const H=Vn(...R),G=C;function J(Y){const X=_(Y);if(!h(X))return;const M=c(X),j=u.BASE.multiply(X).toAffine(),Z=a(j.x);if(Z===Sr)return;const W=a(M*a(G+Z*x));if(W===Sr)return;let Q=(j.x===Z?0:2)|Number(j.y&Lt),oe=W;return I&&g(W)&&(oe=m(W),Q^=1),new w(Z,oe,Q)}return{seed:H,k2sig:J}}const L={lowS:t.lowS,prehash:!1},D={lowS:t.lowS,prehash:!1};function U(k,S,O=L){const{seed:P,k2sig:B}=F(k,S,O),I=t;return ty(I.hash.outputLen,I.nByteLength,I.hmac)(P,B)}u.BASE._setWindowSize(8);function z(k,S,O,P=D){const B=k;if(S=ot("msgHash",S),O=ot("publicKey",O),"strict"in P)throw new Error("options.strict was renamed to lowS");const{lowS:I,prehash:T}=P;let N,C;try{if(typeof B=="string"||B instanceof Uint8Array)try{N=w.fromDER(B)}catch(j){if(!(j instanceof zn.Err))throw j;N=w.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){const{r:j,s:Z}=B;N=new w(j,Z)}else throw new Error("PARSE");C=u.fromHex(O)}catch(j){if(j.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(I&&N.hasHighS())return!1;T&&(S=t.hash(S));const{r:x,s:R}=N,H=$(S),G=c(R),J=a(H*G),Y=a(x*G),X=u.BASE.multiplyAndAddUnsafe(C,J,Y)?.toAffine();return X?a(X.x)===x:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:b,sign:U,verify:z,ProjectivePoint:u,Signature:w,utils:y}}let iy=class extends Q0{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,hT(t);const n=df(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return oa(this),this.iHash.update(t),this}digestInto(t){oa(this),Y0(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ay=(e,t,r)=>new iy(e,t).update(r).digest();ay.create=(e,t)=>new iy(e,t);function GT(e){return{hash:e,hmac:(t,...r)=>ay(e,t,yT(...r)),randomBytes:ey}}function WT(e,t){const r=n=>KT({...e,...GT(n)});return Object.freeze({...r(t),create:r})}const ja=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),sa=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),cy=BigInt(1),ia=BigInt(2),um=(e,t)=>(e+t/ia)/t;function uy(e){const t=ja,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,l=u*u*e%t,f=Ot(l,r,t)*l%t,h=Ot(f,r,t)*l%t,p=Ot(h,ia,t)*u%t,g=Ot(p,o,t)*p%t,m=Ot(g,s,t)*g%t,d=Ot(m,a,t)*m%t,w=Ot(d,c,t)*d%t,y=Ot(w,a,t)*m%t,v=Ot(y,r,t)*l%t,E=Ot(v,i,t)*g%t,b=Ot(E,n,t)*u%t,_=Ot(b,ia,t);if(!Gu.eql(Gu.sqr(_),e))throw new Error("Cannot find square root");return _}const Gu=BT(ja,void 0,void 0,{sqrt:uy}),Mo=WT({a:BigInt(0),b:BigInt(7),Fp:Gu,n:sa,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=sa,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-cy*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,i=BigInt("0x100000000000000000000000000000000"),a=um(s*e,t),c=um(-n*e,t);let u=Je(e-a*r-c*o,t),l=Je(-a*n-c*s,t);const f=u>i,h=l>i;if(f&&(u=t-u),h&&(l=t-l),u>i||l>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:u,k2neg:h,k2:l}}}},Vu),Da=BigInt(0),ly=e=>typeof e=="bigint"&&Da<e&&e<ja,JT=e=>typeof e=="bigint"&&Da<e&&e<sa,lm={};function aa(e,...t){let r=lm[e];if(r===void 0){const n=Vu(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Vn(n,n),lm[e]=r}return Vu(Vn(r,...t))}const yf=e=>e.toRawBytes(!0).slice(1),Wu=e=>hn(e,32),Vc=e=>Je(e,ja),ps=e=>Je(e,sa),wf=Mo.ProjectivePoint,YT=(e,t,r)=>wf.BASE.multiplyAndAddUnsafe(e,t,r);function Ju(e){let t=Mo.utils.normPrivateKeyToScalar(e),r=wf.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:ps(-t),bytes:yf(r)}}function fy(e){if(!ly(e))throw new Error("bad x: need 0 < x < p");const t=Vc(e*e),r=Vc(t*e+BigInt(7));let n=uy(r);n%ia!==Da&&(n=Vc(-n));const o=new wf(e,n,cy);return o.assertValidity(),o}function dy(...e){return ps(_t(aa("BIP0340/challenge",...e)))}function XT(e){return Ju(e).bytes}function QT(e,t,r=ey(32)){const n=ot("message",e),{bytes:o,scalar:s}=Ju(t),i=ot("auxRand",r,32),a=Wu(s^_t(aa("BIP0340/aux",i))),c=aa("BIP0340/nonce",a,o,n),u=ps(_t(c));if(u===Da)throw new Error("sign failed: k is zero");const{bytes:l,scalar:f}=Ju(u),h=dy(l,o,n),p=new Uint8Array(64);if(p.set(l,0),p.set(Wu(ps(f+h*s)),32),!hy(p,n,o))throw new Error("sign: Invalid signature produced");return p}function hy(e,t,r){const n=ot("signature",e,64),o=ot("message",t),s=ot("publicKey",r,32);try{const i=fy(_t(s)),a=_t(n.subarray(0,32));if(!ly(a))return!1;const c=_t(n.subarray(32,64));if(!JT(c))return!1;const u=dy(Wu(a),yf(i),o),l=YT(i,c,ps(-u));return!(!l||!l.hasEvenY()||l.toAffine().x!==a)}catch{return!1}}const nr={getPublicKey:XT,sign:QT,verify:hy,utils:{randomPrivateKey:Mo.utils.randomPrivateKey,lift_x:fy,pointToBytes:yf,numberToBytesBE:hn,bytesToNumberBE:_t,taggedHash:aa,mod:Je}},Zc=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const vf=e=>e instanceof Uint8Array,Kc=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Xt=(e,t)=>e<<32-t|e>>>t,eA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!eA)throw new Error("Non little-endian hardware is not supported");const tA=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Me(e){if(!vf(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=tA[e[r]];return t}function pn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const o=n*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function rA(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ms(e){if(typeof e=="string"&&(e=rA(e)),!vf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Fa(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!vf(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}let py=class{clone(){return this._cloneInto()}};function my(e){const t=n=>e().update(ms(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function gy(e=32){if(Zc&&typeof Zc.getRandomValues=="function")return Zc.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Yu(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function nA(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function yy(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function oA(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yu(e.outputLen),Yu(e.blockLen)}function sA(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function iA(e,t){yy(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const or={number:Yu,bool:nA,bytes:yy,hash:oA,exists:sA,output:iA};function aA(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}let cA=class extends py{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Kc(this.buffer)}update(t){or.exists(this);const{view:r,buffer:n,blockLen:o}=this;t=ms(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Kc(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){or.exists(this),or.output(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:s}=this;let{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;aA(n,o-8,BigInt(this.length*8),s),this.process(n,0);const a=Kc(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%r&&t.buffer.set(n),t}};const uA=(e,t,r)=>e&t^~e&r,lA=(e,t,r)=>e&t^e&r^t&r,fA=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Gr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wr=new Uint32Array(64);let wy=class extends cA{constructor(){super(64,32,8,!1),this.A=Gr[0]|0,this.B=Gr[1]|0,this.C=Gr[2]|0,this.D=Gr[3]|0,this.E=Gr[4]|0,this.F=Gr[5]|0,this.G=Gr[6]|0,this.H=Gr[7]|0}get(){const{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)Wr[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){const h=Wr[f-15],p=Wr[f-2],g=Xt(h,7)^Xt(h,18)^h>>>3,m=Xt(p,17)^Xt(p,19)^p>>>10;Wr[f]=m+Wr[f-7]+g+Wr[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=Xt(a,6)^Xt(a,11)^Xt(a,25),p=l+h+uA(a,c,u)+fA[f]+Wr[f]|0,m=(Xt(n,2)^Xt(n,13)^Xt(n,22))+lA(n,o,s)|0;l=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){Wr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},dA=class extends wy{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const _n=my(()=>new wy);my(()=>new dA);function qo(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Mr(...e){const t=(o,s)=>i=>o(s(i)),r=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),n=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:r,decode:n}}function qr(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(r=>{if(qo(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=e.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return n})}}}function jr(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Ha(e,t="="){if(qo(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of r)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let n=r.length;if(n*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function vy(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function fm(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let n=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(qo(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,a=!0;for(let c=n;c<s.length;c++){const u=s[c],l=t*i+u;if(!Number.isSafeInteger(l)||t*i/t!==i||l-u!==t*i)throw new Error("convertRadix: carry overflow");if(i=l%r,s[c]=Math.floor(l/r),!Number.isSafeInteger(s[c])||s[c]*r+i!==l)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:n=c;else continue}if(o.push(i),a)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const by=(e,t)=>t?by(t,e%t):e,ca=(e,t)=>e+(t-by(e,t));function Xu(e,t,r,n){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(ca(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${ca(t,r)}`);let o=0,s=0;const i=2**r-1,a=[];for(const c of e){if(qo(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(o=o<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=r;s-=r)a.push((o>>s-r&i)>>>0);o&=2**s-1}if(o=o<<r-s&i,!n&&s>=t)throw new Error("Excess padding");if(!n&&o)throw new Error(`Non-zero padding: ${o}`);return n&&s>0&&a.push(o>>>0),a}function hA(e){return qo(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return fm(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(fm(t,e,2**8))}}}function En(e,t=!1){if(qo(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(ca(8,e)>32||ca(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Xu(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Xu(r,e,8,t))}}}function dm(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const pA=Mr(En(4),qr("0123456789ABCDEF"),jr("")),mA=Mr(En(5),qr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ha(5),jr(""));Mr(En(5),qr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Ha(5),jr(""));Mr(En(5),qr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),jr(""),vy(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Lr=Mr(En(6),qr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Ha(6),jr("")),gA=Mr(En(6),qr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Ha(6),jr("")),bf=e=>Mr(hA(58),qr(e),jr("")),Qu=bf("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");bf("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");bf("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const hm=[0,2,3,5,6,7,9,10,11],yA={encode(e){let t="";for(let r=0;r<e.length;r+=8){const n=e.subarray(r,r+8);t+=Qu.encode(n).padStart(hm[n.length],"1")}return t},decode(e){let t=[];for(let r=0;r<e.length;r+=11){const n=e.slice(r,r+11),o=hm.indexOf(n.length),s=Qu.decode(n);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},el=Mr(qr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),jr("")),pm=[996825010,642813549,513874426,1027748829,705979059];function Yo(e){const t=e>>25;let r=(e&33554431)<<5;for(let n=0;n<pm.length;n++)(t>>n&1)===1&&(r^=pm[n]);return r}function mm(e,t,r=1){const n=e.length;let o=1;for(let s=0;s<n;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Yo(o)^i>>5}o=Yo(o);for(let s=0;s<n;s++)o=Yo(o)^e.charCodeAt(s)&31;for(let s of t)o=Yo(o)^s;for(let s=0;s<6;s++)o=Yo(o);return o^=r,el.encode(Xu([o%2**30],30,5,!1))}function _y(e){const t=e==="bech32"?1:734539939,r=En(5),n=r.decode,o=r.encode,s=dm(n);function i(l,f,h=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const p=l.length+7+f.length;if(h!==!1&&p>h)throw new TypeError(`Length ${p} exceeds limit ${h}`);return l=l.toLowerCase(),`${l}1${el.encode(f)}${mm(l,f,t)}`}function a(l,f=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||f!==!1&&l.length>f)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${f})`);const h=l.toLowerCase();if(l!==h&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=h;const p=l.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=l.slice(0,p),m=l.slice(p+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const d=el.decode(m).slice(0,-6),w=mm(g,d,t);if(!m.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:g,words:d}}const c=dm(a);function u(l){const{prefix:f,words:h}=a(l,!1);return{prefix:f,words:h,bytes:n(h)}}return{encode:i,decode:a,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:o}}const To=_y("bech32");_y("bech32m");const wA={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},vA=Mr(En(4),qr("0123456789abcdef"),jr(""),vy(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),bA={utf8:wA,hex:vA,base16:pA,base32:mA,base64:Lr,base64url:gA,base58:Qu,base58xmr:yA};`${Object.keys(bA).join(", ")}`;function Gc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function gm(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function _A(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function sr(e,...t){if(!_A(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}const at=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),EA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!EA)throw new Error("Non little-endian hardware is not supported");const $A=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function to(e){sr(e);let t="";for(let r=0;r<e.length;r++)t+=$A[e[r]];return t}const yr={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ym(e){if(e>=yr._0&&e<=yr._9)return e-yr._0;if(e>=yr._A&&e<=yr._F)return e-(yr._A-10);if(e>=yr._a&&e<=yr._f)return e-(yr._a-10)}function Ey(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const i=ym(e.charCodeAt(s)),a=ym(e.charCodeAt(s+1));if(i===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function SA(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function xA(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const kA=(e,t)=>(Object.assign(t,e),t),cn=16,RA=283;function _f(e){return e<<1^RA&-(e>>7)}function ho(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=_f(e);return r}const tl=(()=>{let e=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=_f(n))e[r]=n;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return t})(),TA=tl.map((e,t)=>tl.indexOf(t)),AA=e=>e<<24|e>>>8,Wc=e=>e<<8|e>>>24;function $y(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((u,l)=>t(e[l])),n=r.map(Wc),o=n.map(Wc),s=o.map(Wc),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let l=0;l<256;l++){const f=u*256+l;i[f]=r[u]^n[l],a[f]=o[u]^s[l],c[f]=e[u]<<8|e[l]}return{sbox:e,sbox2:c,T0:r,T1:n,T2:o,T3:s,T01:i,T23:a}}const Ef=$y(tl,e=>ho(e,3)<<24|e<<16|e<<8|ho(e,2)),Sy=$y(TA,e=>ho(e,11)<<24|ho(e,13)<<16|ho(e,9)<<8|ho(e,14)),IA=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=_f(r))e[t]=r;return e})();function xy(e){sr(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:r}=Ef,n=at(e),o=n.length,s=a=>ir(r,a,a,a,a),i=new Uint32Array(t+28);i.set(n);for(let a=o;a<i.length;a++){let c=i[a-1];a%o===0?c=s(AA(c))^IA[a/o-1]:o>6&&a%o===4&&(c=s(c)),i[a]=i[a-o]^c}return i}function OA(e){const t=xy(e),r=t.slice(),n=t.length,{sbox2:o}=Ef,{T0:s,T1:i,T2:a,T3:c}=Sy;for(let u=0;u<n;u+=4)for(let l=0;l<4;l++)r[u+l]=t[n-u-4+l];t.fill(0);for(let u=4;u<n-4;u++){const l=r[u],f=ir(o,l,l,l,l);r[u]=s[f&255]^i[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return r}function on(e,t,r,n,o,s){return e[r<<8&65280|n>>>8&255]^t[o>>>8&65280|s>>>24&255]}function ir(e,t,r,n,o){return e[t&255|r&65280]|e[n>>>16&255|o>>>16&65280]<<16}function wm(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=Ef;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^on(i,a,t,r,n,o),d=e[c++]^on(i,a,r,n,o,t),w=e[c++]^on(i,a,n,o,t,r),y=e[c++]^on(i,a,o,t,r,n);t=m,r=d,n=w,o=y}const l=e[c++]^ir(s,t,r,n,o),f=e[c++]^ir(s,r,n,o,t),h=e[c++]^ir(s,n,o,t,r),p=e[c++]^ir(s,o,t,r,n);return{s0:l,s1:f,s2:h,s3:p}}function NA(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=Sy;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^on(i,a,t,o,n,r),d=e[c++]^on(i,a,r,t,o,n),w=e[c++]^on(i,a,n,r,t,o),y=e[c++]^on(i,a,o,n,r,t);t=m,r=d,n=w,o=y}const l=e[c++]^ir(s,t,o,n,r),f=e[c++]^ir(s,r,t,o,n),h=e[c++]^ir(s,n,r,t,o),p=e[c++]^ir(s,o,n,r,t);return{s0:l,s1:f,s2:h,s3:p}}function ky(e,t){if(!t)return new Uint8Array(e);if(sr(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function CA(e){if(sr(e),e.length%cn!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${cn}`)}function PA(e,t,r){let n=e.length;const o=n%cn;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=at(e);if(t){let c=cn-o;c||(c=cn),n=n+c}const i=ky(n,r),a=at(i);return{b:s,o:a,out:i}}function LA(e,t){if(!t)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=e[r-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);const o=e.subarray(0,-n);for(let s=0;s<n;s++)if(e[r-s-1]!==n)throw new Error("aes/pcks5: wrong padding");return o}function UA(e){const t=new Uint8Array(16),r=at(t);t.set(e);const n=cn-e.length;for(let o=cn-n;o<cn;o++)t[o]=n;return r}const Ry=kA({blockSize:16,nonceLength:16},function(t,r,n={}){sr(t),sr(r,16);const o=!n.disablePadding;return{encrypt:(s,i)=>{const a=xy(t),{b:c,o:u,out:l}=PA(s,o,i),f=at(r);let h=f[0],p=f[1],g=f[2],m=f[3],d=0;for(;d+4<=c.length;)h^=c[d+0],p^=c[d+1],g^=c[d+2],m^=c[d+3],{s0:h,s1:p,s2:g,s3:m}=wm(a,h,p,g,m),u[d++]=h,u[d++]=p,u[d++]=g,u[d++]=m;if(o){const w=UA(s.subarray(d*4));h^=w[0],p^=w[1],g^=w[2],m^=w[3],{s0:h,s1:p,s2:g,s3:m}=wm(a,h,p,g,m),u[d++]=h,u[d++]=p,u[d++]=g,u[d++]=m}return a.fill(0),l},decrypt:(s,i)=>{CA(s);const a=OA(t),c=at(r),u=ky(s.length,i),l=at(s),f=at(u);let h=c[0],p=c[1],g=c[2],m=c[3];for(let d=0;d+4<=l.length;){const w=h,y=p,v=g,E=m;h=l[d+0],p=l[d+1],g=l[d+2],m=l[d+3];const{s0:b,s1:_,s2:$,s3:A}=NA(a,h,p,g,m);f[d++]=b^w,f[d++]=_^y,f[d++]=$^v,f[d++]=A^E}return a.fill(0),LA(u,o)}}}),Ty=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),zA=Ty("expand 16-byte k"),BA=Ty("expand 32-byte k"),MA=at(zA),Ay=at(BA);Ay.slice();function ue(e,t){return e<<t|e>>>32-t}function rl(e){return e.byteOffset%4===0}const $i=64,qA=16,Iy=2**32-1,vm=new Uint32Array;function jA(e,t,r,n,o,s,i,a){const c=o.length,u=new Uint8Array($i),l=at(u),f=rl(o)&&rl(s),h=f?at(o):vm,p=f?at(s):vm;for(let g=0;g<c;i++){if(e(t,r,n,l,i,a),i>=Iy)throw new Error("arx: counter overflow");const m=Math.min($i,c-g);if(f&&m===$i){const d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<qA;w++)y=d+w,p[y]=h[y]^l[w];g+=$i;continue}for(let d=0,w;d<m;d++)w=g+d,s[w]=o[w]^u[d];g+=m}}function DA(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=SA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Gc(o),Gc(i),gm(s),gm(r),(a,c,u,l,f=0)=>{sr(a),sr(c),sr(u);const h=u.length;if(l||(l=new Uint8Array(h)),sr(l),Gc(f),f<0||f>=Iy)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const p=[];let g=a.length,m,d;if(g===32)m=a.slice(),p.push(m),d=Ay;else if(g===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),d=MA,p.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);rl(c)||(c=c.slice(),p.push(c));const w=at(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(d,w,at(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-o;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,p.push(c)}const v=at(c);for(jA(e,d,w,v,u,l,f,i);p.length>0;)p.pop().fill(0);return l}}function FA(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],u=e[3],l=t[0],f=t[1],h=t[2],p=t[3],g=t[4],m=t[5],d=t[6],w=t[7],y=o,v=r[0],E=r[1],b=r[2],_=i,$=a,A=c,q=u,F=l,L=f,D=h,U=p,z=g,k=m,S=d,O=w,P=y,B=v,I=E,T=b;for(let C=0;C<s;C+=2)_=_+F|0,P=ue(P^_,16),z=z+P|0,F=ue(F^z,12),_=_+F|0,P=ue(P^_,8),z=z+P|0,F=ue(F^z,7),$=$+L|0,B=ue(B^$,16),k=k+B|0,L=ue(L^k,12),$=$+L|0,B=ue(B^$,8),k=k+B|0,L=ue(L^k,7),A=A+D|0,I=ue(I^A,16),S=S+I|0,D=ue(D^S,12),A=A+D|0,I=ue(I^A,8),S=S+I|0,D=ue(D^S,7),q=q+U|0,T=ue(T^q,16),O=O+T|0,U=ue(U^O,12),q=q+U|0,T=ue(T^q,8),O=O+T|0,U=ue(U^O,7),_=_+L|0,T=ue(T^_,16),S=S+T|0,L=ue(L^S,12),_=_+L|0,T=ue(T^_,8),S=S+T|0,L=ue(L^S,7),$=$+D|0,P=ue(P^$,16),O=O+P|0,D=ue(D^O,12),$=$+D|0,P=ue(P^$,8),O=O+P|0,D=ue(D^O,7),A=A+U|0,B=ue(B^A,16),z=z+B|0,U=ue(U^z,12),A=A+U|0,B=ue(B^A,8),z=z+B|0,U=ue(U^z,7),q=q+F|0,I=ue(I^q,16),k=k+I|0,F=ue(F^k,12),q=q+F|0,I=ue(I^q,8),k=k+I|0,F=ue(F^k,7);let N=0;n[N++]=i+_|0,n[N++]=a+$|0,n[N++]=c+A|0,n[N++]=u+q|0,n[N++]=l+F|0,n[N++]=f+L|0,n[N++]=h+D|0,n[N++]=p+U|0,n[N++]=g+z|0,n[N++]=m+k|0,n[N++]=d+S|0,n[N++]=w+O|0,n[N++]=y+P|0,n[N++]=v+B|0,n[N++]=E+I|0,n[N++]=b+T|0}const Oy=DA(FA,{counterRight:!1,counterLength:4,allowShortKeys:!1});let Ny=class extends py{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,or.hash(t);const n=ms(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return or.exists(this),this.iHash.update(t),this}digestInto(t){or.exists(this),or.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Va=(e,t,r)=>new Ny(e,t).update(r).digest();Va.create=(e,t)=>new Ny(e,t);function HA(e,t,r){return or.hash(e),Va(e,ms(r),ms(t))}const Jc=new Uint8Array([0]),bm=new Uint8Array;function VA(e,t,r,n=32){if(or.hash(e),or.number(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(n/e.outputLen);r===void 0&&(r=bm);const s=new Uint8Array(o*e.outputLen),i=Va.create(e,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)Jc[0]=u+1,a.update(u===0?bm:c).update(r).update(Jc).digestInto(c),s.set(c,e.outputLen*u),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),Jc.fill(0),s.slice(0,n)}var ZA=Object.defineProperty,_e=(e,t)=>{for(var r in t)ZA(e,r,{get:t[r],enumerable:!0})},ro=Symbol("verified"),KA=e=>e instanceof Object;function $f(e){if(!KA(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}var GA={};_e(GA,{Queue:()=>XA,QueueNode:()=>Cy,binarySearch:()=>Sf,bytesToHex:()=>Me,hexToBytes:()=>pn,insertEventIntoAscendingList:()=>YA,insertEventIntoDescendingList:()=>JA,normalizeURL:()=>WA,utf8Decoder:()=>Ir,utf8Encoder:()=>Vt});var Ir=new TextDecoder("utf-8"),Vt=new TextEncoder;function WA(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function JA(e,t){const[r,n]=Sf(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return n||e.splice(r,0,t),e}function YA(e,t){const[r,n]=Sf(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return n||e.splice(r,0,t),e}function Sf(e,t){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?n=o-1:r=o+1}return[r,!1]}var Cy=class{value;next=null;prev=null;constructor(t){this.value=t}},XA=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const r=new Cy(t);return this.last?this.last===this.first?(this.last=r,this.last.prev=this.first,this.first.next=r):(r.prev=this.last,this.last.next=r,this.last=r):(this.first=r,this.last=r),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const r=this.first;return this.first=null,this.last=null,r.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},QA=class{generateSecretKey(){return nr.utils.randomPrivateKey()}getPublicKey(t){return Me(nr.getPublicKey(t))}finalizeEvent(t,r){const n=t;return n.pubkey=Me(nr.getPublicKey(r)),n.id=Ui(n),n.sig=Me(nr.sign(Ui(n),r)),n[ro]=!0,n}verifyEvent(t){if(typeof t[ro]=="boolean")return t[ro];const r=Ui(t);if(r!==t.id)return t[ro]=!1,!1;try{const n=nr.verify(t.sig,r,t.pubkey);return t[ro]=n,n}catch{return t[ro]=!1,!1}}};function eI(e){if(!$f(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Ui(e){let t=_n(Vt.encode(eI(e)));return Me(t)}var Za=new QA,Py=Za.generateSecretKey,Ka=Za.getPublicKey,Wt=Za.finalizeEvent,xf=Za.verifyEvent,tI={};_e(tI,{Application:()=>e3,BadgeAward:()=>uI,BadgeDefinition:()=>KI,BlockedRelaysList:()=>OI,BookmarkList:()=>TI,Bookmarksets:()=>HI,Calendar:()=>a3,CalendarEventRSVP:()=>c3,ChannelCreation:()=>qy,ChannelHideMessage:()=>Fy,ChannelMessage:()=>Dy,ChannelMetadata:()=>jy,ChannelMuteUser:()=>Hy,ClassifiedListing:()=>n3,ClientAuth:()=>Zy,CommunitiesList:()=>AI,CommunityDefinition:()=>f3,CommunityPostApproval:()=>yI,Contacts:()=>iI,CreateOrUpdateProduct:()=>JI,CreateOrUpdateStall:()=>WI,Curationsets:()=>VI,Date:()=>s3,DirectMessageRelaysList:()=>LI,DraftClassifiedListing:()=>o3,DraftLong:()=>XI,Emojisets:()=>QI,EncryptedDirectMessage:()=>aI,EventDeletion:()=>cI,FileMetadata:()=>fI,FileServerPreference:()=>UI,Followsets:()=>jI,GenericRepost:()=>If,Genericlists:()=>DI,GiftWrap:()=>Vy,HTTPAuth:()=>Of,Handlerinformation:()=>l3,Handlerrecommendation:()=>u3,Highlights:()=>SI,InterestsList:()=>CI,Interestsets:()=>GI,JobFeedback:()=>bI,JobRequest:()=>wI,JobResult:()=>vI,Label:()=>gI,LightningPubRPC:()=>BI,LiveChatMessage:()=>dI,LiveEvent:()=>t3,LongFormArticle:()=>YI,Metadata:()=>oI,Mutelist:()=>xI,NWCWalletInfo:()=>zI,NWCWalletRequest:()=>Ky,NWCWalletResponse:()=>MI,NostrConnect:()=>qI,OpenTimestamps:()=>lI,Pinlist:()=>kI,PrivateDirectMessage:()=>My,ProblemTracker:()=>hI,ProfileBadges:()=>ZI,PublicChatsList:()=>II,Reaction:()=>Af,RecommendRelay:()=>sI,RelayList:()=>RI,Relaysets:()=>FI,Report:()=>pI,Reporting:()=>mI,Repost:()=>Tf,Seal:()=>By,SearchRelaysList:()=>NI,ShortTextNote:()=>zy,Time:()=>i3,UserEmojiList:()=>PI,UserStatuses:()=>r3,Zap:()=>$I,ZapGoal:()=>_I,ZapRequest:()=>EI,classifyKind:()=>rI,isAddressableKind:()=>Rf,isEphemeralKind:()=>Uy,isKind:()=>nI,isRegularKind:()=>Ly,isReplaceableKind:()=>kf});function Ly(e){return e<1e4&&e!==0&&e!==3}function kf(e){return e===0||e===3||1e4<=e&&e<2e4}function Uy(e){return 2e4<=e&&e<3e4}function Rf(e){return 3e4<=e&&e<4e4}function rI(e){return Ly(e)?"regular":kf(e)?"replaceable":Uy(e)?"ephemeral":Rf(e)?"parameterized":"unknown"}function nI(e,t){const r=t instanceof Array?t:[t];return $f(e)&&r.includes(e.kind)||!1}var oI=0,zy=1,sI=2,iI=3,aI=4,cI=5,Tf=6,Af=7,uI=8,By=13,My=14,If=16,qy=40,jy=41,Dy=42,Fy=43,Hy=44,lI=1040,Vy=1059,fI=1063,dI=1311,hI=1971,pI=1984,mI=1984,gI=1985,yI=4550,wI=5999,vI=6999,bI=7e3,_I=9041,EI=9734,$I=9735,SI=9802,xI=1e4,kI=10001,RI=10002,TI=10003,AI=10004,II=10005,OI=10006,NI=10007,CI=10015,PI=10030,LI=10050,UI=10096,zI=13194,BI=21e3,Zy=22242,Ky=23194,MI=23195,qI=24133,Of=27235,jI=3e4,DI=30001,FI=30002,HI=30003,VI=30004,ZI=30008,KI=30009,GI=30015,WI=30017,JI=30018,YI=30023,XI=30024,QI=30030,e3=30078,t3=30311,r3=30315,n3=30402,o3=30403,s3=31922,i3=31923,a3=31924,c3=31925,u3=31989,l3=31990,f3=34550,d3={};_e(d3,{getHex64:()=>Nf,getInt:()=>Gy,getSubscriptionId:()=>h3,matchEventId:()=>p3,matchEventKind:()=>g3,matchEventPubkey:()=>m3});function Nf(e,t){let r=t.length+3,n=e.indexOf(`"${t}":`)+r,o=e.slice(n).indexOf('"')+n+1;return e.slice(o,o+64)}function Gy(e,t){let r=t.length,n=e.indexOf(`"${t}":`)+r+3,o=e.slice(n),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function h3(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let r=e.slice(t+7+1).indexOf('"');if(r===-1)return null;let n=t+7+1+r,o=e.slice(n+1,80).indexOf('"');if(o===-1)return null;let s=n+1+o;return e.slice(n+1,s)}function p3(e,t){return t===Nf(e,"id")}function m3(e,t){return t===Nf(e,"pubkey")}function g3(e,t){return t===Gy(e,"kind")}var y3={};_e(y3,{makeAuthEvent:()=>w3});function w3(e,t){return{kind:Zy,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var v3;try{v3=WebSocket}catch{}var b3;try{b3=WebSocket}catch{}var _3={};_e(_3,{BECH32_REGEX:()=>Wy,Bech32MaxSize:()=>Cf,NostrTypeGuard:()=>E3,decode:()=>Ga,decodeNostrURI:()=>S3,encodeBytes:()=>Ja,naddrEncode:()=>I3,neventEncode:()=>A3,noteEncode:()=>R3,nprofileEncode:()=>T3,npubEncode:()=>k3,nsecEncode:()=>x3});var E3={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Cf=5e3,Wy=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function $3(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function S3(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),Ga(e)}catch{return{type:"invalid",data:null}}}function Ga(e){let{prefix:t,words:r}=To.decode(e,Cf),n=new Uint8Array(To.fromWords(r));switch(t){case"nprofile":{let o=Yc(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Me(o[0][0]),relays:o[1]?o[1].map(s=>Ir.decode(s)):[]}}}case"nevent":{let o=Yc(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Me(o[0][0]),relays:o[1]?o[1].map(s=>Ir.decode(s)):[],author:o[2]?.[0]?Me(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(Me(o[3][0]),16):void 0}}}case"naddr":{let o=Yc(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ir.decode(o[0][0]),pubkey:Me(o[2][0]),kind:parseInt(Me(o[3][0]),16),relays:o[1]?o[1].map(s=>Ir.decode(s)):[]}}}case"nsec":return{type:t,data:n};case"npub":case"note":return{type:t,data:Me(n)};default:throw new Error(`unknown prefix ${t}`)}}function Yc(e){let t={},r=e;for(;r.length>0;){let n=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${n}`);t[n]=t[n]||[],t[n].push(s)}return t}function x3(e){return Ja("nsec",e)}function k3(e){return Ja("npub",pn(e))}function R3(e){return Ja("note",pn(e))}function Wa(e,t){let r=To.toWords(t);return To.encode(e,r,Cf)}function Ja(e,t){return Wa(e,t)}function T3(e){let t=Pf({0:[pn(e.pubkey)],1:(e.relays||[]).map(r=>Vt.encode(r))});return Wa("nprofile",t)}function A3(e){let t;e.kind!==void 0&&(t=$3(e.kind));let r=Pf({0:[pn(e.id)],1:(e.relays||[]).map(n=>Vt.encode(n)),2:e.author?[pn(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Wa("nevent",r)}function I3(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let r=Pf({0:[Vt.encode(e.identifier)],1:(e.relays||[]).map(n=>Vt.encode(n)),2:[pn(e.pubkey)],3:[new Uint8Array(t)]});return Wa("naddr",r)}function Pf(e){let t=[];return Object.entries(e).reverse().forEach(([r,n])=>{n.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),Fa(...t)}var O3={};_e(O3,{decrypt:()=>N3,encrypt:()=>Jy});function Jy(e,t,r){const n=e instanceof Uint8Array?Me(e):e,o=Mo.getSharedSecret(n,"02"+t),s=Yy(o);let i=Uint8Array.from(gy(16)),a=Vt.encode(r),c=Ry(s,i).encrypt(a),u=Lr.encode(new Uint8Array(c)),l=Lr.encode(new Uint8Array(i.buffer));return`${u}?iv=${l}`}function N3(e,t,r){const n=e instanceof Uint8Array?Me(e):e;let[o,s]=r.split("?iv="),i=Mo.getSharedSecret(n,"02"+t),a=Yy(i),c=Lr.decode(s),u=Lr.decode(o),l=Ry(a,c).decrypt(u);return Ir.decode(l)}function Yy(e){return e.slice(1,33)}var C3={};_e(C3,{NIP05_REGEX:()=>Lf,isNip05:()=>P3,isValid:()=>z3,queryProfile:()=>Xy,searchDomain:()=>U3,useFetchImplementation:()=>L3});var Lf=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,P3=e=>Lf.test(e||""),Ya;try{Ya=fetch}catch{}function L3(e){Ya=e}async function U3(e,t=""){try{const r=`https://${e}/.well-known/nostr.json?name=${t}`,n=await Ya(r,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function Xy(e){const t=e.match(Lf);if(!t)return null;const[,r="_",n]=t;try{const o=`https://${n}/.well-known/nostr.json?name=${r}`,s=await Ya(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const i=await s.json(),a=i.names[r];return a?{pubkey:a,relays:i.relays?.[a]}:null}catch{return null}}async function z3(e,t){const r=await Xy(t);return r?r.pubkey===e:!1}var B3={};_e(B3,{parse:()=>M3});function M3(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,n;for(let o=e.tags.length-1;o>=0;o--){const s=e.tags[o];if(s[0]==="e"&&s[1]){const[i,a,c,u,l]=s,f={id:a,relays:c?[c]:[],author:l};if(u==="root"){t.root=f;continue}if(u==="reply"){t.reply=f;continue}if(u==="mention"){t.mentions.push(f);continue}r?n=f:r=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[i,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=n||r||t.reply),t.reply||(t.reply=r||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{o.relays?.indexOf(a)===-1&&o.relays.push(a)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var q3={};_e(q3,{fetchRelayInformation:()=>D3,useFetchImplementation:()=>j3});var Qy;try{Qy=fetch}catch{}function j3(e){Qy=e}async function D3(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var F3={};_e(F3,{fastEventHash:()=>tw,getPow:()=>ew,minePow:()=>H3});function ew(e){let t=0;for(let r=0;r<64;r+=8){const n=parseInt(e.substring(r,r+8),16);if(n===0)t+=32;else{t+=Math.clz32(n);break}}return t}function H3(e,t){let r=0;const n=e,o=["nonce",r.toString(),t.toString()];for(n.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==n.created_at&&(r=0,n.created_at=s),o[1]=(++r).toString(),n.id=tw(n),ew(n.id)>=t)break}return n}function tw(e){return Me(_n(Vt.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var V3={};_e(V3,{unwrapEvent:()=>rO,unwrapManyEvents:()=>nO,wrapEvent:()=>pw,wrapManyEvents:()=>tO});var Z3={};_e(Z3,{createRumor:()=>lw,createSeal:()=>fw,createWrap:()=>dw,unwrapEvent:()=>qf,unwrapManyEvents:()=>hw,wrapEvent:()=>ua,wrapManyEvents:()=>Q3});var Bn={};_e(Bn,{decrypt:()=>Mf,encrypt:()=>Bf,getConversationKey:()=>Uf,v2:()=>Y3});var rw=1,nw=65535;function Uf(e,t){const r=Mo.getSharedSecret(e,"02"+t).subarray(1,33);return HA(_n,r,"nip44-v2")}function ow(e,t){const r=VA(_n,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function zf(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function K3(e){if(!Number.isSafeInteger(e)||e<rw||e>nw)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function G3(e){const t=Vt.encode(e),r=t.length,n=K3(r),o=new Uint8Array(zf(r)-r);return Fa(n,t,o)}function W3(e){const t=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+t);if(t<rw||t>nw||r.length!==t||e.length!==2+zf(t))throw new Error("invalid padding");return Ir.decode(r)}function sw(e,t,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=Fa(r,t);return Va(_n,e,n)}function J3(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=Lr.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const n=r.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function Bf(e,t,r=gy(32)){const{chacha_key:n,chacha_nonce:o,hmac_key:s}=ow(t,r),i=G3(e),a=Oy(n,o,i),c=sw(s,a,r);return Lr.encode(Fa(new Uint8Array([2]),r,a,c))}function Mf(e,t){const{nonce:r,ciphertext:n,mac:o}=J3(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=ow(t,r),c=sw(a,n,r);if(!xA(c,o))throw new Error("invalid MAC");const u=Oy(s,i,n);return W3(u)}var Y3={utils:{getConversationKey:Uf,calcPaddedLen:zf},encrypt:Bf,decrypt:Mf},X3=2880*60,iw=()=>Math.round(Date.now()/1e3),aw=()=>Math.round(iw()-Math.random()*X3),cw=(e,t)=>Uf(e,t),uw=(e,t,r)=>Bf(JSON.stringify(e),cw(t,r)),_m=(e,t)=>JSON.parse(Mf(e.content,cw(t,e.pubkey)));function lw(e,t){const r={created_at:iw(),content:"",tags:[],...e,pubkey:Ka(t)};return r.id=Ui(r),r}function fw(e,t,r){return Wt({kind:By,content:uw(e,t,r),created_at:aw(),tags:[]},t)}function dw(e,t){const r=Py();return Wt({kind:Vy,content:uw(e,r,t),created_at:aw(),tags:[["p",t]]},r)}function ua(e,t,r){const n=lw(e,t),o=fw(n,t,r);return dw(o,r)}function Q3(e,t,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const n=Ka(t),o=[ua(e,t,n)];return r.forEach(s=>{o.push(ua(e,t,s))}),o}function qf(e,t){const r=_m(e,t);return _m(r,t)}function hw(e,t){let r=[];return e.forEach(n=>{r.push(qf(n,t))}),r.sort((n,o)=>n.created_at-o.created_at),r}function eO(e,t,r,n){const o={created_at:Math.ceil(Date.now()/1e3),kind:My,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),n&&o.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&o.tags.push(["subject",r]),o}function pw(e,t,r,n,o){const s=eO(t,r,n,o);return ua(s,e,t.publicKey)}function tO(e,t,r,n,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Ka(e)},...t].map(i=>pw(e,i,r,n,o))}var rO=qf,nO=hw,oO={};_e(oO,{finishRepostEvent:()=>sO,getRepostedEvent:()=>iO,getRepostedEventPointer:()=>mw});function sO(e,t,r,n){let o;const s=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===zy?o=Tf:(o=If,s.push(["k",String(t.kind)])),Wt({kind:o,tags:s,content:e.content===""||t.tags?.find(i=>i[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},n)}function mw(e){if(![Tf,If].includes(e.kind))return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(t!==void 0)return{id:t[1],relays:[t[2],r?.[2]].filter(n=>typeof n=="string"),author:r?.[1]}}function iO(e,{skipVerification:t}={}){const r=mw(e);if(r===void 0||e.content==="")return;let n;try{n=JSON.parse(e.content)}catch{return}if(n.id===r.id&&!(!t&&!xf(n)))return n}var aO={};_e(aO,{NOSTR_URI_REGEX:()=>jf,parse:()=>uO,test:()=>cO});var jf=new RegExp(`nostr:(${Wy.source})`);function cO(e){return typeof e=="string"&&new RegExp(`^${jf.source}$`).test(e)}function uO(e){const t=e.match(new RegExp(`^${jf.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Ga(t[1])}}var lO={};_e(lO,{finishReactionEvent:()=>fO,getReactedEventPointer:()=>dO});function fO(e,t,r){const n=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return Wt({...e,kind:Af,tags:[...e.tags??[],...n,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function dO(e){if(e.kind!==Af)return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(t===void 0||r===void 0))return{id:t[1],relays:[t[2],r[2]].filter(n=>n!==void 0),author:r[1]}}var hO={};_e(hO,{parse:()=>mO});var Em=/\W/m,$m=/\W |\W$|$|,| /m,pO=42;function*mO(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){const i=e.tags[s];i[0]==="emoji"&&i.length>=3&&t.push({type:"emoji",shortcode:i[1],url:i[2]})}e=e.content}const r=e.length;let n=0,o=0;e:for(;o<r;){const s=e.indexOf(":",o),i=e.indexOf("#",o);if(s===-1&&i===-1)break e;if(s===-1||i>=0&&i<s){if(i===0||e[i-1]===" "){const a=e.slice(i+1,i+pO).match(Em),c=a?i+1+a.index:r;yield{type:"text",text:e.slice(n,i)},yield{type:"hashtag",value:e.slice(i+1,c)},o=c,n=o;continue e}o=i+1;continue e}if(e.slice(s-5,s)==="nostr"){const a=e.slice(s+60).match(Em),c=a?s+60+a.index:r;try{let u,{data:l,type:f}=Ga(e.slice(s+1,c));switch(f){case"npub":u={pubkey:l};break;case"nsec":case"note":o=c+1;continue;default:u=l}n!==s-5&&(yield{type:"text",text:e.slice(n,s-5)}),yield{type:"reference",pointer:u},o=c,n=o;continue e}catch{o=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){const a=e.slice(s+4).match($m),c=a?s+4+a.index:r,u=e[s-1]==="s"?5:4;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(l.pathname)){yield{type:"image",url:l.toString()},o=c,n=o;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(l.pathname)){yield{type:"video",url:l.toString()},o=c,n=o;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(l.pathname)){yield{type:"audio",url:l.toString()},o=c,n=o;continue e}yield{type:"url",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){const a=e.slice(s+4).match($m),c=a?s+4+a.index:r,u=e[s-1]==="s"?3:2;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),yield{type:"relay",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else{for(let a=0;a<t.length;a++){const c=t[a];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){n!==s&&(yield{type:"text",text:e.slice(n,s)}),yield c,o=s+c.shortcode.length+2,n=o;continue e}}o=s+1;continue e}}n!==r&&(yield{type:"text",text:e.slice(n)})}var gO={};_e(gO,{channelCreateEvent:()=>yO,channelHideMessageEvent:()=>bO,channelMessageEvent:()=>vO,channelMetadataEvent:()=>wO,channelMuteUserEvent:()=>_O});var yO=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Wt({kind:qy,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},wO=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Wt({kind:jy,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},vO=(e,t)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Wt({kind:Dy,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},bO=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Wt({kind:Fy,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},_O=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Wt({kind:Hy,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)},EO={};_e(EO,{EMOJI_SHORTCODE_REGEX:()=>gw,matchAll:()=>$O,regex:()=>Df,replaceAll:()=>SO});var gw=/:(\w+):/,Df=()=>new RegExp(`\\B${gw.source}\\B`,"g");function*$O(e){const t=e.matchAll(Df());for(const r of t)try{const[n,o]=r;yield{shortcode:n,name:o,start:r.index,end:r.index+n.length}}catch{}}function SO(e,t){return e.replaceAll(Df(),(r,n)=>t({shortcode:r,name:n}))}var xO={};_e(xO,{useFetchImplementation:()=>kO,validateGithub:()=>RO});var Ff;try{Ff=fetch}catch{}function kO(e){Ff=e}async function RO(e,t,r){try{return await(await Ff(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var TO={};_e(TO,{makeNwcRequestEvent:()=>IO,parseConnectionString:()=>AO});function AO(e){const{host:t,pathname:r,searchParams:n}=new URL(e),o=r||t,s=n.get("relay"),i=n.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function IO(e,t,r){const o=Jy(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),s={kind:Ky,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return Wt(s,t)}var OO={};_e(OO,{normalizeIdentifier:()=>NO});function NO(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var CO={};_e(CO,{getSatoshisAmountFromBolt11:()=>MO,getZapEndpoint:()=>LO,makeZapReceipt:()=>BO,makeZapRequest:()=>UO,useFetchImplementation:()=>PO,validateZapRequest:()=>zO});var Hf;try{Hf=fetch}catch{}function PO(e){Hf=e}async function LO(e){try{let t="",{lud06:r,lud16:n}=JSON.parse(e.content);if(n){let[i,a]=n.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else if(r){let{words:i}=To.decode(r,1e3),a=To.fromWords(i);t=Ir.decode(a)}else return null;let s=await(await Hf(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function UO(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),kf(e.event.kind)){const r=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(r)}else if(Rf(e.event.kind)){let r=e.event.tags.find(([o,s])=>o==="d"&&s);if(!r)throw new Error("d tag not found or is empty");const n=["a",`${e.event.kind}:${e.event.pubkey}:${r[1]}`];t.tags.push(n)}t.tags.push(["k",e.event.kind.toString()])}return t}function zO(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!$f(t))return"Zap request is not a valid Nostr event.";if(!xf(t))return"Invalid signature on zap request.";let r=t.tags.find(([s,i])=>s==="p"&&i);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=t.tags.find(([s,i])=>s==="e"&&i);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function BO({zapRequest:e,preimage:t,bolt11:r,paidAt:n}){let o=JSON.parse(e),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return t&&i.tags.push(["preimage",t]),i}function MO(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;const n=r.substring(4);if(n.length<1)return 0;const o=n[n.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9;let a=n.length-1;if(i&&a++,a<1)return 0;const c=parseInt(n.substring(0,a));switch(o){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var qO={};_e(qO,{Negentropy:()=>ww,NegentropyStorageVector:()=>FO,NegentropySync:()=>HO});var Xc=97,yo=32,yw=16,An={Skip:0,Fingerprint:1,IdList:2},xr=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof xr&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");const r=t.length+this.length;if(this.capacity<r){const n=this._raw,o=Math.max(this.capacity*2,r);this._raw=new Uint8Array(o),this._raw.set(n)}this._raw.set(t,this.length),this.length+=t.length}shift(){const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){const r=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,r}};function Si(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let r=e.shift();if(t=t<<7|r&127,(r&128)===0)break}return t}function br(e){if(e===0)return new xr(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let r=0;r<t.length-1;r++)t[r]|=128;return new xr(new Uint8Array(t))}function jO(e){return zi(e,1)[0]}function zi(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var DO=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(yo)}add(t){let r=0,n=0,o=new DataView(this.buf.buffer),s=new DataView(t.buffer);for(let i=0;i<8;i++){let a=i*4,c=o.getUint32(a,!0),u=s.getUint32(a,!0),l=c;l+=r,l+=u,l>4294967295&&(n=1),o.setUint32(a,l&4294967295,!0),r=n,n=0}}negate(){let t=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let o=n*4;t.setUint32(o,~t.getUint32(o,!0))}let r=new Uint8Array(yo);r[0]=1,this.add(r)}getFingerprint(t){let r=new xr;return r.extend(this.buf),r.extend(br(t)),_n(r.unwrap()).subarray(0,yw)}},FO=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,r){if(this.sealed)throw Error("already sealed");const n=Ey(r);if(n.byteLength!==yo)throw Error("bad id size for added item");this.items.push({timestamp:t,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(Qc);for(let t=1;t<this.items.length;t++)if(Qc(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,r,n){this._checkSealed(),this._checkBounds(t,r);for(let o=t;o<r&&n(this.items[o],o);++o);}findLowerBound(t,r,n){return this._checkSealed(),this._checkBounds(t,r),this._binarySearch(this.items,t,r,o=>Qc(o,n)<0)}fingerprint(t,r){let n=new DO;return n.setToZero(),this.iterate(t,r,o=>(n.add(o.id),!0)),n.getFingerprint(r-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,r){if(t>r||r>this.items.length)throw Error("bad range")}_binarySearch(t,r,n,o){let s=n-r;for(;s>0;){let i=r,a=Math.floor(s/2);i+=a,o(t[i])?(r=++i,s-=a+1):s=a}return r}},ww=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,r=6e4){if(r<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=r,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,r){return{timestamp:t,id:r||new Uint8Array(0)}}initiate(){let t=new xr;return t.extend(new Uint8Array([Xc])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),to(t.unwrap())}reconcile(t,r,n){const o=new xr(Ey(t));this.lastTimestampIn=this.lastTimestampOut=0;let s=new xr;s.extend(new Uint8Array([Xc]));let i=jO(o);if(i<96||i>111)throw Error("invalid negentropy protocol version byte");if(i!==Xc)throw Error("unsupported negentropy protocol version requested: "+(i-96));let a=this.storage.size(),c=this._bound(0),u=0,l=!1;for(;o.length!==0;){let f=new xr,h=()=>{l&&(l=!1,f.extend(this.encodeBound(c)),f.extend(br(An.Skip)))},p=this.decodeBound(o),g=Si(o),m=u,d=this.storage.findLowerBound(u,a,p);if(g===An.Skip)l=!0;else if(g===An.Fingerprint){let w=zi(o,yw),y=this.storage.fingerprint(m,d);vw(w,y)!==0?(h(),this.splitRange(m,d,p,f)):l=!0}else if(g===An.IdList){let w=Si(o),y={};for(let v=0;v<w;v++){let E=zi(o,yo);y[to(E)]=E}if(l=!0,this.storage.iterate(m,d,v=>{let E=v.id;const b=to(E);return y[b]?delete y[to(E)]:r?.(b),!0}),n)for(let v of Object.values(y))n(to(v))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(s.length+f.length)){let w=this.storage.fingerprint(d,a);s.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),s.extend(br(An.Fingerprint)),s.extend(w);break}else s.extend(f);u=d,c=p}return s.length===1?null:to(s.unwrap())}splitRange(t,r,n,o){let s=r-t,i=16;if(s<i*2)o.extend(this.encodeBound(n)),o.extend(br(An.IdList)),o.extend(br(s)),this.storage.iterate(t,r,a=>(o.extend(a.id),!0));else{let a=Math.floor(s/i),c=s%i,u=t;for(let l=0;l<i;l++){let f=a+(l<c?1:0),h=this.storage.fingerprint(u,u+f);u+=f;let p;if(u===r)p=n;else{let g,m;this.storage.iterate(u-1,u+1,(d,w)=>(w===u-1?g=d:m=d,!0)),p=this.getMinimalBound(g,m)}o.extend(this.encodeBound(p)),o.extend(br(An.Fingerprint)),o.extend(h)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let r=Si(t);return r=r===0?Number.MAX_VALUE:r-1,this.lastTimestampIn===Number.MAX_VALUE||r===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(r+=this.lastTimestampIn,this.lastTimestampIn=r,r)}decodeBound(t){let r=this.decodeTimestampIn(t),n=Si(t);if(n>yo)throw Error("bound key too long");let o=zi(t,n);return{timestamp:r,id:o}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,br(0);let r=t;return t-=this.lastTimestampOut,this.lastTimestampOut=r,br(t+1)}encodeBound(t){let r=new xr;return r.extend(this.encodeTimestampOut(t.timestamp)),r.extend(br(t.id.length)),r.extend(t.id),r}getMinimalBound(t,r){if(r.timestamp!==t.timestamp)return this._bound(r.timestamp);{let n=0,o=r.id,s=t.id;for(let i=0;i<yo&&o[i]===s[i];i++)n++;return this._bound(r.timestamp,r.id.subarray(0,n+1))}}};function vw(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function Qc(e,t){return e.timestamp===t.timestamp?vw(e.id,t.id):e.timestamp-t.timestamp}var HO=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,r,n,o={}){this.relay=t,this.storage=r,this.neg=new ww(r),this.onhave=o.onhave,this.onneed=o.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:o.label||"negentropy"}),this.subscription.oncustom=s=>{switch(s[0]){case"NEG-MSG":{s.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${s}`);try{const i=this.neg.reconcile(s[2],this.onhave,this.onneed);i?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${i}"]`):(this.close(),o.onclose?.())}catch(i){console.error("negentropy reconcile error:",i),o?.onclose?.(`reconcile error: ${i}`)}break}case"NEG-CLOSE":{const i=s[2];console.warn("negentropy error:",i),o.onclose?.(i);break}case"NEG-ERR":o.onclose?.()}}}async start(){const t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},VO={};_e(VO,{getToken:()=>ZO,hashPayload:()=>Vf,unpackEventFromToken:()=>_w,validateEvent:()=>Rw,validateEventKind:()=>$w,validateEventMethodTag:()=>xw,validateEventPayloadTag:()=>kw,validateEventTimestamp:()=>Ew,validateEventUrlTag:()=>Sw,validateToken:()=>KO});var bw="Nostr ";async function ZO(e,t,r,n=!1,o){const s={kind:Of,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Vf(o)]);const i=await r(s);return(n?bw:"")+Lr.encode(Vt.encode(JSON.stringify(i)))}async function KO(e,t,r){const n=await _w(e).catch(s=>{throw s});return await Rw(n,t,r).catch(s=>{throw s})}async function _w(e){if(!e)throw new Error("Missing token");e=e.replace(bw,"");const t=Ir.decode(Lr.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Ew(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function $w(e){return e.kind===Of}function Sw(e,t){const r=e.tags.find(n=>n[0]==="u");return r?r.length>0&&r[1]===t:!1}function xw(e,t){const r=e.tags.find(n=>n[0]==="method");return r?r.length>0&&r[1].toLowerCase()===t.toLowerCase():!1}function Vf(e){const t=_n(Vt.encode(JSON.stringify(e)));return Me(t)}function kw(e,t){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const n=Vf(t);return r.length>0&&r[1]===n}async function Rw(e,t,r,n){if(!xf(e))throw new Error("Invalid nostr event, signature invalid");if(!$w(e))throw new Error("Invalid nostr event, kind invalid");if(!Ew(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Sw(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!xw(e,r))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!kw(e,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var no=Symbol("verified"),GO=e=>e instanceof Object;function WO(e){if(!GO(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}new TextDecoder("utf-8");var JO=new TextEncoder,YO=class{generateSecretKey(){return nr.utils.randomPrivateKey()}getPublicKey(t){return Me(nr.getPublicKey(t))}finalizeEvent(t,r){const n=t;return n.pubkey=Me(nr.getPublicKey(r)),n.id=eu(n),n.sig=Me(nr.sign(eu(n),r)),n[no]=!0,n}verifyEvent(t){if(typeof t[no]=="boolean")return t[no];const r=eu(t);if(r!==t.id)return t[no]=!1,!1;try{const n=nr.verify(t.sig,r,t.pubkey);return t[no]=n,n}catch{return t[no]=!1,!1}}};function XO(e){if(!WO(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function eu(e){let t=_n(JO.encode(XO(e)));return Me(t)}var Xa=new YO,QO=Xa.generateSecretKey,eN=Xa.getPublicKey,tN=Xa.finalizeEvent;Xa.verifyEvent;function rN(e,t){const r=QO(),n=eN(r),o=Bn.v2.utils.getConversationKey(r,t),s=Bn.v2.encrypt(e,o),i={kind:Ma,content:s,tags:[[Li.PUBKEY,t]],created_at:Math.floor(Date.now()/1e3),pubkey:n};return tN(i,r)}async function nN(e,t){var r;if(e.kind!==Ma)throw new Error("Event is not a gift wrap.");if(!((r=t.nip44)===null||r===void 0)&&r.decrypt)return await t.nip44.decrypt(e.pubkey,e.content);throw new Error("Signer does not support NIP-44 decryption. Please use a signer with nip44 support.")}const nl=e=>new Promise(t=>setTimeout(t,e));function oN(e){try{return nx.parse(e)}catch{return null}}function ao(e,t,r="Operation timed out"){return new Promise((n,o)=>{const s=setTimeout(()=>{o(new Error(r))},t);e.then(i=>{clearTimeout(s),n(i)}).catch(i=>{clearTimeout(s),o(i)})})}function Sm(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Tw(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function sN(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Sm(e.outputLen),Sm(e.blockLen)}function la(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function iN(e,t){Tw(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const tu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Aw=e=>e instanceof Uint8Array,ru=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Qt=(e,t)=>e<<32-t|e>>>t,aN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!aN)throw new Error("Non little-endian hardware is not supported");function cN(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Zf(e){if(typeof e=="string"&&(e=cN(e)),!Aw(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function uN(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!Aw(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}let Iw=class{clone(){return this._cloneInto()}};function lN(e){const t=n=>e().update(Zf(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Ow(e=32){if(tu&&typeof tu.getRandomValues=="function")return tu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function fN(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}let dN=class extends Iw{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ru(this.buffer)}update(t){la(this);const{view:r,buffer:n,blockLen:o}=this;t=Zf(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=ru(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){la(this),iN(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:s}=this;let{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;fN(n,o-8,BigInt(this.length*8),s),this.process(n,0);const a=ru(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%r&&t.buffer.set(n),t}};const hN=(e,t,r)=>e&t^~e&r,pN=(e,t,r)=>e&t^e&r^t&r,mN=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Yr=new Uint32Array(64);let gN=class extends dN{constructor(){super(64,32,8,!1),this.A=Jr[0]|0,this.B=Jr[1]|0,this.C=Jr[2]|0,this.D=Jr[3]|0,this.E=Jr[4]|0,this.F=Jr[5]|0,this.G=Jr[6]|0,this.H=Jr[7]|0}get(){const{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)Yr[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){const h=Yr[f-15],p=Yr[f-2],g=Qt(h,7)^Qt(h,18)^h>>>3,m=Qt(p,17)^Qt(p,19)^p>>>10;Yr[f]=m+Yr[f-7]+g+Yr[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=Qt(a,6)^Qt(a,11)^Qt(a,25),p=l+h+hN(a,c,u)+mN[f]+Yr[f]|0,m=(Qt(n,2)^Qt(n,13)^Qt(n,22))+pN(n,o,s)|0;l=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){Yr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const ol=lN(()=>new gN);BigInt(0);const yN=BigInt(1),wN=BigInt(2),Qa=e=>e instanceof Uint8Array,vN=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ao(e){if(!Qa(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=vN[e[r]];return t}function Kf(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function gs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const o=n*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function Et(e){return Kf(Ao(e))}function Gf(e){if(!Qa(e))throw new Error("Uint8Array expected");return Kf(Ao(Uint8Array.from(e).reverse()))}function mn(e,t){return gs(e.toString(16).padStart(t*2,"0"))}function Wf(e,t){return mn(e,t).reverse()}function st(e,t,r){let n;if(typeof t=="string")try{n=gs(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Qa(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return n}function Zn(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!Qa(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}const Jf=e=>(wN<<BigInt(e-1))-yN,nu=e=>new Uint8Array(e),xm=e=>Uint8Array.from(e);function Nw(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=nu(e),o=nu(e),s=0;const i=()=>{n.fill(1),o.fill(0),s=0},a=(...f)=>r(o,n,...f),c=(f=nu())=>{o=a(xm([0]),f),n=a(),f.length!==0&&(o=a(xm([1]),f),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<t;){n=a();const p=n.slice();h.push(p),f+=n.length}return Zn(...h)};return(f,h)=>{i(),c(f);let p;for(;!(p=h(u()));)c();return i(),p}}const bN={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Is(e,t,r={}){const n=(o,s,i)=>{const a=bN[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(i&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(t))n(o,s,!1);for(const[o,s]of Object.entries(r))n(o,s,!0);return e}const _N=Object.freeze(Object.defineProperty({__proto__:null,bitMask:Jf,bytesToHex:Ao,bytesToNumberBE:Et,bytesToNumberLE:Gf,concatBytes:Zn,createHmacDrbg:Nw,ensureBytes:st,hexToBytes:gs,hexToNumber:Kf,numberToBytesBE:mn,numberToBytesLE:Wf,validateObject:Is},Symbol.toStringTag,{value:"Module"}));const Ve=BigInt(0),Ue=BigInt(1),Ln=BigInt(2),EN=BigInt(3),sl=BigInt(4),km=BigInt(5),Rm=BigInt(8);BigInt(9);BigInt(16);function Ye(e,t){const r=e%t;return r>=Ve?r:t+r}function $N(e,t,r){if(r<=Ve||t<Ve)throw new Error("Expected power/modulo > 0");if(r===Ue)return Ve;let n=Ue;for(;t>Ve;)t&Ue&&(n=n*e%r),e=e*e%r,t>>=Ue;return n}function Nt(e,t,r){let n=e;for(;t-- >Ve;)n*=n,n%=r;return n}function il(e,t){if(e===Ve||t<=Ve)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=Ye(e,t),n=t,o=Ve,s=Ue;for(;r!==Ve;){const a=n/r,c=n%r,u=o-s*a;n=r,r=c,o=s,s=u}if(n!==Ue)throw new Error("invert: does not exist");return Ye(o,t)}function SN(e){const t=(e-Ue)/Ln;let r,n,o;for(r=e-Ue,n=0;r%Ln===Ve;r/=Ln,n++);for(o=Ln;o<e&&$N(o,t,e)!==e-Ue;o++);if(n===1){const i=(e+Ue)/sl;return function(c,u){const l=c.pow(u,i);if(!c.eql(c.sqr(l),u))throw new Error("Cannot find square root");return l}}const s=(r+Ue)/Ln;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(c,s),h=a.pow(c,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let m=a.sqr(h);p<u&&!a.eql(m,a.ONE);p++)m=a.sqr(m);const g=a.pow(l,Ue<<BigInt(u-p-1));l=a.sqr(g),f=a.mul(f,g),h=a.mul(h,l),u=p}return f}}function xN(e){if(e%sl===EN){const t=(e+Ue)/sl;return function(n,o){const s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%Rm===km){const t=(e-km)/Rm;return function(n,o){const s=n.mul(o,Ln),i=n.pow(s,t),a=n.mul(o,i),c=n.mul(n.mul(a,Ln),i),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return SN(e)}const kN=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function RN(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=kN.reduce((n,o)=>(n[o]="function",n),t);return Is(e,r)}function TN(e,t,r){if(r<Ve)throw new Error("Expected power > 0");if(r===Ve)return e.ONE;if(r===Ue)return t;let n=e.ONE,o=t;for(;r>Ve;)r&Ue&&(n=e.mul(n,o)),o=e.sqr(o),r>>=Ue;return n}function AN(e,t){const r=new Array(t.length),n=t.reduce((s,i,a)=>e.is0(i)?s:(r[a]=s,e.mul(s,i)),e.ONE),o=e.inv(n);return t.reduceRight((s,i,a)=>e.is0(i)?s:(r[a]=e.mul(s,r[a]),e.mul(s,i)),o),r}function Cw(e,t){const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function IN(e,t,r=!1,n={}){if(e<=Ve)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=Cw(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=xN(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Jf(o),ZERO:Ve,ONE:Ue,create:c=>Ye(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Ve<=c&&c<e},is0:c=>c===Ve,isOdd:c=>(c&Ue)===Ue,neg:c=>Ye(-c,e),eql:(c,u)=>c===u,sqr:c=>Ye(c*c,e),add:(c,u)=>Ye(c+u,e),sub:(c,u)=>Ye(c-u,e),mul:(c,u)=>Ye(c*u,e),pow:(c,u)=>TN(a,c,u),div:(c,u)=>Ye(c*il(u,e),e),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>il(c,e),sqrt:n.sqrt||(c=>i(a,c)),invertBatch:c=>AN(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Wf(c,s):mn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?Gf(c):Et(c)}});return Object.freeze(a)}function Pw(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Lw(e){const t=Pw(e);return t+Math.ceil(t/2)}function ON(e,t,r=!1){const n=e.length,o=Pw(t),s=Lw(t);if(n<16||n<s||n>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${n}`);const i=r?Et(e):Gf(e),a=Ye(i,t-Ue)+Ue;return r?Wf(a,o):mn(a,o)}const NN=BigInt(0),ou=BigInt(1);function CN(e,t){const r=(o,s)=>{const i=s.negate();return o?i:s},n=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:r,unsafeLadder(o,s){let i=e.ZERO,a=o;for(;s>NN;)s&ou&&(i=i.add(a)),a=a.double(),s>>=ou;return i},precomputeWindow(o,s){const{windows:i,windowSize:a}=n(s),c=[];let u=o,l=u;for(let f=0;f<i;f++){l=u,c.push(l);for(let h=1;h<a;h++)l=l.add(u),c.push(l);u=l.double()}return c},wNAF(o,s,i){const{windows:a,windowSize:c}=n(o);let u=e.ZERO,l=e.BASE;const f=BigInt(2**o-1),h=2**o,p=BigInt(o);for(let g=0;g<a;g++){const m=g*c;let d=Number(i&f);i>>=p,d>c&&(d-=h,i+=ou);const w=m,y=m+Math.abs(d)-1,v=g%2!==0,E=d<0;d===0?l=l.add(r(v,s[w])):u=u.add(r(E,s[y]))}return{p:u,f:l}},wNAFCached(o,s,i,a){const c=o._WINDOW_SIZE||1;let u=s.get(o);return u||(u=this.precomputeWindow(o,c),c!==1&&s.set(o,a(u))),this.wNAF(c,u,i)}}}function Uw(e){return RN(e.Fp),Is(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cw(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function PN(e){const t=Uw(e);Is(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:o}=t;if(r){if(!n.eql(o,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:LN,hexToBytes:UN}=_N,Mn={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Mn;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:LN(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=Mn,r=typeof e=="string"?UN(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=Mn._parseInt(r.subarray(2)),{d:i,l:a}=Mn._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,r=u=>{const l=u.toString(16);return l.length&1?`0${l}`:l},n=t(r(e.s)),o=t(r(e.r)),s=n.length/2,i=o.length/2,a=r(s),c=r(i);return`30${r(i+s+4)}02${c}${o}02${a}${n}`}},kr=BigInt(0),Ut=BigInt(1);BigInt(2);const Tm=BigInt(3);BigInt(4);function zN(e){const t=PN(e),{Fp:r}=t,n=t.toBytes||((g,m,d)=>{const w=m.toAffine();return Zn(Uint8Array.from([4]),r.toBytes(w.x),r.toBytes(w.y))}),o=t.fromBytes||(g=>{const m=g.subarray(1),d=r.fromBytes(m.subarray(0,r.BYTES)),w=r.fromBytes(m.subarray(r.BYTES,2*r.BYTES));return{x:d,y:w}});function s(g){const{a:m,b:d}=t,w=r.sqr(g),y=r.mul(w,g);return r.add(r.add(y,r.mul(g,m)),d)}if(!r.eql(r.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(g){return typeof g=="bigint"&&kr<g&&g<t.n}function a(g){if(!i(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(g){const{allowedPrivateKeyLengths:m,nByteLength:d,wrapPrivateKey:w,n:y}=t;if(m&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Ao(g)),typeof g!="string"||!m.includes(g.length))throw new Error("Invalid key");g=g.padStart(d*2,"0")}let v;try{v=typeof g=="bigint"?g:Et(st("private key",g,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof g}`)}return w&&(v=Ye(v,y)),a(v),v}const u=new Map;function l(g){if(!(g instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(m,d,w){if(this.px=m,this.py=d,this.pz=w,m==null||!r.isValid(m))throw new Error("x required");if(d==null||!r.isValid(d))throw new Error("y required");if(w==null||!r.isValid(w))throw new Error("z required")}static fromAffine(m){const{x:d,y:w}=m||{};if(!m||!r.isValid(d)||!r.isValid(w))throw new Error("invalid affine point");if(m instanceof f)throw new Error("projective point not allowed");const y=v=>r.eql(v,r.ZERO);return y(d)&&y(w)?f.ZERO:new f(d,w,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const d=r.invertBatch(m.map(w=>w.pz));return m.map((w,y)=>w.toAffine(d[y])).map(f.fromAffine)}static fromHex(m){const d=f.fromAffine(o(st("pointHex",m)));return d.assertValidity(),d}static fromPrivateKey(m){return f.BASE.multiply(c(m))}_setWindowSize(m){this._WINDOW_SIZE=m,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:d}=this.toAffine();if(!r.isValid(m)||!r.isValid(d))throw new Error("bad point: x or y not FE");const w=r.sqr(d),y=s(m);if(!r.eql(w,y))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(r.isOdd)return!r.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){l(m);const{px:d,py:w,pz:y}=this,{px:v,py:E,pz:b}=m,_=r.eql(r.mul(d,b),r.mul(v,y)),$=r.eql(r.mul(w,b),r.mul(E,y));return _&&$}negate(){return new f(this.px,r.neg(this.py),this.pz)}double(){const{a:m,b:d}=t,w=r.mul(d,Tm),{px:y,py:v,pz:E}=this;let b=r.ZERO,_=r.ZERO,$=r.ZERO,A=r.mul(y,y),q=r.mul(v,v),F=r.mul(E,E),L=r.mul(y,v);return L=r.add(L,L),$=r.mul(y,E),$=r.add($,$),b=r.mul(m,$),_=r.mul(w,F),_=r.add(b,_),b=r.sub(q,_),_=r.add(q,_),_=r.mul(b,_),b=r.mul(L,b),$=r.mul(w,$),F=r.mul(m,F),L=r.sub(A,F),L=r.mul(m,L),L=r.add(L,$),$=r.add(A,A),A=r.add($,A),A=r.add(A,F),A=r.mul(A,L),_=r.add(_,A),F=r.mul(v,E),F=r.add(F,F),A=r.mul(F,L),b=r.sub(b,A),$=r.mul(F,q),$=r.add($,$),$=r.add($,$),new f(b,_,$)}add(m){l(m);const{px:d,py:w,pz:y}=this,{px:v,py:E,pz:b}=m;let _=r.ZERO,$=r.ZERO,A=r.ZERO;const q=t.a,F=r.mul(t.b,Tm);let L=r.mul(d,v),D=r.mul(w,E),U=r.mul(y,b),z=r.add(d,w),k=r.add(v,E);z=r.mul(z,k),k=r.add(L,D),z=r.sub(z,k),k=r.add(d,y);let S=r.add(v,b);return k=r.mul(k,S),S=r.add(L,U),k=r.sub(k,S),S=r.add(w,y),_=r.add(E,b),S=r.mul(S,_),_=r.add(D,U),S=r.sub(S,_),A=r.mul(q,k),_=r.mul(F,U),A=r.add(_,A),_=r.sub(D,A),A=r.add(D,A),$=r.mul(_,A),D=r.add(L,L),D=r.add(D,L),U=r.mul(q,U),k=r.mul(F,k),D=r.add(D,U),U=r.sub(L,U),U=r.mul(q,U),k=r.add(k,U),L=r.mul(D,k),$=r.add($,L),L=r.mul(S,k),_=r.mul(z,_),_=r.sub(_,L),L=r.mul(z,D),A=r.mul(S,A),A=r.add(A,L),new f(_,$,A)}subtract(m){return this.add(m.negate())}is0(){return this.equals(f.ZERO)}wNAF(m){return p.wNAFCached(this,u,m,d=>{const w=r.invertBatch(d.map(y=>y.pz));return d.map((y,v)=>y.toAffine(w[v])).map(f.fromAffine)})}multiplyUnsafe(m){const d=f.ZERO;if(m===kr)return d;if(a(m),m===Ut)return this;const{endo:w}=t;if(!w)return p.unsafeLadder(this,m);let{k1neg:y,k1:v,k2neg:E,k2:b}=w.splitScalar(m),_=d,$=d,A=this;for(;v>kr||b>kr;)v&Ut&&(_=_.add(A)),b&Ut&&($=$.add(A)),A=A.double(),v>>=Ut,b>>=Ut;return y&&(_=_.negate()),E&&($=$.negate()),$=new f(r.mul($.px,w.beta),$.py,$.pz),_.add($)}multiply(m){a(m);let d=m,w,y;const{endo:v}=t;if(v){const{k1neg:E,k1:b,k2neg:_,k2:$}=v.splitScalar(d);let{p:A,f:q}=this.wNAF(b),{p:F,f:L}=this.wNAF($);A=p.constTimeNegate(E,A),F=p.constTimeNegate(_,F),F=new f(r.mul(F.px,v.beta),F.py,F.pz),w=A.add(F),y=q.add(L)}else{const{p:E,f:b}=this.wNAF(d);w=E,y=b}return f.normalizeZ([w,y])[0]}multiplyAndAddUnsafe(m,d,w){const y=f.BASE,v=(b,_)=>_===kr||_===Ut||!b.equals(y)?b.multiplyUnsafe(_):b.multiply(_),E=v(this,d).add(v(m,w));return E.is0()?void 0:E}toAffine(m){const{px:d,py:w,pz:y}=this,v=this.is0();m==null&&(m=v?r.ONE:r.inv(y));const E=r.mul(d,m),b=r.mul(w,m),_=r.mul(y,m);if(v)return{x:r.ZERO,y:r.ZERO};if(!r.eql(_,r.ONE))throw new Error("invZ was invalid");return{x:E,y:b}}isTorsionFree(){const{h:m,isTorsionFree:d}=t;if(m===Ut)return!0;if(d)return d(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:d}=t;return m===Ut?this:d?d(f,this):this.multiplyUnsafe(t.h)}toRawBytes(m=!0){return this.assertValidity(),n(f,this,m)}toHex(m=!0){return Ao(this.toRawBytes(m))}}f.BASE=new f(t.Gx,t.Gy,r.ONE),f.ZERO=new f(r.ZERO,r.ONE,r.ZERO);const h=t.nBitLength,p=CN(f,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}function BN(e){const t=Uw(e);return Is(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function MN(e){const t=BN(e),{Fp:r,n}=t,o=r.BYTES+1,s=2*r.BYTES+1;function i(k){return kr<k&&k<r.ORDER}function a(k){return Ye(k,n)}function c(k){return il(k,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:h}=zN({...t,toBytes(k,S,O){const P=S.toAffine(),B=r.toBytes(P.x),I=Zn;return O?I(Uint8Array.from([S.hasEvenY()?2:3]),B):I(Uint8Array.from([4]),B,r.toBytes(P.y))},fromBytes(k){const S=k.length,O=k[0],P=k.subarray(1);if(S===o&&(O===2||O===3)){const B=Et(P);if(!i(B))throw new Error("Point is not on curve");const I=f(B);let T=r.sqrt(I);const N=(T&Ut)===Ut;return(O&1)===1!==N&&(T=r.neg(T)),{x:B,y:T}}else if(S===s&&O===4){const B=r.fromBytes(P.subarray(0,r.BYTES)),I=r.fromBytes(P.subarray(r.BYTES,2*r.BYTES));return{x:B,y:I}}else throw new Error(`Point of length ${S} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),p=k=>Ao(mn(k,t.nByteLength));function g(k){const S=n>>Ut;return k>S}function m(k){return g(k)?a(-k):k}const d=(k,S,O)=>Et(k.slice(S,O));class w{constructor(S,O,P){this.r=S,this.s=O,this.recovery=P,this.assertValidity()}static fromCompact(S){const O=t.nByteLength;return S=st("compactSignature",S,O*2),new w(d(S,0,O),d(S,O,2*O))}static fromDER(S){const{r:O,s:P}=Mn.toSig(st("DER",S));return new w(O,P)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(S){return new w(this.r,this.s,S)}recoverPublicKey(S){const{r:O,s:P,recovery:B}=this,I=$(st("msgHash",S));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const T=B===2||B===3?O+t.n:O;if(T>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const N=(B&1)===0?"02":"03",C=u.fromHex(N+p(T)),x=c(T),R=a(-I*x),H=a(P*x),G=u.BASE.multiplyAndAddUnsafe(C,R,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return gs(this.toDERHex())}toDERHex(){return Mn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return gs(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(k){try{return l(k),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const k=Lw(t.n);return ON(t.randomBytes(k),t.n)},precompute(k=8,S=u.BASE){return S._setWindowSize(k),S.multiply(BigInt(3)),S}};function v(k,S=!0){return u.fromPrivateKey(k).toRawBytes(S)}function E(k){const S=k instanceof Uint8Array,O=typeof k=="string",P=(S||O)&&k.length;return S?P===o||P===s:O?P===2*o||P===2*s:k instanceof u}function b(k,S,O=!0){if(E(k))throw new Error("first arg must be private key");if(!E(S))throw new Error("second arg must be public key");return u.fromHex(S).multiply(l(k)).toRawBytes(O)}const _=t.bits2int||function(k){const S=Et(k),O=k.length*8-t.nBitLength;return O>0?S>>BigInt(O):S},$=t.bits2int_modN||function(k){return a(_(k))},A=Jf(t.nBitLength);function q(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(kr<=k&&k<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return mn(k,t.nByteLength)}function F(k,S,O=L){if(["recovered","canonical"].some(Y=>Y in O))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:B}=t;let{lowS:I,prehash:T,extraEntropy:N}=O;I==null&&(I=!0),k=st("msgHash",k),T&&(k=st("prehashed msgHash",P(k)));const C=$(k),x=l(S),R=[q(x),q(C)];if(N!=null){const Y=N===!0?B(r.BYTES):N;R.push(st("extraEntropy",Y))}const H=Zn(...R),G=C;function J(Y){const X=_(Y);if(!h(X))return;const M=c(X),j=u.BASE.multiply(X).toAffine(),Z=a(j.x);if(Z===kr)return;const W=a(M*a(G+Z*x));if(W===kr)return;let Q=(j.x===Z?0:2)|Number(j.y&Ut),oe=W;return I&&g(W)&&(oe=m(W),Q^=1),new w(Z,oe,Q)}return{seed:H,k2sig:J}}const L={lowS:t.lowS,prehash:!1},D={lowS:t.lowS,prehash:!1};function U(k,S,O=L){const{seed:P,k2sig:B}=F(k,S,O),I=t;return Nw(I.hash.outputLen,I.nByteLength,I.hmac)(P,B)}u.BASE._setWindowSize(8);function z(k,S,O,P=D){const B=k;if(S=st("msgHash",S),O=st("publicKey",O),"strict"in P)throw new Error("options.strict was renamed to lowS");const{lowS:I,prehash:T}=P;let N,C;try{if(typeof B=="string"||B instanceof Uint8Array)try{N=w.fromDER(B)}catch(j){if(!(j instanceof Mn.Err))throw j;N=w.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){const{r:j,s:Z}=B;N=new w(j,Z)}else throw new Error("PARSE");C=u.fromHex(O)}catch(j){if(j.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(I&&N.hasHighS())return!1;T&&(S=t.hash(S));const{r:x,s:R}=N,H=$(S),G=c(R),J=a(H*G),Y=a(x*G),X=u.BASE.multiplyAndAddUnsafe(C,J,Y)?.toAffine();return X?a(X.x)===x:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:b,sign:U,verify:z,ProjectivePoint:u,Signature:w,utils:y}}let zw=class extends Iw{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,sN(t);const n=Zf(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return la(this),this.iHash.update(t),this}digestInto(t){la(this),Tw(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Bw=(e,t,r)=>new zw(e,t).update(r).digest();Bw.create=(e,t)=>new zw(e,t);function qN(e){return{hash:e,hmac:(t,...r)=>Bw(e,t,uN(...r)),randomBytes:Ow}}function jN(e,t){const r=n=>MN({...e,...qN(n)});return Object.freeze({...r(t),create:r})}const ec=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),fa=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Mw=BigInt(1),da=BigInt(2),Am=(e,t)=>(e+t/da)/t;function qw(e){const t=ec,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,l=u*u*e%t,f=Nt(l,r,t)*l%t,h=Nt(f,r,t)*l%t,p=Nt(h,da,t)*u%t,g=Nt(p,o,t)*p%t,m=Nt(g,s,t)*g%t,d=Nt(m,a,t)*m%t,w=Nt(d,c,t)*d%t,y=Nt(w,a,t)*m%t,v=Nt(y,r,t)*l%t,E=Nt(v,i,t)*g%t,b=Nt(E,n,t)*u%t,_=Nt(b,da,t);if(!al.eql(al.sqr(_),e))throw new Error("Cannot find square root");return _}const al=IN(ec,void 0,void 0,{sqrt:qw}),jo=jN({a:BigInt(0),b:BigInt(7),Fp:al,n:fa,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=fa,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Mw*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,i=BigInt("0x100000000000000000000000000000000"),a=Am(s*e,t),c=Am(-n*e,t);let u=Ye(e-a*r-c*o,t),l=Ye(-a*n-c*s,t);const f=u>i,h=l>i;if(f&&(u=t-u),h&&(l=t-l),u>i||l>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:u,k2neg:h,k2:l}}}},ol),tc=BigInt(0),jw=e=>typeof e=="bigint"&&tc<e&&e<ec,DN=e=>typeof e=="bigint"&&tc<e&&e<fa,Im={};function ha(e,...t){let r=Im[e];if(r===void 0){const n=ol(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Zn(n,n),Im[e]=r}return ol(Zn(r,...t))}const Yf=e=>e.toRawBytes(!0).slice(1),cl=e=>mn(e,32),su=e=>Ye(e,ec),ys=e=>Ye(e,fa),Xf=jo.ProjectivePoint,FN=(e,t,r)=>Xf.BASE.multiplyAndAddUnsafe(e,t,r);function ul(e){let t=jo.utils.normPrivateKeyToScalar(e),r=Xf.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:ys(-t),bytes:Yf(r)}}function Dw(e){if(!jw(e))throw new Error("bad x: need 0 < x < p");const t=su(e*e),r=su(t*e+BigInt(7));let n=qw(r);n%da!==tc&&(n=su(-n));const o=new Xf(e,n,Mw);return o.assertValidity(),o}function Fw(...e){return ys(Et(ha("BIP0340/challenge",...e)))}function HN(e){return ul(e).bytes}function VN(e,t,r=Ow(32)){const n=st("message",e),{bytes:o,scalar:s}=ul(t),i=st("auxRand",r,32),a=cl(s^Et(ha("BIP0340/aux",i))),c=ha("BIP0340/nonce",a,o,n),u=ys(Et(c));if(u===tc)throw new Error("sign failed: k is zero");const{bytes:l,scalar:f}=ul(u),h=Fw(l,o,n),p=new Uint8Array(64);if(p.set(l,0),p.set(cl(ys(f+h*s)),32),!Hw(p,n,o))throw new Error("sign: Invalid signature produced");return p}function Hw(e,t,r){const n=st("signature",e,64),o=st("message",t),s=st("publicKey",r,32);try{const i=Dw(Et(s)),a=Et(n.subarray(0,32));if(!jw(a))return!1;const c=Et(n.subarray(32,64));if(!DN(c))return!1;const u=Fw(cl(a),Yf(i),o),l=FN(i,c,ys(-u));return!(!l||!l.hasEvenY()||l.toAffine().x!==a)}catch{return!1}}const Xo={getPublicKey:HN,sign:VN,verify:Hw,utils:{randomPrivateKey:jo.utils.randomPrivateKey,lift_x:Dw,pointToBytes:Yf,numberToBytesBE:mn,bytesToNumberBE:Et,taggedHash:ha,mod:Ye}},iu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Qf=e=>e instanceof Uint8Array,au=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),er=(e,t)=>e<<32-t|e>>>t,ZN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ZN)throw new Error("Non little-endian hardware is not supported");const KN=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function it(e){if(!Qf(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=KN[e[r]];return t}function Kn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const o=n*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function GN(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ws(e){if(typeof e=="string"&&(e=GN(e)),!Qf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function rc(...e){const t=new Uint8Array(e.reduce((n,o)=>n+o.length,0));let r=0;return e.forEach(n=>{if(!Qf(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}class Vw{clone(){return this._cloneInto()}}function Zw(e){const t=n=>e().update(ws(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Kw(e=32){if(iu&&typeof iu.getRandomValues=="function")return iu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ll(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function WN(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Gw(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function JN(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ll(e.outputLen),ll(e.blockLen)}function YN(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function XN(e,t){Gw(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const ar={number:ll,bool:WN,bytes:Gw,hash:JN,exists:YN,output:XN};function QN(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}class e4 extends Vw{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=au(this.buffer)}update(t){ar.exists(this);const{view:r,buffer:n,blockLen:o}=this;t=ws(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=au(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ar.exists(this),ar.output(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:s}=this;let{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;QN(n,o-8,BigInt(this.length*8),s),this.process(n,0);const a=au(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%r&&t.buffer.set(n),t}}const t4=(e,t,r)=>e&t^~e&r,r4=(e,t,r)=>e&t^e&r^t&r,n4=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qr=new Uint32Array(64);class Ww extends e4{constructor(){super(64,32,8,!1),this.A=Xr[0]|0,this.B=Xr[1]|0,this.C=Xr[2]|0,this.D=Xr[3]|0,this.E=Xr[4]|0,this.F=Xr[5]|0,this.G=Xr[6]|0,this.H=Xr[7]|0}get(){const{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)Qr[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){const h=Qr[f-15],p=Qr[f-2],g=er(h,7)^er(h,18)^h>>>3,m=er(p,17)^er(p,19)^p>>>10;Qr[f]=m+Qr[f-7]+g+Qr[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=er(a,6)^er(a,11)^er(a,25),p=l+h+t4(a,c,u)+n4[f]+Qr[f]|0,m=(er(n,2)^er(n,13)^er(n,22))+r4(n,o,s)|0;l=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){Qr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class o4 extends Ww{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Jn=Zw(()=>new Ww);Zw(()=>new o4);var fl=function(e,t){return fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},fl(e,t)};function Jt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");fl(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var dl=function(){return dl=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},dl.apply(this,arguments)};function s4(e,t,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(l){try{u(n.next(l))}catch(f){i(f)}}function c(l){try{u(n.throw(l))}catch(f){i(f)}}function u(l){l.done?s(l.value):o(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}function Jw(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(s=u[0]&2?o.return:u[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,u[1])).done)return s;switch(o=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],o=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Io(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ur(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,s=[],i;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return s}function zr(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,s;n<o;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function wo(e){return this instanceof wo?(this.v=e,this):new wo(e)}function i4(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,s=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",i),o[Symbol.asyncIterator]=function(){return this},o;function i(p){return function(g){return Promise.resolve(g).then(p,f)}}function a(p,g){n[p]&&(o[p]=function(m){return new Promise(function(d,w){s.push([p,m,d,w])>1||c(p,m)})},g&&(o[p]=g(o[p])))}function c(p,g){try{u(n[p](g))}catch(m){h(s[0][3],m)}}function u(p){p.value instanceof wo?Promise.resolve(p.value.v).then(l,f):h(s[0][2],p)}function l(p){c("next",p)}function f(p){c("throw",p)}function h(p,g){p(g),s.shift(),s.length&&c(s[0][0],s[0][1])}}function a4(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Io=="function"?Io(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(i){return new Promise(function(a,c){i=e[s](i),o(a,c,i.done,i.value)})}}function o(s,i,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},i)}}function xe(e){return typeof e=="function"}function nc(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var cu=nc(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function pa(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Do=(function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,s;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=Io(i),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(m){t={error:m}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else i.remove(this);var l=this.initialTeardown;if(xe(l))try{l()}catch(m){s=m instanceof cu?m.errors:[m]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var h=Io(f),p=h.next();!p.done;p=h.next()){var g=p.value;try{Om(g)}catch(m){s=s??[],m instanceof cu?s=zr(zr([],Ur(s)),Ur(m.errors)):s.push(m)}}}catch(m){n={error:m}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(n)throw n.error}}}if(s)throw new cu(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Om(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&pa(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&pa(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=(function(){var t=new e;return t.closed=!0,t})(),e})(),Yw=Do.EMPTY;function Xw(e){return e instanceof Do||e&&"closed"in e&&xe(e.remove)&&xe(e.add)&&xe(e.unsubscribe)}function Om(e){xe(e)?e():e.unsubscribe()}var c4={Promise:void 0},u4={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,zr([e,t],Ur(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Qw(e){u4.setTimeout(function(){throw e})}function Oo(){}function Bi(e){e()}var oc=(function(e){Jt(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Xw(r)&&r.add(n)):n.destination=d4,n}return t.create=function(r,n,o){return new No(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t})(Do),l4=(function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){xi(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){xi(n)}else xi(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){xi(r)}},e})(),No=(function(e){Jt(t,e);function t(r,n,o){var s=e.call(this)||this,i;return xe(r)||!r?i={next:r??void 0,error:n??void 0,complete:o??void 0}:i=r,s.destination=new l4(i),s}return t})(oc);function xi(e){Qw(e)}function f4(e){throw e}var d4={closed:!0,next:Oo,error:f4,complete:Oo},ed=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function pt(e){return e}function h4(e){return e.length===0?pt:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var Oe=(function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,s=m4(t)?t:new No(t,r,n);return Bi(function(){var i=o,a=i.operator,c=i.source;s.add(a?a.call(s,c):c?o._subscribe(s):o._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Nm(r),new r(function(o,s){var i=new No({next:function(a){try{t(a)}catch(c){s(c),i.unsubscribe()}},error:s,complete:o});n.subscribe(i)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[ed]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return h4(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Nm(t),new t(function(n,o){var s;r.subscribe(function(i){return s=i},function(i){return o(i)},function(){return n(s)})})},e.create=function(t){return new e(t)},e})();function Nm(e){var t;return(t=e??c4.Promise)!==null&&t!==void 0?t:Promise}function p4(e){return e&&xe(e.next)&&xe(e.error)&&xe(e.complete)}function m4(e){return e&&e instanceof oc||p4(e)&&Xw(e)}function g4(e){return xe(e?.lift)}function Ee(e){return function(t){if(g4(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ve(e,t,r,n,o){return new y4(e,t,r,n,o)}var y4=(function(e){Jt(t,e);function t(r,n,o,s,i,a){var c=e.call(this,r)||this;return c.onFinalize=i,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){r.error(l)}}:e.prototype._next,c._error=s?function(u){try{s(u)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=o?function(){try{o()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t})(oc),w4=nc(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),kt=(function(e){Jt(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new hl(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new w4},t.prototype.next=function(r){var n=this;Bi(function(){var o,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var i=Io(n.currentObservers),a=i.next();!a.done;a=i.next()){var c=a.value;c.next(r)}}catch(u){o={error:u}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;Bi(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;Bi(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,s=o.hasError,i=o.isStopped,a=o.observers;return s||i?Yw:(this.currentObservers=null,a.push(r),new Do(function(){n.currentObservers=null,pa(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,s=n.thrownError,i=n.isStopped;o?r.error(s):i&&r.complete()},t.prototype.asObservable=function(){var r=new Oe;return r.source=this,r},t.create=function(r,n){return new hl(r,n)},t})(Oe),hl=(function(e){Jt(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:Yw},t})(kt),rt=(function(e){Jt(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,o=r.thrownError,s=r._value;if(n)throw o;return this._throwIfClosed(),s},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t})(kt),td={now:function(){return(td.delegate||Date).now()},delegate:void 0},Mi=(function(e){Jt(t,e);function t(r,n,o){r===void 0&&(r=1/0),n===void 0&&(n=1/0),o===void 0&&(o=td);var s=e.call(this)||this;return s._bufferSize=r,s._windowTime=n,s._timestampProvider=o,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,r),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(r){var n=this,o=n.isStopped,s=n._buffer,i=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;o||(s.push(r),!i&&s.push(a.now()+c)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),o=this,s=o._infiniteTimeWindow,i=o._buffer,a=i.slice(),c=0;c<a.length&&!r.closed;c+=s?1:2)r.next(a[c]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,o=r._timestampProvider,s=r._buffer,i=r._infiniteTimeWindow,a=(i?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!i){for(var c=o.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},t})(kt),v4=(function(e){Jt(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t})(Do),Cm={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setInterval.apply(void 0,zr([e,t],Ur(r)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},b4=(function(e){Jt(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return t.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var s=this.id,i=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(i,s,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(i,this.id,n),this},t.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),Cm.setInterval(r.flush.bind(r,this),o)},t.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&Cm.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var o=!1,s;try{this.work(r)}catch(i){o=!0,s=i||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,s=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,pa(s,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t})(v4),Pm=(function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=td.now,e})(),_4=(function(e){Jt(t,e);function t(r,n){n===void 0&&(n=Pm.now);var o=e.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},t})(Pm),ev=new _4(b4),E4=ev,sc=new Oe(function(e){return e.complete()});function tv(e){return e&&xe(e.schedule)}function rd(e){return e[e.length-1]}function $4(e){return xe(rd(e))?e.pop():void 0}function Fo(e){return tv(rd(e))?e.pop():void 0}function rv(e,t){return typeof rd(e)=="number"?e.pop():t}var nv=(function(e){return e&&typeof e.length=="number"&&typeof e!="function"});function ov(e){return xe(e?.then)}function sv(e){return xe(e[ed])}function iv(e){return Symbol.asyncIterator&&xe(e?.[Symbol.asyncIterator])}function av(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function S4(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var cv=S4();function uv(e){return xe(e?.[cv])}function lv(e){return i4(this,arguments,function(){var r,n,o,s;return Jw(this,function(i){switch(i.label){case 0:r=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,wo(r.read())];case 3:return n=i.sent(),o=n.value,s=n.done,s?[4,wo(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,wo(o)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function fv(e){return xe(e?.getReader)}function lt(e){if(e instanceof Oe)return e;if(e!=null){if(sv(e))return x4(e);if(nv(e))return k4(e);if(ov(e))return R4(e);if(iv(e))return dv(e);if(uv(e))return T4(e);if(fv(e))return A4(e)}throw av(e)}function x4(e){return new Oe(function(t){var r=e[ed]();if(xe(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function k4(e){return new Oe(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function R4(e){return new Oe(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Qw)})}function T4(e){return new Oe(function(t){var r,n;try{for(var o=Io(e),s=o.next();!s.done;s=o.next()){var i=s.value;if(t.next(i),t.closed)return}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function dv(e){return new Oe(function(t){I4(e,t).catch(function(r){return t.error(r)})})}function A4(e){return dv(lv(e))}function I4(e,t){var r,n,o,s;return s4(this,void 0,void 0,function(){var i,a;return Jw(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=a4(e),c.label=1;case 1:return[4,r.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(i=n.value,t.next(i),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=r.return)?[4,s.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Pr(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var s=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!o)return s}function hv(e,t){return t===void 0&&(t=0),Ee(function(r,n){r.subscribe(ve(n,function(o){return Pr(n,e,function(){return n.next(o)},t)},function(){return Pr(n,e,function(){return n.complete()},t)},function(o){return Pr(n,e,function(){return n.error(o)},t)}))})}function pv(e,t){return t===void 0&&(t=0),Ee(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function O4(e,t){return lt(e).pipe(pv(t),hv(t))}function N4(e,t){return lt(e).pipe(pv(t),hv(t))}function C4(e,t){return new Oe(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function P4(e,t){return new Oe(function(r){var n;return Pr(r,t,function(){n=e[cv](),Pr(r,t,function(){var o,s,i;try{o=n.next(),s=o.value,i=o.done}catch(a){r.error(a);return}i?r.complete():r.next(s)},0,!0)}),function(){return xe(n?.return)&&n.return()}})}function mv(e,t){if(!e)throw new Error("Iterable cannot be null");return new Oe(function(r){Pr(r,t,function(){var n=e[Symbol.asyncIterator]();Pr(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function L4(e,t){return mv(lv(e),t)}function U4(e,t){if(e!=null){if(sv(e))return O4(e,t);if(nv(e))return C4(e,t);if(ov(e))return N4(e,t);if(iv(e))return mv(e,t);if(uv(e))return P4(e,t);if(fv(e))return L4(e,t)}throw av(e)}function Zt(e,t){return t?U4(e,t):lt(e)}function ht(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Fo(e);return Zt(e,r)}function qi(e,t){var r=xe(e)?e:function(){return e},n=function(o){return o.error(r())};return new Oe(n)}function Lm(e){return!!e&&(e instanceof Oe||xe(e.lift)&&xe(e.subscribe))}var gv=nc(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Un(e,t){return new Promise(function(r,n){var o=!1,s;e.subscribe({next:function(i){s=i,o=!0},error:n,complete:function(){o?r(s):n(new gv)}})})}function ji(e,t){return new Promise(function(r,n){var o=new No({next:function(s){r(s),o.unsubscribe()},error:n,complete:function(){n(new gv)}});e.subscribe(o)})}function yv(e){return e instanceof Date&&!isNaN(e)}var z4=nc(function(e){return function(r){r===void 0&&(r=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=r}});function qn(e,t){var r=yv(e)?{first:e}:typeof e=="number"?{each:e}:e,n=r.first,o=r.each,s=r.with,i=s===void 0?B4:s,a=r.scheduler,c=a===void 0?ev:a,u=r.meta,l=u===void 0?null:u;if(n==null&&o==null)throw new TypeError("No timeout provided.");return Ee(function(f,h){var p,g,m=null,d=0,w=function(y){g=Pr(h,c,function(){try{p.unsubscribe(),lt(i({meta:l,lastValue:m,seen:d})).subscribe(h)}catch(v){h.error(v)}},y)};p=f.subscribe(ve(h,function(y){g?.unsubscribe(),d++,h.next(m=y),o>0&&w(o)},void 0,void 0,function(){g?.closed||g?.unsubscribe(),m=null})),!d&&w(n!=null?typeof n=="number"?n:+n-c.now():o)})}function B4(e){throw new z4(e)}function We(e,t){return Ee(function(r,n){var o=0;r.subscribe(ve(n,function(s){n.next(e.call(t,s,o++))}))})}var M4=Array.isArray;function q4(e,t){return M4(t)?e.apply(void 0,zr([],Ur(t))):e(t)}function j4(e){return We(function(t){return q4(e,t)})}var D4=Array.isArray,F4=Object.getPrototypeOf,H4=Object.prototype,V4=Object.keys;function Z4(e){if(e.length===1){var t=e[0];if(D4(t))return{args:t,keys:null};if(K4(t)){var r=V4(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function K4(e){return e&&typeof e=="object"&&F4(e)===H4}function G4(e,t){return e.reduce(function(r,n,o){return r[n]=t[o],r},{})}function Di(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Fo(e),n=$4(e),o=Z4(e),s=o.args,i=o.keys;if(s.length===0)return Zt([],r);var a=new Oe(W4(s,r,i?function(c){return G4(i,c)}:pt));return n?a.pipe(j4(n)):a}function W4(e,t,r){return r===void 0&&(r=pt),function(n){Um(t,function(){for(var o=e.length,s=new Array(o),i=o,a=o,c=function(l){Um(t,function(){var f=Zt(e[l],t),h=!1;f.subscribe(ve(n,function(p){s[l]=p,h||(h=!0,a--),a||n.next(r(s.slice()))},function(){--i||n.complete()}))},n)},u=0;u<o;u++)c(u)},n)}}function Um(e,t,r){e?Pr(r,e,t):t()}function J4(e,t,r,n,o,s,i,a){var c=[],u=0,l=0,f=!1,h=function(){f&&!c.length&&!u&&t.complete()},p=function(m){return u<n?g(m):c.push(m)},g=function(m){u++;var d=!1;lt(r(m,l++)).subscribe(ve(t,function(w){t.next(w)},function(){d=!0},void 0,function(){if(d)try{u--;for(var w=function(){var y=c.shift();i||g(y)};c.length&&u<n;)w();h()}catch(y){t.error(y)}}))};return e.subscribe(ve(t,p,function(){f=!0,h()})),function(){}}function vs(e,t,r){return r===void 0&&(r=1/0),xe(t)?vs(function(n,o){return We(function(s,i){return t(n,s,o,i)})(lt(e(n,o)))},r):(typeof t=="number"&&(r=t),Ee(function(n,o){return J4(n,o,e,r)}))}function nd(e){return e===void 0&&(e=1/0),vs(pt,e)}function Y4(){return nd(1)}function pl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y4()(Zt(e,Fo(e)))}function Fi(e){return new Oe(function(t){lt(e()).subscribe(t)})}function Fn(e,t,r){e===void 0&&(e=0),r===void 0&&(r=E4);var n=-1;return t!=null&&(tv(t)?r=t:n=t),new Oe(function(o){var s=yv(e)?+e-r.now():e;s<0&&(s=0);var i=0;return r.schedule(function(){o.closed||(o.next(i++),0<=n?this.schedule(void 0,n):o.complete())},s)})}function xt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Fo(e),n=rv(e,1/0),o=e;return o.length?o.length===1?lt(o[0]):nd(n)(Zt(o,r)):sc}var rr=new Oe(Oo);function nt(e,t){return Ee(function(r,n){var o=0;r.subscribe(ve(n,function(s){return e.call(t,s,o++)&&n.next(s)}))})}function Rr(e){return Ee(function(t,r){var n=null,o=!1,s;n=t.subscribe(ve(r,void 0,void 0,function(i){s=lt(e(i,Rr(e)(t))),n?(n.unsubscribe(),n=null,s.subscribe(r)):o=!0})),o&&(n.unsubscribe(),n=null,s.subscribe(r))})}function wv(e,t,r,n,o){return function(s,i){var a=r,c=t,u=0;s.subscribe(ve(i,function(l){var f=u++;c=a?e(c,l,f):(a=!0,l),n&&i.next(c)},o&&(function(){a&&i.next(c),i.complete()})))}}function X4(e,t){return Ee(wv(e,t,arguments.length>=2,!1,!0))}var Q4=function(e,t){return e.push(t),e};function eC(){return Ee(function(e,t){X4(Q4,[])(e).subscribe(t)})}function tC(e){return Ee(function(t,r){var n=!1;t.subscribe(ve(r,function(o){n=!0,r.next(o)},function(){n||r.next(e),r.complete()}))})}function Dt(e){return e<=0?function(){return sc}:Ee(function(t,r){var n=0;t.subscribe(ve(r,function(o){++n<=e&&(r.next(o),e<=n&&r.complete())}))})}function ss(){return Ee(function(e,t){e.subscribe(ve(t,Oo))})}function rC(e,t){return Ee(function(r,n){var o=new Set;r.subscribe(ve(n,function(s){var i=e?e(s):s;o.has(i)||(o.add(i),n.next(s))})),t&&lt(t).subscribe(ve(n,function(){return o.clear()},Oo))})}function is(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return pl(r,ht.apply(void 0,zr([],Ur(e))))}}function zm(e){return Ee(function(t,r){try{t.subscribe(r)}finally{r.add(e)}})}function nC(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Fo(e),n=rv(e,1/0);return Ee(function(o,s){nd(n)(Zt(zr([o],Ur(e)),r)).subscribe(s)})}function vv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nC.apply(void 0,zr([],Ur(e)))}function uu(e){var t,r=1/0,n;return e!=null&&(typeof e=="object"?(t=e.count,r=t===void 0?1/0:t,n=e.delay):r=e),r<=0?function(){return sc}:Ee(function(o,s){var i=0,a,c=function(){if(a?.unsubscribe(),a=null,n!=null){var l=typeof n=="number"?Fn(n):lt(n(i)),f=ve(s,function(){f.unsubscribe(),u()});l.subscribe(f)}else u()},u=function(){var l=!1;a=o.subscribe(ve(s,void 0,function(){++i<r?a?c():l=!0:s.complete()})),l&&c()};u()})}function ki(e){e===void 0&&(e=1/0);var t;e&&typeof e=="object"?t=e:t={count:e};var r=t.count,n=r===void 0?1/0:r,o=t.delay,s=t.resetOnSuccess,i=s===void 0?!1:s;return n<=0?pt:Ee(function(a,c){var u=0,l,f=function(){var h=!1;l=a.subscribe(ve(c,function(p){i&&(u=0),c.next(p)},void 0,function(p){if(u++<n){var g=function(){l?(l.unsubscribe(),l=null,f()):h=!0};if(o!=null){var m=typeof o=="number"?Fn(o):lt(o(p,u)),d=ve(c,function(){d.unsubscribe(),g()},function(){c.complete()});m.subscribe(d)}else g()}else c.error(p)})),h&&(l.unsubscribe(),l=null,f())};f()})}function ml(e,t){return Ee(wv(e,t,arguments.length>=2,!0))}function De(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new kt}:t,n=e.resetOnError,o=n===void 0?!0:n,s=e.resetOnComplete,i=s===void 0?!0:s,a=e.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,f,h,p=0,g=!1,m=!1,d=function(){f?.unsubscribe(),f=void 0},w=function(){d(),l=h=void 0,g=m=!1},y=function(){var v=l;w(),v?.unsubscribe()};return Ee(function(v,E){p++,!m&&!g&&d();var b=h=h??r();E.add(function(){p--,p===0&&!m&&!g&&(f=lu(y,c))}),b.subscribe(E),!l&&p>0&&(l=new No({next:function(_){return b.next(_)},error:function(_){m=!0,d(),f=lu(w,o,_),b.error(_)},complete:function(){g=!0,d(),f=lu(w,i),b.complete()}}),lt(v).subscribe(l))})(u)}}function lu(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var o=new No({next:function(){o.unsubscribe(),e()}});return lt(t.apply(void 0,zr([],Ur(r)))).subscribe(o)}}function gl(e,t,r){var n,o=!1;return n=e,De({connector:function(){return new Mi(n,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}function oC(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Fo(e);return Ee(function(n,o){(r?pl(e,n,r):pl(e,n)).subscribe(o)})}function Ht(e,t){return Ee(function(r,n){var o=null,s=0,i=!1,a=function(){return i&&!o&&n.complete()};r.subscribe(ve(n,function(c){o?.unsubscribe();var u=0,l=s++;lt(e(c,l)).subscribe(o=ve(n,function(f){return n.next(t?t(c,f,l,u++):f)},function(){o=null,a()}))},function(){i=!0,a()}))})}function vo(e){return Ee(function(t,r){lt(e).subscribe(ve(r,function(){return r.complete()},Oo)),!r.closed&&t.subscribe(r)})}function bv(e,t){return t===void 0&&(t=!1),Ee(function(r,n){var o=0;r.subscribe(ve(n,function(s){var i=e(s,o++);(i||t)&&n.next(s),!i&&n.complete()}))})}function _r(e,t,r){var n=xe(e)||t||r?{next:e,error:t,complete:r}:e;return n?Ee(function(o,s){var i;(i=n.subscribe)===null||i===void 0||i.call(n);var a=!0;o.subscribe(ve(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):pt}function Ho(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Dr(...e){const t=(o,s)=>i=>o(s(i)),r=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),n=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:r,decode:n}}function Fr(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(r=>{if(Ho(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=e.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return n})}}}function Hr(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function ic(e,t="="){if(Ho(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of r)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let n=r.length;if(n*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function _v(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Bm(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let n=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(Ho(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,a=!0;for(let c=n;c<s.length;c++){const u=s[c],l=t*i+u;if(!Number.isSafeInteger(l)||t*i/t!==i||l-u!==t*i)throw new Error("convertRadix: carry overflow");if(i=l%r,s[c]=Math.floor(l/r),!Number.isSafeInteger(s[c])||s[c]*r+i!==l)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:n=c;else continue}if(o.push(i),a)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const Ev=(e,t)=>t?Ev(t,e%t):e,ma=(e,t)=>e+(t-Ev(e,t));function yl(e,t,r,n){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(ma(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${ma(t,r)}`);let o=0,s=0;const i=2**r-1,a=[];for(const c of e){if(Ho(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(o=o<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=r;s-=r)a.push((o>>s-r&i)>>>0);o&=2**s-1}if(o=o<<r-s&i,!n&&s>=t)throw new Error("Excess padding");if(!n&&o)throw new Error(`Non-zero padding: ${o}`);return n&&s>0&&a.push(o>>>0),a}function sC(e){return Ho(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Bm(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Bm(t,e,2**8))}}}function $n(e,t=!1){if(Ho(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(ma(8,e)>32||ma(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return yl(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(yl(r,e,8,t))}}}function Mm(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const iC=Dr($n(4),Fr("0123456789ABCDEF"),Hr("")),aC=Dr($n(5),Fr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ic(5),Hr(""));Dr($n(5),Fr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ic(5),Hr(""));Dr($n(5),Fr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Hr(""),_v(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Br=Dr($n(6),Fr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ic(6),Hr("")),cC=Dr($n(6),Fr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ic(6),Hr("")),od=e=>Dr(sC(58),Fr(e),Hr("")),wl=od("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");od("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");od("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const qm=[0,2,3,5,6,7,9,10,11],uC={encode(e){let t="";for(let r=0;r<e.length;r+=8){const n=e.subarray(r,r+8);t+=wl.encode(n).padStart(qm[n.length],"1")}return t},decode(e){let t=[];for(let r=0;r<e.length;r+=11){const n=e.slice(r,r+11),o=qm.indexOf(n.length),s=wl.decode(n);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},vl=Dr(Fr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Hr("")),jm=[996825010,642813549,513874426,1027748829,705979059];function Qo(e){const t=e>>25;let r=(e&33554431)<<5;for(let n=0;n<jm.length;n++)(t>>n&1)===1&&(r^=jm[n]);return r}function Dm(e,t,r=1){const n=e.length;let o=1;for(let s=0;s<n;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Qo(o)^i>>5}o=Qo(o);for(let s=0;s<n;s++)o=Qo(o)^e.charCodeAt(s)&31;for(let s of t)o=Qo(o)^s;for(let s=0;s<6;s++)o=Qo(o);return o^=r,vl.encode(yl([o%2**30],30,5,!1))}function $v(e){const t=e==="bech32"?1:734539939,r=$n(5),n=r.decode,o=r.encode,s=Mm(n);function i(l,f,h=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const p=l.length+7+f.length;if(h!==!1&&p>h)throw new TypeError(`Length ${p} exceeds limit ${h}`);return l=l.toLowerCase(),`${l}1${vl.encode(f)}${Dm(l,f,t)}`}function a(l,f=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||f!==!1&&l.length>f)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${f})`);const h=l.toLowerCase();if(l!==h&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=h;const p=l.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=l.slice(0,p),m=l.slice(p+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const d=vl.decode(m).slice(0,-6),w=Dm(g,d,t);if(!m.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:g,words:d}}const c=Mm(a);function u(l){const{prefix:f,words:h}=a(l,!1);return{prefix:f,words:h,bytes:n(h)}}return{encode:i,decode:a,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:o}}const Co=$v("bech32");$v("bech32m");const lC={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},fC=Dr($n(4),Fr("0123456789abcdef"),Hr(""),_v(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),dC={utf8:lC,hex:fC,base16:iC,base32:aC,base64:Br,base64url:cC,base58:wl,base58xmr:uC};`${Object.keys(dC).join(", ")}`;function fu(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Fm(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function hC(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function cr(e,...t){if(!hC(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}const ct=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),pC=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!pC)throw new Error("Non little-endian hardware is not supported");const mC=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function oo(e){cr(e);let t="";for(let r=0;r<e.length;r++)t+=mC[e[r]];return t}const wr={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Hm(e){if(e>=wr._0&&e<=wr._9)return e-wr._0;if(e>=wr._A&&e<=wr._F)return e-(wr._A-10);if(e>=wr._a&&e<=wr._f)return e-(wr._a-10)}function Sv(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const i=Hm(e.charCodeAt(s)),a=Hm(e.charCodeAt(s+1));if(i===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function gC(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function yC(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const wC=(e,t)=>(Object.assign(t,e),t),un=16,vC=283;function sd(e){return e<<1^vC&-(e>>7)}function po(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=sd(e);return r}const bl=(()=>{let e=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=sd(n))e[r]=n;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return t})(),bC=bl.map((e,t)=>bl.indexOf(t)),_C=e=>e<<24|e>>>8,du=e=>e<<8|e>>>24;function xv(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((u,l)=>t(e[l])),n=r.map(du),o=n.map(du),s=o.map(du),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let l=0;l<256;l++){const f=u*256+l;i[f]=r[u]^n[l],a[f]=o[u]^s[l],c[f]=e[u]<<8|e[l]}return{sbox:e,sbox2:c,T0:r,T1:n,T2:o,T3:s,T01:i,T23:a}}const id=xv(bl,e=>po(e,3)<<24|e<<16|e<<8|po(e,2)),kv=xv(bC,e=>po(e,11)<<24|po(e,13)<<16|po(e,9)<<8|po(e,14)),EC=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=sd(r))e[t]=r;return e})();function Rv(e){cr(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:r}=id,n=ct(e),o=n.length,s=a=>ur(r,a,a,a,a),i=new Uint32Array(t+28);i.set(n);for(let a=o;a<i.length;a++){let c=i[a-1];a%o===0?c=s(_C(c))^EC[a/o-1]:o>6&&a%o===4&&(c=s(c)),i[a]=i[a-o]^c}return i}function $C(e){const t=Rv(e),r=t.slice(),n=t.length,{sbox2:o}=id,{T0:s,T1:i,T2:a,T3:c}=kv;for(let u=0;u<n;u+=4)for(let l=0;l<4;l++)r[u+l]=t[n-u-4+l];t.fill(0);for(let u=4;u<n-4;u++){const l=r[u],f=ur(o,l,l,l,l);r[u]=s[f&255]^i[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return r}function sn(e,t,r,n,o,s){return e[r<<8&65280|n>>>8&255]^t[o>>>8&65280|s>>>24&255]}function ur(e,t,r,n,o){return e[t&255|r&65280]|e[n>>>16&255|o>>>16&65280]<<16}function Vm(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=id;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^sn(i,a,t,r,n,o),d=e[c++]^sn(i,a,r,n,o,t),w=e[c++]^sn(i,a,n,o,t,r),y=e[c++]^sn(i,a,o,t,r,n);t=m,r=d,n=w,o=y}const l=e[c++]^ur(s,t,r,n,o),f=e[c++]^ur(s,r,n,o,t),h=e[c++]^ur(s,n,o,t,r),p=e[c++]^ur(s,o,t,r,n);return{s0:l,s1:f,s2:h,s3:p}}function SC(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=kv;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^sn(i,a,t,o,n,r),d=e[c++]^sn(i,a,r,t,o,n),w=e[c++]^sn(i,a,n,r,t,o),y=e[c++]^sn(i,a,o,n,r,t);t=m,r=d,n=w,o=y}const l=e[c++]^ur(s,t,o,n,r),f=e[c++]^ur(s,r,t,o,n),h=e[c++]^ur(s,n,r,t,o),p=e[c++]^ur(s,o,n,r,t);return{s0:l,s1:f,s2:h,s3:p}}function Tv(e,t){if(!t)return new Uint8Array(e);if(cr(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function xC(e){if(cr(e),e.length%un!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${un}`)}function kC(e,t,r){let n=e.length;const o=n%un;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=ct(e);if(t){let c=un-o;c||(c=un),n=n+c}const i=Tv(n,r),a=ct(i);return{b:s,o:a,out:i}}function RC(e,t){if(!t)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=e[r-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);const o=e.subarray(0,-n);for(let s=0;s<n;s++)if(e[r-s-1]!==n)throw new Error("aes/pcks5: wrong padding");return o}function TC(e){const t=new Uint8Array(16),r=ct(t);t.set(e);const n=un-e.length;for(let o=un-n;o<un;o++)t[o]=n;return r}const Av=wC({blockSize:16,nonceLength:16},function(t,r,n={}){cr(t),cr(r,16);const o=!n.disablePadding;return{encrypt:(s,i)=>{const a=Rv(t),{b:c,o:u,out:l}=kC(s,o,i),f=ct(r);let h=f[0],p=f[1],g=f[2],m=f[3],d=0;for(;d+4<=c.length;)h^=c[d+0],p^=c[d+1],g^=c[d+2],m^=c[d+3],{s0:h,s1:p,s2:g,s3:m}=Vm(a,h,p,g,m),u[d++]=h,u[d++]=p,u[d++]=g,u[d++]=m;if(o){const w=TC(s.subarray(d*4));h^=w[0],p^=w[1],g^=w[2],m^=w[3],{s0:h,s1:p,s2:g,s3:m}=Vm(a,h,p,g,m),u[d++]=h,u[d++]=p,u[d++]=g,u[d++]=m}return a.fill(0),l},decrypt:(s,i)=>{xC(s);const a=$C(t),c=ct(r),u=Tv(s.length,i),l=ct(s),f=ct(u);let h=c[0],p=c[1],g=c[2],m=c[3];for(let d=0;d+4<=l.length;){const w=h,y=p,v=g,E=m;h=l[d+0],p=l[d+1],g=l[d+2],m=l[d+3];const{s0:b,s1:_,s2:$,s3:A}=SC(a,h,p,g,m);f[d++]=b^w,f[d++]=_^y,f[d++]=$^v,f[d++]=A^E}return a.fill(0),RC(u,o)}}}),Iv=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),AC=Iv("expand 16-byte k"),IC=Iv("expand 32-byte k"),OC=ct(AC),Ov=ct(IC);Ov.slice();function le(e,t){return e<<t|e>>>32-t}function _l(e){return e.byteOffset%4===0}const Ri=64,NC=16,Nv=2**32-1,Zm=new Uint32Array;function CC(e,t,r,n,o,s,i,a){const c=o.length,u=new Uint8Array(Ri),l=ct(u),f=_l(o)&&_l(s),h=f?ct(o):Zm,p=f?ct(s):Zm;for(let g=0;g<c;i++){if(e(t,r,n,l,i,a),i>=Nv)throw new Error("arx: counter overflow");const m=Math.min(Ri,c-g);if(f&&m===Ri){const d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<NC;w++)y=d+w,p[y]=h[y]^l[w];g+=Ri;continue}for(let d=0,w;d<m;d++)w=g+d,s[w]=o[w]^u[d];g+=m}}function PC(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=gC({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return fu(o),fu(i),Fm(s),Fm(r),(a,c,u,l,f=0)=>{cr(a),cr(c),cr(u);const h=u.length;if(l||(l=new Uint8Array(h)),cr(l),fu(f),f<0||f>=Nv)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const p=[];let g=a.length,m,d;if(g===32)m=a.slice(),p.push(m),d=Ov;else if(g===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),d=OC,p.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);_l(c)||(c=c.slice(),p.push(c));const w=ct(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(d,w,ct(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-o;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,p.push(c)}const v=ct(c);for(CC(e,d,w,v,u,l,f,i);p.length>0;)p.pop().fill(0);return l}}function LC(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],u=e[3],l=t[0],f=t[1],h=t[2],p=t[3],g=t[4],m=t[5],d=t[6],w=t[7],y=o,v=r[0],E=r[1],b=r[2],_=i,$=a,A=c,q=u,F=l,L=f,D=h,U=p,z=g,k=m,S=d,O=w,P=y,B=v,I=E,T=b;for(let C=0;C<s;C+=2)_=_+F|0,P=le(P^_,16),z=z+P|0,F=le(F^z,12),_=_+F|0,P=le(P^_,8),z=z+P|0,F=le(F^z,7),$=$+L|0,B=le(B^$,16),k=k+B|0,L=le(L^k,12),$=$+L|0,B=le(B^$,8),k=k+B|0,L=le(L^k,7),A=A+D|0,I=le(I^A,16),S=S+I|0,D=le(D^S,12),A=A+D|0,I=le(I^A,8),S=S+I|0,D=le(D^S,7),q=q+U|0,T=le(T^q,16),O=O+T|0,U=le(U^O,12),q=q+U|0,T=le(T^q,8),O=O+T|0,U=le(U^O,7),_=_+L|0,T=le(T^_,16),S=S+T|0,L=le(L^S,12),_=_+L|0,T=le(T^_,8),S=S+T|0,L=le(L^S,7),$=$+D|0,P=le(P^$,16),O=O+P|0,D=le(D^O,12),$=$+D|0,P=le(P^$,8),O=O+P|0,D=le(D^O,7),A=A+U|0,B=le(B^A,16),z=z+B|0,U=le(U^z,12),A=A+U|0,B=le(B^A,8),z=z+B|0,U=le(U^z,7),q=q+F|0,I=le(I^q,16),k=k+I|0,F=le(F^k,12),q=q+F|0,I=le(I^q,8),k=k+I|0,F=le(F^k,7);let N=0;n[N++]=i+_|0,n[N++]=a+$|0,n[N++]=c+A|0,n[N++]=u+q|0,n[N++]=l+F|0,n[N++]=f+L|0,n[N++]=h+D|0,n[N++]=p+U|0,n[N++]=g+z|0,n[N++]=m+k|0,n[N++]=d+S|0,n[N++]=w+O|0,n[N++]=y+P|0,n[N++]=v+B|0,n[N++]=E+I|0,n[N++]=b+T|0}const Cv=PC(LC,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Pv extends Vw{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,ar.hash(t);const n=ws(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return ar.exists(this),this.iHash.update(t),this}digestInto(t){ar.exists(this),ar.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ac=(e,t,r)=>new Pv(e,t).update(r).digest();ac.create=(e,t)=>new Pv(e,t);function UC(e,t,r){return ar.hash(e),ac(e,ws(r),ws(t))}const hu=new Uint8Array([0]),Km=new Uint8Array;function zC(e,t,r,n=32){if(ar.hash(e),ar.number(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(n/e.outputLen);r===void 0&&(r=Km);const s=new Uint8Array(o*e.outputLen),i=ac.create(e,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)hu[0]=u+1,a.update(u===0?Km:c).update(r).update(hu).digestInto(c),s.set(c,e.outputLen*u),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),hu.fill(0),s.slice(0,n)}var BC=Object.defineProperty,$e=(e,t)=>{for(var r in t)BC(e,r,{get:t[r],enumerable:!0})},so=Symbol("verified"),MC=e=>e instanceof Object;function ad(e){if(!MC(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}var qC={};$e(qC,{Queue:()=>HC,QueueNode:()=>Lv,binarySearch:()=>cd,bytesToHex:()=>it,hexToBytes:()=>Kn,insertEventIntoAscendingList:()=>FC,insertEventIntoDescendingList:()=>DC,normalizeURL:()=>jC,utf8Decoder:()=>Or,utf8Encoder:()=>Kt});var Or=new TextDecoder("utf-8"),Kt=new TextEncoder;function jC(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function DC(e,t){const[r,n]=cd(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return n||e.splice(r,0,t),e}function FC(e,t){const[r,n]=cd(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return n||e.splice(r,0,t),e}function cd(e,t){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?n=o-1:r=o+1}return[r,!1]}var Lv=class{value;next=null;prev=null;constructor(e){this.value=e}},HC=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new Lv(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},VC=class{generateSecretKey(){return Xo.utils.randomPrivateKey()}getPublicKey(t){return it(Xo.getPublicKey(t))}finalizeEvent(t,r){const n=t;return n.pubkey=it(Xo.getPublicKey(r)),n.id=Hi(n),n.sig=it(Xo.sign(Hi(n),r)),n[so]=!0,n}verifyEvent(t){if(typeof t[so]=="boolean")return t[so];const r=Hi(t);if(r!==t.id)return t[so]=!1,!1;try{const n=Xo.verify(t.sig,r,t.pubkey);return t[so]=n,n}catch{return t[so]=!1,!1}}};function ZC(e){if(!ad(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Hi(e){let t=Jn(Kt.encode(ZC(e)));return it(t)}var cc=new VC,KC=cc.generateSecretKey,ud=cc.getPublicKey,dr=cc.finalizeEvent,ld=cc.verifyEvent,Be={};$e(Be,{Application:()=>s6,BadgeAward:()=>tP,BadgeDefinition:()=>XP,BlockedRelaysList:()=>PP,BlossomServerList:()=>jP,BookmarkList:()=>OP,Bookmarksets:()=>WP,Calendar:()=>d6,CalendarEventRSVP:()=>h6,ChannelCreation:()=>jv,ChannelHideMessage:()=>Hv,ChannelMessage:()=>Fv,ChannelMetadata:()=>Dv,ChannelMuteUser:()=>Vv,ChatMessage:()=>rP,ClassifiedListing:()=>c6,ClientAuth:()=>Kv,Comment:()=>fP,CommunitiesList:()=>NP,CommunityDefinition:()=>y6,CommunityPostApproval:()=>vP,Contacts:()=>XC,CreateOrUpdateProduct:()=>t6,CreateOrUpdateStall:()=>e6,Curationsets:()=>JP,Date:()=>l6,DirectMessageRelaysList:()=>MP,DraftClassifiedListing:()=>u6,DraftLong:()=>n6,Emojisets:()=>o6,EncryptedDirectMessage:()=>QC,EventDeletion:()=>eP,FavoriteRelays:()=>UP,FileMessage:()=>oP,FileMetadata:()=>lP,FileServerPreference:()=>qP,Followsets:()=>ZP,ForumThread:()=>nP,GenericRepost:()=>md,Genericlists:()=>KP,GiftWrap:()=>Zv,GroupMetadata:()=>w6,HTTPAuth:()=>gd,Handlerinformation:()=>g6,Handlerrecommendation:()=>m6,Highlights:()=>kP,InterestsList:()=>zP,Interestsets:()=>QP,JobFeedback:()=>EP,JobRequest:()=>bP,JobResult:()=>_P,Label:()=>wP,LightningPubRPC:()=>FP,LiveChatMessage:()=>dP,LiveEvent:()=>i6,LongFormArticle:()=>r6,Metadata:()=>JC,Mutelist:()=>TP,NWCWalletInfo:()=>DP,NWCWalletRequest:()=>Gv,NWCWalletResponse:()=>HP,NormalVideo:()=>iP,NostrConnect:()=>VP,OpenTimestamps:()=>cP,Photo:()=>sP,Pinlist:()=>AP,Poll:()=>uP,PollResponse:()=>RP,PrivateDirectMessage:()=>qv,ProblemTracker:()=>mP,ProfileBadges:()=>YP,PublicChatsList:()=>CP,Reaction:()=>pd,RecommendRelay:()=>YC,RelayList:()=>IP,RelayReview:()=>p6,Relaysets:()=>GP,Report:()=>gP,Reporting:()=>yP,Repost:()=>hd,Seal:()=>Mv,SearchRelaysList:()=>LP,ShortTextNote:()=>Bv,ShortVideo:()=>aP,Time:()=>f6,UserEmojiList:()=>BP,UserStatuses:()=>a6,Voice:()=>hP,VoiceComment:()=>pP,Zap:()=>xP,ZapGoal:()=>$P,ZapRequest:()=>SP,classifyKind:()=>GC,isAddressableKind:()=>dd,isEphemeralKind:()=>zv,isKind:()=>WC,isRegularKind:()=>Uv,isReplaceableKind:()=>fd});function Uv(e){return e<1e4&&e!==0&&e!==3}function fd(e){return e===0||e===3||1e4<=e&&e<2e4}function zv(e){return 2e4<=e&&e<3e4}function dd(e){return 3e4<=e&&e<4e4}function GC(e){return Uv(e)?"regular":fd(e)?"replaceable":zv(e)?"ephemeral":dd(e)?"parameterized":"unknown"}function WC(e,t){const r=t instanceof Array?t:[t];return ad(e)&&r.includes(e.kind)||!1}var JC=0,Bv=1,YC=2,XC=3,QC=4,eP=5,hd=6,pd=7,tP=8,rP=9,nP=11,Mv=13,qv=14,oP=15,md=16,sP=20,iP=21,aP=22,jv=40,Dv=41,Fv=42,Hv=43,Vv=44,cP=1040,Zv=1059,uP=1068,lP=1063,fP=1111,dP=1311,hP=1222,pP=1244,mP=1971,gP=1984,yP=1984,wP=1985,vP=4550,bP=5999,_P=6999,EP=7e3,$P=9041,SP=9734,xP=9735,kP=9802,RP=1018,TP=1e4,AP=10001,IP=10002,OP=10003,NP=10004,CP=10005,PP=10006,LP=10007,UP=10012,zP=10015,BP=10030,MP=10050,qP=10096,jP=10063,DP=13194,FP=21e3,Kv=22242,Gv=23194,HP=23195,VP=24133,gd=27235,ZP=3e4,KP=30001,GP=30002,WP=30003,JP=30004,YP=30008,XP=30009,QP=30015,e6=30017,t6=30018,r6=30023,n6=30024,o6=30030,s6=30078,i6=30311,a6=30315,c6=30402,u6=30403,l6=31922,f6=31923,d6=31924,h6=31925,p6=31987,m6=31989,g6=31990,y6=34550,w6=39e3,v6={};$e(v6,{getHex64:()=>yd,getInt:()=>Wv,getSubscriptionId:()=>b6,matchEventId:()=>_6,matchEventKind:()=>$6,matchEventPubkey:()=>E6});function yd(e,t){let r=t.length+3,n=e.indexOf(`"${t}":`)+r,o=e.slice(n).indexOf('"')+n+1;return e.slice(o,o+64)}function Wv(e,t){let r=t.length,n=e.indexOf(`"${t}":`)+r+3,o=e.slice(n),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function b6(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let r=e.slice(t+7+1).indexOf('"');if(r===-1)return null;let n=t+7+1+r,o=e.slice(n+1,80).indexOf('"');if(o===-1)return null;let s=n+1+o;return e.slice(n+1,s)}function _6(e,t){return t===yd(e,"id")}function E6(e,t){return t===yd(e,"pubkey")}function $6(e,t){return t===Wv(e,"kind")}var S6={};$e(S6,{makeAuthEvent:()=>x6});function x6(e,t){return{kind:Kv,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var k6;try{k6=WebSocket}catch{}var R6;try{R6=WebSocket}catch{}var T6={};$e(T6,{BECH32_REGEX:()=>Jv,Bech32MaxSize:()=>wd,NostrTypeGuard:()=>A6,decode:()=>uc,decodeNostrURI:()=>O6,encodeBytes:()=>fc,naddrEncode:()=>z6,neventEncode:()=>U6,noteEncode:()=>P6,nprofileEncode:()=>L6,npubEncode:()=>C6,nsecEncode:()=>N6});var A6={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},wd=5e3,Jv=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function I6(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function O6(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),uc(e)}catch{return{type:"invalid",data:null}}}function uc(e){let{prefix:t,words:r}=Co.decode(e,wd),n=new Uint8Array(Co.fromWords(r));switch(t){case"nprofile":{let o=pu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:it(o[0][0]),relays:o[1]?o[1].map(s=>Or.decode(s)):[]}}}case"nevent":{let o=pu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:it(o[0][0]),relays:o[1]?o[1].map(s=>Or.decode(s)):[],author:o[2]?.[0]?it(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(it(o[3][0]),16):void 0}}}case"naddr":{let o=pu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Or.decode(o[0][0]),pubkey:it(o[2][0]),kind:parseInt(it(o[3][0]),16),relays:o[1]?o[1].map(s=>Or.decode(s)):[]}}}case"nsec":return{type:t,data:n};case"npub":case"note":return{type:t,data:it(n)};default:throw new Error(`unknown prefix ${t}`)}}function pu(e){let t={},r=e;for(;r.length>0;){let n=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${n}`);t[n]=t[n]||[],t[n].push(s)}return t}function N6(e){return fc("nsec",e)}function C6(e){return fc("npub",Kn(e))}function P6(e){return fc("note",Kn(e))}function lc(e,t){let r=Co.toWords(t);return Co.encode(e,r,wd)}function fc(e,t){return lc(e,t)}function L6(e){let t=vd({0:[Kn(e.pubkey)],1:(e.relays||[]).map(r=>Kt.encode(r))});return lc("nprofile",t)}function U6(e){let t;e.kind!==void 0&&(t=I6(e.kind));let r=vd({0:[Kn(e.id)],1:(e.relays||[]).map(n=>Kt.encode(n)),2:e.author?[Kn(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return lc("nevent",r)}function z6(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let r=vd({0:[Kt.encode(e.identifier)],1:(e.relays||[]).map(n=>Kt.encode(n)),2:[Kn(e.pubkey)],3:[new Uint8Array(t)]});return lc("naddr",r)}function vd(e){let t=[];return Object.entries(e).reverse().forEach(([r,n])=>{n.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),rc(...t)}var B6={};$e(B6,{decrypt:()=>M6,encrypt:()=>Yv});function Yv(e,t,r){const n=e instanceof Uint8Array?it(e):e,o=jo.getSharedSecret(n,"02"+t),s=Xv(o);let i=Uint8Array.from(Kw(16)),a=Kt.encode(r),c=Av(s,i).encrypt(a),u=Br.encode(new Uint8Array(c)),l=Br.encode(new Uint8Array(i.buffer));return`${u}?iv=${l}`}function M6(e,t,r){const n=e instanceof Uint8Array?it(e):e;let[o,s]=r.split("?iv="),i=jo.getSharedSecret(n,"02"+t),a=Xv(i),c=Br.decode(s),u=Br.decode(o),l=Av(a,c).decrypt(u);return Or.decode(l)}function Xv(e){return e.slice(1,33)}var q6={};$e(q6,{NIP05_REGEX:()=>bd,isNip05:()=>j6,isValid:()=>H6,queryProfile:()=>Qv,searchDomain:()=>F6,useFetchImplementation:()=>D6});var bd=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,j6=e=>bd.test(e||""),dc;try{dc=fetch}catch{}function D6(e){dc=e}async function F6(e,t=""){try{const r=`https://${e}/.well-known/nostr.json?name=${t}`,n=await dc(r,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function Qv(e){const t=e.match(bd);if(!t)return null;const[,r="_",n]=t;try{const o=`https://${n}/.well-known/nostr.json?name=${r}`,s=await dc(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const i=await s.json(),a=i.names[r];return a?{pubkey:a,relays:i.relays?.[a]}:null}catch{return null}}async function H6(e,t){const r=await Qv(t);return r?r.pubkey===e:!1}var V6={};$e(V6,{parse:()=>Z6});function Z6(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,n;for(let o=e.tags.length-1;o>=0;o--){const s=e.tags[o];if(s[0]==="e"&&s[1]){const[i,a,c,u,l]=s,f={id:a,relays:c?[c]:[],author:l};if(u==="root"){t.root=f;continue}if(u==="reply"){t.reply=f;continue}if(u==="mention"){t.mentions.push(f);continue}r?n=f:r=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[i,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=n||r||t.reply),t.reply||(t.reply=r||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{o.relays?.indexOf(a)===-1&&o.relays.push(a)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var K6={};$e(K6,{fetchRelayInformation:()=>W6,useFetchImplementation:()=>G6});var eb;try{eb=fetch}catch{}function G6(e){eb=e}async function W6(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var J6={};$e(J6,{fastEventHash:()=>rb,getPow:()=>tb,minePow:()=>Y6});function tb(e){let t=0;for(let r=0;r<64;r+=8){const n=parseInt(e.substring(r,r+8),16);if(n===0)t+=32;else{t+=Math.clz32(n);break}}return t}function Y6(e,t){let r=0;const n=e,o=["nonce",r.toString(),t.toString()];for(n.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==n.created_at&&(r=0,n.created_at=s),o[1]=(++r).toString(),n.id=rb(n),tb(n.id)>=t)break}return n}function rb(e){return it(Jn(Kt.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var X6={};$e(X6,{unwrapEvent:()=>lL,unwrapManyEvents:()=>fL,wrapEvent:()=>mb,wrapManyEvents:()=>uL});var Q6={};$e(Q6,{createRumor:()=>fb,createSeal:()=>db,createWrap:()=>hb,unwrapEvent:()=>xd,unwrapManyEvents:()=>pb,wrapEvent:()=>ga,wrapManyEvents:()=>aL});var eL={};$e(eL,{decrypt:()=>Sd,encrypt:()=>$d,getConversationKey:()=>_d,v2:()=>sL});var nb=1,ob=65535;function _d(e,t){const r=jo.getSharedSecret(e,"02"+t).subarray(1,33);return UC(Jn,r,"nip44-v2")}function sb(e,t){const r=zC(Jn,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function Ed(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function tL(e){if(!Number.isSafeInteger(e)||e<nb||e>ob)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function rL(e){const t=Kt.encode(e),r=t.length,n=tL(r),o=new Uint8Array(Ed(r)-r);return rc(n,t,o)}function nL(e){const t=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+t);if(t<nb||t>ob||r.length!==t||e.length!==2+Ed(t))throw new Error("invalid padding");return Or.decode(r)}function ib(e,t,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=rc(r,t);return ac(Jn,e,n)}function oL(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=Br.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const n=r.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function $d(e,t,r=Kw(32)){const{chacha_key:n,chacha_nonce:o,hmac_key:s}=sb(t,r),i=rL(e),a=Cv(n,o,i),c=ib(s,a,r);return Br.encode(rc(new Uint8Array([2]),r,a,c))}function Sd(e,t){const{nonce:r,ciphertext:n,mac:o}=oL(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=sb(t,r),c=ib(a,n,r);if(!yC(c,o))throw new Error("invalid MAC");const u=Cv(s,i,n);return nL(u)}var sL={utils:{getConversationKey:_d,calcPaddedLen:Ed},encrypt:$d,decrypt:Sd},iL=2880*60,ab=()=>Math.round(Date.now()/1e3),cb=()=>Math.round(ab()-Math.random()*iL),ub=(e,t)=>_d(e,t),lb=(e,t,r)=>$d(JSON.stringify(e),ub(t,r)),Gm=(e,t)=>JSON.parse(Sd(e.content,ub(t,e.pubkey)));function fb(e,t){const r={created_at:ab(),content:"",tags:[],...e,pubkey:ud(t)};return r.id=Hi(r),r}function db(e,t,r){return dr({kind:Mv,content:lb(e,t,r),created_at:cb(),tags:[]},t)}function hb(e,t){const r=KC();return dr({kind:Zv,content:lb(e,r,t),created_at:cb(),tags:[["p",t]]},r)}function ga(e,t,r){const n=fb(e,t),o=db(n,t,r);return hb(o,r)}function aL(e,t,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const n=ud(t),o=[ga(e,t,n)];return r.forEach(s=>{o.push(ga(e,t,s))}),o}function xd(e,t){const r=Gm(e,t);return Gm(r,t)}function pb(e,t){let r=[];return e.forEach(n=>{r.push(xd(n,t))}),r.sort((n,o)=>n.created_at-o.created_at),r}function cL(e,t,r,n){const o={created_at:Math.ceil(Date.now()/1e3),kind:qv,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),n&&o.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&o.tags.push(["subject",r]),o}function mb(e,t,r,n,o){const s=cL(t,r,n,o);return ga(s,e,t.publicKey)}function uL(e,t,r,n,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:ud(e)},...t].map(i=>mb(e,i,r,n,o))}var lL=xd,fL=pb,dL={};$e(dL,{finishRepostEvent:()=>hL,getRepostedEvent:()=>pL,getRepostedEventPointer:()=>gb});function hL(e,t,r,n){let o;const s=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===Bv?o=hd:(o=md,s.push(["k",String(t.kind)])),dr({kind:o,tags:s,content:e.content===""||t.tags?.find(i=>i[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},n)}function gb(e){if(![hd,md].includes(e.kind))return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(t!==void 0)return{id:t[1],relays:[t[2],r?.[2]].filter(n=>typeof n=="string"),author:r?.[1]}}function pL(e,{skipVerification:t}={}){const r=gb(e);if(r===void 0||e.content==="")return;let n;try{n=JSON.parse(e.content)}catch{return}if(n.id===r.id&&!(!t&&!ld(n)))return n}var mL={};$e(mL,{NOSTR_URI_REGEX:()=>kd,parse:()=>yL,test:()=>gL});var kd=new RegExp(`nostr:(${Jv.source})`);function gL(e){return typeof e=="string"&&new RegExp(`^${kd.source}$`).test(e)}function yL(e){const t=e.match(new RegExp(`^${kd.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:uc(t[1])}}var wL={};$e(wL,{finishReactionEvent:()=>vL,getReactedEventPointer:()=>bL});function vL(e,t,r){const n=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return dr({...e,kind:pd,tags:[...e.tags??[],...n,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function bL(e){if(e.kind!==pd)return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(t===void 0||r===void 0))return{id:t[1],relays:[t[2],r[2]].filter(n=>n!==void 0),author:r[1]}}var _L={};$e(_L,{parse:()=>$L});var Wm=/\W/m,Jm=/[^\w\/] |[^\w\/]$|$|,| /m,EL=42;function*$L(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){const i=e.tags[s];i[0]==="emoji"&&i.length>=3&&t.push({type:"emoji",shortcode:i[1],url:i[2]})}e=e.content}const r=e.length;let n=0,o=0;e:for(;o<r;){const s=e.indexOf(":",o),i=e.indexOf("#",o);if(s===-1&&i===-1)break e;if(s===-1||i>=0&&i<s){if(i===0||e[i-1]===" "){const a=e.slice(i+1,i+EL).match(Wm),c=a?i+1+a.index:r;yield{type:"text",text:e.slice(n,i)},yield{type:"hashtag",value:e.slice(i+1,c)},o=c,n=o;continue e}o=i+1;continue e}if(e.slice(s-5,s)==="nostr"){const a=e.slice(s+60).match(Wm),c=a?s+60+a.index:r;try{let u,{data:l,type:f}=uc(e.slice(s+1,c));switch(f){case"npub":u={pubkey:l};break;case"note":u={id:l};break;case"nsec":o=c+1;continue;default:u=l}n!==s-5&&(yield{type:"text",text:e.slice(n,s-5)}),yield{type:"reference",pointer:u},o=c,n=o;continue e}catch{o=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){const a=e.slice(s+4).match(Jm),c=a?s+4+a.index:r,u=e[s-1]==="s"?5:4;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(l.pathname)){yield{type:"image",url:l.toString()},o=c,n=o;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(l.pathname)){yield{type:"video",url:l.toString()},o=c,n=o;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(l.pathname)){yield{type:"audio",url:l.toString()},o=c,n=o;continue e}yield{type:"url",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){const a=e.slice(s+4).match(Jm),c=a?s+4+a.index:r,u=e[s-1]==="s"?3:2;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),yield{type:"relay",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else{for(let a=0;a<t.length;a++){const c=t[a];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){n!==s&&(yield{type:"text",text:e.slice(n,s)}),yield c,o=s+c.shortcode.length+2,n=o;continue e}}o=s+1;continue e}}n!==r&&(yield{type:"text",text:e.slice(n)})}var SL={};$e(SL,{channelCreateEvent:()=>xL,channelHideMessageEvent:()=>TL,channelMessageEvent:()=>RL,channelMetadataEvent:()=>kL,channelMuteUserEvent:()=>AL});var xL=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return dr({kind:jv,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},kL=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return dr({kind:Dv,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},RL=(e,t)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),dr({kind:Fv,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},TL=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return dr({kind:Hv,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},AL=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return dr({kind:Vv,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)},IL={};$e(IL,{EMOJI_SHORTCODE_REGEX:()=>yb,matchAll:()=>OL,regex:()=>Rd,replaceAll:()=>NL});var yb=/:(\w+):/,Rd=()=>new RegExp(`\\B${yb.source}\\B`,"g");function*OL(e){const t=e.matchAll(Rd());for(const r of t)try{const[n,o]=r;yield{shortcode:n,name:o,start:r.index,end:r.index+n.length}}catch{}}function NL(e,t){return e.replaceAll(Rd(),(r,n)=>t({shortcode:r,name:n}))}var CL={};$e(CL,{useFetchImplementation:()=>PL,validateGithub:()=>LL});var Td;try{Td=fetch}catch{}function PL(e){Td=e}async function LL(e,t,r){try{return await(await Td(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var UL={};$e(UL,{makeNwcRequestEvent:()=>BL,parseConnectionString:()=>zL});function zL(e){const{host:t,pathname:r,searchParams:n}=new URL(e),o=r||t,s=n.get("relay"),i=n.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function BL(e,t,r){const o=Yv(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),s={kind:Gv,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return dr(s,t)}var ML={};$e(ML,{normalizeIdentifier:()=>qL});function qL(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var jL={};$e(jL,{getSatoshisAmountFromBolt11:()=>KL,getZapEndpoint:()=>FL,makeZapReceipt:()=>ZL,makeZapRequest:()=>HL,useFetchImplementation:()=>DL,validateZapRequest:()=>VL});var Ad;try{Ad=fetch}catch{}function DL(e){Ad=e}async function FL(e){try{let t="",{lud06:r,lud16:n}=JSON.parse(e.content);if(n){let[i,a]=n.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else if(r){let{words:i}=Co.decode(r,1e3),a=Co.fromWords(i);t=Or.decode(a)}else return null;let s=await(await Ad(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function HL(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),fd(e.event.kind)){const r=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(r)}else if(dd(e.event.kind)){let r=e.event.tags.find(([o,s])=>o==="d"&&s);if(!r)throw new Error("d tag not found or is empty");const n=["a",`${e.event.kind}:${e.event.pubkey}:${r[1]}`];t.tags.push(n)}t.tags.push(["k",e.event.kind.toString()])}return t}function VL(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!ad(t))return"Zap request is not a valid Nostr event.";if(!ld(t))return"Invalid signature on zap request.";let r=t.tags.find(([s,i])=>s==="p"&&i);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=t.tags.find(([s,i])=>s==="e"&&i);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function ZL({zapRequest:e,preimage:t,bolt11:r,paidAt:n}){let o=JSON.parse(e),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return t&&i.tags.push(["preimage",t]),i}function KL(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;const n=r.substring(4);if(n.length<1)return 0;const o=n[n.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9;let a=n.length-1;if(i&&a++,a<1)return 0;const c=parseInt(n.substring(0,a));switch(o){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var GL={};$e(GL,{Negentropy:()=>vb,NegentropyStorageVector:()=>YL,NegentropySync:()=>XL});var mu=97,bo=32,wb=16,In={Skip:0,Fingerprint:1,IdList:2},Tr=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof Tr&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");const r=t.length+this.length;if(this.capacity<r){const n=this._raw,o=Math.max(this.capacity*2,r);this._raw=new Uint8Array(o),this._raw.set(n)}this._raw.set(t,this.length),this.length+=t.length}shift(){const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){const r=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,r}};function Ti(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let r=e.shift();if(t=t<<7|r&127,(r&128)===0)break}return t}function Er(e){if(e===0)return new Tr(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let r=0;r<t.length-1;r++)t[r]|=128;return new Tr(new Uint8Array(t))}function WL(e){return Vi(e,1)[0]}function Vi(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var JL=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(bo)}add(t){let r=0,n=0,o=new DataView(this.buf.buffer),s=new DataView(t.buffer);for(let i=0;i<8;i++){let a=i*4,c=o.getUint32(a,!0),u=s.getUint32(a,!0),l=c;l+=r,l+=u,l>4294967295&&(n=1),o.setUint32(a,l&4294967295,!0),r=n,n=0}}negate(){let t=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let o=n*4;t.setUint32(o,~t.getUint32(o,!0))}let r=new Uint8Array(bo);r[0]=1,this.add(r)}getFingerprint(t){let r=new Tr;return r.extend(this.buf),r.extend(Er(t)),Jn(r.unwrap()).subarray(0,wb)}},YL=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,r){if(this.sealed)throw Error("already sealed");const n=Sv(r);if(n.byteLength!==bo)throw Error("bad id size for added item");this.items.push({timestamp:t,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(gu);for(let t=1;t<this.items.length;t++)if(gu(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,r,n){this._checkSealed(),this._checkBounds(t,r);for(let o=t;o<r&&n(this.items[o],o);++o);}findLowerBound(t,r,n){return this._checkSealed(),this._checkBounds(t,r),this._binarySearch(this.items,t,r,o=>gu(o,n)<0)}fingerprint(t,r){let n=new JL;return n.setToZero(),this.iterate(t,r,o=>(n.add(o.id),!0)),n.getFingerprint(r-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,r){if(t>r||r>this.items.length)throw Error("bad range")}_binarySearch(t,r,n,o){let s=n-r;for(;s>0;){let i=r,a=Math.floor(s/2);i+=a,o(t[i])?(r=++i,s-=a+1):s=a}return r}},vb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,r=6e4){if(r<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=r,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,r){return{timestamp:t,id:r||new Uint8Array(0)}}initiate(){let t=new Tr;return t.extend(new Uint8Array([mu])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),oo(t.unwrap())}reconcile(t,r,n){const o=new Tr(Sv(t));this.lastTimestampIn=this.lastTimestampOut=0;let s=new Tr;s.extend(new Uint8Array([mu]));let i=WL(o);if(i<96||i>111)throw Error("invalid negentropy protocol version byte");if(i!==mu)throw Error("unsupported negentropy protocol version requested: "+(i-96));let a=this.storage.size(),c=this._bound(0),u=0,l=!1;for(;o.length!==0;){let f=new Tr,h=()=>{l&&(l=!1,f.extend(this.encodeBound(c)),f.extend(Er(In.Skip)))},p=this.decodeBound(o),g=Ti(o),m=u,d=this.storage.findLowerBound(u,a,p);if(g===In.Skip)l=!0;else if(g===In.Fingerprint){let w=Vi(o,wb),y=this.storage.fingerprint(m,d);bb(w,y)!==0?(h(),this.splitRange(m,d,p,f)):l=!0}else if(g===In.IdList){let w=Ti(o),y={};for(let v=0;v<w;v++){let E=Vi(o,bo);y[oo(E)]=E}if(l=!0,this.storage.iterate(m,d,v=>{let E=v.id;const b=oo(E);return y[b]?delete y[oo(E)]:r?.(b),!0}),n)for(let v of Object.values(y))n(oo(v))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(s.length+f.length)){let w=this.storage.fingerprint(d,a);s.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),s.extend(Er(In.Fingerprint)),s.extend(w);break}else s.extend(f);u=d,c=p}return s.length===1?null:oo(s.unwrap())}splitRange(t,r,n,o){let s=r-t,i=16;if(s<i*2)o.extend(this.encodeBound(n)),o.extend(Er(In.IdList)),o.extend(Er(s)),this.storage.iterate(t,r,a=>(o.extend(a.id),!0));else{let a=Math.floor(s/i),c=s%i,u=t;for(let l=0;l<i;l++){let f=a+(l<c?1:0),h=this.storage.fingerprint(u,u+f);u+=f;let p;if(u===r)p=n;else{let g,m;this.storage.iterate(u-1,u+1,(d,w)=>(w===u-1?g=d:m=d,!0)),p=this.getMinimalBound(g,m)}o.extend(this.encodeBound(p)),o.extend(Er(In.Fingerprint)),o.extend(h)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let r=Ti(t);return r=r===0?Number.MAX_VALUE:r-1,this.lastTimestampIn===Number.MAX_VALUE||r===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(r+=this.lastTimestampIn,this.lastTimestampIn=r,r)}decodeBound(t){let r=this.decodeTimestampIn(t),n=Ti(t);if(n>bo)throw Error("bound key too long");let o=Vi(t,n);return{timestamp:r,id:o}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Er(0);let r=t;return t-=this.lastTimestampOut,this.lastTimestampOut=r,Er(t+1)}encodeBound(t){let r=new Tr;return r.extend(this.encodeTimestampOut(t.timestamp)),r.extend(Er(t.id.length)),r.extend(t.id),r}getMinimalBound(t,r){if(r.timestamp!==t.timestamp)return this._bound(r.timestamp);{let n=0,o=r.id,s=t.id;for(let i=0;i<bo&&o[i]===s[i];i++)n++;return this._bound(r.timestamp,r.id.subarray(0,n+1))}}};function bb(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function gu(e,t){return e.timestamp===t.timestamp?bb(e.id,t.id):e.timestamp-t.timestamp}var XL=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,r,n,o={}){this.relay=t,this.storage=r,this.neg=new vb(r),this.onhave=o.onhave,this.onneed=o.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:o.label||"negentropy"}),this.subscription.oncustom=s=>{switch(s[0]){case"NEG-MSG":{s.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${s}`);try{const i=this.neg.reconcile(s[2],this.onhave,this.onneed);i?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${i}"]`):(this.close(),o.onclose?.())}catch(i){console.error("negentropy reconcile error:",i),o?.onclose?.(`reconcile error: ${i}`)}break}case"NEG-CLOSE":{const i=s[2];console.warn("negentropy error:",i),o.onclose?.(i);break}case"NEG-ERR":o.onclose?.()}}}async start(){const t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},QL={};$e(QL,{getToken:()=>e8,hashPayload:()=>Id,unpackEventFromToken:()=>Eb,validateEvent:()=>Tb,validateEventKind:()=>Sb,validateEventMethodTag:()=>kb,validateEventPayloadTag:()=>Rb,validateEventTimestamp:()=>$b,validateEventUrlTag:()=>xb,validateToken:()=>t8});var _b="Nostr ";async function e8(e,t,r,n=!1,o){const s={kind:gd,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Id(o)]);const i=await r(s);return(n?_b:"")+Br.encode(Kt.encode(JSON.stringify(i)))}async function t8(e,t,r){const n=await Eb(e).catch(s=>{throw s});return await Tb(n,t,r).catch(s=>{throw s})}async function Eb(e){if(!e)throw new Error("Missing token");e=e.replace(_b,"");const t=Or.decode(Br.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function $b(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Sb(e){return e.kind===gd}function xb(e,t){const r=e.tags.find(n=>n[0]==="u");return r?r.length>0&&r[1]===t:!1}function kb(e,t){const r=e.tags.find(n=>n[0]==="method");return r?r.length>0&&r[1].toLowerCase()===t.toLowerCase():!1}function Id(e){const t=Jn(Kt.encode(JSON.stringify(e)));return it(t)}function Rb(e,t){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const n=Id(t);return r.length>0&&r[1]===n}async function Tb(e,t,r,n){if(!ld(e))throw new Error("Invalid nostr event, signature invalid");if(!Sb(e))throw new Error("Invalid nostr event, kind invalid");if(!$b(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!xb(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!kb(e,r))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!Rb(e,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function r8(e){return e===0||e===3||1e4<=e&&e<2e4}function n8(e){return 3e4<=e&&e<4e4}new TextDecoder("utf-8");new TextEncoder;function yu(e,t){const[r,n]=Zi(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return n||e.splice(r,0,t),e}function Zi(e,t){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?n=o-1:r=o+1}return[r,!1]}function Ym(e){return r8(e)||n8(e)}function es(e,t,r){return e+":"+t+":"+(r??"")}function o8(e,t="https:"){return/^[a-zA-Z][a-zA-Z0-9+.-]+:/.test(e)?e:t+"//"+e}function Xm(e){const t=typeof e=="string"?new URL(o8(e,"http:")):new URL(e);return t.protocol==="ws:"?t.protocol="http:":(t.protocol==="wss:"||t.protocol!=="http:")&&(t.protocol="https:"),typeof e=="string"?t.toString():t}const Qm=Symbol.for("seen-relays");function s8(e,t){let r=Reflect.get(e,Qm);return r?(r.add(t),r):(r=new Set([t]),Reflect.set(e,Qm,r),r)}cf();const eg="abcdefghijklmnopqrstuvwxyz",El=new Set((eg+eg.toUpperCase()).split("")),tg=Symbol.for("indexable-tags");function wu(e){let t=Reflect.get(e,tg);if(!t){const r=new Set;for(const n of e.tags)n.length>=2&&n[0].length===1&&El.has(n[0])&&r.add(n[0]+":"+n[1]);t=r,Reflect.set(e,tg,r)}return t}class rg{first=null;items=Object.create(null);last=null;max;resetTtl;size;ttl;constructor(t=0,r=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=n,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const r=this.items[t];delete this.items[t],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(t=this.keys()){return t.map(r=>[r,this.get(r)])}evict(t=!1){if(t||this.size>0){const r=this.first;delete this.items[r.key],--this.size===0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(t){let r;return this.has(t)&&(r=this.items[t].expiry),r}get(t){let r;if(this.has(t)){const n=this.items[t];this.ttl>0&&n.expiry<=Date.now()?this.delete(t):(r=n.value,this.set(t,r,!0))}return r}has(t){return t in this.items}keys(){const t=[];let r=this.first;for(;r!==null;)t.push(r.key),r=r.next;return t}set(t,r,n=!1,o=this.resetTtl){let s;if(n||this.has(t)){if(s=this.items[t],s.value=r,n===!1&&o&&(s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==s){const i=this.last,a=s.next,c=s.prev;this.first===s&&(this.first=s.next),s.next=null,s.prev=this.last,i.next=s,c!==null&&(c.next=a),a!==null&&(a.prev=c)}}else this.max>0&&this.size===this.max&&this.evict(!0),s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r},++this.size===1?this.first=s:this.last.next=s;return this.last=s,this}values(t=this.keys()){return t.map(r=>this.get(r))}}var Ai={exports:{}},vu,ng;function i8(){if(ng)return vu;ng=1;var e=1e3,t=e*60,r=t*60,n=r*24,o=n*7,s=n*365.25;vu=function(l,f){f=f||{};var h=typeof l;if(h==="string"&&l.length>0)return i(l);if(h==="number"&&isFinite(l))return f.long?c(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function i(l){if(l=String(l),!(l.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(f){var h=parseFloat(f[1]),p=(f[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*o;case"days":case"day":case"d":return h*n;case"hours":case"hour":case"hrs":case"hr":case"h":return h*r;case"minutes":case"minute":case"mins":case"min":case"m":return h*t;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(l){var f=Math.abs(l);return f>=n?Math.round(l/n)+"d":f>=r?Math.round(l/r)+"h":f>=t?Math.round(l/t)+"m":f>=e?Math.round(l/e)+"s":l+"ms"}function c(l){var f=Math.abs(l);return f>=n?u(l,f,n,"day"):f>=r?u(l,f,r,"hour"):f>=t?u(l,f,t,"minute"):f>=e?u(l,f,e,"second"):l+" ms"}function u(l,f,h,p){var g=f>=h*1.5;return Math.round(l/h)+" "+p+(g?"s":"")}return vu}var bu,og;function a8(){if(og)return bu;og=1;function e(t){n.debug=n,n.default=n,n.coerce=u,n.disable=a,n.enable=s,n.enabled=c,n.humanize=i8(),n.destroy=l,Object.keys(t).forEach(f=>{n[f]=t[f]}),n.names=[],n.skips=[],n.formatters={};function r(f){let h=0;for(let p=0;p<f.length;p++)h=(h<<5)-h+f.charCodeAt(p),h|=0;return n.colors[Math.abs(h)%n.colors.length]}n.selectColor=r;function n(f){let h,p=null,g,m;function d(...w){if(!d.enabled)return;const y=d,v=Number(new Date),E=v-(h||v);y.diff=E,y.prev=h,y.curr=v,h=v,w[0]=n.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let b=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,($,A)=>{if($==="%%")return"%";b++;const q=n.formatters[A];if(typeof q=="function"){const F=w[b];$=q.call(y,F),w.splice(b,1),b--}return $}),n.formatArgs.call(y,w),(y.log||n.log).apply(y,w)}return d.namespace=f,d.useColors=n.useColors(),d.color=n.selectColor(f),d.extend=o,d.destroy=n.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(g!==n.namespaces&&(g=n.namespaces,m=n.enabled(f)),m),set:w=>{p=w}}),typeof n.init=="function"&&n.init(d),d}function o(f,h){const p=n(this.namespace+(typeof h>"u"?":":h)+f);return p.log=this.log,p}function s(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];const h=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const p of h)p[0]==="-"?n.skips.push(p.slice(1)):n.names.push(p)}function i(f,h){let p=0,g=0,m=-1,d=0;for(;p<f.length;)if(g<h.length&&(h[g]===f[p]||h[g]==="*"))h[g]==="*"?(m=g,d=p,g++):(p++,g++);else if(m!==-1)g=m+1,d++,p=d;else return!1;for(;g<h.length&&h[g]==="*";)g++;return g===h.length}function a(){const f=[...n.names,...n.skips.map(h=>"-"+h)].join(",");return n.enable(""),f}function c(f){for(const h of n.skips)if(i(f,h))return!1;for(const h of n.names)if(i(f,h))return!0;return!1}function u(f){return f instanceof Error?f.stack||f.message:f}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}return bu=e,bu}var sg;function c8(){return sg||(sg=1,(function(e,t){var r={};t.formatArgs=o,t.save=s,t.load=i,t.useColors=n,t.storage=a(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let f=0,h=0;u[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(f++,p==="%c"&&(h=f))}),u.splice(h,0,l)}t.log=console.debug||console.log||(()=>{});function s(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}function i(){let u;try{u=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=r.DEBUG),u}function a(){try{return localStorage}catch{}}e.exports=a8()(t);const{formatters:c}=e.exports;c.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Ai,Ai.exports)),Ai.exports}var u8=c8();const l8=Pa(u8),Od=l8("applesauce");class ig{log=Od.extend("EventMemory");kinds=new Map;authors=new Map;tags=new rg;created_at=[];kindAuthor=new Map;events=new rg;replaceable=new Map;get size(){return this.events.size}hasEvent(t){return this.events.has(t)}getEvent(t){return this.events.get(t)}hasReplaceable(t,r,n){const o=this.replaceable.get(es(t,r,n));return!!o&&o.length>0}getReplaceable(t,r,n){const o=es(t,r,n);return this.replaceable.get(o)?.[0]}getReplaceableHistory(t,r,n){const o=es(t,r,n);return this.replaceable.get(o)}getByFilters(t){return Array.from(this.getEventsForFilters(Array.isArray(t)?t:[t]))}getTimeline(t){const r=[],n=this.getByFilters(t);for(const o of n)yu(r,o);return r}add(t){const r=t.id,n=this.events.get(r);if(n)return n;this.events.set(r,t),this.getKindIndex(t.kind).add(t),this.getAuthorsIndex(t.pubkey).add(t),this.getKindAuthorIndex(t.kind,t.pubkey).add(t);for(const o of wu(t))this.tags.has(o)&&this.getTagIndex(o).add(t);if(yu(this.created_at,t),Ym(t.kind)){const o=t.tags.find(a=>a[0]==="d")?.[1],s=es(t.kind,t.pubkey,o);let i=this.replaceable.get(s);this.replaceable.has(s)||(i=[],this.replaceable.set(s,i)),yu(i,t)}return t}remove(t){let r=typeof t=="string"?this.events.get(t):t;if(!r)return!1;const n=r.id;if(!this.events.has(n))return!1;this.getAuthorsIndex(r.pubkey).delete(r),this.getKindIndex(r.kind).delete(r);const o=`${r.kind}:${r.pubkey}`;this.kindAuthor.has(o)&&this.kindAuthor.get(o).delete(r);for(const s of wu(r))this.tags.has(s)&&this.getTagIndex(s).delete(r);if(this.removeFromSortedArray(this.created_at,r),this.events.delete(n),Ym(r.kind)){const s=r.tags.find(c=>c[0]==="d")?.[1],i=es(r.kind,r.pubkey,s),a=this.replaceable.get(i);a&&this.removeFromSortedArray(a,r)}return this.claims.delete(r),!0}removeByFilters(t){const r=this.getByFilters(t);let n=0;for(const o of r)this.remove(o)&&n++;return n}update(t){}claims=new WeakMap;touch(t){this.events.has(t.id)&&this.events.set(t.id,t)}claim(t){const r=this.claims.get(t)||0;this.claims.set(t,r+1),this.touch(t)}isClaimed(t){const r=this.claims.get(t);return r!==void 0&&r>0}removeClaim(t){const r=this.claims.get(t);if(r!==void 0&&r>0){const n=r-1;n===0?this.claims.delete(t):this.claims.set(t,n)}}clearClaim(t){this.claims.delete(t)}*unclaimed(){let t=0,r=this.events.first;for(;r;){const n=r.value;this.isClaimed(n)||(yield n),r=r.next}return t}prune(t){let r=0;const n=this.unclaimed();for(const o of n)if(this.remove(o),r++,t&&r>=t)break;return r}getKindIndex(t){return this.kinds.has(t)||this.kinds.set(t,new Set),this.kinds.get(t)}getAuthorsIndex(t){return this.authors.has(t)||this.authors.set(t,new Set),this.authors.get(t)}getKindAuthorIndex(t,r){const n=`${t}:${r}`;return this.kindAuthor.has(n)||this.kindAuthor.set(n,new Set),this.kindAuthor.get(n)}getTagIndex(t){if(!this.tags.has(t)){const r=new Set,n=Date.now();for(const s of this.events.values())wu(s).has(t)&&r.add(s);const o=Date.now()-n;o>100&&this.log(`Built index ${t} took ${o}ms`),this.tags.set(t,r)}return this.tags.get(t)}removeFromSortedArray(t,r){if(t.length===0)return;const n=Zi(t,s=>s.created_at-r.created_at);if(n){let s=n[0],i=!1;if(t[s]===r){t.splice(s,1);return}for(let a=s-1;a>=0&&t[a].created_at===r.created_at;a--)if(t[a]===r){t.splice(a,1),i=!0;break}if(i)return;for(let a=s+1;a<t.length&&t[a].created_at===r.created_at;a++)if(t[a]===r){t.splice(a,1);return}}const o=t.indexOf(r);o!==-1&&t.splice(o,1)}*iterateAuthors(t){for(const r of t){const n=this.authors.get(r);if(n)for(const o of n)yield o}}*iterateTag(t,r){for(const n of r){const o=this.getTagIndex(t+":"+n);if(o)for(const s of o)yield s}}*iterateKinds(t){for(const r of t){const n=this.kinds.get(r);if(n)for(const o of n)yield o}}*iterateTime(t,r){if(this.created_at.length===0)return;let n=0,o=this.created_at.length-1,s=r?Zi(this.created_at,a=>a.created_at-r):void 0;s&&(n=Math.max(0,Math.min(s[0],this.created_at.length-1)));const i=t?Zi(this.created_at,a=>a.created_at-t):void 0;if(i&&(o=Math.max(0,Math.min(i[0],this.created_at.length-1))),!(n>o))for(let a=n;a<=o;a++){const c=this.created_at[a];if(!(r!==void 0&&c.created_at>r)){if(t!==void 0&&c.created_at<t)break;yield c}}}*iterateIds(t){for(const r of t)this.events.has(r)&&(yield this.events.get(r))}getEventsForFilter(t){if(t.search)return new Set;let r=!0,n=new Set;const o=i=>{const a=i instanceof Set?i:new Set(i);if(r)n=a,r=!1;else for(const c of n)a.has(c)||n.delete(c);return n};t.ids&&o(this.iterateIds(t.ids));let s=null;t.since!==void 0&&(s=Array.from(this.iterateTime(t.since,t.until)),o(s));for(const i of El){const a=`&${i}`,c=t[a];if(c?.length)for(const u of c)o(this.iterateTag(i,[u]))}for(const i of El){const a=`#${i}`,c=t[a];if(c?.length){const u=`&${i}`,l=t[u],f=l?c.filter(h=>!l.includes(h)):c;f.length>0&&o(this.iterateTag(i,f))}}if(t.authors&&t.kinds&&t.authors.length*t.kinds.length<=20){const i=new Set;for(const a of t.kinds)for(const c of t.authors){const u=`${a}:${c}`,l=this.kindAuthor.get(u);if(l)for(const f of l)i.add(f)}o(i)}else t.authors&&o(this.iterateAuthors(t.authors)),t.kinds&&o(this.iterateKinds(t.kinds));if(t.since===void 0&&t.until!==void 0&&(s=Array.from(this.iterateTime(t.since,t.until)),o(s)),r)return new Set(this.events.values());if(t.limit&&s){const i=new Set;for(const a of s){if(i.size>=t.limit)break;n.has(a)&&i.add(a)}return i}return n}getEventsForFilters(t){if(t.length===0)return new Set;let r=new Set;for(const n of t){const o=this.getEventsForFilter(n);for(const s of o)r.add(s)}return r}reset(){this.events.clear(),this.kinds.clear(),this.authors.clear(),this.kindAuthor.clear(),this.tags.clear(),this.created_at=[],this.replaceable.clear(),this.claims=new WeakMap}}const f8={[Be.EncryptedDirectMessage]:"nip04",[Be.Seal]:"nip44",[Be.GiftWrap]:"nip44"};function Ab(e,t){return f8[e]=t,e}const d8=new Set([Ab(Be.DraftLong,"nip04")]);function Ct(e,t){return d8.add(Ab(e,t)),e}const h8=10009;Ct(Be.BookmarkList,"nip04"),Ct(Be.InterestsList,"nip04"),Ct(Be.Mutelist,"nip04"),Ct(Be.CommunitiesList,"nip04"),Ct(Be.PublicChatsList,"nip04"),Ct(Be.SearchRelaysList,"nip04"),Ct(h8,"nip04"),Ct(Be.Bookmarksets,"nip04"),Ct(Be.Relaysets,"nip04"),Ct(Be.Followsets,"nip04"),Ct(Be.Curationsets,"nip04"),Ct(Be.Interestsets,"nip04");function Ib(e,t=!0){return r=>{const n=r.pipe(De());return n.pipe(vs(o=>{if(typeof o=="string")return sc;const s=e.add(o);return s instanceof Promise?Zt(s):ht(s)}),Rr(()=>ht(null)),nt(o=>o!==null),t?rC():pt,vv(n.pipe(nt(o=>typeof o=="string"))))}}function _u(e){return Ib(e,!0)}class p8 extends Error{}function Eu(e,t){return qn({first:e,with:()=>qi(()=>new p8("Timeout"))})}const m8="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let as=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=m8[r[e]&63];return t};function $l(e){return bv(t=>t!=="EOSE",e)}function g8(){return e=>e.pipe(nt(t=>t!=="EOSE"))}function y8(e){return Ee((t,r)=>{let n=null,o=0,s=!1;const i=()=>{s&&!n&&r.complete()};t.subscribe(ve(r,a=>{const c=o++,u=n,l=n=ve(r,f=>r.next(f),()=>{(n===l||n===null)&&(n=null,i())});Zt(e(a,c)).subscribe(n),u?.unsubscribe()},()=>{s=!0,i()}))})}function w8(e){return Rr(t=>ht({ok:!1,from:e.url,message:t?.message||"Unknown error"}))}class $u{relays$=new rt([]);status$;get relays(){if(this.relays$ instanceof rt)return this.relays$.value;throw new Error("This group was created with an observable, relays are not available")}constructor(t){this.relays$=Array.isArray(t)?new rt(t):t,this.status$=this.relays$.pipe(Ht(r=>r.length===0?ht({}):xt(...r.map(n=>n.status$)).pipe(ml((n,o)=>({...n,[o.url]:o}),{}),oC({}))),gl(1))}get controlled(){return!(this.relays$ instanceof rt)}has(t){if(this.controlled)throw new Error("This group was created with an observable, relays are not available");return typeof t=="string"?this.relays.some(r=>r.url===t):this.relays.includes(t)}add(t){this.has(t)||this.relays$.next([...this.relays,t])}remove(t){this.has(t)&&this.relays$.next(this.relays.filter(r=>r!==t))}internalSubscription(t,r=pt){const n=new WeakMap,o=this.relays$.pipe(y8(a=>{const c=[];for(const u of a){if(n.has(u)){c.push(n.get(u));continue}const l=t(u).pipe(Rr(()=>ht("EOSE")),We(f=>[u,f]));c.push(l),n.set(u,l)}return xt(...c)}),De()),s=o.pipe(We(([a,c])=>c),g8(),r),i=this.relays$.pipe(Ht(a=>o.pipe(nt(([c,u])=>u==="EOSE"),ml((c,[u])=>[...c,u],[]),bv(c=>a.some(u=>!c.includes(u))),ss(),is("EOSE"))));return xt(s,i).pipe(De())}internalPublish(t){const r=new WeakMap;return this.relays$.pipe(Dt(1),Ht(n=>{const o=[];for(const s of n){if(r.has(s)){o.push(r.get(s));continue}const i=t(s).pipe(w8(s));o.push(i),r.set(s,i)}return xt(...o)}))}req(t,r=as(),n){return this.internalSubscription(o=>o.req(t,r),n?.eventStore?_u(n?.eventStore):pt)}event(t){return this.internalPublish(r=>r.event(t)).pipe(De())}async negentropy(t,r,n,o){const i=(await Promise.all(this.relays.map(async a=>[a,await a.getSupported()]))).filter(([a,c])=>c?.includes(77)).map(([a])=>a);if(i.length===0)throw new Error("No relays support NIP-77 negentropy sync");if(!o?.parallel)throw new Error("Negentropy sync must be parallel (for now)");return await Promise.allSettled(i.map(a=>a.negentropy(t,r,n,o))),!0}publish(t,r){return Un(this.internalPublish(n=>Zt(n.publish(t,r))).pipe(eC(),tC([])))}request(t,r){return this.internalSubscription(n=>n.request(t,r).pipe(is("EOSE")),r?.eventStore==null?pt:_u(r?.eventStore??new ig)).pipe($l())}subscription(t,r){return this.internalSubscription(n=>n.subscription(t,r),r?.eventStore==null?pt:_u(r?.eventStore??new ig))}count(t,r=as()){return this.relays$.pipe(Ht(n=>Di(Object.fromEntries(n.map(o=>[o.url,o.count(t,r)])))),De())}sync(t,r,n){return Fi(async()=>{const s=(await Promise.all(this.relays.map(async i=>[i,await i.getSupported()]))).filter(([i,a])=>a?.includes(77)).map(([i])=>i);if(s.length===0)throw new Error("No relays support NIP-77 negentropy sync");return s}).pipe(Ht(o=>xt(...o.map(s=>s.sync(t,r,n)))),De())}}Od.extend("event-cache");Be.EncryptedDirectMessage,Be.GiftWrap,Be.Seal,Be.PrivateDirectMessage;const v8="modulepreload",b8=function(e){return"/"+e},ag={},_8=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(l=>Promise.resolve(l).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");o=c(r.map(u=>{if(u=b8(u),u in ag)return;ag[u]=!0;const l=u.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":v8,l||(h.as="script"),h.crossOrigin="",h.href=u,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((p,g)=>{h.addEventListener("load",p),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})};var E8=22242;function $8(e,t){return{kind:E8,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var S8={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},x8="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",k8=(function(e){Jt(t,e);function t(r,n){var o=e.call(this)||this;if(o._socket=null,r instanceof Oe)o.destination=n,o.source=r;else{var s=o._config=dl({},S8);if(o._output=new kt,typeof r=="string")s.url=r;else for(var i in r)r.hasOwnProperty(i)&&(s[i]=r[i]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");o.destination=new Mi}return o}return t.prototype.lift=function(r){var n=new t(this._config,this.destination);return n.operator=r,n.source=this,n},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Mi),this._output=new kt},t.prototype.multiplex=function(r,n,o){var s=this;return new Oe(function(i){try{s.next(r())}catch(c){i.error(c)}var a=s.subscribe({next:function(c){try{o(c)&&i.next(c)}catch(u){i.error(u)}},error:function(c){return i.error(c)},complete:function(){return i.complete()}});return function(){try{s.next(n())}catch(c){i.error(c)}a.unsubscribe()}})},t.prototype._connectSocket=function(){var r=this,n=this._config,o=n.WebSocketCtor,s=n.protocol,i=n.url,a=n.binaryType,c=this._output,u=null;try{u=s?new o(i,s):new o(i),this._socket=u,a&&(this._socket.binaryType=a)}catch(f){c.error(f);return}var l=new Do(function(){r._socket=null,u&&u.readyState===1&&u.close()});u.onopen=function(f){var h=r._socket;if(!h){u.close(),r._resetState();return}var p=r._config.openObserver;p&&p.next(f);var g=r.destination;r.destination=oc.create(function(m){if(u.readyState===1)try{var d=r._config.serializer;u.send(d(m))}catch(w){r.destination.error(w)}},function(m){var d=r._config.closingObserver;d&&d.next(void 0),m&&m.code?u.close(m.code,m.reason):c.error(new TypeError(x8)),r._resetState()},function(){var m=r._config.closingObserver;m&&m.next(void 0),u.close(),r._resetState()}),g&&g instanceof Mi&&l.add(g.subscribe(r.destination))},u.onerror=function(f){r._resetState(),c.error(f)},u.onclose=function(f){u===r._socket&&r._resetState();var h=r._config.closeObserver;h&&h.next(f),f.wasClean?c.complete():c.error(f)},u.onmessage=function(f){try{var h=r._config.deserializer;c.next(h(f))}catch(p){c.error(p)}}},t.prototype._subscribe=function(r){var n=this,o=this.source;return o?o.subscribe(r):(this._socket||this._connectSocket(),this._output.subscribe(r),r.add(function(){var s=n._socket;n._output.observers.length===0&&(s&&(s.readyState===1||s.readyState===0)&&s.close(),n._resetState())}),r)},t.prototype.unsubscribe=function(){var r=this._socket;r&&(r.readyState===1||r.readyState===0)&&r.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t})(hl);function R8(e){return new k8(e)}function T8(e){return t=>t.pipe(_r(r=>{typeof r!="string"&&s8(r,e)}))}const Su="auth-required:",xu={count:3,delay:1e3,resetOnSuccess:!0};var cs;(function(e){e[e.RECEIVE=1]="RECEIVE",e[e.SEND=2]="SEND",e[e.BOTH=3]="BOTH"})(cs||(cs={}));class ku extends Error{}const A8={ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0};class ya{url;log=Od.extend("Relay");socket;_ready$=new rt(!0);ready$=this._ready$.asObservable();reconnectTimer;attempts$=new rt(0);connected$=new rt(!1);challenge$=new rt(null);authenticated$;authenticatedAs$;authentication$=new rt(null);authenticationResponse$=new rt(null);notices$=new rt([]);error$=new rt(null);message$;notice$;lastMessageReceivedAt=0;_lastMessageAt$=new rt(0);lastMessageAt$=this._lastMessageAt$.asObservable();status$;information$;_nip11=null;icon$;limitations$;supported$;open$=new kt;close$=new kt;closing$=new kt;reqs$=new rt({});get ready(){return this._ready$.value}get connected(){return this.connected$.value}get challenge(){return this.challenge$.value}get notices(){return this.notices$.value}get authenticated(){return this.authenticationResponse?.ok===!0}get authentication(){return this.authentication$.value}get authenticatedAs(){return this.authenticated?this.authentication?.pubkey??null:null}get authenticationResponse(){return this.authenticationResponse$.value}get information(){return this._nip11}get lastMessageAt(){return this._lastMessageAt$.value}get reqs(){return this.reqs$.value}eoseTimeout=1e4;eventTimeout=1e4;publishTimeout=3e4;keepAlive=3e4;enablePing=!1;pingFrequency=29e3;pingTimeout=2e4;subscriptionReconnect;requestReconnect;publishRetry;onUnresponsive;receivedAuthRequiredForReq=new rt(!1);receivedAuthRequiredForEvent=new rt(!1);authRequiredForRead$;authRequiredForPublish$;resetState(){this.challenge$.value!==null&&this.challenge$.next(null),this.authenticationResponse$.value&&this.authenticationResponse$.next(null),this.authentication$.value!==null&&this.authentication$.next(null),this.notices$.value.length>0&&this.notices$.next([]),this.receivedAuthRequiredForReq.value&&this.receivedAuthRequiredForReq.next(!1),this.receivedAuthRequiredForEvent.value&&this.receivedAuthRequiredForEvent.next(!1)}watchTower;constructor(t,r){this.url=t,this.log=this.log.extend(t),r?.eoseTimeout!==void 0&&(this.eoseTimeout=r.eoseTimeout),r?.eventTimeout!==void 0&&(this.eventTimeout=r.eventTimeout),r?.publishTimeout!==void 0&&(this.publishTimeout=r.publishTimeout),r?.keepAlive!==void 0&&(this.keepAlive=r.keepAlive),r?.enablePing!==void 0&&(this.enablePing=r.enablePing),r?.pingFrequency!==void 0&&(this.pingFrequency=r.pingFrequency),r?.pingTimeout!==void 0&&(this.pingTimeout=r.pingTimeout),r?.onUnresponsive!==void 0&&(this.onUnresponsive=r.onUnresponsive),this.subscriptionReconnect={...xu,...r?.subscriptionRetry??{}},this.requestReconnect={...xu,...r?.requestRetry??{}},this.publishRetry={...xu,...r?.publishRetry??{}},this.authenticated$=this.authenticationResponse$.pipe(We(c=>c?.ok===!0)),this.authenticatedAs$=Di([this.authenticated$,this.authentication$]).pipe(We(([c,u])=>c&&u?u.pubkey:null)),this.reconnectTimer=ya.createReconnectTimer(t),this.open$.subscribe(()=>{this.log("Connected"),this.connected$.next(!0),this.attempts$.next(0),this.error$.next(null),this.resetState()}),this.close$.subscribe(c=>{this.connected$.value?this.log("Disconnected"):this.log("Failed to connect"),this.connected$.value&&this.connected$.next(!1),this.attempts$.next(this.attempts$.value+1),this.resetState(),c.wasClean||this.startReconnectTimer(c)}),this.socket=R8({url:t,openObserver:this.open$,closeObserver:this.close$,closingObserver:this.closing$,WebSocketCtor:r?.WebSocket}),this.information$=Fi(()=>(this.log("Fetching NIP-11 information document"),ya.fetchInformationDocument(this.url))).pipe(Rr(()=>ht(null)),_r(c=>this._nip11=c),gl(1)),this.limitations$=this.information$.pipe(We(c=>c?c.limitation:null)),this.supported$=this.information$.pipe(We(c=>c&&Array.isArray(c.supported_nips)?c.supported_nips.filter(u=>typeof u=="number"):null)),this.icon$=this.information$.pipe(We(c=>c?.icon||new URL("/favicon.ico",Xm(this.url)).toString())),this.authRequiredForRead$=this.receivedAuthRequiredForReq,this.authRequiredForPublish$=this.receivedAuthRequiredForEvent,this.authRequiredForRead$.pipe(nt(c=>c===!0),Dt(1)).subscribe(()=>this.log("Auth required for REQ")),this.authRequiredForPublish$.pipe(nt(c=>c===!0),Dt(1)).subscribe(()=>this.log("Auth required for EVENT")),this.status$=Di({url:ht(this.url),connected:this.connected$,authenticated:this.authenticated$,authenticatedAs:this.authenticatedAs$,ready:this._ready$,authRequiredForRead:this.authRequiredForRead$,authRequiredForPublish:this.authRequiredForPublish$}).pipe(gl(1));const n=this.socket.pipe(nt(c=>Array.isArray(c)&&c[0]==="NOTICE"),We(c=>c[1]),ml((c,u)=>[...c,u],[]),_r(c=>this.notices$.next(c))),o=this.socket.pipe(nt(c=>c[0]==="AUTH"),We(c=>c[1]),_r(c=>{this.log("Received AUTH challenge",c),this.challenge$.next(c)})),s=new kt,i=this.socket.pipe(_r(c=>{const u=Date.now();this.lastMessageReceivedAt=u,this._lastMessageAt$.next(u),s.next(c)}));this.message$=s.asObservable(),this.notice$=this.message$.pipe(nt(c=>Array.isArray(c)&&c[0]==="NOTICE"),We(c=>c[1]));const a=this.connected$.pipe(Ht(c=>!c||!this.enablePing?rr:Fn(this.pingFrequency,this.pingFrequency).pipe(vs(()=>{if(Date.now()-this.lastMessageReceivedAt<this.pingFrequency)return rr;const u="ping:"+as();return this.send(["REQ",u,A8]),this.message$.pipe(nt(l=>Array.isArray(l)&&(l[0]==="EOSE"||l[0]==="CLOSED")&&l[1]===u),Dt(1),qn({first:this.pingTimeout,with:()=>{const l=Date.now(),f=this.onUnresponsive?.({url:this.url,lastMessageAt:this.lastMessageReceivedAt,now:l,attempts:this.attempts$.value})??"reconnect",h=new Error(`Relay ping timeout after ${this.pingTimeout}ms`);return f==="reconnect"?(this.log("Relay connection has become unresponsive, triggering reconnect"),this.startReconnectTimer(h)):f==="close"?(this.log("Relay connection has become unresponsive, closing connection"),this.error$.next(h),this.socket.complete()):this.log("Relay connection has become unresponsive (ignoring per policy)"),rr}}),zm(()=>this.send(["CLOSE",u])))}))),Rr(()=>rr));this.watchTower=this.ready$.pipe(Ht(c=>c?xt(i,n,o,this.information$,a).pipe(ss(),Rr(u=>(this.startReconnectTimer(u instanceof Error?u:new Error("Connection error")),rr)),De({resetOnRefCountZero:()=>Fn(this.keepAlive)})):rr),De())}startReconnectTimer(t){this.ready&&(this.error$.next(t instanceof Error?t:new Error("Connection error")),this._ready$.next(!1),this.reconnectTimer(t,this.attempts$.value).pipe(Dt(1)).subscribe(()=>{this._ready$.next(!0)}))}waitForAuth(t,r){return Di([t,this.authenticated$]).pipe(vv(this.watchTower),nt(([n,o])=>!n||o),Dt(1),Ht(()=>r))}waitForReady(t){return this.ready?t:this.ready$.pipe(nt(r=>r),Dt(1),Ht(()=>t))}multiplex(t,r,n){return this.socket.multiplex(t,r,n)}send(t){this.socket.next(t)}req(t,r=as()){let n;if(typeof t=="function"){const c=t(this);n=(Lm(c)?c:xt(ht(c),rr)).pipe(We(u=>Array.isArray(u)?u:[u]))}else n=(Lm(t)?t:xt(ht(t),rr)).pipe(We(c=>Array.isArray(c)?c:[c]));const o=n.pipe(ss(),is(null)),s=this.socket.pipe(nt(c=>Array.isArray(c)&&(c[0]==="EVENT"||c[0]==="CLOSED"||c[0]==="EOSE")&&c[1]===r),De()),i=n.pipe(_r(c=>{this.socket.next(["REQ",r,...c]),this.reqs$.next({...this.reqs$.value,[r]:c})}),zm(()=>{this.socket.next(["CLOSE",r]);const{[r]:c,...u}=this.reqs$.value;this.reqs$.next(u)}),Ht(()=>s)),a=xt(this.watchTower,i).pipe(vo(s.pipe(ss(),is(!0))),vo(o),We(c=>{if(c[0]==="EOSE")return"EOSE";if(c[0]==="CLOSED")throw new ku(c[2]);return c[2]}),this.handleAuthRequiredForReq("REQ"),T8(this.url),qn({first:this.eoseTimeout,with:()=>xt(ht("EOSE"),rr)}),De());return this.waitForReady(this.waitForAuth(this.authRequiredForRead$,a))}count(t,r=as()){const n=this.socket.pipe(nt(s=>Array.isArray(s)&&(s[0]==="COUNT"||s[0]==="CLOSED")&&s[1]===r)),o=Fi(()=>(this.socket.next(Array.isArray(t)?["COUNT",r,...t]:["COUNT",r,t]),xt(this.watchTower,n))).pipe(We(s=>{if(s[0]==="COUNT")return s[2];throw new ku(s[2])}),this.handleAuthRequiredForReq("COUNT"),Dt(1),qn({first:this.eoseTimeout,with:()=>qi(()=>new Error("COUNT timeout"))}));return this.waitForReady(this.waitForAuth(this.authRequiredForRead$,o)).pipe(De())}event(t,r="EVENT"){const n=Fi(()=>(this.socket.next([r,t]),this.socket.pipe(nt(s=>s[0]==="OK"&&s[1]===t.id),We(s=>({ok:s[2],message:s[3],from:this.url}))))).pipe(De()),o=xt(this.watchTower,n).pipe(vo(n.pipe(ss(),is(!0))),Dt(1),_r(({ok:s,message:i})=>{s===!1&&i?.startsWith(Su)&&!this.receivedAuthRequiredForEvent.value&&(this.log("Auth required for publish"),this.receivedAuthRequiredForEvent.next(!0))}),qn({first:this.eventTimeout,with:()=>ht({ok:!1,from:this.url,message:"Timeout"})}));return r==="AUTH"?this.waitForReady(o).pipe(De()):this.waitForReady(this.waitForAuth(this.authRequiredForPublish$,o)).pipe(De())}auth(t){return this.authentication$.next(t),Un(this.event(t,"AUTH").pipe(_r(r=>this.authenticationResponse$.next(r))))}async negentropy(t,r,n,o){if((await this.getSupported())?.includes(77)===!1)throw new Error("Relay does not support NIP-77");const{buildStorageVector:s,buildStorageFromFilter:i,negentropySync:a}=await _8(async()=>{const{buildStorageVector:u,buildStorageFromFilter:l,negentropySync:f}=await import("../assets/negentropy-DLKJKEy-.js");return{buildStorageVector:u,buildStorageFromFilter:l,negentropySync:f}},[]),c=Array.isArray(t)?s(t):await i(t,r);return a(c,this.socket,r,n,o)}authenticate(t){if(!this.challenge)throw new Error("Have not received authentication challenge");const r=t.signEvent($8(this.url,this.challenge)),n=r instanceof Promise?Zt(r):ht(r);return Un(n.pipe(Ht(o=>this.auth(o))))}customRetryOperator(t,r){return t===!1?pt:typeof t=="number"?ki({...r,count:t}):t===!0?r?ki(r):ki():ki({...r,...t})}customRepeatOperator(t){return t===!1||t===void 0?pt:t===!0?uu():uu(t)}customTimeoutOperator(t,r){return t===!1?pt:Eu(t===!0?r:t??r)}handleAuthRequiredForReq(t){return Rr(r=>(r instanceof ku&&r.message.startsWith(Su)&&!this.receivedAuthRequiredForReq.value&&(this.log(`Auth required for ${t}`),this.receivedAuthRequiredForReq.next(!0)),qi(()=>r)))}subscription(t,r){return this.req(t,r?.id).pipe(this.customRetryOperator(r?.reconnect??!0,this.subscriptionReconnect),this.customRepeatOperator(r?.resubscribe),De())}request(t,r){return this.req(t,r?.id).pipe(this.customRetryOperator(r?.reconnect??!0,this.requestReconnect),this.customRepeatOperator(r?.resubscribe),$l(),De())}publish(t,r){return Un(this.event(t).pipe(vs(n=>n.ok===!1&&n.message?.startsWith(Su)?qi(()=>new Error(n.message)):ht(n)),this.customRetryOperator(r?.retries??r?.reconnect??!0,this.publishRetry),this.customTimeoutOperator(r?.timeout,this.publishTimeout)))}sync(t,r,n=cs.RECEIVE){const o=async s=>Array.isArray(t)?t.filter(i=>s.includes(i.id)):t.getByFilters({ids:s});return new Oe(s=>{const i=new AbortController;let a=!1;const c=()=>{a||(a=!0,i.abort())};return this.negentropy(t,r,async(u,l)=>{if(n&cs.SEND&&u.length>0){const f=await o(u);await Promise.allSettled(f.map(h=>Un(this.event(h))))}n&cs.RECEIVE&&l.length>0&&await Un(this.req({ids:l}).pipe($l(),Reflect.has(t,"add")?Ib(t):pt,_r(f=>s.next(f))))},{signal:i.signal}).then(()=>{a||s.complete()}).catch(u=>{a||s.error(u)}),c}).pipe(De())}close(){this.socket.unsubscribe()}async getInformation(){return ji(this.information$)}async getLimitations(){return ji(this.limitations$)}async getSupported(){return ji(this.supported$)}static fetchInformationDocument(t){return Zt(fetch(Xm(t),{headers:{Accept:"application/nostr+json"}}).then(r=>r.json())).pipe(Rr(()=>ht(null)),Eu(1e4))}static createReconnectTimer(t){return(r,n=0)=>{const o=Math.min(Math.pow(1.5,n)*1e3,3e5);return Fn(o)}}}const he=Ts("applesauce-relay"),I8={ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0};class Fe{prepareRelayForShutdown(t){try{t.keepAlive=0}catch{}try{t.reconnectTimer=()=>rr}catch{}}completeSubjectSafely(t){if(t&&typeof t.complete=="function"&&!t.closed)try{t.complete()}catch{}}async safelyCloseRelay(t,r){try{let n;const o=Math.min(this.pingTimeoutMs,Fe.DISCONNECT_CLOSE_TIMEOUT_MS);r?.awaitClose&&t.connected&&(n=ji(t.close$.pipe(Dt(1),qn(o)))),r?.awaitClose&&this.prepareRelayForShutdown(t);const s=[t.connected$,t.attempts$,t.challenge$,t.authenticationResponse$,t.notices$,t.error$,t.open$,t.close$,t.closing$,t._ready$,t.receivedAuthRequiredForReq,t.receivedAuthRequiredForEvent];try{t.close()}catch{}n&&await n.catch(()=>{}),s.forEach(i=>this.completeSubjectSafely(i)),he.debug("Completed all subjects for relay",{url:t.url})}catch(n){he.warn("Error during relay cleanup",{url:t.url,error:n instanceof Error?n.message:String(n)})}}createRelay(t){const r=new ya(t,{keepAlive:this.pingFrequencyMs+this.pingTimeoutMs+5e3});r.reconnectTimer=(s,i=0)=>{const a=Math.min(Math.pow(1.5,i)*Fe.RECONNECT_BASE_DELAY_MS,Fe.RECONNECT_MAX_DELAY_MS);return Fn(a)};const n=r.connected$.subscribe(s=>{he.debug("Connection status changed",{relayUrl:r.url,connected:s})}),o=r.error$.subscribe(s=>{s&&he.error("Relay connection error",{relayUrl:r.url,error:s instanceof Error?s.message:String(s)})});return this.relayObservers.push(n,o),r}constructor(t,r){var n,o;this.subscriptionDescriptors=[],this.activeUnsubscribers=[],this.destroy$=new kt,this.relayObservers=[],this.relays=[],this.relayUrls=t,this.pingFrequencyMs=(n=r?.pingFrequencyMs)!==null&&n!==void 0?n:12e4,this.pingTimeoutMs=(o=r?.pingTimeoutMs)!==null&&o!==void 0?o:2e4,this.relays=t.map(s=>this.createRelay(s)),this.relayGroup=new $u(this.relays)}async connect(){he.debug("Connecting to relays",{relayUrls:this.relayUrls});for(const t of this.relayUrls)try{new URL(t)}catch(r){throw he.error("Invalid relay URL",{url:t,error:r}),new Error(`Invalid relay URL: ${t}`)}he.debug("Relay group initialized",{relayUrls:this.relayUrls})}async publish(t){he.debug("Publishing event",{eventId:t.id,kind:t.kind});let r=0,n=0;for(;;){n+=1;try{const o=await this.relayGroup.publish(t,{timeout:Fe.PUBLISH_ATTEMPT_TIMEOUT_MS,retries:0});let s=0,i=0;for(const a of o)a.ok?s+=1:i+=1;if(s===0)throw new Error("Failed to publish event");i>0?he.warn("Failed to publish event to some relays",{eventId:t.id,failedCount:i,successCount:s}):he.debug("Event published successfully",{eventId:t.id});return}catch(o){const s=Date.now();s-r>=Fe.PUBLISH_ERROR_LOG_INTERVAL_MS&&(r=s,he.error("Publish failed; will retry",{eventId:t.id,kind:t.kind,attempt:n,error:o})),await nl(Fe.PUBLISH_RETRY_INTERVAL_MS)}}}createSubscription(t,r,n){he.debug("Creating subscription",{filters:t});const s=this.relayGroup.subscription(t,{reconnect:1/0,resubscribe:1/0}).subscribe({next:i=>{i==="EOSE"?n?.():r(i)},complete:()=>{he.debug("Subscription complete")},error:i=>{he.error("Subscription error",{error:i,relayUrls:this.relayUrls})}});return()=>s.unsubscribe()}async subscribe(t,r,n){this.subscriptionDescriptors.push({filters:t,onEvent:r,onEose:n}),this.activeUnsubscribers.push(this.createSubscription(t,r,n)),he.debug("Starting ping monitor from subscribe",{activeUnsubscribers:this.activeUnsubscribers.length}),this.startPingMonitor()}async disconnect(){this.destroy$.next(),this.destroy$.complete(),this.rebuildInFlight&&await Promise.race([this.rebuildInFlight.catch(()=>{}),nl(Fe.DISCONNECT_CLOSE_TIMEOUT_MS)]),this.unsubscribe();for(const t of this.relayObservers)t.unsubscribe();this.relayObservers=[];for(const t of this.relays)await this.safelyCloseRelay(t,{awaitClose:!0});this.relays=[],this.relayGroup=new $u([]),he.debug("Disconnected from all relays")}stopActiveSubscriptions(){he.debug("Stopping active subscriptions (preserving descriptors)");try{for(const t of this.activeUnsubscribers)t();this.activeUnsubscribers=[]}catch(t){he.error("Error while stopping active subscriptions",{error:t})}}unsubscribe(){he.debug("Unsubscribing from all subscriptions");try{this.stopActiveSubscriptions(),this.subscriptionDescriptors=[],this.stopPingMonitor()}catch(t){he.error("Error while unsubscribing from subscriptions",{error:t})}}getRelayUrls(){return[...this.relayUrls]}stopPingMonitor(){this.pingSubscription&&(this.pingSubscription.unsubscribe(),this.pingSubscription=void 0)}startPingMonitor(){if(this.pingSubscription){he.debug("Ping monitor already started, skipping");return}const t=Math.random()*Math.min(1e4,this.pingFrequencyMs)-Math.min(5e3,this.pingFrequencyMs/2),r=Math.max(0,this.pingFrequencyMs+t);this.pingSubscription=Fn(r,this.pingFrequencyMs).pipe(vo(this.destroy$)).subscribe({next:()=>{this.checkLiveness()},error:n=>{he.error("Ping monitor error",{error:n})}})}async checkLiveness(){if(this.activeUnsubscribers.length===0){he.debug("Skipping liveness check: no active subscriptions");return}he.debug("Running liveness check",{activeUnsubscribers:this.activeUnsubscribers.length,relayCount:this.relays.length});const t=this.relays;if(t.length===0){he.warn("No relays in group, triggering rebuild"),this.rebuild("no-relays");return}const r=t.filter(o=>o.connected);if(r.length===0){he.warn("No connected relays, triggering rebuild",{totalRelays:t.length,relayStates:t.map(o=>({url:o.url,connected:o.connected}))}),this.rebuild("no-connected-relays");return}const n=`ping:${Date.now()}`;try{for(const o of r)try{o.send(["REQ",n,I8])}catch(s){he.debug("Failed to send ping to relay",{url:o.url,error:s})}await Un(xt(...r.map(o=>o.message$)).pipe(nt(o=>Array.isArray(o)&&o[0]==="EOSE"&&o[1]===n),Dt(1),qn(this.pingTimeoutMs)))}catch(o){o instanceof Error&&o.name==="TimeoutError"?he.warn("Liveness check timed out - no response from relays",{pingTimeoutMs:this.pingTimeoutMs,connectedRelays:r.length}):he.warn("Liveness check failed, triggering rebuild",{error:o}),this.rebuild("liveness-timeout")}}rebuild(t){this.rebuildInFlight||(this.rebuildInFlight=(async()=>{he.info("Rebuilding relay pool",{reason:t}),this.stopPingMonitor();for(const r of this.relayObservers)r.unsubscribe();this.relayObservers=[];for(const r of this.relays)this.safelyCloseRelay(r);this.stopActiveSubscriptions(),this.relays=this.relayUrls.map(r=>this.createRelay(r)),this.relayGroup=new $u(this.relays);for(const r of this.subscriptionDescriptors)this.activeUnsubscribers.push(this.createSubscription(r.filters,r.onEvent,r.onEose));he.info("Relay pool rebuilt successfully"),this.startPingMonitor()})().finally(()=>{this.rebuildInFlight=void 0}))}}Fe.PUBLISH_ATTEMPT_TIMEOUT_MS=1e4;Fe.PUBLISH_RETRY_INTERVAL_MS=500;Fe.PUBLISH_ERROR_LOG_INTERVAL_MS=1e4;Fe.RECONNECT_BASE_DELAY_MS=3e3;Fe.RECONNECT_MAX_DELAY_MS=3e4;Fe.DISCONNECT_CLOSE_TIMEOUT_MS=2e3;new TextDecoder("utf-8");new TextEncoder;class Nd{constructor(t){this.nip44={encrypt:async(r,n)=>{const o=Bn.v2.utils.getConversationKey(this.privateKey,r);return Bn.v2.encrypt(n,o)},decrypt:async(r,n)=>{const o=Bn.v2.utils.getConversationKey(this.privateKey,r);return Bn.v2.decrypt(n,o)}},this.privateKey=t?pn(t):Py(),this.publicKey=Ka(this.privateKey)}async getPublicKey(){return this.publicKey}async signEvent(t){return Wt(t,this.privateKey)}}class O8{constructor(t=5){this.concurrency=t,this.running=0,this.queue=[],this.isShutdown=!1}add(t){this.isShutdown||(this.queue.push(t),this.processNext())}getQueueSize(){return this.queue.length}getRunningCount(){return this.running}async shutdown(t=5e3){this.isShutdown=!0,this.queue.length>0&&(this.queue=[]);const n=Date.now();for(;this.running>0&&Date.now()-n<t;)await nl(100);this.running>0&&console.warn(`TaskQueue shutdown timed out with ${this.running} tasks still running`)}processNext(){if(this.running>=this.concurrency||this.queue.length===0)return;const t=this.queue.shift();t&&(this.running++,t().finally(()=>{this.running--,this.processNext()}))}}const ts=3e4;class hc{constructor(t,r){var n;this.isConnected=!1,this.signer=r.signer,this.relayHandler=Array.isArray(r.relayHandler)?new Fe(r.relayHandler):r.relayHandler,this.encryptionMode=(n=r.encryptionMode)!==null&&n!==void 0?n:fo.OPTIONAL,this.logger=Ts(t,{level:r.logLevel}),this.taskQueue=new O8(5)}async connect(){var t,r,n;if(!this.isConnected)try{await ao(this.relayHandler.connect(),ts,"Connection to Nostr relay network timed out"),this.isConnected=!0,this.logger.info("Connected to Nostr relays",(n=(r=(t=this.relayHandler).getRelayUrls)===null||r===void 0?void 0:r.call(t))!==null&&n!==void 0?n:"")}catch(o){this.logAndRethrowError("Failed to connect to Nostr relay network",o)}}async disconnect(){if(this.isConnected)try{await ao(this.relayHandler.disconnect(),ts,"Disconnection from Nostr relay network timed out"),this.isConnected=!1,this.logger.info("Disconnected from Nostr relay network")}catch(t){this.logAndRethrowError("Failed to disconnect from Nostr relay network",t)}}async getPublicKey(){try{return await ao(this.signer.getPublicKey(),ts,"Get public key timed out")}catch(t){this.logAndRethrowError("Failed to get public key from signer",t)}}async subscribe(t,r){try{await this.relayHandler.subscribe(t,n=>{this.taskQueue.add(async()=>{try{await r(n)}catch(o){this.logger.error("Error in subscription event handler",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,eventId:n.id,eventKind:n.kind})}})}),this.logger.debug("Subscribed to Nostr events",{filters:t})}catch(n){this.logAndRethrowError("Failed to subscribe to Nostr events",n,{filters:t})}}convertNostrEventToMcpMessage(t){try{const r=fT(t);if(!r)return this.logger.debug("Failed to convert Nostr event to MCP message - null result",{eventId:t.id,pubkey:t.pubkey}),null;const n=oN(r);return n||(this.logger.warn("Failed to validate MCP message structure",{eventId:t.id,pubkey:t.pubkey}),null)}catch(r){return this.logger.error("Error converting Nostr event to MCP message",{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0,eventId:t.id,pubkey:t.pubkey}),null}}async createSignedNostrEvent(t,r,n){try{const o=await this.getPublicKey(),s=lT(t,o,r,n);return await ao(this.signer.signEvent(s),ts,"Sign event timed out")}catch(o){this.logAndRethrowError("Failed to create signed Nostr event",o,{kind:r,hasTags:!!n})}}async publishEvent(t){try{await ao(this.relayHandler.publish(t),ts,"Publish event timed out"),this.logger.debug("Published Nostr event",{eventId:t.id,kind:t.kind})}catch(r){this.logAndRethrowError("Failed to publish Nostr event",r,{eventId:t.id,kind:t.kind})}}async sendMcpMessage(t,r,n,o,s,i){try{const a=this.shouldEncryptMessage(n,s),c=await this.createSignedNostrEvent(t,n,o);if(i?.(c.id),a){const u=rN(JSON.stringify(c),r);await this.publishEvent(u),this.logger.debug("Sent encrypted MCP message",{eventId:c.id,kind:n,recipient:r})}else await this.publishEvent(c),this.logger.debug("Sent unencrypted MCP message",{eventId:c.id,kind:n,recipient:r});return c.id}catch(a){this.logAndRethrowError("Failed to send MCP message",a,{kind:n,recipient:r,encryptionMode:this.encryptionMode})}}shouldEncryptMessage(t,r){if(hc.UNENCRYPTED_KINDS.has(t))return!1;switch(this.encryptionMode){case fo.DISABLED:return!1;case fo.REQUIRED:return!0;case fo.OPTIONAL:return r??!0;default:return!0}}createSubscriptionFilters(t,r={}){return[{"#p":[t],kinds:[J0,Ma],since:Math.floor(Date.now()/1e3),...r}]}createRecipientTags(t){return[[Li.PUBKEY,t]]}createResponseTags(t,r){return[[Li.PUBKEY,t],[Li.EVENT_ID,r]]}logAndRethrowError(t,r,n){throw this.logger.error(t,{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0,...n}),r instanceof Error?r:new Error(String(r))}}hc.UNENCRYPTED_KINDS=new Set([YR,XR,QR,eT,tT]);class N8{constructor(t,r){this.capacity=t,this.onEvict=r,this.cache=new Map}get(t){const r=this.cache.get(t);return r!==void 0&&(this.cache.delete(t),this.cache.set(t,r)),r}set(t,r){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){const n=this.cache.keys().next().value;if(n){const o=this.cache.get(n);if(this.cache.delete(n),o!==void 0&&this.onEvict)try{this.onEvict(n,o)}catch(s){console.error("Error in LruCache eviction callback",{key:n,error:s instanceof Error?s.message:String(s)})}}}this.cache.set(t,r)}has(t){return this.cache.has(t)}entries(){return this.cache.entries()}delete(t){return this.cache.delete(t)}clear(){this.cache.clear()}get size(){return this.cache.size}}class C8{constructor(t={}){const{maxPendingRequests:r=1e3,onRequestEvicted:n}=t;this.pendingRequests=new N8(r,n)}registerRequest(t,r){this.pendingRequests.set(t,r)}resolveResponse(t,r){const n=this.pendingRequests.get(t);return n?(n.originalRequestId!==null&&(r.id=n.originalRequestId),this.pendingRequests.delete(t),!0):!1}hasPendingRequest(t){return this.pendingRequests.has(t)}removePendingRequest(t){return this.pendingRequests.delete(t)}get pendingRequestCount(){return this.pendingRequests.size}clear(){this.pendingRequests.clear()}}class P8{createEmulatedResponse(t){return{jsonrpc:"2.0",id:t,result:{protocolVersion:jl,serverInfo:{name:"Emulated-Stateless-Server",version:"1.0.0"},capabilities:{tools:{listChanged:!0},prompts:{listChanged:!0},resources:{subscribe:!0,listChanged:!0}}}}}shouldHandleStatelessly(t){return"method"in t&&t.method===Hu&&"id"in t||"method"in t&&t.method===nT}}class L8 extends hc{constructor(t){var r;if(super("nostr-client-transport",t),!/^[0-9a-f]{64}$/i.test(t.serverPubkey))throw new Error(`Invalid serverPubkey format: ${t.serverPubkey}`);this.serverPubkey=t.serverPubkey,this.isStateless=(r=t.isStateless)!==null&&r!==void 0?r:!1,this.correlationStore=new C8({maxPendingRequests:rT,onRequestEvicted:n=>{this.logger.debug("Evicted pending request",{eventId:n})}}),this.statelessHandler=new P8}async start(){var t;try{const[r,n]=await Promise.all([this.connect(),this.getPublicKey()]);this.logger.info("Client pubkey:",n);const o=this.createSubscriptionFilters(n);await this.subscribe(o,async s=>{var i;try{await this.processIncomingEvent(s)}catch(a){this.logger.error("Error processing incoming event",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,eventId:s.id}),(i=this.onerror)===null||i===void 0||i.call(this,a instanceof Error?a:new Error(String(a)))}})}catch(r){(t=this.onerror)===null||t===void 0||t.call(this,r instanceof Error?r:new Error(String(r))),this.logAndRethrowError("Error starting NostrClientTransport",r)}}async close(){var t,r;try{await this.disconnect(),this.correlationStore.clear(),(t=this.onclose)===null||t===void 0||t.call(this)}catch(n){(r=this.onerror)===null||r===void 0||r.call(this,n instanceof Error?n:new Error(String(n))),this.logAndRethrowError("Error closing NostrClientTransport",n)}}async send(t){var r;try{if(this.isStateless&&this.statelessHandler.shouldHandleStatelessly(t)){if(Cn(t)&&t.method===Hu){this.logger.info("Stateless mode: Emulating initialize response."),this.emulateInitializeResponse(t.id);return}return}await this.sendRequest(t)}catch(n){(r=this.onerror)===null||r===void 0||r.call(this,n instanceof Error?n:new Error(String(n))),this.logAndRethrowError("Error sending message",n,{messageType:Cn(t)?"request":Fu(t)?"notification":"unknown",method:Cn(t)||Fu(t)?t.method:void 0})}}async sendRequest(t){const r=this.createRecipientTags(this.serverPubkey);return await this.sendMcpMessage(t,this.serverPubkey,J0,r,void 0,n=>{this.correlationStore.registerRequest(n,{originalRequestId:Cn(t)?t.id:null,isInitialize:Cn(t)&&t.method===Hu})})}emulateInitializeResponse(t){const r=this.statelessHandler.createEmulatedResponse(t);queueMicrotask(()=>{var n,o;try{(n=this.onmessage)===null||n===void 0||n.call(this,r)}catch(s){this.logger.error("Error in emulated initialize response callback",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,requestId:t}),(o=this.onerror)===null||o===void 0||o.call(this,s instanceof Error?s:new Error(String(s)))}})}async processIncomingEvent(t){var r,n;try{let o=t;if(t.kind===Ma)try{const a=await ao(nN(t,this.signer),3e4,"Decrypt message timed out");o=JSON.parse(a)}catch(a){this.logger.error("Failed to decrypt gift-wrapped event",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,eventId:t.id,pubkey:t.pubkey}),(r=this.onerror)===null||r===void 0||r.call(this,a instanceof Error?a:new Error("Failed to decrypt gift-wrapped event"));return}if(o.pubkey!==this.serverPubkey){this.logger.debug("Skipping event from unexpected server pubkey:",{receivedPubkey:o.pubkey,expectedPubkey:this.serverPubkey,eventId:o.id});return}const s=dT(o.tags,"e");if(!this.serverInitializeEvent&&s)try{const a=JSON.parse(o.content);Zl.safeParse(a.result).success&&(this.serverInitializeEvent=o,this.logger.info("Received server initialize event",{eventId:o.id}))}catch{this.logger.debug("Event is not a valid initialize response",{eventId:o.id})}if(s&&!this.correlationStore.hasPendingRequest(s)){this.logger.warn("Received response for unknown/expired request",{eventId:o.id,eTag:s,reason:"Request not found in pending set - may be duplicate or late response"});return}const i=this.convertNostrEventToMcpMessage(o);if(!i){this.logger.error("Skipping invalid Nostr event with malformed JSON content",{eventId:o.id,pubkey:o.pubkey});return}s?this.handleResponse(s,i):this.handleNotification(i)}catch(o){this.logger.error("Error handling incoming Nostr event",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,eventId:t.id,pubkey:t.pubkey,kind:t.kind}),(n=this.onerror)===null||n===void 0||n.call(this,o instanceof Error?o:new Error("Failed to handle incoming Nostr event"))}}getServerInitializeEvent(){return this.serverInitializeEvent}handleResponse(t,r){var n,o;try{this.correlationStore.resolveResponse(t,r)?(n=this.onmessage)===null||n===void 0||n.call(this,r):this.logger.warn("Response for unknown request",{eventId:t})}catch(s){this.logger.error("Error handling response",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,correlatedEventId:t}),(o=this.onerror)===null||o===void 0||o.call(this,s instanceof Error?s:new Error(String(s)))}}handleNotification(t){var r,n;try{const o=At.safeParse(t);if(!o.success){this.logger.warn("Invalid notification schema",{issues:o.error.issues,message:t});return}(r=this.onmessage)===null||r===void 0||r.call(this,t)}catch(o){this.logger.error("Failed to handle incoming notification",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0}),(n=this.onerror)===null||n===void 0||n.call(this,o instanceof Error?o:new Error("Failed to handle incoming notification"))}}getInternalStateForTesting(){return{correlationStore:this.correlationStore,statelessHandler:this.statelessHandler,serverInitializeEvent:this.serverInitializeEvent}}}function Cd(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function gn(e,t=""){if(!Number.isSafeInteger(e)||e<0){const r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function ye(e,t,r=""){const n=Cd(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){const i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function pc(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");gn(e.outputLen),gn(e.blockLen)}function wa(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function U8(e,t){ye(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function bs(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Ru(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function tr(e,t){return e<<32-t|e>>>t}const Ob=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",z8=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function we(e){if(ye(e),Ob)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=z8[e[r]];return t}const vr={_0:48,_9:57,A:65,F:70,a:97,f:102};function cg(e){if(e>=vr._0&&e<=vr._9)return e-vr._0;if(e>=vr.A&&e<=vr.F)return e-(vr.A-10);if(e>=vr.a&&e<=vr.f)return e-(vr.a-10)}function Ce(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Ob)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const i=cg(e.charCodeAt(s)),a=cg(e.charCodeAt(s+1));if(i===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function vt(...e){let t=0;for(let n=0;n<e.length;n++){const o=e[n];ye(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const s=e[n];r.set(s,o),o+=s.length}return r}function B8(e,t={}){const r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function Vo(e=32){const t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}const M8=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function q8(e,t,r){return e&t^~e&r}function j8(e,t,r){return e&t^e&r^t&r}class D8{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Ru(this.buffer)}update(t){wa(this),ye(t);const{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Ru(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){wa(this),U8(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:s}=this;let{pos:i}=this;r[i++]=128,bs(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);const a=Ru(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const en=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),F8=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),tn=new Uint32Array(64);class H8 extends D8{constructor(t){super(64,t,8,!1)}get(){const{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)tn[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){const h=tn[f-15],p=tn[f-2],g=tr(h,7)^tr(h,18)^h>>>3,m=tr(p,17)^tr(p,19)^p>>>10;tn[f]=m+tn[f-7]+g+tn[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=tr(a,6)^tr(a,11)^tr(a,25),p=l+h+q8(a,c,u)+F8[f]+tn[f]|0,m=(tr(n,2)^tr(n,13)^tr(n,22))+j8(n,o,s)|0;l=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){bs(tn)}destroy(){this.set(0,0,0,0,0,0,0,0),bs(this.buffer)}}class V8 extends H8{A=en[0]|0;B=en[1]|0;C=en[2]|0;D=en[3]|0;E=en[4]|0;F=en[5]|0;G=en[6]|0;H=en[7]|0;constructor(){super(32)}}const fr=B8(()=>new V8,M8(1));const Pd=BigInt(0),Sl=BigInt(1);function va(e,t=""){if(typeof e!="boolean"){const r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Nb(e){if(typeof e=="bigint"){if(!Ki(e))throw new Error("positive bigint expected, got "+e)}else gn(e);return e}function Ii(e){const t=Nb(e).toString(16);return t.length&1?"0"+t:t}function Cb(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Pd:BigInt("0x"+e)}function Os(e){return Cb(we(e))}function Pb(e){return Cb(we(Z8(ye(e)).reverse()))}function Ld(e,t){gn(t),e=Nb(e);const r=Ce(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Lb(e,t){return Ld(e,t).reverse()}function Z8(e){return Uint8Array.from(e)}function K8(e){return Uint8Array.from(e,(t,r)=>{const n=t.charCodeAt(0);if(t.length!==1||n>127)throw new Error(`string contains non-ASCII character "${e[r]}" with code ${n} at position ${r}`);return n})}const Ki=e=>typeof e=="bigint"&&Pd<=e;function G8(e,t,r){return Ki(e)&&Ki(t)&&Ki(r)&&t<=e&&e<r}function W8(e,t,r,n){if(!G8(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function J8(e){let t;for(t=0;e>Pd;e>>=Sl,t+=1);return t}const Ud=e=>(Sl<<BigInt(e))-Sl;function Y8(e,t,r){if(gn(e,"hashLen"),gn(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");const n=d=>new Uint8Array(d),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),a=1e3;let c=n(e),u=n(e),l=0;const f=()=>{c.fill(1),u.fill(0),l=0},h=(...d)=>r(u,vt(c,...d)),p=(d=o)=>{u=h(s,d),c=h(),d.length!==0&&(u=h(i,d),c=h())},g=()=>{if(l++>=a)throw new Error("drbg: tried max amount of iterations");let d=0;const w=[];for(;d<t;){c=h();const y=c.slice();w.push(y),d+=c.length}return vt(...w)};return(d,w)=>{f(),p(d);let y;for(;!(y=w(g()));)p();return f(),y}}function zd(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,a){const c=e[s];if(a&&c===void 0)return;const u=typeof c;if(u!==i||c===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${u}`)}const o=(s,i)=>Object.entries(s).forEach(([a,c])=>n(a,c,i));o(t,!1),o(r,!0)}function ug(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const s=e(r,...n);return t.set(r,s),s}}const bt=BigInt(0),mt=BigInt(1),jn=BigInt(2),Ub=BigInt(3),zb=BigInt(4),Bb=BigInt(5),X8=BigInt(7),Mb=BigInt(8),Q8=BigInt(9),qb=BigInt(16);function Ft(e,t){const r=e%t;return r>=bt?r:t+r}function Pt(e,t,r){let n=e;for(;t-- >bt;)n*=n,n%=r;return n}function lg(e,t){if(e===bt)throw new Error("invert: expected non-zero number");if(t<=bt)throw new Error("invert: expected positive modulus, got "+t);let r=Ft(e,t),n=t,o=bt,s=mt;for(;r!==bt;){const a=n/r,c=n%r,u=o-s*a;n=r,r=c,o=s,s=u}if(n!==mt)throw new Error("invert: does not exist");return Ft(o,t)}function Bd(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function jb(e,t){const r=(e.ORDER+mt)/zb,n=e.pow(t,r);return Bd(e,n,t),n}function eU(e,t){const r=(e.ORDER-Bb)/Mb,n=e.mul(t,jn),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,jn),o),a=e.mul(s,e.sub(i,e.ONE));return Bd(e,a,t),a}function tU(e){const t=mc(e),r=Db(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+X8)/qb;return(a,c)=>{let u=a.pow(c,i),l=a.mul(u,n);const f=a.mul(u,o),h=a.mul(u,s),p=a.eql(a.sqr(l),c),g=a.eql(a.sqr(f),c);u=a.cmov(u,l,p),l=a.cmov(h,f,g);const m=a.eql(a.sqr(l),c),d=a.cmov(u,l,m);return Bd(a,d,c),d}}function Db(e){if(e<Ub)throw new Error("sqrt is not defined for small field");let t=e-mt,r=0;for(;t%jn===bt;)t/=jn,r++;let n=jn;const o=mc(e);for(;fg(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return jb;let s=o.pow(n,t);const i=(t+mt)/jn;return function(c,u){if(c.is0(u))return u;if(fg(c,u)!==1)throw new Error("Cannot find square root");let l=r,f=c.mul(c.ONE,s),h=c.pow(u,t),p=c.pow(u,i);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let g=1,m=c.sqr(h);for(;!c.eql(m,c.ONE);)if(g++,m=c.sqr(m),g===l)throw new Error("Cannot find square root");const d=mt<<BigInt(l-g-1),w=c.pow(f,d);l=g,f=c.sqr(w),h=c.mul(h,f),p=c.mul(p,w)}return p}}function rU(e){return e%zb===Ub?jb:e%Mb===Bb?eU:e%qb===Q8?tU(e):Db(e)}const nU=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function oU(e){const t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=nU.reduce((n,o)=>(n[o]="function",n),t);return zd(e,r),e}function sU(e,t,r){if(r<bt)throw new Error("invalid exponent, negatives unsupported");if(r===bt)return e.ONE;if(r===mt)return t;let n=e.ONE,o=t;for(;r>bt;)r&mt&&(n=e.mul(n,o)),o=e.sqr(o),r>>=mt;return n}function Fb(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function fg(e,t){const r=(e.ORDER-mt)/jn,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function iU(e,t){t!==void 0&&gn(t);const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}class aU{ORDER;BITS;BYTES;isLE;ZERO=bt;ONE=mt;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=bt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));const{nBitLength:o,nByteLength:s}=iU(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return Ft(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return bt<=t&&t<this.ORDER}is0(t){return t===bt}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&mt)===mt}neg(t){return Ft(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return Ft(t*t,this.ORDER)}add(t,r){return Ft(t+r,this.ORDER)}sub(t,r){return Ft(t-r,this.ORDER)}mul(t,r){return Ft(t*r,this.ORDER)}pow(t,r){return sU(this,t,r)}div(t,r){return Ft(t*lg(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return lg(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=rU(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Lb(t,this.BYTES):Ld(t,this.BYTES)}fromBytes(t,r=!1){ye(t);const{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:a}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);const u=new Uint8Array(o);u.set(t,s?0:u.length-t.length),t=u}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let c=s?Pb(t):Os(t);if(a&&(c=Ft(c,i)),!r&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(t){return Fb(this,t)}cmov(t,r,n){return n?r:t}}function mc(e,t={}){return new aU(e,t)}function Hb(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Vb(e){const t=Hb(e);return t+Math.ceil(t/2)}function Zb(e,t,r=!1){ye(e);const n=e.length,o=Hb(t),s=Vb(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const i=r?Pb(e):Os(e),a=Ft(i,t-mt)+mt;return r?Lb(a,o):Ld(a,o)}const Po=BigInt(0),Dn=BigInt(1);function ba(e,t){const r=t.negate();return e?r:t}function dg(e,t){const r=Fb(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Kb(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Tu(e,t){Kb(e,t);const r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Ud(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function hg(e,t,r){const{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r;let a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=Dn);const u=t*n,l=u+Math.abs(a)-1,f=a===0,h=a<0,p=t%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:h,isNegF:p,offsetF:u}}const Au=new WeakMap,Gb=new WeakMap;function Iu(e){return Gb.get(e)||1}function pg(e){if(e!==Po)throw new Error("invalid wNAF")}class cU{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>Po;)r&Dn&&(n=n.add(o)),o=o.double(),r>>=Dn;return n}precomputeWindow(t,r){const{windows:n,windowSize:o}=Tu(r,this.bits),s=[];let i=t,a=i;for(let c=0;c<n;c++){a=i,s.push(a);for(let u=1;u<o;u++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE;const i=Tu(t,this.bits);for(let a=0;a<i.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:h,offsetF:p}=hg(n,a,i);n=c,l?s=s.add(ba(h,r[p])):o=o.add(ba(f,r[u]))}return pg(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){const s=Tu(t,this.bits);for(let i=0;i<s.windows&&n!==Po;i++){const{nextN:a,offset:c,isZero:u,isNeg:l}=hg(n,i,s);if(n=a,!u){const f=r[c];o=o.add(l?f.negate():f)}}return pg(n),o}getPrecomputes(t,r,n){let o=Au.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),Au.set(r,o))),o}cached(t,r,n){const o=Iu(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){const s=Iu(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Kb(r,this.bits),Gb.set(t,r),Au.delete(t)}hasCache(t){return Iu(t)!==1}}function uU(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Po||n>Po;)r&Dn&&(s=s.add(o)),n&Dn&&(i=i.add(o)),o=o.double(),r>>=Dn,n>>=Dn;return{p1:s,p2:i}}function mg(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return oU(t),t}else return mc(e,{isLE:r})}function lU(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const c of["p","n","h"]){const u=t[c];if(!(typeof u=="bigint"&&u>Po))throw new Error(`CURVE.${c} must be positive bigint`)}const o=mg(t.p,r.Fp,n),s=mg(t.n,r.Fn,n),a=["Gx","Gy","a","b"];for(const c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function Wb(e,t){return function(n){const o=e(n);return{secretKey:o,publicKey:t(o)}}}class Jb{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(pc(t),ye(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),bs(o)}update(t){return wa(this),this.iHash.update(t),this}digestInto(t){wa(this),ye(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ns=(e,t,r)=>new Jb(e,t).update(r).digest();Ns.create=(e,t)=>new Jb(e,t);const gg=(e,t)=>(e+(e>=0?t:-t)/Yb)/t;function fU(e,t,r){const[[n,o],[s,i]]=t,a=gg(i*e,r),c=gg(-o*e,r);let u=e-a*n-c*s,l=-a*o-c*i;const f=u<Nr,h=l<Nr;f&&(u=-u),h&&(l=-l);const p=Ud(Math.ceil(J8(r)/2))+_o;if(u<Nr||u>=p||l<Nr||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:f,k1:u,k2neg:h,k2:l}}function xl(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Ou(e,t){const r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return va(r.lowS,"lowS"),va(r.prehash,"prehash"),r.format!==void 0&&xl(r.format),r}class dU extends Error{constructor(t=""){super(t)}}const nn={Err:dU,_tlv:{encode:(e,t)=>{const{Err:r}=nn;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");const n=t.length/2,o=Ii(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Ii(o.length/2|128):"";return Ii(e)+s+o+t},decode(e,t){const{Err:r}=nn;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const o=t[n++],s=!!(o&128);let i=0;if(!s)i=o;else{const c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=t.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)i=i<<8|l;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}const a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){const{Err:t}=nn;if(e<Nr)throw new t("integer: negative integers are not allowed");let r=Ii(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=nn;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Os(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=nn,o=ye(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){const{_tlv:t,_int:r}=nn,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Nr=BigInt(0),_o=BigInt(1),Yb=BigInt(2),Oi=BigInt(3),hU=BigInt(4);function pU(e,t={}){const r=lU("weierstrass",e,t),{Fp:n,Fn:o}=r;let s=r.CURVE;const{h:i,n:a}=s;zd(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:c}=t;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Qb(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(D,U,z){const{x:k,y:S}=U.toAffine(),O=n.toBytes(k);if(va(z,"isCompressed"),z){l();const P=!n.isOdd(S);return vt(Xb(P),O)}else return vt(Uint8Array.of(4),O,n.toBytes(S))}function h(D){ye(D,void 0,"Point");const{publicKey:U,publicKeyUncompressed:z}=u,k=D.length,S=D[0],O=D.subarray(1);if(k===U&&(S===2||S===3)){const P=n.fromBytes(O);if(!n.isValid(P))throw new Error("bad point: is not on curve, wrong x");const B=m(P);let I;try{I=n.sqrt(B)}catch(C){const x=C instanceof Error?": "+C.message:"";throw new Error("bad point: is not on curve, sqrt error"+x)}l();const T=n.isOdd(I);return(S&1)===1!==T&&(I=n.neg(I)),{x:P,y:I}}else if(k===z&&S===4){const P=n.BYTES,B=n.fromBytes(O.subarray(0,P)),I=n.fromBytes(O.subarray(P,P*2));if(!d(B,I))throw new Error("bad point: is not on curve");return{x:B,y:I}}else throw new Error(`bad point: got length ${k}, expected compressed=${U} or uncompressed=${z}`)}const p=t.toBytes||f,g=t.fromBytes||h;function m(D){const U=n.sqr(D),z=n.mul(U,D);return n.add(n.add(z,n.mul(D,s.a)),s.b)}function d(D,U){const z=n.sqr(U),k=m(D);return n.eql(z,k)}if(!d(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const w=n.mul(n.pow(s.a,Oi),hU),y=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(w,y)))throw new Error("bad curve params: a or b");function v(D,U,z=!1){if(!n.isValid(U)||z&&n.is0(U))throw new Error(`bad point coordinate ${D}`);return U}function E(D){if(!(D instanceof q))throw new Error("Weierstrass Point expected")}function b(D){if(!c||!c.basises)throw new Error("no endo");return fU(D,c.basises,o.ORDER)}const _=ug((D,U)=>{const{X:z,Y:k,Z:S}=D;if(n.eql(S,n.ONE))return{x:z,y:k};const O=D.is0();U==null&&(U=O?n.ONE:n.inv(S));const P=n.mul(z,U),B=n.mul(k,U),I=n.mul(S,U);if(O)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:P,y:B}}),$=ug(D=>{if(D.is0()){if(t.allowInfinityPoint&&!n.is0(D.Y))return;throw new Error("bad point: ZERO")}const{x:U,y:z}=D.toAffine();if(!n.isValid(U)||!n.isValid(z))throw new Error("bad point: x or y not field elements");if(!d(U,z))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(D,U,z,k,S){return z=new q(n.mul(z.X,D),z.Y,z.Z),U=ba(k,U),z=ba(S,z),U.add(z)}class q{static BASE=new q(s.Gx,s.Gy,n.ONE);static ZERO=new q(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(U,z,k){this.X=v("x",U),this.Y=v("y",z,!0),this.Z=v("z",k),Object.freeze(this)}static CURVE(){return s}static fromAffine(U){const{x:z,y:k}=U||{};if(!U||!n.isValid(z)||!n.isValid(k))throw new Error("invalid affine point");if(U instanceof q)throw new Error("projective point not allowed");return n.is0(z)&&n.is0(k)?q.ZERO:new q(z,k,n.ONE)}static fromBytes(U){const z=q.fromAffine(g(ye(U,void 0,"point")));return z.assertValidity(),z}static fromHex(U){return q.fromBytes(Ce(U))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(U=8,z=!0){return L.createCache(this,U),z||this.multiply(Oi),this}assertValidity(){$(this)}hasEvenY(){const{y:U}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(U)}equals(U){E(U);const{X:z,Y:k,Z:S}=this,{X:O,Y:P,Z:B}=U,I=n.eql(n.mul(z,B),n.mul(O,S)),T=n.eql(n.mul(k,B),n.mul(P,S));return I&&T}negate(){return new q(this.X,n.neg(this.Y),this.Z)}double(){const{a:U,b:z}=s,k=n.mul(z,Oi),{X:S,Y:O,Z:P}=this;let B=n.ZERO,I=n.ZERO,T=n.ZERO,N=n.mul(S,S),C=n.mul(O,O),x=n.mul(P,P),R=n.mul(S,O);return R=n.add(R,R),T=n.mul(S,P),T=n.add(T,T),B=n.mul(U,T),I=n.mul(k,x),I=n.add(B,I),B=n.sub(C,I),I=n.add(C,I),I=n.mul(B,I),B=n.mul(R,B),T=n.mul(k,T),x=n.mul(U,x),R=n.sub(N,x),R=n.mul(U,R),R=n.add(R,T),T=n.add(N,N),N=n.add(T,N),N=n.add(N,x),N=n.mul(N,R),I=n.add(I,N),x=n.mul(O,P),x=n.add(x,x),N=n.mul(x,R),B=n.sub(B,N),T=n.mul(x,C),T=n.add(T,T),T=n.add(T,T),new q(B,I,T)}add(U){E(U);const{X:z,Y:k,Z:S}=this,{X:O,Y:P,Z:B}=U;let I=n.ZERO,T=n.ZERO,N=n.ZERO;const C=s.a,x=n.mul(s.b,Oi);let R=n.mul(z,O),H=n.mul(k,P),G=n.mul(S,B),J=n.add(z,k),Y=n.add(O,P);J=n.mul(J,Y),Y=n.add(R,H),J=n.sub(J,Y),Y=n.add(z,S);let X=n.add(O,B);return Y=n.mul(Y,X),X=n.add(R,G),Y=n.sub(Y,X),X=n.add(k,S),I=n.add(P,B),X=n.mul(X,I),I=n.add(H,G),X=n.sub(X,I),N=n.mul(C,Y),I=n.mul(x,G),N=n.add(I,N),I=n.sub(H,N),N=n.add(H,N),T=n.mul(I,N),H=n.add(R,R),H=n.add(H,R),G=n.mul(C,G),Y=n.mul(x,Y),H=n.add(H,G),G=n.sub(R,G),G=n.mul(C,G),Y=n.add(Y,G),R=n.mul(H,Y),T=n.add(T,R),R=n.mul(X,Y),I=n.mul(J,I),I=n.sub(I,R),R=n.mul(J,H),N=n.mul(X,N),N=n.add(N,R),new q(I,T,N)}subtract(U){return this.add(U.negate())}is0(){return this.equals(q.ZERO)}multiply(U){const{endo:z}=t;if(!o.isValidNot0(U))throw new Error("invalid scalar: out of range");let k,S;const O=P=>L.cached(this,P,B=>dg(q,B));if(z){const{k1neg:P,k1:B,k2neg:I,k2:T}=b(U),{p:N,f:C}=O(B),{p:x,f:R}=O(T);S=C.add(R),k=A(z.beta,N,x,P,I)}else{const{p:P,f:B}=O(U);k=P,S=B}return dg(q,[k,S])[0]}multiplyUnsafe(U){const{endo:z}=t,k=this;if(!o.isValid(U))throw new Error("invalid scalar: out of range");if(U===Nr||k.is0())return q.ZERO;if(U===_o)return k;if(L.hasCache(this))return this.multiply(U);if(z){const{k1neg:S,k1:O,k2neg:P,k2:B}=b(U),{p1:I,p2:T}=uU(q,k,O,B);return A(z.beta,I,T,S,P)}else return L.unsafe(k,U)}toAffine(U){return _(this,U)}isTorsionFree(){const{isTorsionFree:U}=t;return i===_o?!0:U?U(q,this):L.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:U}=t;return i===_o?this:U?U(q,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(U=!0){return va(U,"isCompressed"),this.assertValidity(),p(q,this,U)}toHex(U=!0){return we(this.toBytes(U))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const F=o.BITS,L=new cU(q,t.endo?Math.ceil(F/2):F);return q.BASE.precompute(8),q}function Xb(e){return Uint8Array.of(e?2:3)}function Qb(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function mU(e,t={}){const{Fn:r}=e,n=t.randomBytes||Vo,o=Object.assign(Qb(e.Fp,r),{seed:Vb(r.ORDER)});function s(p){try{const g=r.fromBytes(p);return r.isValidNot0(g)}catch{return!1}}function i(p,g){const{publicKey:m,publicKeyUncompressed:d}=o;try{const w=p.length;return g===!0&&w!==m||g===!1&&w!==d?!1:!!e.fromBytes(p)}catch{return!1}}function a(p=n(o.seed)){return Zb(ye(p,o.seed,"seed"),r.ORDER)}function c(p,g=!0){return e.BASE.multiply(r.fromBytes(p)).toBytes(g)}function u(p){const{secretKey:g,publicKey:m,publicKeyUncompressed:d}=o;if(!Cd(p)||"_lengths"in r&&r._lengths||g===m)return;const w=ye(p,void 0,"key").length;return w===m||w===d}function l(p,g,m=!0){if(u(p)===!0)throw new Error("first arg must be private key");if(u(g)===!1)throw new Error("second arg must be public key");const d=r.fromBytes(p);return e.fromBytes(g).multiply(d).toBytes(m)}const f={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:a},h=Wb(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:h,Point:e,utils:f,lengths:o})}function gU(e,t,r={}){pc(t),zd(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);const n=r.randomBytes||Vo,o=r.hmac||((z,k)=>Ns(t,z,k)),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i,{keygen:u,getPublicKey:l,getSharedSecret:f,utils:h,lengths:p}=mU(e,r),g={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},m=a*Yb<s.ORDER;function d(z){const k=a>>_o;return z>k}function w(z,k){if(!i.isValidNot0(k))throw new Error(`invalid signature ${z}: out of range 1..Point.Fn.ORDER`);return k}function y(){if(m)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function v(z,k){xl(k);const S=p.signature,O=k==="compact"?S:k==="recovered"?S+1:void 0;return ye(z,O)}class E{r;s;recovery;constructor(k,S,O){if(this.r=w("r",k),this.s=w("s",S),O!=null){if(y(),![0,1,2,3].includes(O))throw new Error("invalid recovery id");this.recovery=O}Object.freeze(this)}static fromBytes(k,S=g.format){v(k,S);let O;if(S==="der"){const{r:T,s:N}=nn.toSig(ye(k));return new E(T,N)}S==="recovered"&&(O=k[0],S="compact",k=k.subarray(1));const P=p.signature/2,B=k.subarray(0,P),I=k.subarray(P,P*2);return new E(i.fromBytes(B),i.fromBytes(I),O)}static fromHex(k,S){return this.fromBytes(Ce(k),S)}assertRecovery(){const{recovery:k}=this;if(k==null)throw new Error("invalid recovery id: must be present");return k}addRecoveryBit(k){return new E(this.r,this.s,k)}recoverPublicKey(k){const{r:S,s:O}=this,P=this.assertRecovery(),B=P===2||P===3?S+a:S;if(!s.isValid(B))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const I=s.toBytes(B),T=e.fromBytes(vt(Xb((P&1)===0),I)),N=i.inv(B),C=_(ye(k,void 0,"msgHash")),x=i.create(-C*N),R=i.create(O*N),H=e.BASE.multiplyUnsafe(x).add(T.multiplyUnsafe(R));if(H.is0())throw new Error("invalid recovery: point at infinify");return H.assertValidity(),H}hasHighS(){return d(this.s)}toBytes(k=g.format){if(xl(k),k==="der")return Ce(nn.hexFromSig(this));const{r:S,s:O}=this,P=i.toBytes(S),B=i.toBytes(O);return k==="recovered"?(y(),vt(Uint8Array.of(this.assertRecovery()),P,B)):vt(P,B)}toHex(k){return we(this.toBytes(k))}}const b=r.bits2int||function(k){if(k.length>8192)throw new Error("input is too large");const S=Os(k),O=k.length*8-c;return O>0?S>>BigInt(O):S},_=r.bits2int_modN||function(k){return i.create(b(k))},$=Ud(c);function A(z){return W8("num < 2^"+c,z,Nr,$),i.toBytes(z)}function q(z,k){return ye(z,void 0,"message"),k?ye(t(z),void 0,"prehashed message"):z}function F(z,k,S){const{lowS:O,prehash:P,extraEntropy:B}=Ou(S,g);z=q(z,P);const I=_(z),T=i.fromBytes(k);if(!i.isValidNot0(T))throw new Error("invalid private key");const N=[A(T),A(I)];if(B!=null&&B!==!1){const H=B===!0?n(p.secretKey):B;N.push(ye(H,void 0,"extraEntropy"))}const C=vt(...N),x=I;function R(H){const G=b(H);if(!i.isValidNot0(G))return;const J=i.inv(G),Y=e.BASE.multiply(G).toAffine(),X=i.create(Y.x);if(X===Nr)return;const M=i.create(J*i.create(x+X*T));if(M===Nr)return;let j=(Y.x===X?0:2)|Number(Y.y&_o),Z=M;return O&&d(M)&&(Z=i.neg(M),j^=1),new E(X,Z,m?void 0:j)}return{seed:C,k2sig:R}}function L(z,k,S={}){const{seed:O,k2sig:P}=F(z,k,S);return Y8(t.outputLen,i.BYTES,o)(O,P).toBytes(S.format)}function D(z,k,S,O={}){const{lowS:P,prehash:B,format:I}=Ou(O,g);if(S=ye(S,void 0,"publicKey"),k=q(k,B),!Cd(z)){const T=z instanceof E?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+T)}v(z,I);try{const T=E.fromBytes(z,I),N=e.fromBytes(S);if(P&&T.hasHighS())return!1;const{r:C,s:x}=T,R=_(k),H=i.inv(x),G=i.create(R*H),J=i.create(C*H),Y=e.BASE.multiplyUnsafe(G).add(N.multiplyUnsafe(J));return Y.is0()?!1:i.create(Y.x)===C}catch{return!1}}function U(z,k,S={}){const{prehash:O}=Ou(S,g);return k=q(k,O),E.fromBytes(z,"recovered").recoverPublicKey(k).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:f,utils:h,lengths:p,Point:e,sign:L,verify:D,recoverPublicKey:U,Signature:E,hash:t})}const gc={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},yU={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},wU=BigInt(0),kl=BigInt(2);function vU(e){const t=gc.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,l=u*u*e%t,f=Pt(l,r,t)*l%t,h=Pt(f,r,t)*l%t,p=Pt(h,kl,t)*u%t,g=Pt(p,o,t)*p%t,m=Pt(g,s,t)*g%t,d=Pt(m,a,t)*m%t,w=Pt(d,c,t)*d%t,y=Pt(w,a,t)*m%t,v=Pt(y,r,t)*l%t,E=Pt(v,i,t)*g%t,b=Pt(E,n,t)*u%t,_=Pt(b,kl,t);if(!_a.eql(_a.sqr(_),e))throw new Error("Cannot find square root");return _}const _a=mc(gc.p,{sqrt:vU}),Yn=pU(gc,{Fp:_a,endo:yU}),Md=gU(Yn,fr),yg={};function Ea(e,...t){let r=yg[e];if(r===void 0){const n=fr(K8(e));r=vt(n,n),yg[e]=r}return fr(vt(r,...t))}const qd=e=>e.toBytes(!0).slice(1),jd=e=>e%kl===wU;function Rl(e){const{Fn:t,BASE:r}=Yn,n=t.fromBytes(e),o=r.multiply(n);return{scalar:jd(o.y)?n:t.neg(n),bytes:qd(o)}}function e_(e){const t=_a;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x  p");const r=t.create(e*e),n=t.create(r*e+BigInt(7));let o=t.sqrt(n);jd(o)||(o=t.neg(o));const s=Yn.fromAffine({x:e,y:o});return s.assertValidity(),s}const us=Os;function t_(...e){return Yn.Fn.create(us(Ea("BIP0340/challenge",...e)))}function wg(e){return Rl(e).bytes}function bU(e,t,r=Vo(32)){const{Fn:n}=Yn,o=ye(e,void 0,"message"),{bytes:s,scalar:i}=Rl(t),a=ye(r,32,"auxRand"),c=n.toBytes(i^us(Ea("BIP0340/aux",a))),u=Ea("BIP0340/nonce",c,s,o),{bytes:l,scalar:f}=Rl(u),h=t_(l,s,o),p=new Uint8Array(64);if(p.set(l,0),p.set(n.toBytes(n.create(f+h*i)),32),!r_(p,o,s))throw new Error("sign: Invalid signature produced");return p}function r_(e,t,r){const{Fp:n,Fn:o,BASE:s}=Yn,i=ye(e,64,"signature"),a=ye(t,void 0,"message"),c=ye(r,32,"publicKey");try{const u=e_(us(c)),l=us(i.subarray(0,32));if(!n.isValidNot0(l))return!1;const f=us(i.subarray(32,64));if(!o.isValidNot0(f))return!1;const h=t_(o.toBytes(l),qd(u),a),p=s.multiplyUnsafe(f).add(u.multiplyUnsafe(o.neg(h))),{x:g,y:m}=p.toAffine();return!(p.is0()||!jd(m)||g!==l)}catch{return!1}}const rs=(()=>{const r=(n=Vo(48))=>Zb(n,gc.n);return{keygen:Wb(r,wg),getPublicKey:wg,sign:bU,verify:r_,Point:Yn,utils:{randomSecretKey:r,taggedHash:Ea,lift_x:e_,pointToBytes:qd},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})();function Dd(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function _U(e){if(!Dd(e))throw new Error("Uint8Array expected")}function n_(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(r=>typeof r=="string"):t.every(r=>Number.isSafeInteger(r)):!1}function EU(e){if(typeof e!="function")throw new Error("function expected");return!0}function Gn(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Fd(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function Tl(e){if(!Array.isArray(e))throw new Error("array expected")}function $a(e,t){if(!n_(!0,t))throw new Error(`${e}: array of strings expected`)}function o_(e,t){if(!n_(!1,t))throw new Error(`${e}: array of numbers expected`)}function s_(...e){const t=s=>s,r=(s,i)=>a=>s(i(a)),n=e.map(s=>s.encode).reduceRight(r,t),o=e.map(s=>s.decode).reduce(r,t);return{encode:n,decode:o}}function i_(e){const t=typeof e=="string"?e.split(""):e,r=t.length;$a("alphabet",t);const n=new Map(t.map((o,s)=>[o,s]));return{encode:o=>(Tl(o),o.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:o=>(Tl(o),o.map(s=>{Gn("alphabet.decode",s);const i=n.get(s);if(i===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return i}))}}function a_(e=""){return Gn("join",e),{encode:t=>($a("join.decode",t),t.join(e)),decode:t=>(Gn("join.decode",t),t.split(e))}}function $U(e,t="="){return Fd(e),Gn("padding",t),{encode(r){for($a("padding.encode",r);r.length*e%8;)r.push(t);return r},decode(r){$a("padding.decode",r);let n=r.length;if(n*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if((n-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}const c_=(e,t)=>t===0?e:c_(t,e%t),Sa=(e,t)=>e+(t-c_(e,t)),Gi=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function Al(e,t,r,n){if(Tl(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Sa(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${Sa(t,r)}`);let o=0,s=0;const i=Gi[t],a=Gi[r]-1,c=[];for(const u of e){if(Fd(u),u>=i)throw new Error(`convertRadix2: invalid data word=${u} from=${t}`);if(o=o<<t|u,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=r;s-=r)c.push((o>>s-r&a)>>>0);const l=Gi[s];if(l===void 0)throw new Error("invalid carry");o&=l-1}if(o=o<<r-s&a,!n&&s>=t)throw new Error("Excess padding");if(!n&&o>0)throw new Error(`Non-zero padding: ${o}`);return n&&s>0&&c.push(o>>>0),c}function u_(e,t=!1){if(Fd(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Sa(8,e)>32||Sa(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Dd(r))throw new Error("radix2.encode input should be Uint8Array");return Al(Array.from(r),8,e,!t)},decode:r=>(o_("radix2.decode",r),Uint8Array.from(Al(r,e,8,t)))}}function vg(e){return EU(e),function(...t){try{return e.apply(null,t)}catch{}}}const SU=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",xU=(e,t)=>{Gn("base64",e);const r=/^[A-Za-z0-9=+/]+$/,n="base64";if(e.length>0&&!r.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:n,lastChunkHandling:"strict"})},yn=SU?{encode(e){return _U(e),e.toBase64()},decode(e){return xU(e)}}:s_(u_(6),i_("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),$U(6),a_("")),Il=s_(i_("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),a_("")),bg=[996825010,642813549,513874426,1027748829,705979059];function ns(e){const t=e>>25;let r=(e&33554431)<<5;for(let n=0;n<bg.length;n++)(t>>n&1)===1&&(r^=bg[n]);return r}function _g(e,t,r=1){const n=e.length;let o=1;for(let s=0;s<n;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=ns(o)^i>>5}o=ns(o);for(let s=0;s<n;s++)o=ns(o)^e.charCodeAt(s)&31;for(let s of t)o=ns(o)^s;for(let s=0;s<6;s++)o=ns(o);return o^=r,Il.encode(Al([o%Gi[30]],30,5,!1))}function kU(e){const t=e==="bech32"?1:734539939,r=u_(5),n=r.decode,o=r.encode,s=vg(n);function i(f,h,p=90){Gn("bech32.encode prefix",f),Dd(h)&&(h=Array.from(h)),o_("bech32.encode",h);const g=f.length;if(g===0)throw new TypeError(`Invalid prefix length ${g}`);const m=g+7+h.length;if(p!==!1&&m>p)throw new TypeError(`Length ${m} exceeds limit ${p}`);const d=f.toLowerCase(),w=_g(d,h,t);return`${d}1${Il.encode(h)}${w}`}function a(f,h=90){Gn("bech32.decode input",f);const p=f.length;if(p<8||h!==!1&&p>h)throw new TypeError(`invalid string length: ${p} (${f}). Expected (8..${h})`);const g=f.toLowerCase();if(f!==g&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");const m=g.lastIndexOf("1");if(m===0||m===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=g.slice(0,m),w=g.slice(m+1);if(w.length<6)throw new Error("Data must be at least 6 characters long");const y=Il.decode(w).slice(0,-6),v=_g(d,y,t);if(!w.endsWith(v))throw new Error(`Invalid checksum in ${f}: expected "${v}"`);return{prefix:d,words:y}}const c=vg(a);function u(f){const{prefix:h,words:p}=a(f,!1);return{prefix:h,words:p,bytes:n(p)}}function l(f,h){return i(f,o(h))}return{encode:i,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:o}}const Lo=kU("bech32");function RU(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Eg(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Nu(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function yt(e,t,r=""){const n=RU(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){const i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function ut(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Uo(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const TU=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function AU(e,t){return e.buffer===t.buffer&&e.byteOffset<t.byteOffset+t.byteLength&&t.byteOffset<e.byteOffset+e.byteLength}function l_(e,t){if(AU(e,t)&&e.byteOffset<t.byteOffset)throw new Error("complex overlap of input and output is not supported")}function IU(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function OU(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const NU=(e,t)=>{function r(n,...o){if(yt(n,void 0,"key"),!TU)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const l=o[0];yt(l,e.varSizeNonce?void 0:e.nonceLength,"nonce")}const s=e.tagLength;s&&o[1]!==void 0&&yt(o[1],void 0,"AAD");const i=t(n,...o),a=(l,f)=>{if(f!==void 0){if(l!==2)throw new Error("cipher output not supported");yt(f,void 0,"output")}};let c=!1;return{encrypt(l,f){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,yt(l),a(i.encrypt.length,f),i.encrypt(l,f)},decrypt(l,f){if(yt(l),s&&l.length<s)throw new Error('"ciphertext" expected length bigger than tagLength='+s);return a(i.decrypt.length,f),i.decrypt(l,f)}}}return Object.assign(r,e),r};function f_(e,t,r=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&!Eo(t))throw new Error("invalid output, must be aligned");return t}function Eo(e){return e.byteOffset%4===0}function Hn(e){return Uint8Array.from(e)}const ln=16,CU=283;function PU(e){if(![16,24,32].includes(e.length))throw new Error('"aes key" expected Uint8Array of length 16/24/32, got length='+e.length)}function Hd(e){return e<<1^CU&-(e>>7)}function mo(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=Hd(e);return r}const Ol=(()=>{const e=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=Hd(n))e[r]=n;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return Uo(e),t})(),LU=Ol.map((e,t)=>Ol.indexOf(t)),UU=e=>e<<24|e>>>8,Cu=e=>e<<8|e>>>24;function d_(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((u,l)=>t(e[l])),n=r.map(Cu),o=n.map(Cu),s=o.map(Cu),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let l=0;l<256;l++){const f=u*256+l;i[f]=r[u]^n[l],a[f]=o[u]^s[l],c[f]=e[u]<<8|e[l]}return{sbox:e,sbox2:c,T0:r,T1:n,T2:o,T3:s,T01:i,T23:a}}const Vd=d_(Ol,e=>mo(e,3)<<24|e<<16|e<<8|mo(e,2)),h_=d_(LU,e=>mo(e,11)<<24|mo(e,13)<<16|mo(e,9)<<8|mo(e,14)),zU=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=Hd(r))e[t]=r;return e})();function p_(e){yt(e);const t=e.length;PU(e);const{sbox2:r}=Vd,n=[];Eo(e)||n.push(e=Hn(e));const o=ut(e),s=o.length,i=c=>lr(r,c,c,c,c),a=new Uint32Array(t+28);a.set(o);for(let c=s;c<a.length;c++){let u=a[c-1];c%s===0?u=i(UU(u))^zU[c/s-1]:s>6&&c%s===4&&(u=i(u)),a[c]=a[c-s]^u}return Uo(...n),a}function BU(e){const t=p_(e),r=t.slice(),n=t.length,{sbox2:o}=Vd,{T0:s,T1:i,T2:a,T3:c}=h_;for(let u=0;u<n;u+=4)for(let l=0;l<4;l++)r[u+l]=t[n-u-4+l];Uo(t);for(let u=4;u<n-4;u++){const l=r[u],f=lr(o,l,l,l,l);r[u]=s[f&255]^i[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return r}function an(e,t,r,n,o,s){return e[r<<8&65280|n>>>8&255]^t[o>>>8&65280|s>>>24&255]}function lr(e,t,r,n,o){return e[t&255|r&65280]|e[n>>>16&255|o>>>16&65280]<<16}function $g(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=Vd;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^an(i,a,t,r,n,o),d=e[c++]^an(i,a,r,n,o,t),w=e[c++]^an(i,a,n,o,t,r),y=e[c++]^an(i,a,o,t,r,n);t=m,r=d,n=w,o=y}const l=e[c++]^lr(s,t,r,n,o),f=e[c++]^lr(s,r,n,o,t),h=e[c++]^lr(s,n,o,t,r),p=e[c++]^lr(s,o,t,r,n);return{s0:l,s1:f,s2:h,s3:p}}function MU(e,t,r,n,o){const{sbox2:s,T01:i,T23:a}=h_;let c=0;t^=e[c++],r^=e[c++],n^=e[c++],o^=e[c++];const u=e.length/4-2;for(let g=0;g<u;g++){const m=e[c++]^an(i,a,t,o,n,r),d=e[c++]^an(i,a,r,t,o,n),w=e[c++]^an(i,a,n,r,t,o),y=e[c++]^an(i,a,o,n,r,t);t=m,r=d,n=w,o=y}const l=e[c++]^lr(s,t,o,n,r),f=e[c++]^lr(s,r,t,o,n),h=e[c++]^lr(s,n,r,t,o),p=e[c++]^lr(s,o,n,r,t);return{s0:l,s1:f,s2:h,s3:p}}function qU(e){if(yt(e),e.length%ln!==0)throw new Error("aes-(cbc/ecb).decrypt ciphertext should consist of blocks with size "+ln)}function jU(e,t,r){yt(e);let n=e.length;const o=n%ln;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");Eo(e)||(e=Hn(e));const s=ut(e);if(t){let a=ln-o;a||(a=ln),n=n+a}r=f_(n,r),l_(e,r);const i=ut(r);return{b:s,o:i,out:r}}function DU(e,t){if(!t)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=e[r-1];if(n<=0||n>16)throw new Error("aes/pcks5: wrong padding");const o=e.subarray(0,-n);for(let s=0;s<n;s++)if(e[r-s-1]!==n)throw new Error("aes/pcks5: wrong padding");return o}function FU(e){const t=new Uint8Array(16),r=ut(t);t.set(e);const n=ln-e.length;for(let o=ln-n;o<ln;o++)t[o]=n;return r}const m_=NU({blockSize:16,nonceLength:16},function(t,r,n={}){const o=!n.disablePadding;return{encrypt(s,i){const a=p_(t),{b:c,o:u,out:l}=jU(s,o,i);let f=r;const h=[a];Eo(f)||h.push(f=Hn(f));const p=ut(f);let g=p[0],m=p[1],d=p[2],w=p[3],y=0;for(;y+4<=c.length;)g^=c[y+0],m^=c[y+1],d^=c[y+2],w^=c[y+3],{s0:g,s1:m,s2:d,s3:w}=$g(a,g,m,d,w),u[y++]=g,u[y++]=m,u[y++]=d,u[y++]=w;if(o){const v=FU(s.subarray(y*4));g^=v[0],m^=v[1],d^=v[2],w^=v[3],{s0:g,s1:m,s2:d,s3:w}=$g(a,g,m,d,w),u[y++]=g,u[y++]=m,u[y++]=d,u[y++]=w}return Uo(...h),l},decrypt(s,i){qU(s);const a=BU(t);let c=r;const u=[a];Eo(c)||u.push(c=Hn(c));const l=ut(c);i=f_(s.length,i),Eo(s)||u.push(s=Hn(s)),l_(s,i);const f=ut(s),h=ut(i);let p=l[0],g=l[1],m=l[2],d=l[3];for(let w=0;w+4<=f.length;){const y=p,v=g,E=m,b=d;p=f[w+0],g=f[w+1],m=f[w+2],d=f[w+3];const{s0:_,s1:$,s2:A,s3:q}=MU(a,p,g,m,d);h[w++]=_^y,h[w++]=$^v,h[w++]=A^E,h[w++]=q^b}return Uo(...u),DU(i,o)}}}),g_=e=>Uint8Array.from(e.split(""),t=>t.charCodeAt(0)),HU=g_("expand 16-byte k"),VU=g_("expand 32-byte k"),ZU=ut(HU),KU=ut(VU);function fe(e,t){return e<<t|e>>>32-t}function Nl(e){return e.byteOffset%4===0}const Ni=64,GU=16,y_=2**32-1,Sg=Uint32Array.of();function WU(e,t,r,n,o,s,i,a){const c=o.length,u=new Uint8Array(Ni),l=ut(u),f=Nl(o)&&Nl(s),h=f?ut(o):Sg,p=f?ut(s):Sg;for(let g=0;g<c;i++){if(e(t,r,n,l,i,a),i>=y_)throw new Error("arx: counter overflow");const m=Math.min(Ni,c-g);if(f&&m===Ni){const d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<GU;w++)y=d+w,p[y]=h[y]^l[w];g+=Ni;continue}for(let d=0,w;d<m;d++)w=g+d,s[w]=o[w]^u[d];g+=m}}function JU(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=IU({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Nu(o),Nu(i),Eg(s),Eg(r),(a,c,u,l,f=0)=>{yt(a,void 0,"key"),yt(c,void 0,"nonce"),yt(u,void 0,"data");const h=u.length;if(l===void 0&&(l=new Uint8Array(h)),yt(l,void 0,"output"),Nu(f),f<0||f>=y_)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const p=[];let g=a.length,m,d;if(g===32)p.push(m=Hn(a)),d=KU;else if(g===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),d=ZU,p.push(m);else throw yt(a,32,"arx key"),new Error("invalid key size");Nl(c)||p.push(c=Hn(c));const w=ut(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(d,w,ut(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-o;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,p.push(c)}const v=ut(c);return WU(e,d,w,v,u,l,f,i),Uo(...p),l}}function YU(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],u=e[3],l=t[0],f=t[1],h=t[2],p=t[3],g=t[4],m=t[5],d=t[6],w=t[7],y=o,v=r[0],E=r[1],b=r[2],_=i,$=a,A=c,q=u,F=l,L=f,D=h,U=p,z=g,k=m,S=d,O=w,P=y,B=v,I=E,T=b;for(let C=0;C<s;C+=2)_=_+F|0,P=fe(P^_,16),z=z+P|0,F=fe(F^z,12),_=_+F|0,P=fe(P^_,8),z=z+P|0,F=fe(F^z,7),$=$+L|0,B=fe(B^$,16),k=k+B|0,L=fe(L^k,12),$=$+L|0,B=fe(B^$,8),k=k+B|0,L=fe(L^k,7),A=A+D|0,I=fe(I^A,16),S=S+I|0,D=fe(D^S,12),A=A+D|0,I=fe(I^A,8),S=S+I|0,D=fe(D^S,7),q=q+U|0,T=fe(T^q,16),O=O+T|0,U=fe(U^O,12),q=q+U|0,T=fe(T^q,8),O=O+T|0,U=fe(U^O,7),_=_+L|0,T=fe(T^_,16),S=S+T|0,L=fe(L^S,12),_=_+L|0,T=fe(T^_,8),S=S+T|0,L=fe(L^S,7),$=$+D|0,P=fe(P^$,16),O=O+P|0,D=fe(D^O,12),$=$+D|0,P=fe(P^$,8),O=O+P|0,D=fe(D^O,7),A=A+U|0,B=fe(B^A,16),z=z+B|0,U=fe(U^z,12),A=A+U|0,B=fe(B^A,8),z=z+B|0,U=fe(U^z,7),q=q+F|0,I=fe(I^q,16),k=k+I|0,F=fe(F^k,12),q=q+F|0,I=fe(I^q,8),k=k+I|0,F=fe(F^k,7);let N=0;n[N++]=i+_|0,n[N++]=a+$|0,n[N++]=c+A|0,n[N++]=u+q|0,n[N++]=l+F|0,n[N++]=f+L|0,n[N++]=h+D|0,n[N++]=p+U|0,n[N++]=g+z|0,n[N++]=m+k|0,n[N++]=d+S|0,n[N++]=w+O|0,n[N++]=y+P|0,n[N++]=v+B|0,n[N++]=E+I|0,n[N++]=b+T|0}const w_=JU(YU,{counterRight:!1,counterLength:4,allowShortKeys:!1});function XU(e,t,r){return pc(e),r===void 0&&(r=new Uint8Array(e.outputLen)),Ns(e,r,t)}const Pu=Uint8Array.of(0),xg=Uint8Array.of();function QU(e,t,r,n=32){pc(e),gn(n,"length");const o=e.outputLen;if(n>255*o)throw new Error("Length must be <= 255*HashLen");const s=Math.ceil(n/o);r===void 0?r=xg:ye(r,void 0,"info");const i=new Uint8Array(s*o),a=Ns.create(e,t),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Pu[0]=l+1,c.update(l===0?xg:u).update(r).update(Pu).digestInto(u),i.set(u,o*l),a._cloneInto(c);return a.destroy(),c.destroy(),bs(u,Pu),i.slice(0,n)}var ez=Object.defineProperty,Se=(e,t)=>{for(var r in t)ez(e,r,{get:t[r],enumerable:!0})},io=Symbol("verified"),tz=e=>e instanceof Object;function Zd(e){if(!tz(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}var rz={};Se(rz,{binarySearch:()=>Kd,bytesToHex:()=>we,hexToBytes:()=>Ce,insertEventIntoAscendingList:()=>sz,insertEventIntoDescendingList:()=>oz,mergeReverseSortedLists:()=>iz,normalizeURL:()=>nz,utf8Decoder:()=>Cr,utf8Encoder:()=>Bt});var Cr=new TextDecoder("utf-8"),Bt=new TextEncoder;function nz(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function oz(e,t){const[r,n]=Kd(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return n||e.splice(r,0,t),e}function sz(e,t){const[r,n]=Kd(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return n||e.splice(r,0,t),e}function Kd(e,t){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?n=o-1:r=o+1}return[r,!1]}function iz(e,t){const r=new Array(e.length+t.length);r.length=0;let n=0,o=0,s=[];for(;n<e.length&&o<t.length;){let i;if(e[n]?.created_at>t[o]?.created_at?(i=e[n],n++):(i=t[o],o++),r.length>0&&r[r.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;r.push(i),s.push(i.id)}for(;n<e.length;){const i=e[n];if(n++,r.length>0&&r[r.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;r.push(i),s.push(i.id)}for(;o<t.length;){const i=t[o];if(o++,r.length>0&&r[r.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;r.push(i),s.push(i.id)}return r}var az=class{generateSecretKey(){return rs.utils.randomSecretKey()}getPublicKey(e){return we(rs.getPublicKey(e))}finalizeEvent(e,t){const r=e;return r.pubkey=we(rs.getPublicKey(t)),r.id=Wi(r),r.sig=we(rs.sign(Ce(Wi(r)),t)),r[io]=!0,r}verifyEvent(e){if(typeof e[io]=="boolean")return e[io];const t=Wi(e);if(t!==e.id)return e[io]=!1,!1;try{const r=rs.verify(Ce(e.sig),Ce(t),Ce(e.pubkey));return e[io]=r,r}catch{return e[io]=!1,!1}}};function cz(e){if(!Zd(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Wi(e){let t=fr(Bt.encode(cz(e)));return we(t)}var yc=new az,uz=yc.generateSecretKey,Gd=yc.getPublicKey,hr=yc.finalizeEvent,Cs=yc.verifyEvent,lz={};Se(lz,{Application:()=>EB,BadgeAward:()=>wz,BadgeDefinition:()=>mB,BlockedRelaysList:()=>Yz,BlossomServerList:()=>oB,BookmarkList:()=>Gz,Bookmarksets:()=>dB,Calendar:()=>AB,CalendarEventRSVP:()=>IB,ChannelCreation:()=>S_,ChannelHideMessage:()=>R_,ChannelMessage:()=>k_,ChannelMetadata:()=>x_,ChannelMuteUser:()=>T_,ChatMessage:()=>vz,ClassifiedListing:()=>xB,ClientAuth:()=>I_,Comment:()=>Tz,CommunitiesList:()=>Wz,CommunityDefinition:()=>PB,CommunityPostApproval:()=>Uz,Contacts:()=>mz,CreateOrUpdateProduct:()=>wB,CreateOrUpdateStall:()=>yB,Curationsets:()=>hB,Date:()=>RB,DirectMessageRelaysList:()=>rB,DraftClassifiedListing:()=>kB,DraftLong:()=>bB,Emojisets:()=>_B,EncryptedDirectMessage:()=>gz,EventDeletion:()=>yz,FavoriteRelays:()=>Qz,FileMessage:()=>_z,FileMetadata:()=>Rz,FileServerPreference:()=>nB,Followsets:()=>uB,ForumThread:()=>bz,GenericRepost:()=>Qd,Genericlists:()=>lB,GiftWrap:()=>A_,GroupMetadata:()=>LB,HTTPAuth:()=>eh,Handlerinformation:()=>CB,Handlerrecommendation:()=>NB,Highlights:()=>Fz,InterestsList:()=>eB,Interestsets:()=>gB,JobFeedback:()=>Mz,JobRequest:()=>zz,JobResult:()=>Bz,Label:()=>Lz,LightningPubRPC:()=>iB,LiveChatMessage:()=>Az,LiveEvent:()=>$B,LongFormArticle:()=>vB,Metadata:()=>hz,Mutelist:()=>Vz,NWCWalletInfo:()=>sB,NWCWalletRequest:()=>O_,NWCWalletResponse:()=>aB,NormalVideo:()=>$z,NostrConnect:()=>cB,OpenTimestamps:()=>xz,Photo:()=>Ez,Pinlist:()=>Zz,Poll:()=>kz,PollResponse:()=>Hz,PrivateDirectMessage:()=>$_,ProblemTracker:()=>Nz,ProfileBadges:()=>pB,PublicChatsList:()=>Jz,Reaction:()=>Xd,RecommendRelay:()=>pz,RelayList:()=>Kz,RelayReview:()=>OB,Relaysets:()=>fB,Report:()=>Cz,Reporting:()=>Pz,Repost:()=>Yd,Seal:()=>E_,SearchRelaysList:()=>Xz,ShortTextNote:()=>__,ShortVideo:()=>Sz,Time:()=>TB,UserEmojiList:()=>tB,UserStatuses:()=>SB,Voice:()=>Iz,VoiceComment:()=>Oz,Zap:()=>Dz,ZapGoal:()=>qz,ZapRequest:()=>jz,classifyKind:()=>fz,isAddressableKind:()=>Jd,isEphemeralKind:()=>b_,isKind:()=>dz,isRegularKind:()=>v_,isReplaceableKind:()=>Wd});function v_(e){return e<1e4&&e!==0&&e!==3}function Wd(e){return e===0||e===3||1e4<=e&&e<2e4}function b_(e){return 2e4<=e&&e<3e4}function Jd(e){return 3e4<=e&&e<4e4}function fz(e){return v_(e)?"regular":Wd(e)?"replaceable":b_(e)?"ephemeral":Jd(e)?"parameterized":"unknown"}function dz(e,t){const r=t instanceof Array?t:[t];return Zd(e)&&r.includes(e.kind)||!1}var hz=0,__=1,pz=2,mz=3,gz=4,yz=5,Yd=6,Xd=7,wz=8,vz=9,bz=11,E_=13,$_=14,_z=15,Qd=16,Ez=20,$z=21,Sz=22,S_=40,x_=41,k_=42,R_=43,T_=44,xz=1040,A_=1059,kz=1068,Rz=1063,Tz=1111,Az=1311,Iz=1222,Oz=1244,Nz=1971,Cz=1984,Pz=1984,Lz=1985,Uz=4550,zz=5999,Bz=6999,Mz=7e3,qz=9041,jz=9734,Dz=9735,Fz=9802,Hz=1018,Vz=1e4,Zz=10001,Kz=10002,Gz=10003,Wz=10004,Jz=10005,Yz=10006,Xz=10007,Qz=10012,eB=10015,tB=10030,rB=10050,nB=10096,oB=10063,sB=13194,iB=21e3,I_=22242,O_=23194,aB=23195,cB=24133,eh=27235,uB=3e4,lB=30001,fB=30002,dB=30003,hB=30004,pB=30008,mB=30009,gB=30015,yB=30017,wB=30018,vB=30023,bB=30024,_B=30030,EB=30078,$B=30311,SB=30315,xB=30402,kB=30403,RB=31922,TB=31923,AB=31924,IB=31925,OB=31987,NB=31989,CB=31990,PB=34550,LB=39e3,UB={};Se(UB,{getHex64:()=>th,getInt:()=>N_,getSubscriptionId:()=>zB,matchEventId:()=>BB,matchEventKind:()=>qB,matchEventPubkey:()=>MB});function th(e,t){let r=t.length+3,n=e.indexOf(`"${t}":`)+r,o=e.slice(n).indexOf('"')+n+1;return e.slice(o,o+64)}function N_(e,t){let r=t.length,n=e.indexOf(`"${t}":`)+r+3,o=e.slice(n),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function zB(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let r=e.slice(t+7+1).indexOf('"');if(r===-1)return null;let n=t+7+1+r,o=e.slice(n+1,80).indexOf('"');if(o===-1)return null;let s=n+1+o;return e.slice(n+1,s)}function BB(e,t){return t===th(e,"id")}function MB(e,t){return t===th(e,"pubkey")}function qB(e,t){return t===N_(e,"kind")}var jB={};Se(jB,{makeAuthEvent:()=>DB});function DB(e,t){return{kind:I_,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var FB;try{FB=WebSocket}catch{}var HB;try{HB=WebSocket}catch{}var _s={};Se(_s,{BECH32_REGEX:()=>C_,Bech32MaxSize:()=>rh,NostrTypeGuard:()=>VB,decode:()=>wc,decodeNostrURI:()=>KB,encodeBytes:()=>bc,naddrEncode:()=>QB,neventEncode:()=>XB,noteEncode:()=>JB,nprofileEncode:()=>YB,npubEncode:()=>WB,nsecEncode:()=>GB});var VB={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},rh=5e3,C_=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ZB(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function KB(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),wc(e)}catch{return{type:"invalid",data:null}}}function wc(e){let{prefix:t,words:r}=Lo.decode(e,rh),n=new Uint8Array(Lo.fromWords(r));switch(t){case"nprofile":{let o=Lu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:we(o[0][0]),relays:o[1]?o[1].map(s=>Cr.decode(s)):[]}}}case"nevent":{let o=Lu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:we(o[0][0]),relays:o[1]?o[1].map(s=>Cr.decode(s)):[],author:o[2]?.[0]?we(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(we(o[3][0]),16):void 0}}}case"naddr":{let o=Lu(n);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Cr.decode(o[0][0]),pubkey:we(o[2][0]),kind:parseInt(we(o[3][0]),16),relays:o[1]?o[1].map(s=>Cr.decode(s)):[]}}}case"nsec":return{type:t,data:n};case"npub":case"note":return{type:t,data:we(n)};default:throw new Error(`unknown prefix ${t}`)}}function Lu(e){let t={},r=e;for(;r.length>0;){let n=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${n}`);t[n]=t[n]||[],t[n].push(s)}return t}function GB(e){return bc("nsec",e)}function WB(e){return bc("npub",Ce(e))}function JB(e){return bc("note",Ce(e))}function vc(e,t){let r=Lo.toWords(t);return Lo.encode(e,r,rh)}function bc(e,t){return vc(e,t)}function YB(e){let t=nh({0:[Ce(e.pubkey)],1:(e.relays||[]).map(r=>Bt.encode(r))});return vc("nprofile",t)}function XB(e){let t;e.kind!==void 0&&(t=ZB(e.kind));let r=nh({0:[Ce(e.id)],1:(e.relays||[]).map(n=>Bt.encode(n)),2:e.author?[Ce(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return vc("nevent",r)}function QB(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let r=nh({0:[Bt.encode(e.identifier)],1:(e.relays||[]).map(n=>Bt.encode(n)),2:[Ce(e.pubkey)],3:[new Uint8Array(t)]});return vc("naddr",r)}function nh(e){let t=[];return Object.entries(e).reverse().forEach(([r,n])=>{n.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),vt(...t)}var eM={};Se(eM,{decrypt:()=>tM,encrypt:()=>P_});function P_(e,t,r){const n=e instanceof Uint8Array?e:Ce(e),o=Md.getSharedSecret(n,Ce("02"+t)),s=L_(o);let i=Uint8Array.from(Vo(16)),a=Bt.encode(r),c=m_(s,i).encrypt(a),u=yn.encode(new Uint8Array(c)),l=yn.encode(new Uint8Array(i.buffer));return`${u}?iv=${l}`}function tM(e,t,r){const n=e instanceof Uint8Array?e:Ce(e);let[o,s]=r.split("?iv="),i=Md.getSharedSecret(n,Ce("02"+t)),a=L_(i),c=yn.decode(s),u=yn.decode(o),l=m_(a,c).decrypt(u);return Cr.decode(l)}function L_(e){return e.slice(1,33)}var rM={};Se(rM,{NIP05_REGEX:()=>oh,isNip05:()=>nM,isValid:()=>iM,queryProfile:()=>U_,searchDomain:()=>sM,useFetchImplementation:()=>oM});var oh=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,nM=e=>oh.test(e||""),_c;try{_c=fetch}catch{}function oM(e){_c=e}async function sM(e,t=""){try{const r=`https://${e}/.well-known/nostr.json?name=${t}`,n=await _c(r,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function U_(e){const t=e.match(oh);if(!t)return null;const[,r="_",n]=t;try{const o=`https://${n}/.well-known/nostr.json?name=${r}`,s=await _c(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const i=await s.json(),a=i.names[r];return a?{pubkey:a,relays:i.relays?.[a]}:null}catch{return null}}async function iM(e,t){const r=await U_(t);return r?r.pubkey===e:!1}var aM={};Se(aM,{parse:()=>cM});function cM(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,n;for(let o=e.tags.length-1;o>=0;o--){const s=e.tags[o];if(s[0]==="e"&&s[1]){const[i,a,c,u,l]=s,f={id:a,relays:c?[c]:[],author:l};if(u==="root"){t.root=f;continue}if(u==="reply"){t.reply=f;continue}if(u==="mention"){t.mentions.push(f);continue}r?n=f:r=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[i,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=n||r||t.reply),t.reply||(t.reply=r||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{o.relays?.indexOf(a)===-1&&o.relays.push(a)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var uM={};Se(uM,{fetchRelayInformation:()=>fM,useFetchImplementation:()=>lM});var z_;try{z_=fetch}catch{}function lM(e){z_=e}async function fM(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var dM={};Se(dM,{fastEventHash:()=>M_,getPow:()=>B_,minePow:()=>hM});function B_(e){let t=0;for(let r=0;r<64;r+=8){const n=parseInt(e.substring(r,r+8),16);if(n===0)t+=32;else{t+=Math.clz32(n);break}}return t}function hM(e,t){let r=0;const n=e,o=["nonce",r.toString(),t.toString()];for(n.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==n.created_at&&(r=0,n.created_at=s),o[1]=(++r).toString(),n.id=M_(n),B_(n.id)>=t)break}return n}function M_(e){return we(fr(Bt.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var pM={};Se(pM,{unwrapEvent:()=>kM,unwrapManyEvents:()=>RM,wrapEvent:()=>X_,wrapManyEvents:()=>xM});var mM={};Se(mM,{createRumor:()=>G_,createSeal:()=>W_,createWrap:()=>J_,unwrapEvent:()=>uh,unwrapManyEvents:()=>Y_,wrapEvent:()=>xa,wrapManyEvents:()=>$M});var gM={};Se(gM,{decrypt:()=>ch,encrypt:()=>ah,getConversationKey:()=>sh,v2:()=>_M});var q_=1,j_=65535;function sh(e,t){const r=Md.getSharedSecret(e,Ce("02"+t)).subarray(1,33);return XU(fr,r,Bt.encode("nip44-v2"))}function D_(e,t){const r=QU(fr,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function ih(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function yM(e){if(!Number.isSafeInteger(e)||e<q_||e>j_)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function wM(e){const t=Bt.encode(e),r=t.length,n=yM(r),o=new Uint8Array(ih(r)-r);return vt(n,t,o)}function vM(e){const t=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+t);if(t<q_||t>j_||r.length!==t||e.length!==2+ih(t))throw new Error("invalid padding");return Cr.decode(r)}function F_(e,t,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=vt(r,t);return Ns(fr,e,n)}function bM(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=yn.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const n=r.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function ah(e,t,r=Vo(32)){const{chacha_key:n,chacha_nonce:o,hmac_key:s}=D_(t,r),i=wM(e),a=w_(n,o,i),c=F_(s,a,r);return yn.encode(vt(new Uint8Array([2]),r,a,c))}function ch(e,t){const{nonce:r,ciphertext:n,mac:o}=bM(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=D_(t,r),c=F_(a,n,r);if(!OU(c,o))throw new Error("invalid MAC");const u=w_(s,i,n);return vM(u)}var _M={utils:{getConversationKey:sh,calcPaddedLen:ih},encrypt:ah,decrypt:ch},EM=2880*60,H_=()=>Math.round(Date.now()/1e3),V_=()=>Math.round(H_()-Math.random()*EM),Z_=(e,t)=>sh(e,t),K_=(e,t,r)=>ah(JSON.stringify(e),Z_(t,r)),kg=(e,t)=>JSON.parse(ch(e.content,Z_(t,e.pubkey)));function G_(e,t){const r={created_at:H_(),content:"",tags:[],...e,pubkey:Gd(t)};return r.id=Wi(r),r}function W_(e,t,r){return hr({kind:E_,content:K_(e,t,r),created_at:V_(),tags:[]},t)}function J_(e,t){const r=uz();return hr({kind:A_,content:K_(e,r,t),created_at:V_(),tags:[["p",t]]},r)}function xa(e,t,r){const n=G_(e,t),o=W_(n,t,r);return J_(o,r)}function $M(e,t,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const n=Gd(t),o=[xa(e,t,n)];return r.forEach(s=>{o.push(xa(e,t,s))}),o}function uh(e,t){const r=kg(e,t);return kg(r,t)}function Y_(e,t){let r=[];return e.forEach(n=>{r.push(uh(n,t))}),r.sort((n,o)=>n.created_at-o.created_at),r}function SM(e,t,r,n){const o={created_at:Math.ceil(Date.now()/1e3),kind:$_,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),n&&o.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&o.tags.push(["subject",r]),o}function X_(e,t,r,n,o){const s=SM(t,r,n,o);return xa(s,e,t.publicKey)}function xM(e,t,r,n,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Gd(e)},...t].map(i=>X_(e,i,r,n,o))}var kM=uh,RM=Y_,TM={};Se(TM,{finishRepostEvent:()=>AM,getRepostedEvent:()=>IM,getRepostedEventPointer:()=>Q_});function AM(e,t,r,n){let o;const s=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===__?o=Yd:(o=Qd,s.push(["k",String(t.kind)])),hr({kind:o,tags:s,content:e.content===""||t.tags?.find(i=>i[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},n)}function Q_(e){if(![Yd,Qd].includes(e.kind))return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(t!==void 0)return{id:t[1],relays:[t[2],r?.[2]].filter(n=>typeof n=="string"),author:r?.[1]}}function IM(e,{skipVerification:t}={}){const r=Q_(e);if(r===void 0||e.content==="")return;let n;try{n=JSON.parse(e.content)}catch{return}if(n.id===r.id&&!(!t&&!Cs(n)))return n}var OM={};Se(OM,{NOSTR_URI_REGEX:()=>lh,parse:()=>CM,test:()=>NM});var lh=new RegExp(`nostr:(${C_.source})`);function NM(e){return typeof e=="string"&&new RegExp(`^${lh.source}$`).test(e)}function CM(e){const t=e.match(new RegExp(`^${lh.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:wc(t[1])}}var PM={};Se(PM,{finishReactionEvent:()=>LM,getReactedEventPointer:()=>UM});function LM(e,t,r){const n=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return hr({...e,kind:Xd,tags:[...e.tags??[],...n,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function UM(e){if(e.kind!==Xd)return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const o=e.tags[n];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(t===void 0||r===void 0))return{id:t[1],relays:[t[2],r[2]].filter(n=>n!==void 0),author:r[1]}}var zM={};Se(zM,{parse:()=>MM});var Uu=/\W/m,Rg=/[^\w\/] |[^\w\/]$|$|,| /m,BM=42;function*MM(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){const i=e.tags[s];i[0]==="emoji"&&i.length>=3&&t.push({type:"emoji",shortcode:i[1],url:i[2]})}e=e.content}const r=e.length;let n=0,o=0;e:for(;o<r;){const s=e.indexOf(":",o),i=e.indexOf("#",o);if(s===-1&&i===-1)break e;if(s===-1||i>=0&&i<s){if(i===0||e[i-1].match(Uu)){const a=e.slice(i+1,i+BM).match(Uu),c=a?i+1+a.index:r;yield{type:"text",text:e.slice(n,i)},yield{type:"hashtag",value:e.slice(i+1,c)},o=c,n=o;continue e}o=i+1;continue e}if(e.slice(s-5,s)==="nostr"){const a=e.slice(s+60).match(Uu),c=a?s+60+a.index:r;try{let u,{data:l,type:f}=wc(e.slice(s+1,c));switch(f){case"npub":u={pubkey:l};break;case"note":u={id:l};break;case"nsec":o=c+1;continue;default:u=l}n!==s-5&&(yield{type:"text",text:e.slice(n,s-5)}),yield{type:"reference",pointer:u},o=c,n=o;continue e}catch{o=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){const a=e.slice(s+4).match(Rg),c=a?s+4+a.index:r,u=e[s-1]==="s"?5:4;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(l.pathname)){yield{type:"image",url:l.toString()},o=c,n=o;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(l.pathname)){yield{type:"video",url:l.toString()},o=c,n=o;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(l.pathname)){yield{type:"audio",url:l.toString()},o=c,n=o;continue e}yield{type:"url",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){const a=e.slice(s+4).match(Rg),c=a?s+4+a.index:r,u=e[s-1]==="s"?3:2;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==s-u&&(yield{type:"text",text:e.slice(n,s-u)}),yield{type:"relay",url:l.toString()},o=c,n=o;continue e}catch{o=c+1;continue e}}else{for(let a=0;a<t.length;a++){const c=t[a];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){n!==s&&(yield{type:"text",text:e.slice(n,s)}),yield c,o=s+c.shortcode.length+2,n=o;continue e}}o=s+1;continue e}}n!==r&&(yield{type:"text",text:e.slice(n)})}var qM={};Se(qM,{channelCreateEvent:()=>jM,channelHideMessageEvent:()=>HM,channelMessageEvent:()=>FM,channelMetadataEvent:()=>DM,channelMuteUserEvent:()=>VM});var jM=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return hr({kind:S_,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},DM=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return hr({kind:x_,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},FM=(e,t)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),hr({kind:k_,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},HM=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return hr({kind:R_,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},VM=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return hr({kind:T_,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)},ZM={};Se(ZM,{EMOJI_SHORTCODE_REGEX:()=>eE,matchAll:()=>KM,regex:()=>fh,replaceAll:()=>GM});var eE=/:(\w+):/,fh=()=>new RegExp(`\\B${eE.source}\\B`,"g");function*KM(e){const t=e.matchAll(fh());for(const r of t)try{const[n,o]=r;yield{shortcode:n,name:o,start:r.index,end:r.index+n.length}}catch{}}function GM(e,t){return e.replaceAll(fh(),(r,n)=>t({shortcode:r,name:n}))}var WM={};Se(WM,{useFetchImplementation:()=>JM,validateGithub:()=>YM});var dh;try{dh=fetch}catch{}function JM(e){dh=e}async function YM(e,t,r){try{return await(await dh(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var XM={};Se(XM,{makeNwcRequestEvent:()=>eq,parseConnectionString:()=>QM});function QM(e){const{host:t,pathname:r,searchParams:n}=new URL(e),o=r||t,s=n.get("relay"),i=n.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function eq(e,t,r){const o=P_(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),s={kind:O_,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return hr(s,t)}var tq={};Se(tq,{normalizeIdentifier:()=>rq});function rq(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nq={};Se(nq,{getSatoshisAmountFromBolt11:()=>uq,getZapEndpoint:()=>sq,makeZapReceipt:()=>cq,makeZapRequest:()=>iq,useFetchImplementation:()=>oq,validateZapRequest:()=>aq});var hh;try{hh=fetch}catch{}function oq(e){hh=e}async function sq(e){try{let t="",{lud06:r,lud16:n}=JSON.parse(e.content);if(n){let[i,a]=n.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else if(r){let{words:i}=Lo.decode(r,1e3),a=Lo.fromWords(i);t=Cr.decode(a)}else return null;let s=await(await hh(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function iq(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),Wd(e.event.kind)){const r=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(r)}else if(Jd(e.event.kind)){let r=e.event.tags.find(([o,s])=>o==="d"&&s);if(!r)throw new Error("d tag not found or is empty");const n=["a",`${e.event.kind}:${e.event.pubkey}:${r[1]}`];t.tags.push(n)}t.tags.push(["k",e.event.kind.toString()])}return t}function aq(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Zd(t))return"Zap request is not a valid Nostr event.";if(!Cs(t))return"Invalid signature on zap request.";let r=t.tags.find(([s,i])=>s==="p"&&i);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=t.tags.find(([s,i])=>s==="e"&&i);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function cq({zapRequest:e,preimage:t,bolt11:r,paidAt:n}){let o=JSON.parse(e),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return t&&i.tags.push(["preimage",t]),i}function uq(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;const n=r.substring(4);if(n.length<1)return 0;const o=n[n.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9;let a=n.length-1;if(i&&a++,a<1)return 0;const c=parseInt(n.substring(0,a));switch(o){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var lq={};Se(lq,{Negentropy:()=>rE,NegentropyStorageVector:()=>hq,NegentropySync:()=>pq});var zu=97,$o=32,tE=16,On={Skip:0,Fingerprint:1,IdList:2},Ar=class{_raw;length;constructor(e){typeof e=="number"?(this._raw=new Uint8Array(e),this.length=0):e instanceof Uint8Array?(this._raw=new Uint8Array(e),this.length=e.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(e){if(e instanceof Ar&&(e=e.unwrap()),typeof e.length!="number")throw Error("bad length");const t=e.length+this.length;if(this.capacity<t){const r=this._raw,n=Math.max(this.capacity*2,t);this._raw=new Uint8Array(n),this._raw.set(r)}this._raw.set(e,this.length),this.length+=e.length}shift(){const e=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,e}shiftN(e=1){const t=this._raw.subarray(0,e);return this._raw=this._raw.subarray(e),this.length-=e,t}};function Ci(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let r=e.shift();if(t=t<<7|r&127,(r&128)===0)break}return t}function $r(e){if(e===0)return new Ar(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let r=0;r<t.length-1;r++)t[r]|=128;return new Ar(new Uint8Array(t))}function fq(e){return Ji(e,1)[0]}function Ji(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var dq=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array($o)}add(e){let t=0,r=0,n=new DataView(this.buf.buffer),o=new DataView(e.buffer);for(let s=0;s<8;s++){let i=s*4,a=n.getUint32(i,!0),c=o.getUint32(i,!0),u=a;u+=t,u+=c,u>4294967295&&(r=1),n.setUint32(i,u&4294967295,!0),t=r,r=0}}negate(){let e=new DataView(this.buf.buffer);for(let r=0;r<8;r++){let n=r*4;e.setUint32(n,~e.getUint32(n,!0))}let t=new Uint8Array($o);t[0]=1,this.add(t)}getFingerprint(e){let t=new Ar;return t.extend(this.buf),t.extend($r(e)),fr(t.unwrap()).subarray(0,tE)}},hq=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(e,t){if(this.sealed)throw Error("already sealed");const r=Ce(t);if(r.byteLength!==$o)throw Error("bad id size for added item");this.items.push({timestamp:e,id:r})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(Bu);for(let e=1;e<this.items.length;e++)if(Bu(this.items[e-1],this.items[e])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(e){if(this._checkSealed(),e>=this.items.length)throw Error("out of range");return this.items[e]}iterate(e,t,r){this._checkSealed(),this._checkBounds(e,t);for(let n=e;n<t&&r(this.items[n],n);++n);}findLowerBound(e,t,r){return this._checkSealed(),this._checkBounds(e,t),this._binarySearch(this.items,e,t,n=>Bu(n,r)<0)}fingerprint(e,t){let r=new dq;return r.setToZero(),this.iterate(e,t,n=>(r.add(n.id),!0)),r.getFingerprint(t-e)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(e,t){if(e>t||t>this.items.length)throw Error("bad range")}_binarySearch(e,t,r,n){let o=r-t;for(;o>0;){let s=t,i=Math.floor(o/2);s+=i,n(e[s])?(t=++s,o-=i+1):o=i}return t}},rE=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(e,t=6e4){if(t<4096)throw Error("frameSizeLimit too small");this.storage=e,this.frameSizeLimit=t,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(e,t){return{timestamp:e,id:t||new Uint8Array(0)}}initiate(){let e=new Ar;return e.extend(new Uint8Array([zu])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),e),we(e.unwrap())}reconcile(e,t,r){const n=new Ar(Ce(e));this.lastTimestampIn=this.lastTimestampOut=0;let o=new Ar;o.extend(new Uint8Array([zu]));let s=fq(n);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==zu)throw Error("unsupported negentropy protocol version requested: "+(s-96));let i=this.storage.size(),a=this._bound(0),c=0,u=!1;for(;n.length!==0;){let l=new Ar,f=()=>{u&&(u=!1,l.extend(this.encodeBound(a)),l.extend($r(On.Skip)))},h=this.decodeBound(n),p=Ci(n),g=c,m=this.storage.findLowerBound(c,i,h);if(p===On.Skip)u=!0;else if(p===On.Fingerprint){let d=Ji(n,tE),w=this.storage.fingerprint(g,m);nE(d,w)!==0?(f(),this.splitRange(g,m,h,l)):u=!0}else if(p===On.IdList){let d=Ci(n),w={};for(let y=0;y<d;y++){let v=Ji(n,$o);w[we(v)]=v}if(u=!0,this.storage.iterate(g,m,y=>{let v=y.id;const E=we(v);return w[E]?delete w[we(v)]:t?.(E),!0}),r)for(let y of Object.values(w))r(we(y))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(o.length+l.length)){let d=this.storage.fingerprint(m,i);o.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),o.extend($r(On.Fingerprint)),o.extend(d);break}else o.extend(l);c=m,a=h}return o.length===1?null:we(o.unwrap())}splitRange(e,t,r,n){let o=t-e,s=16;if(o<s*2)n.extend(this.encodeBound(r)),n.extend($r(On.IdList)),n.extend($r(o)),this.storage.iterate(e,t,i=>(n.extend(i.id),!0));else{let i=Math.floor(o/s),a=o%s,c=e;for(let u=0;u<s;u++){let l=i+(u<a?1:0),f=this.storage.fingerprint(c,c+l);c+=l;let h;if(c===t)h=r;else{let p,g;this.storage.iterate(c-1,c+1,(m,d)=>(d===c-1?p=m:g=m,!0)),h=this.getMinimalBound(p,g)}n.extend(this.encodeBound(h)),n.extend($r(On.Fingerprint)),n.extend(f)}}}exceededFrameSizeLimit(e){return e>this.frameSizeLimit-200}decodeTimestampIn(e){let t=Ci(e);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(e){let t=this.decodeTimestampIn(e),r=Ci(e);if(r>$o)throw Error("bound key too long");let n=Ji(e,r);return{timestamp:t,id:n}}encodeTimestampOut(e){if(e===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,$r(0);let t=e;return e-=this.lastTimestampOut,this.lastTimestampOut=t,$r(e+1)}encodeBound(e){let t=new Ar;return t.extend(this.encodeTimestampOut(e.timestamp)),t.extend($r(e.id.length)),t.extend(e.id),t}getMinimalBound(e,t){if(t.timestamp!==e.timestamp)return this._bound(t.timestamp);{let r=0,n=t.id,o=e.id;for(let s=0;s<$o&&n[s]===o[s];s++)r++;return this._bound(t.timestamp,t.id.subarray(0,r+1))}}};function nE(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function Bu(e,t){return e.timestamp===t.timestamp?nE(e.id,t.id):e.timestamp-t.timestamp}var pq=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(e,t,r,n={}){this.relay=e,this.storage=t,this.neg=new rE(t),this.onhave=n.onhave,this.onneed=n.onneed,this.filter=r,this.subscription=this.relay.prepareSubscription([{}],{label:n.label||"negentropy"}),this.subscription.oncustom=o=>{switch(o[0]){case"NEG-MSG":{o.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${o}`);try{const s=this.neg.reconcile(o[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),n.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),n?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{const s=o[2];console.warn("negentropy error:",s),n.onclose?.(s);break}case"NEG-ERR":n.onclose?.()}}}async start(){const e=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${e}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},mq={};Se(mq,{getToken:()=>gq,hashPayload:()=>ph,unpackEventFromToken:()=>sE,validateEvent:()=>fE,validateEventKind:()=>aE,validateEventMethodTag:()=>uE,validateEventPayloadTag:()=>lE,validateEventTimestamp:()=>iE,validateEventUrlTag:()=>cE,validateToken:()=>yq});var oE="Nostr ";async function gq(e,t,r,n=!1,o){const s={kind:eh,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",ph(o)]);const i=await r(s);return(n?oE:"")+yn.encode(Bt.encode(JSON.stringify(i)))}async function yq(e,t,r){const n=await sE(e).catch(s=>{throw s});return await fE(n,t,r).catch(s=>{throw s})}async function sE(e){if(!e)throw new Error("Missing token");e=e.replace(oE,"");const t=Cr.decode(yn.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function iE(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function aE(e){return e.kind===eh}function cE(e,t){const r=e.tags.find(n=>n[0]==="u");return r?r.length>0&&r[1]===t:!1}function uE(e,t){const r=e.tags.find(n=>n[0]==="method");return r?r.length>0&&r[1].toLowerCase()===t.toLowerCase():!1}function ph(e){const t=fr(Bt.encode(JSON.stringify(e)));return we(t)}function lE(e,t){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const n=ph(t);return r.length>0&&r[1]===n}async function fE(e,t,r,n){if(!Cs(e))throw new Error("Invalid nostr event, signature invalid");if(!aE(e))throw new Error("Invalid nostr event, kind invalid");if(!iE(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!cE(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!uE(e,r))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!lE(e,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Tg=30080,wq=["wss://relay.damus.io/","wss://nos.lol/","wss://nostr.mom/","wss://offchain.pub/","wss://relay.primal.net/","wss://nostr.wine/","wss://nostrelites.org/","wss://wot.nostr.party/"],vq=5e3;function bq(e){const t=atob(e),r=JSON.parse(t),n=Cs(r),o={rawEvent:r,isValid:n,workspacePubkeyHex:r.pubkey,workspaceNpub:_s.npubEncode(r.pubkey)},s=i=>{const a=_s.decode(i);if(a.type!=="npub")throw new Error(`Expected npub, got ${a.type}`);return a.data};for(const i of r.tags){const[a,c]=i;switch(a){case"server":o.serverNpub=c,o.serverPubkeyHex=s(c);break;case"workspace":o.workspaceNpub=c,o.workspacePubkeyHex=s(c);break;case"app":o.appNpub=c,o.appPubkeyHex=s(c);break;case"relay":o.relayUrl=c;break;case"invite":o.inviteId=c;break}}return o}class mh{constructor(t){this._pubkey=t,this.nip44={encrypt:async(r,n)=>{if(!window.nostr?.nip44?.encrypt)throw new Error("Extension does not support NIP-44 encryption");return window.nostr.nip44.encrypt(r,n)},decrypt:async(r,n)=>{if(!window.nostr?.nip44?.decrypt)throw new Error("Extension does not support NIP-44 decryption");return window.nostr.nip44.decrypt(r,n)}}}getPublicKey(){return Promise.resolve(this._pubkey)}async signEvent(t){return window.nostr.signEvent(t)}}async function _q(e){const{privateKeyHex:t,extensionPubkey:r,serverPubkeyHex:n,relays:o}=e;let s;if(t)s=new Nd(t),console.log("SuperBased: using PrivateKeySigner");else if(r&&window.nostr)s=new mh(r),console.log("SuperBased: using ExtensionSigner");else throw new Error("No signing method available");const i=new JR({name:"SuperbasedClient",version:"1.0.0"}),a=new Fe(o),c=new L8({serverPubkey:n,signer:s,relayHandler:a,isStateless:!0});i.connect(c).catch(l=>{console.error("SuperBased: connection error",l)}),await new Promise(l=>setTimeout(l,1500));async function u(l,f){const h=await i.callTool({name:l,arguments:{...f}});if(h.structuredContent)return h.structuredContent;const g=h.content?.find(m=>m.type==="text");if(g?.text)return JSON.parse(g.text);throw new Error("No valid response content")}return{async Health(l={}){return u("health",l)},async GetCredits(l={}){return u("get_credits",l)},async SyncRecords(l,f,h){return u("sync_records",{workspace_npub:l,app_npub:f,records:h})},async FetchRecords(l,f,h,p){return u("fetch_records",{workspace_npub:l,app_npub:f,collection:h,since:p})},async disconnect(){try{await c.close()}catch(l){console.error("SuperBased: disconnect error",l)}}}}const Ag="superbased_device_id";function dE(){let e=localStorage.getItem(Ag);return e||(e=crypto.randomUUID(),localStorage.setItem(Ag,e),console.log("SyncNotifier: generated new deviceId:",e)),e}class Eq{constructor(t){this.userPubkeyHex=t.userPubkeyHex,this.appNpub=t.appNpub,this.privateKeyHex=t.privateKeyHex,this.useExtension=t.useExtension,this.deviceId=dE(),this.signer=null,this.relayPool=null,this.stopSignal=new kt,this.subscription=null,this.lastPublishTime=0,this.onSyncNeeded=null,this.privateKeyHex?this.signer=new Nd(this.privateKeyHex):this.useExtension&&(this.signer=new mh(this.userPubkeyHex)),this.relayPool=new Fe(wq),console.log("SyncNotifier: initialized with deviceId:",this.deviceId)}async publish(){const t=Date.now();if(t-this.lastPublishTime<vq)return console.log("SyncNotifier: skipping publish (debounce)"),!1;this.lastPublishTime=t;try{const r={deviceId:this.deviceId,appNpub:this.appNpub,timestamp:t},n=await this.signer.nip44.encrypt(this.userPubkeyHex,JSON.stringify(r)),o={kind:Tg,created_at:Math.floor(t/1e3),tags:[["p",this.userPubkeyHex],["d",this.appNpub]],content:n},s=await this.signer.signEvent(o);return await this.relayPool.publish(s),console.log("SyncNotifier: published notification"),!0}catch(r){return console.error("SyncNotifier: publish failed:",r),!1}}startSubscription(t){if(this.subscription){console.log("SyncNotifier: already subscribed");return}this.onSyncNeeded=t;const r={kinds:[Tg],"#p":[this.userPubkeyHex],since:Math.floor(Date.now()/1e3)-300};console.log("SyncNotifier: starting subscription with filter:",r);const n=new Oe(o=>(this.relayPool.subscribe([r],s=>{o.next(s)},()=>{console.log("SyncNotifier: received EOSE")}),()=>{this.relayPool.unsubscribe()}));this.subscription=n.pipe(vo(this.stopSignal)).subscribe({next:async o=>{try{const s=await this.signer.nip44.decrypt(o.pubkey,o.content),i=JSON.parse(s);if(i.deviceId===this.deviceId){console.log("SyncNotifier: skipping own notification");return}if(i.appNpub!==this.appNpub){console.log("SyncNotifier: skipping different app notification");return}console.log("SyncNotifier: received sync notification from device:",i.deviceId),this.onSyncNeeded&&this.onSyncNeeded(i)}catch(s){console.error("SyncNotifier: failed to process event:",s)}},error:o=>{console.error("SyncNotifier: subscription error:",o)}})}stopSubscription(){this.subscription&&(this.stopSignal.next(),this.subscription.unsubscribe(),this.subscription=null,this.onSyncNeeded=null,console.log("SyncNotifier: stopped subscription"))}destroy(){this.stopSubscription()}}function $q(e){return new Eq(e)}const Cl=30081,hE=["wss://relay.damus.io/","wss://nos.lol/","wss://purplepag.es/","wss://relay.nostr.band/","wss://nostr.mom/"];class Sq{constructor(t){this.userPubkeyHex=t.userPubkeyHex,this.appNpub=t.appNpub,this.privateKeyHex=t.privateKeyHex,this.useExtension=t.useExtension,this.signer=null,this.relayPool=null,this.stopSignal=new kt,this.subscription=null,this.onDelegation=null,this.privateKeyHex?this.signer=new Nd(this.privateKeyHex):this.useExtension&&(this.signer=new mh(this.userPubkeyHex)),this.relayPool=new Fe(hE),console.log("DelegationNotifier: initialized for app:",this.appNpub)}_toHex(t){return t.startsWith("npub1")?_s.decode(t).data:t}async publishAssignment(t,r,n="assign"){try{const o=this._toHex(t),s=Date.now(),i={kind:Cl,created_at:Math.floor(s/1e3),tags:[["d",this.appNpub],["p",o],["record",r],["action",n]],content:""},a=await this.signer.signEvent(i);return await this.relayPool.publish(a),console.log(`DelegationNotifier: published ${n} notification for record ${r} to ${t.slice(0,15)}...`),!0}catch(o){return console.error("DelegationNotifier: publish failed:",o),!1}}async publishAssignments(t){const r=[];for(const{delegatePubkey:n,recordId:o,action:s}of t){const i=await this.publishAssignment(n,o,s||"assign");r.push({delegatePubkey:n,recordId:o,success:i})}return r}startSubscription(t){if(this.subscription){console.log("DelegationNotifier: already subscribed");return}this.onDelegation=t;const r={kinds:[Cl],"#p":[this.userPubkeyHex],since:Math.floor(Date.now()/1e3)-300};console.log("DelegationNotifier: starting subscription with filter:",r);const n=new Oe(o=>(this.relayPool.subscribe([r],s=>{o.next(s)},()=>{console.log("DelegationNotifier: received EOSE")}),()=>{this.relayPool.unsubscribe()}));this.subscription=n.pipe(vo(this.stopSignal)).subscribe({next:async o=>{try{const s=o.tags.find(u=>u[0]==="record")?.[1],i=o.tags.find(u=>u[0]==="action")?.[1]||"assign",a=o.tags.find(u=>u[0]==="d")?.[1],c=o.pubkey;console.log(`DelegationNotifier: received ${i} notification for record ${s} from ${c.slice(0,12)}...`),this.onDelegation&&this.onDelegation({action:i,recordId:s,appNpub:a,ownerPubkey:c,timestamp:o.created_at})}catch(s){console.error("DelegationNotifier: failed to process event:",s)}},error:o=>{console.error("DelegationNotifier: subscription error:",o)}})}stopSubscription(){this.subscription&&(this.stopSignal.next(),this.subscription.unsubscribe(),this.subscription=null,this.onDelegation=null,console.log("DelegationNotifier: stopped subscription"))}destroy(){this.stopSubscription()}}function xq(e){return new Sq(e)}window.SuperBasedSDK={createClient:_q,createSyncNotifier:$q,createDelegationNotifier:xq,parseToken:bq,verifyEvent:Cs,nip19:_s,bytesToHex:we,getDeviceId:dE,DELEGATION_NOTIFY_KIND:Cl,DELEGATION_RELAYS:hE};console.log("SuperBased SDK loaded");export{Oe as O,ve as c,ji as f,lt as i,Od as l,We as m,as as n,De as s};
